<!DOCTYPE html>
<html lang="en" class="no-js" data-color-scheme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- Enhanced SEO Meta Tags for American Audiences & AI-Friendly -->
    <title>🇺🇸 FinGuid - Home Loan Pro | AI-Powered Mortgage Calculator 2025 | Live Federal Reserve Rates</title>
    <meta name="description" content="FinGuid's Home Loan Pro - World's first AI-powered mortgage calculator with live FRED API rates, voice commands, perfect down payment sync, and real-time insights. Built for Americans by Americans.">
    <meta name="keywords" content="USA mortgage calculator 2025, AI mortgage calculator, FRED API rates, voice calculator, PMI calculator, FHA VA USDA loans, federal reserve data, American home loans, payment schedule">
    <meta name="author" content="FinGuid - World's First AI Calculators">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="en-US">
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    
    <!-- Enhanced Open Graph for Social Sharing -->
    <meta property="og:title" content="🇺🇸 FinGuid - Home Loan Pro | AI-Powered Mortgage Calculator 2025 - Live Federal Reserve Rates">
    <meta property="og:description" content="Calculate your perfect American home loan with live FRED rates, AI insights, voice commands, and perfect down payment synchronization. Trusted by millions of Americans.">
    <meta property="og:url" content="https://finguid.com/usa-mortgage">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="FinGuid - World's First AI Calculators">
    <meta property="og:image" content="https://finguid.com/images/usa-mortgage-calculator-og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="🇺🇸 FinGuid - Home Loan Pro | AI-Powered Mortgage Calculator 2025">
    <meta name="twitter:description" content="America's most advanced mortgage calculator with voice commands and live Federal Reserve rates">
    <meta name="twitter:image" content="https://finguid.com/images/usa-mortgage-calculator-twitter.jpg">
    <meta name="twitter:site" content="@FinGuidAI">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://finguid.com/usa-mortgage">
    
    <!-- Enhanced Icons and Theme -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/usa-mortgage-icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
    <link rel="manifest" href="/app.webmanifest">
    <meta name="theme-color" content="#218089" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#32b8c6" media="(prefers-color-scheme: dark)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="USA Mortgage Calculator">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.stlouisfed.org">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    
    <!-- Enhanced Fonts for Better Reading -->
    <link href="https://fonts.googleapis.com/css2?family=FKGroteskNeue:wght@400;500;550;600&family=Geist:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Chart.js for Enhanced Colorful Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js" defer></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NYBL2CDNQJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NYBL2CDNQJ');
    </script>
    
    <style>
        /* ========================================================================== */
        /* FINGUID - HOME LOAN PRO - AI-POWERED MORTGAGE CALCULATOR - ENHANCED CSS   */
        /* Perfect Light/Dark Mode Visibility, Payment Schedules, Working Features  */
        /* Layout: Left 29% | Middle 42% | Right 29% + Header Animation            */
        /* ALL IMPROVEMENTS IMPLEMENTED - PRODUCTION READY                         */
        /* ========================================================================== */

        :root {
            /* Enhanced Color System - Perfect Light/Dark Visibility */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-50: rgba(249, 250, 251, 1);
            --color-gray-100: rgba(243, 244, 246, 1);
            --color-gray-200: rgba(229, 231, 235, 1);
            --color-gray-300: rgba(209, 213, 219, 1);
            --color-gray-400: rgba(156, 163, 175, 1);
            --color-gray-500: rgba(107, 114, 128, 1);
            --color-gray-600: rgba(75, 85, 99, 1);
            --color-gray-700: rgba(55, 65, 81, 1);
            --color-gray-800: rgba(31, 41, 55, 1);
            --color-gray-900: rgba(17, 24, 39, 1);
            
            /* Enhanced Primary & Secondary Colors */
            --color-teal-50: rgba(240, 253, 250, 1);
            --color-teal-100: rgba(204, 251, 241, 1);
            --color-teal-200: rgba(153, 246, 228, 1);
            --color-teal-300: rgba(94, 234, 212, 1);
            --color-teal-400: rgba(45, 212, 191, 1);
            --color-teal-500: rgba(20, 184, 166, 1);
            --color-teal-600: rgba(13, 148, 136, 1);
            --color-teal-700: rgba(15, 118, 110, 1);
            --color-teal-800: rgba(17, 94, 89, 1);
            --color-teal-900: rgba(19, 78, 74, 1);
            
            /* USA Color Palette */
            --usa-blue: rgba(0, 47, 108, 1);
            --usa-red: rgba(179, 25, 66, 1);
            --usa-gold: rgba(255, 193, 7, 1);
            --usa-silver: rgba(192, 192, 192, 1);
            --usa-navy: rgba(0, 32, 91, 1);
            
            /* Enhanced Status Colors */
            --color-success-50: rgba(240, 253, 244, 1);
            --color-success-500: rgba(34, 197, 94, 1);
            --color-success-600: rgba(22, 163, 74, 1);
            --color-error-50: rgba(254, 242, 242, 1);
            --color-error-500: rgba(239, 68, 68, 1);
            --color-error-600: rgba(220, 38, 38, 1);
            --color-warning-50: rgba(255, 251, 235, 1);
            --color-warning-500: rgba(245, 158, 11, 1);
            --color-warning-600: rgba(217, 119, 6, 1);
            --color-info-50: rgba(239, 246, 255, 1);
            --color-info-500: rgba(59, 130, 246, 1);
            --color-info-600: rgba(37, 99, 235, 1);
            
            /* Light Mode Semantic Colors - Enhanced Visibility */
            --color-background: var(--color-gray-50);
            --color-surface: var(--color-white);
            --color-surface-secondary: var(--color-gray-100);
            --color-text: var(--color-gray-900);
            --color-text-secondary: var(--color-gray-600);
            --color-text-muted: var(--color-gray-500);
            --color-primary: var(--color-teal-600);
            --color-primary-hover: var(--color-teal-700);
            --color-primary-light: var(--color-teal-50);
            --color-border: var(--color-gray-300);
            --color-border-light: var(--color-gray-200);
            --color-border-strong: var(--color-gray-400);
            
            /* Enhanced Typography */
            --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
            
            /* Responsive Font Sizes with Working Controls */
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-size-5xl: 3rem;
            
            /* Font Scaling System for Working Font Controls */
            --font-scale: 1;
            --font-size-calculated-xs: calc(var(--font-size-xs) * var(--font-scale));
            --font-size-calculated-sm: calc(var(--font-size-sm) * var(--font-scale));
            --font-size-calculated-base: calc(var(--font-size-base) * var(--font-scale));
            --font-size-calculated-lg: calc(var(--font-size-lg) * var(--font-scale));
            --font-size-calculated-xl: calc(var(--font-size-xl) * var(--font-scale));
            --font-size-calculated-2xl: calc(var(--font-size-2xl) * var(--font-scale));
            --font-size-calculated-3xl: calc(var(--font-size-3xl) * var(--font-scale));
            --font-size-calculated-4xl: calc(var(--font-size-4xl) * var(--font-scale));
            
            /* Font Weights */
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            /* Spacing System */
            --space-px: 1px;
            --space-0-5: 0.125rem;
            --space-1: 0.25rem;
            --space-1-5: 0.375rem;
            --space-2: 0.5rem;
            --space-2-5: 0.625rem;
            --space-3: 0.75rem;
            --space-3-5: 0.875rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-7: 1.75rem;
            --space-8: 2rem;
            --space-9: 2.25rem;
            --space-10: 2.5rem;
            --space-11: 2.75rem;
            --space-12: 3rem;
            --space-14: 3.5rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            --space-28: 7rem;
            --space-32: 8rem;
            --space-36: 9rem;
            --space-40: 10rem;
            --space-44: 11rem;
            --space-48: 12rem;
            
            /* Border Radius */
            --radius-none: 0px;
            --radius-sm: 0.125rem;
            --radius-base: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Enhanced Shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            /* Animation & Transitions */
            --duration-75: 75ms;
            --duration-100: 100ms;
            --duration-150: 150ms;
            --duration-200: 200ms;
            --duration-300: 300ms;
            --duration-500: 500ms;
            --duration-700: 700ms;
            --duration-1000: 1000ms;
            
            --ease-linear: linear;
            --ease-in: cubic-bezier(0.4, 0, 1, 1);
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-back: cubic-bezier(0.34, 1.56, 0.64, 1);
            
            --transition-fast: var(--duration-150) var(--ease-out);
            --transition-normal: var(--duration-200) var(--ease-in-out);
            --transition-slow: var(--duration-300) var(--ease-in-out);
            
            /* Z-Index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* Dark Mode Theme - Enhanced Visibility */
        [data-color-scheme="dark"] {
            --color-background: var(--color-gray-900);
            --color-surface: var(--color-gray-800);
            --color-surface-secondary: var(--color-gray-700);
            --color-text: var(--color-gray-100);
            --color-text-secondary: var(--color-gray-400);
            --color-text-muted: var(--color-gray-500);
            --color-primary: var(--color-teal-400);
            --color-primary-hover: var(--color-teal-300);
            --color-primary-light: rgba(45, 212, 191, 0.1);
            --color-border: var(--color-gray-600);
            --color-border-light: var(--color-gray-700);
            --color-border-strong: var(--color-gray-500);
            
            /* Enhanced dark mode shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px -1px rgba(0, 0, 0, 0.4);
            --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px -1px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 8px 10px -6px rgba(0, 0, 0, 0.4);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Font Scale Classes for Working Font Controls */
        .font-scale-75 { --font-scale: 0.75; }
        .font-scale-87 { --font-scale: 0.875; }
        .font-scale-100 { --font-scale: 1; }
        .font-scale-112 { --font-scale: 1.125; }
        .font-scale-125 { --font-scale: 1.25; }

        /* Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        * {
            margin: 0;
        }

        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -moz-tab-size: 4;
            tab-size: 4;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: var(--font-family-primary);
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-normal);
            line-height: 1.5;
            color: var(--color-text);
            background-color: var(--color-background);
            min-height: 100vh;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Enhanced Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .skip-link {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            z-index: var(--z-modal);
            padding: var(--space-3) var(--space-6);
            background: var(--color-primary);
            color: var(--color-white);
            text-decoration: none;
            font-weight: var(--font-weight-semibold);
            border-radius: var(--radius-lg);
            transform: translateY(-200%);
            transition: transform var(--transition-fast);
        }

        .skip-link:focus {
            transform: translateY(0);
        }

        /* Enhanced Header with Animation */
        .site-header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            transition: all var(--transition-normal);
        }

        .site-header.scrolled {
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        [data-color-scheme="dark"] .site-header.scrolled {
            background: rgba(31, 41, 55, 0.95);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 4rem;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        /* Animated Header Middle Section */
        .header-middle {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-teal-700) 100%);
            color: var(--color-white);
            overflow: hidden;
            position: relative;
        }

        .hero-animation {
            animation: heroPulse 3s ease-in-out infinite, heroFloat 6s ease-in-out infinite;
        }

        @keyframes heroPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes heroFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header-middle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate var(--duration-1000) linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header-middle-content {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: var(--space-3) var(--space-4);
        }

        .tagline {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-2);
        }

        .features-quick {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .feature-quick {
            font-size: var(--font-size-calculated-sm);
            background: rgba(255, 255, 255, 0.15);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            backdrop-filter: blur(5px);
        }

        /* Enhanced Brand Section */
        .brand-section {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .logo-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--color-text);
            transition: transform var(--transition-fast);
        }

        .logo-link:hover {
            transform: translateY(-1px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .usa-flag {
            font-size: var(--font-size-calculated-2xl);
            animation: flag-wave var(--duration-1000) ease-in-out infinite;
        }

        @keyframes flag-wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-2deg); }
            75% { transform: rotate(2deg); }
        }

        .logo-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-0-5);
        }

        .logo-main {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            line-height: 1.2;
        }

        .logo-subtitle {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* Enhanced Navigation with Animation */
        .nav-links {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }

        .animated-nav {
            animation: slideInFromRight var(--duration-500) var(--ease-out);
        }

        @keyframes slideInFromRight {
            0% {
                transform: translateX(100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-calculated-sm);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
            position: relative;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--color-primary);
            transition: width var(--transition-fast);
        }

        .nav-link:hover::before {
            width: 100%;
        }

        .nav-link:hover {
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-1px);
        }

        /* Enhanced Accessibility Controls with Working Animations */
        .accessibility-controls {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }

        .animated-controls {
            animation: slideInFromLeft var(--duration-500) var(--ease-out) var(--duration-200);
        }

        @keyframes slideInFromLeft {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .accessibility-controls:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .font-controls {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding-right: var(--space-3);
            border-right: 1px solid var(--color-border);
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            min-width: 2.5rem;
            min-height: 2.5rem;
            padding: var(--space-2);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left var(--transition-normal);
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .control-btn:active {
            transform: translateY(-1px);
        }

        .control-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2);
        }

        /* Working Font Control Animations */
        .font-btn:hover .control-icon {
            animation: fontBounce var(--duration-500) ease-in-out;
        }

        @keyframes fontBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Working Theme Button Animation */
        .theme-btn.active .theme-icon,
        .theme-btn:hover .theme-icon {
            animation: themeRotate var(--duration-500) ease-in-out;
        }

        @keyframes themeRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Working Voice Button Animation */
        .voice-btn.active {
            animation: voicePulse var(--duration-1000) ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .voice-btn.active .voice-icon {
            animation: voiceWave var(--duration-1000) ease-in-out infinite;
        }

        @keyframes voiceWave {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Working Screen Reader Button Animation */
        .reader-btn.active .reader-icon {
            animation: readerBlink var(--duration-1000) ease-in-out infinite;
        }

        @keyframes readerBlink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        .control-icon,
        .control-label {
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-semibold);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 2rem;
            height: 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .hamburger {
            display: block;
            height: 3px;
            width: 100%;
            background: var(--color-text);
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
        }

        .hamburger:nth-child(1) { transform-origin: 0% 0%; }
        .hamburger:nth-child(2) { transform-origin: 0% 100%; }

        .mobile-menu-toggle:hover .hamburger {
            background: var(--color-primary);
        }

        /* Main Calculator Layout - Perfect 29-42-29 */
        .calculator-main {
            background: var(--color-background);
            min-height: 100vh;
        }

        .calculator-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-4);
            display: grid;
            grid-template-columns: 29% 42% 29%;
            gap: var(--space-6);
            align-items: start;
        }

        .input-section,
        .results-section,
        .sidebar-section {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-lg);
            padding: var(--space-6);
            transition: all var(--transition-normal);
        }

        .input-section:hover,
        .results-section:hover,
        .sidebar-section:hover {
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
            transform: translateY(-1px);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--color-border);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin: 0;
        }

        .section-icon {
            color: var(--color-primary);
            font-size: var(--font-size-calculated-lg);
        }

        .section-subtitle {
            color: var(--color-text-muted);
            font-size: var(--font-size-calculated-sm);
            margin: 0;
        }

        /* Enhanced Form Components */
        .form-section {
            margin-bottom: var(--space-8);
        }

        .subsection-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-5);
            padding: var(--space-4);
            background: linear-gradient(135deg, var(--color-primary-light), rgba(20, 184, 166, 0.05));
            border-radius: var(--radius-xl);
            border-left: 4px solid var(--color-primary);
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-bold);
            flex-shrink: 0;
        }

        .subsection-help {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-normal);
            font-style: italic;
        }

        .form-group {
            margin-bottom: var(--space-5);
        }

        .form-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .label-content {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-calculated-sm);
        }

        .label-icon {
            color: var(--color-primary);
            font-size: var(--font-size-calculated-base);
        }

        .label-help {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-normal);
            font-style: italic;
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .form-control {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-calculated-base);
            font-family: var(--font-family-primary);
            color: var(--color-text);
            background-color: var(--color-surface);
            transition: all var(--transition-fast);
            min-height: 3rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
            transform: translateY(-1px);
        }

        .form-control:hover:not(:focus) {
            border-color: var(--color-border-strong);
        }

        .form-control:read-only {
            background-color: var(--color-surface-secondary);
            cursor: not-allowed;
        }

        .input-prefix,
        .input-suffix {
            position: absolute;
            display: flex;
            align-items: center;
            height: calc(100% - 4px);
            padding: 0 var(--space-3);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-semibold);
            background: var(--color-surface-secondary);
            border: 2px solid var(--color-border);
            font-size: var(--font-size-calculated-sm);
            z-index: 1;
            pointer-events: none;
            top: 2px;
        }

        .input-prefix {
            left: 2px;
            border-right: none;
            border-radius: var(--radius-xl) 0 0 var(--radius-xl);
        }

        .input-suffix {
            right: 2px;
            border-left: none;
            border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
        }

        .input-group:has(.input-prefix) .form-control {
            padding-left: calc(var(--space-4) * 2.5);
        }

        .input-group:has(.input-suffix) .form-control {
            padding-right: calc(var(--space-4) * 2.5);
        }

        .help-text {
            display: block;
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-1);
        }

        /* Working Down Payment Synchronization */
        .percentage-input {
            margin-top: var(--space-2);
        }

        .percentage-chips {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-top: var(--space-3);
        }

        .percentage-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
            min-width: 4rem;
            min-height: 4rem;
            position: relative;
            overflow: hidden;
        }

        .percentage-chip::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(20, 184, 166, 0.1), transparent);
            transition: left var(--transition-normal);
        }

        .percentage-chip:hover::before {
            left: 100%;
        }

        .percentage-chip:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .percentage-chip.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
        }

        .chip-value {
            font-weight: var(--font-weight-bold);
            line-height: 1;
        }

        .chip-label {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
            margin-top: var(--space-1);
        }

        /* Credit Score Impact Display */
        .credit-impact {
            margin-top: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .credit-impact.positive {
            background: var(--color-success-50);
            color: var(--color-success-600);
            border: 1px solid var(--color-success-500);
        }

        .credit-impact.negative {
            background: var(--color-error-50);
            color: var(--color-error-600);
            border: 1px solid var(--color-error-500);
        }

        .credit-impact.neutral {
            background: var(--color-info-50);
            color: var(--color-info-600);
            border: 1px solid var(--color-info-500);
        }

        [data-color-scheme="dark"] .credit-impact.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--color-success-500);
        }

        [data-color-scheme="dark"] .credit-impact.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--color-error-500);
        }

        [data-color-scheme="dark"] .credit-impact.neutral {
            background: rgba(59, 130, 246, 0.15);
            color: var(--color-info-500);
        }

        /* Enhanced Interest Rate with Live FRED */
        .rate-info {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .live-rate-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-calculated-xs);
            padding: var(--space-1) var(--space-2);
            background: var(--color-success-500);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
        }

        .live-icon {
            animation: livePulse var(--duration-1000) ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .refresh-rate-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .refresh-rate-btn:hover {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: rotate(180deg);
        }

        .federal-attribution {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-2);
            font-style: italic;
        }

        /* Enhanced Loan Terms - 75% Size */
        .term-chips.compact-75 {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            transform: scale(0.75);
            transform-origin: left center;
        }

        .term-chip {
            flex: 1;
            min-width: 4.5rem;
            max-width: 6rem;
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            text-align: center;
            transition: all var(--transition-fast);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
        }

        .term-chip:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .term-chip.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.2);
        }

        .term-years {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
        }

        .term-label {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
        }

        .custom-term-group {
            margin-top: var(--space-4);
        }

        .custom-term-label {
            display: block;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        /* Half Size Loan Type Cards */
        .loan-type-section {
            background: linear-gradient(135deg, var(--color-primary-light), rgba(20, 184, 166, 0.03));
            padding: var(--space-6);
            border-radius: var(--radius-2xl);
            border: 1px solid var(--color-border);
            margin-bottom: var(--space-6);
        }

        .loan-type-grid.half-size {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            margin-top: var(--space-4);
            transform: scale(0.85);
            transform-origin: left top;
        }

        .loan-type-btn {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            text-align: left;
            transition: all var(--transition-fast);
            min-height: 6rem;
            position: relative;
            overflow: hidden;
        }

        .loan-type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left var(--transition-normal);
        }

        .loan-type-btn:hover::before {
            left: 100%;
        }

        .loan-type-btn:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .loan-type-btn.active {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
            color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .loan-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .loan-icon i {
            font-size: var(--font-size-calculated-lg);
            color: var(--color-primary);
        }

        .loan-content {
            flex: 1;
        }

        .loan-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-1);
        }

        .loan-description {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
        }

        /* Auto-Calculated PMI Status */
        .pmi-status {
            margin-top: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .pmi-status.active {
            background: var(--color-warning-50);
            color: var(--color-warning-600);
            border: 1px solid var(--color-warning-500);
        }

        .pmi-status.inactive {
            background: var(--color-success-50);
            color: var(--color-success-600);
            border: 1px solid var(--color-success-500);
        }

        [data-color-scheme="dark"] .pmi-status.active {
            background: rgba(245, 158, 11, 0.15);
            color: var(--color-warning-500);
        }

        [data-color-scheme="dark"] .pmi-status.inactive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--color-success-500);
        }

        .auto-update-notice {
            text-align: center;
            padding: var(--space-4);
            background: var(--color-info-50);
            border: 1px solid var(--color-info-500);
            border-radius: var(--radius-lg);
            color: var(--color-info-600);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            margin-top: var(--space-4);
        }

        [data-color-scheme="dark"] .auto-update-notice {
            background: rgba(59, 130, 246, 0.15);
            color: var(--color-info-500);
        }

        .closing-costs-display {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-2);
            flex-wrap: wrap;
        }

        .closing-costs-amount {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .closing-costs-note {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-style: italic;
        }

        /* Main Payment Display */
        .main-payment-card {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-teal-700) 100%);
            color: var(--color-white);
            padding: var(--space-6);
            border-radius: var(--radius-2xl);
            margin-bottom: var(--space-6);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .main-payment-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: paymentGlow var(--duration-1000) ease-in-out infinite;
        }

        @keyframes paymentGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .payment-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .loan-type-badge {
            background: rgba(255, 255, 255, 0.2);
            color: var(--color-white);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .payment-amount {
            position: relative;
            z-index: 1;
        }

        .payment-value {
            font-size: var(--font-size-calculated-4xl);
            font-weight: var(--font-weight-bold);
            display: block;
            margin-bottom: var(--space-2);
            line-height: 1.1;
        }

        .payment-breakdown {
            font-size: var(--font-size-calculated-lg);
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .breakdown-separator {
            margin: 0 var(--space-1);
            opacity: 0.7;
        }

        /* Payment Components Chart Section */
        .chart-section.payment-components {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .chart-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin: 0;
        }

        .chart-container {
            position: relative;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Colorful & Attractive Loan Summary */
        .loan-summary.colorful {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .summary-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-5);
        }

        .summary-icon {
            color: var(--color-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-4);
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border-radius: var(--radius-xl);
            border: 1px solid;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left var(--transition-normal);
        }

        .summary-item:hover::before {
            left: 100%;
        }

        .summary-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .summary-item.loan-amount {
            background: linear-gradient(135deg, var(--color-info-500), var(--color-teal-600));
            border-color: var(--color-info-500);
            color: var(--color-white);
        }

        .summary-item.total-interest {
            background: linear-gradient(135deg, var(--color-warning-500), var(--color-warning-600));
            border-color: var(--color-warning-500);
            color: var(--color-white);
        }

        .summary-item.total-cost {
            background: linear-gradient(135deg, var(--color-error-500), #e11d48);
            border-color: var(--color-error-500);
            color: var(--color-white);
        }

        .summary-item.payoff-date {
            background: linear-gradient(135deg, var(--color-success-500), #059669);
            border-color: var(--color-success-500);
            color: var(--color-white);
        }

        .summary-item.closing-costs {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-color: #8b5cf6;
            color: var(--color-white);
        }

        .summary-item .summary-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: var(--radius-xl);
            background: rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .summary-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .summary-label {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            opacity: 0.9;
        }

        .summary-value {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
        }

        /* Live Updating Loan Analysis */
        .loan-analysis-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .analysis-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        .chart-subtitle {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            text-align: center;
            margin-bottom: var(--space-5);
            font-family: var(--font-family-mono);
        }

        /* Working Year Selector */
        .year-selector-section {
            margin: var(--space-5) 0;
        }

        .year-selector-label {
            display: block;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            margin-bottom: var(--space-3);
        }

        .year-slider {
            width: 100%;
            height: var(--space-2);
            border-radius: var(--radius-full);
            background: var(--color-border);
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .year-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: var(--space-6);
            height: var(--space-6);
            border-radius: var(--radius-full);
            background: var(--color-primary);
            cursor: pointer;
            border: 3px solid var(--color-white);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .year-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-lg);
        }

        .year-slider::-moz-range-thumb {
            width: var(--space-6);
            height: var(--space-6);
            border-radius: var(--radius-full);
            background: var(--color-primary);
            cursor: pointer;
            border: 3px solid var(--color-white);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        /* Colorful Year Details */
        .year-details.colorful {
            text-align: center;
            margin: var(--space-4) 0;
        }

        .year-title {
            font-size: var(--font-size-calculated-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-4);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border-radius: var(--radius-xl);
            border: 1px solid;
            transition: all var(--transition-fast);
        }

        .detail-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .detail-item.principal-paid {
            background: linear-gradient(135deg, var(--color-success-500), #059669);
            border-color: var(--color-success-500);
            color: var(--color-white);
        }

        .detail-item.interest-paid {
            background: linear-gradient(135deg, var(--color-warning-500), var(--color-warning-600));
            border-color: var(--color-warning-500);
            color: var(--color-white);
        }

        .detail-item.remaining-balance {
            background: linear-gradient(135deg, var(--color-info-500), var(--color-teal-600));
            border-color: var(--color-info-500);
            color: var(--color-white);
        }

        .detail-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius-xl);
            background: rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .detail-content {
            flex: 1;
            text-align: left;
        }

        .detail-label {
            display: block;
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            opacity: 0.9;
            margin-bottom: var(--space-1);
        }

        .detail-value {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
        }

        /* Enhanced Payment Schedule with Monthly/Yearly Options */
        .payment-schedule-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .schedule-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .schedule-icon {
            color: var(--color-primary);
        }

        .schedule-options {
            display: flex;
            gap: var(--space-1);
            background: var(--color-surface-secondary);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }

        .schedule-btn {
            padding: var(--space-2) var(--space-4);
            border: none;
            border-radius: var(--radius-md);
            background: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .schedule-btn:hover {
            color: var(--color-text);
        }

        .schedule-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: var(--shadow-sm);
        }

        .schedule-container {
            margin-top: var(--space-4);
        }

        .schedule-table-wrapper {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-calculated-sm);
        }

        .schedule-table th {
            background: var(--color-surface-secondary);
            color: var(--color-text);
            font-weight: var(--font-weight-semibold);
            text-align: left;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border);
        }

        .schedule-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-light);
            color: var(--color-text);
        }

        .schedule-table tbody tr:hover {
            background: var(--color-surface-secondary);
        }

        .schedule-loading {
            text-align: center;
            padding: var(--space-8);
            color: var(--color-text-muted);
            font-style: italic;
        }

        .schedule-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-calculated-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn:not(:disabled):hover {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-info {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* AI-Powered Insights */
        .ai-insights-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .insights-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-5);
        }

        .insights-icon {
            color: var(--color-primary);
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-calculated-xs);
            padding: var(--space-1) var(--space-2);
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
            animation: aiPulse var(--duration-1000) ease-in-out infinite alternate;
        }

        @keyframes aiPulse {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .insights-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .insight-item {
            padding: var(--space-4);
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-primary);
            transition: all var(--transition-fast);
        }

        .insight-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .insight-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .insight-text {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text);
            line-height: 1.6;
        }

        /* Universal Sharing Options */
        .sharing-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .sharing-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-4);
        }

        .sharing-icon {
            color: var(--color-primary);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            border: 2px solid;
            min-height: 3rem;
        }

        .action-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .action-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .action-btn.secondary:hover {
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Sponsor Section Styles */
        .partner-showcase {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .partner-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            transition: all var(--transition-fast);
        }

        .partner-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary);
        }

        .partner-card.featured {
            background: linear-gradient(135deg, var(--color-primary-light), rgba(20, 184, 166, 0.05));
            border-color: var(--color-primary);
        }

        .partner-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .partner-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .partner-icon {
            font-size: var(--font-size-calculated-lg);
            color: var(--color-primary);
        }

        .partner-info {
            flex: 1;
        }

        .partner-name {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-1);
        }

        .partner-rating {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .rating-stars {
            color: var(--color-warning-500);
        }

        .rating-text {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
        }

        .partner-rates {
            margin-bottom: var(--space-4);
        }

        .rate-display {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            padding: var(--space-3);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .rate-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .rate-value {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .rate-apr {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
        }

        .partner-cta {
            width: 100%;
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .partner-cta.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .partner-cta.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        .partner-cta.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .partner-cta.secondary:hover {
            background: var(--color-primary-light);
            transform: translateY(-1px);
        }

        /* Market Insights */
        .market-insights {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .market-stats {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .market-stat {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .stat-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
            display: block;
        }

        .stat-value {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .stat-change {
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            margin-left: var(--space-2);
        }

        .stat-change.positive {
            color: var(--color-success-500);
        }

        .stat-change.negative {
            color: var(--color-error-500);
        }

        .stat-change.neutral {
            color: var(--color-text-muted);
        }

        /* Advertisement Space */
        .ad-space {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
        }

        .ad-container {
            text-align: center;
        }

        .ad-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            text-transform: uppercase;
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
        }

        .ad-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        .ad-description {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-4);
            line-height: 1.5;
        }

        .ad-cta {
            width: 100%;
            padding: var(--space-3);
            background: var(--color-primary);
            color: var(--color-white);
            border: 2px solid var(--color-primary);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .ad-cta:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Voice Modal and Overlays */
        .voice-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .voice-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
            animation: modalSlideIn var(--duration-300) ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .voice-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-border);
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .modal-icon {
            color: var(--color-primary);
        }

        .modal-close-btn {
            width: 2.5rem;
            height: 2.5rem;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }

        .modal-close-btn:hover {
            background: var(--color-surface-secondary);
            color: var(--color-text);
        }

        .voice-modal-body {
            padding: var(--space-6);
        }

        .voice-instructions {
            color: var(--color-text);
        }

        .instructions-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-4);
        }

        .command-category {
            margin-bottom: var(--space-4);
        }

        .category-title {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
        }

        .command-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .command-list li {
            padding: var(--space-2) 0;
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border);
        }

        .command-list li:last-child {
            border-bottom: none;
        }

        .voice-modal-footer {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-6);
            border-top: 1px solid var(--color-border);
        }

        .modal-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .modal-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .modal-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
        }

        .modal-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .modal-btn.secondary:hover {
            background: var(--color-primary-light);
        }

        /* Enhanced Footer */
        .site-footer {
            background: linear-gradient(135deg, var(--usa-navy) 0%, var(--usa-blue) 100%);
            color: var(--color-white);
            padding: var(--space-16) 0 var(--space-8);
            margin-top: var(--space-16);
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--space-12);
            margin-bottom: var(--space-12);
        }

        .footer-brand {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .footer-logo-text {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .footer-brand-name {
            font-size: var(--font-size-calculated-xl);
            font-weight: var(--font-weight-bold);
        }

        .footer-brand-tagline {
            font-size: var(--font-size-calculated-sm);
            opacity: 0.9;
        }

        .footer-description {
            font-size: var(--font-size-calculated-sm);
            line-height: 1.6;
            opacity: 0.9;
        }

        .footer-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-8);
        }

        .footer-column h4 {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-4);
        }

        .footer-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-column ul li {
            margin-bottom: var(--space-2);
        }

        .footer-column ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: var(--font-size-calculated-sm);
            transition: color var(--transition-fast);
        }

        .footer-column ul li a:hover {
            color: var(--color-white);
            text-decoration: underline;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: var(--space-8);
            text-align: center;
        }

        .footer-disclaimer {
            margin-bottom: var(--space-6);
        }

        .footer-disclaimer p {
            font-size: var(--font-size-calculated-xs);
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: var(--space-3);
        }

        .footer-copyright {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .copyright-left p {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
            margin: 0 0 var(--space-1) 0;
        }

        .footer-badges {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .badge {
            font-size: var(--font-size-calculated-xs);
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
        }

        /* Loading Indicator */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-4);
            background: var(--color-surface);
            padding: var(--space-8);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: var(--radius-full);
            animation: spin var(--duration-1000) linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: var(--font-size-calculated-base);
            color: var(--color-text);
            font-weight: var(--font-weight-medium);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .toast {
            padding: var(--space-4) var(--space-6);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            max-width: 400px;
            animation: toastSlideIn var(--transition-normal) ease-out;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-info-500);
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success::before {
            background: var(--color-success-500);
        }

        .toast.error::before {
            background: var(--color-error-500);
        }

        .toast.warning::before {
            background: var(--color-warning-500);
        }

        .toast.info::before {
            background: var(--color-info-500);
        }

        .toast-message {
            flex: 1;
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-base);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-close:hover {
            background: var(--color-surface-secondary);
            color: var(--color-text);
        }

        /* Voice Status Indicator */
        .voice-status {
            position: fixed;
            top: var(--space-20);
            right: var(--space-4);
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .voice-status.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-status-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--color-error-500);
            color: var(--color-white);
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-lg);
            animation: voicePulseStatus var(--duration-1000) ease-in-out infinite;
        }

        @keyframes voicePulseStatus {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .voice-status-icon {
            animation: voiceWave var(--duration-1000) ease-in-out infinite;
        }

        .voice-status-text {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
        }

        .voice-status-close {
            background: none;
            border: none;
            color: var(--color-white);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-base);
            transition: all var(--transition-fast);
        }

        .voice-status-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Screen Reader Mode */
        .screen-reader-mode {
            font-size: 1.2em !important;
            line-height: 1.8 !important;
            letter-spacing: 0.05em !important;
        }

        .screen-reader-mode * {
            animation: none !important;
            transition: none !important;
        }

        /* Responsive Design - Enhanced */
        @media (max-width: 1279px) {
            .calculator-container {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .header-middle-content {
                padding: var(--space-2) var(--space-4);
            }
            
            .tagline {
                font-size: var(--font-size-calculated-base);
            }
            
            .features-quick {
                justify-content: center;
                gap: var(--space-2);
            }
        }

        @media (max-width: 1023px) {
            .header-container {
                min-height: 3.5rem;
                flex-wrap: wrap;
            }
            
            .nav-links {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .term-chips.compact-75 {
                transform: scale(0.85);
                grid-template-columns: repeat(2, 1fr);
            }
            
            .loan-type-grid.half-size {
                grid-template-columns: 1fr;
                transform: scale(1);
            }
            
            .summary-grid,
            .details-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: var(--space-8);
            }
            
            .footer-links {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 767px) {
            .calculator-container {
                padding: var(--space-6) var(--space-3);
            }
            
            .input-section,
            .results-section,
            .sidebar-section {
                padding: var(--space-5);
            }
            
            .payment-value {
                font-size: var(--font-size-calculated-3xl);
            }
            
            .payment-breakdown {
                flex-direction: column;
                gap: var(--space-1);
            }
            
            .summary-grid,
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .voice-modal-content {
                width: 95%;
            }
            
            .voice-modal-footer {
                flex-direction: column;
            }
            
            .footer-links {
                grid-template-columns: 1fr;
            }
            
            .footer-copyright {
                flex-direction: column;
                text-align: center;
            }
            
            .percentage-chips {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .schedule-title {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .accessibility-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .font-controls {
                border-right: none;
                padding-right: var(--space-2);
                border-bottom: 1px solid var(--color-border);
                padding-bottom: var(--space-2);
                margin-bottom: var(--space-2);
            }
        }

        @media (max-width: 479px) {
            .header-container {
                padding: 0 var(--space-2);
            }
            
            .calculator-container {
                padding: var(--space-4) var(--space-2);
            }
            
            .input-section,
            .results-section,
            .sidebar-section {
                padding: var(--space-4);
            }
            
            .voice-modal-content {
                margin: var(--space-4);
                width: calc(100% - 2rem);
            }
            
            .toast-container {
                left: var(--space-2);
                right: var(--space-2);
            }
            
            .toast {
                max-width: none;
            }
        }

        /* Print Styles */
        @media print {
            * {
                background: var(--color-white) !important;
                color: var(--color-black) !important;
                box-shadow: none !important;
            }
            
            .accessibility-controls,
            .voice-modal,
            .sharing-section,
            .sidebar-section,
            .loading-overlay,
            .toast-container,
            .voice-status {
                display: none !important;
            }
            
            .calculator-container {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-4);
            }
            
            .site-header,
            .header-middle {
                position: static;
                box-shadow: none;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --color-border: var(--color-black);
                --color-border-strong: var(--color-black);
            }
            
            .control-btn {
                border-width: 3px;
            }
            
            .form-control {
                border-width: 3px;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Focus Styles for Better Accessibility */
        *:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .control-btn:focus {
            outline-color: var(--color-primary);
            outline-width: 3px;
        }

        .form-control:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.3);
        }

        /* Utility Classes */
        .highlight-update {
            animation: highlightFlash var(--duration-700) ease-out;
        }

        @keyframes highlightFlash {
            0% { background-color: rgba(20, 184, 166, 0.3); }
            100% { background-color: transparent; }
        }

        .animate-bounce {
            animation: bounce var(--duration-500) ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade-in {
            animation: fadeIn var(--duration-300) ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .focus-within {
            border-color: var(--color-primary) !important;
            box-shadow: 0 0 0 1px rgba(20, 184, 166, 0.1) !important;
        }

        /* NEW: State Dropdown Styles */
        .state-dropdown-container {
            margin-bottom: var(--space-4);
        }

        .state-tax-info {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-2);
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
        }

        .tax-rate, .insurance-rate {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .rate-value {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        /* NEW: Tab System Styles */
        .results-tabs {
            display: flex;
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            white-space: nowrap;
            min-width: 120px;
        }

        .tab-btn:hover {
            color: var(--color-text);
        }

        .tab-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn var(--duration-300) ease-out;
        }

        /* NEW: Screen Reader Button */
        .screen-reader-btn {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: var(--z-tooltip);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            height: 3.5rem;
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .screen-reader-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        .screen-reader-btn.active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(20, 184, 166, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(20, 184, 166, 0); }
            100% { box-shadow: 0 0 0 0 rgba(20, 184, 166, 0); }
        }

        /* NEW: Loan Comparison Modal */
        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .comparison-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .comparison-modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            max-width: 1000px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
            animation: modalSlideIn var(--duration-300) ease-out;
        }

        .comparison-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-border);
        }

        .comparison-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .comparison-body {
            padding: var(--space-6);
        }

        .comparison-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .scenario-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            transition: all var(--transition-fast);
        }

        .scenario-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary);
        }

        .scenario-card.featured {
            background: linear-gradient(135deg, var(--color-primary-light), rgba(20, 184, 166, 0.05));
            border-color: var(--color-primary);
        }

        .scenario-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .scenario-name {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .scenario-badge {
            font-size: var(--font-size-calculated-xs);
            background: var(--color-primary);
            color: var(--color-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
        }

        .scenario-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .scenario-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--color-border-light);
        }

        .detail-label {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
        }

        .detail-value {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .detail-value.highlight {
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        .scenario-actions {
            margin-top: var(--space-4);
        }

        .scenario-btn {
            width: 100%;
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .scenario-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .scenario-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
        }

        .scenario-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .scenario-btn.secondary:hover {
            background: var(--color-primary-light);
        }

        .comparison-footer {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-6);
            border-top: 1px solid var(--color-border);
        }

        /* ========================================================================== */
        /* END OF FINGUID - HOME LOAN PRO - AI-POWERED MORTGAGE CALCULATOR - ENHANCED CSS */
        /* ALL IMPROVEMENTS IMPLEMENTED - PERFECT VISIBILITY & ANIMATIONS            */
        /* Layout: Left 29% | Middle 42% | Right 29% - PRODUCTION READY             */
        /* ========================================================================== */
    </style>
</head>

<body class="font-adjustable" data-color-scheme="light">
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#calculator-inputs" class="skip-link">Skip to calculator</a>

    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="sr-status" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

    <!-- Enhanced Header with Animation -->
    <header class="site-header animated-header" role="banner">
        <div class="header-container">
            <!-- Enhanced USA Brand -->
            <div class="brand-section">
                <a href="#" class="logo-link" aria-label="FinGuid - World's First AI Calculators">
                    <div class="logo-container">
                        <span class="usa-flag" role="img" aria-label="USA Flag">🇺🇸</span>
                        <div class="logo-content">
                            <div class="logo-main">FinGuid</div>
                            <div class="logo-subtitle">World's First AI Calculators</div>
                        </div>
                    </div>
                </a>
            </div>
            
            <!-- Animated Navigation Links -->
            <nav class="nav-links animated-nav" role="navigation" aria-label="Main navigation">
                <a href="#features" class="nav-link">Features</a>
                <a href="#how-it-works" class="nav-link">How It Works</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#contact" class="nav-link">Contact</a>
            </nav>
            
            <!-- Enhanced Accessibility Controls with Working Animations -->
            <div class="accessibility-controls animated-controls" id="accessibility-controls" role="toolbar" aria-label="Accessibility Controls">
                <!-- Working Font Controls -->
                <div class="font-controls" role="group" aria-label="Font Size Controls">
                    <button type="button" class="control-btn font-btn active" id="font-decrease" 
                            aria-label="Decrease font size" title="Make text smaller"
                            onclick="adjustFontSize('decrease')">
                        <span class="control-icon" aria-hidden="true">-A-</span>
                    </button>
                    <button type="button" class="control-btn font-btn" id="font-reset" 
                            aria-label="Reset font size" title="Reset text size"
                            onclick="adjustFontSize('reset')">
                        <span class="control-icon" aria-hidden="true">Aa</span>
                    </button>
                    <button type="button" class="control-btn font-btn" id="font-increase" 
                            aria-label="Increase font size" title="Make text larger"
                            onclick="adjustFontSize('increase')">
                        <span class="control-icon" aria-hidden="true">+A+</span>
                    </button>
                </div>
                
                <!-- Working Theme Toggle with Animation -->
                <button type="button" class="control-btn theme-btn" id="theme-toggle" 
                        aria-label="Toggle dark mode" title="Switch between light and dark theme"
                        onclick="toggleTheme()">
                    <i class="fas fa-moon theme-icon" aria-hidden="true"></i>
                    <span class="control-label">Dark</span>
                </button>
                
                <!-- Working Voice Control -->
                <button type="button" class="control-btn voice-btn" id="voice-toggle" 
                        aria-label="Toggle voice control" title="Enable voice commands"
                        onclick="toggleVoiceControl()">
                    <i class="fas fa-microphone voice-icon" aria-hidden="true"></i>
                    <span class="control-label">Voice</span>
                </button>
                
                <!-- Working Screen Reader Mode -->
                <button type="button" class="control-btn reader-btn" id="screen-reader-toggle" 
                        aria-label="Toggle screen reader mode" title="Enhanced screen reader mode"
                        onclick="toggleScreenReaderMode()">
                    <i class="fas fa-eye reader-icon" aria-hidden="true"></i>
                    <span class="control-label">Reader</span>
                </button>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
        </div>
        
        <!-- Animated Middle Section -->
        <div class="header-middle hero-animation">
            <div class="header-middle-content">
                <div class="tagline">Home Loan Pro — Mortgage Calculator (AI‑Powered)</div>
                <div class="features-quick">
                    <span class="feature-quick">Live FRED Data</span>
                    <span class="feature-quick">Voice Commands</span>
                    <span class="feature-quick">AI Insights</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Calculator Container with Perfect 29-42-29 Layout -->
    <main id="main-content" class="calculator-main" role="main">
        <div class="calculator-container">
            
            <!-- Left Section: Input Values (29%) -->
            <section class="input-section" role="form" aria-labelledby="input-section-title" id="calculator-inputs">
                <div class="section-header">
                    <h2 class="section-title" id="input-section-title">
                        <i class="fas fa-home section-icon" aria-hidden="true"></i>
                        USA Loan Details
                    </h2>
                    <div class="section-subtitle">Enter your American home loan information</div>
                </div>

                <!-- Primary Information -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">1</span>
                        Primary Information
                    </h3>

                    <!-- Home Price -->
                    <div class="form-group">
                        <label for="home-price" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-dollar-sign label-icon" aria-hidden="true"></i>
                                Home Price
                            </span>
                            <span class="label-help">Average US home: $428,700</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="home-price" class="form-control" value="450,000" 
                                   aria-describedby="home-price-help" placeholder="450,000"
                                   oninput="updateCalculation()">
                        </div>
                        <small id="home-price-help" class="help-text">Property tax varies by location and is typically 0.5% to 2.5% of home value</small>
                    </div>

                    <!-- Enhanced Down Payment with Perfect Synchronization -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-content">
                                <i class="fas fa-piggy-bank label-icon" aria-hidden="true"></i>
                                Down Payment
                            </span>
                            <span class="label-help">Perfect sync between % and $ amounts</span>
                        </label>
                        
                        <!-- Dollar Amount -->
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="down-payment" class="form-control" value="90,000" 
                                   aria-label="Down payment in dollars" placeholder="90,000"
                                   oninput="syncDownPaymentDollar()">
                        </div>

                        <!-- Percentage Input -->
                        <div class="input-group percentage-input">
                            <input type="number" id="down-payment-percent" class="form-control" 
                                   min="0" max="100" step="0.1" value="20" 
                                   aria-label="Down payment as percentage" placeholder="20"
                                   oninput="syncDownPaymentPercent()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>

                        <!-- Working Percentage Chips -->
                        <div class="percentage-chips" role="group" aria-label="Quick down payment percentages">
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(3.5, event)" 
                                    aria-label="3.5 percent down payment">
                                <span class="chip-value">3.5%</span>
                                <span class="chip-label">FHA Min</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(5, event)"
                                    aria-label="5 percent down payment">
                                <span class="chip-value">5%</span>
                                <span class="chip-label">Conv Min</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(10, event)"
                                    aria-label="10 percent down payment">
                                <span class="chip-value">10%</span>
                                <span class="chip-label">Good</span>
                            </button>
                            <button type="button" class="percentage-chip active" onclick="setDownPaymentChip(20, event)"
                                    aria-label="20 percent down payment">
                                <span class="chip-value">20%</span>
                                <span class="chip-label">No PMI</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(25, event)"
                                    aria-label="25 percent down payment">
                                <span class="chip-value">25%</span>
                                <span class="chip-label">Excellent</span>
                            </button>
                        </div>
                    </div>

                    <!-- NEW: State Dropdown with Tax and Insurance Rates -->
                    <div class="form-group state-dropdown-container">
                        <label for="state-select" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-map-marker-alt label-icon" aria-hidden="true"></i>
                                State
                            </span>
                            <span class="label-help">Auto-calculates tax & insurance</span>
                        </label>
                        <select id="state-select" class="form-control" onchange="updateStateRates()">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA" selected>California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                        <div class="state-tax-info">
                            <div class="tax-rate">
                                <span>Property Tax Rate:</span>
                                <span class="rate-value" id="property-tax-rate">0.76%</span>
                            </div>
                            <div class="insurance-rate">
                                <span>Insurance Rate:</span>
                                <span class="rate-value" id="insurance-rate">0.60%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Credit Score with Rate Impact -->
                    <div class="form-group">
                        <label for="credit-score" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-chart-line label-icon" aria-hidden="true"></i>
                                Credit Score
                            </span>
                            <span class="label-help" id="rate-impact-text">Affects your interest rate</span>
                        </label>
                        <select id="credit-score" class="form-control" aria-describedby="credit-impact"
                                onchange="updateRateFromCredit()">
                            <option value="580">Poor (580 or below) - Higher rates</option>
                            <option value="630">Fair (580-669) - Standard rates</option>
                            <option value="700" selected>Good (670-739) - Competitive rates</option>
                            <option value="780">Very Good (740-799) - Better rates</option>
                            <option value="820">Excellent (800+) - Best rates</option>
                        </select>
                        <div id="credit-impact" class="credit-impact" aria-live="polite"></div>
                    </div>

                    <!-- Enhanced Interest Rate with Live FRED Integration -->
                    <div class="form-group">
                        <label for="interest-rate" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-percentage label-icon" aria-hidden="true"></i>
                                Interest Rate
                            </span>
                            <div class="rate-info">
                                <span class="live-rate-badge">
                                    <i class="fas fa-wifi live-icon" aria-hidden="true"></i>
                                    Live FRED Rate
                                </span>
                                <button type="button" class="refresh-rate-btn" id="refresh-rate" 
                                        title="Refresh live rate from Federal Reserve"
                                        aria-label="Refresh live rate"
                                        onclick="refreshLiveRate()">
                                    <i class="fas fa-sync-alt" aria-hidden="true"></i>
                                </button>
                            </div>
                        </label>
                        <div class="input-group">
                            <input type="number" id="interest-rate" class="form-control" value="6.44" 
                                   min="0.1" max="20" step="0.01" 
                                   aria-describedby="fred-attribution" placeholder="6.44"
                                   oninput="updateCalculation()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>
                        <div id="fred-attribution" class="federal-attribution">
                            <small>Source: Federal Reserve Economic Data (FRED), Federal Reserve Bank of St. Louis</small>
                        </div>
                    </div>

                    <!-- Enhanced Loan Term - 75% Size with 4 Terms -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-content">
                                <i class="fas fa-calendar-alt label-icon" aria-hidden="true"></i>
                                Loan Term
                            </span>
                            <span class="label-help">Choose preset or enter custom term</span>
                        </label>
                        
                        <!-- 75% Size Chips -->
                        <div class="term-chips compact-75" role="group" aria-label="Loan term options">
                            <button type="button" class="term-chip" data-term="10" onclick="selectTerm(10, event)">
                                <span class="term-years">10</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip" data-term="15" onclick="selectTerm(15, event)">
                                <span class="term-years">15</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip" data-term="20" onclick="selectTerm(20, event)">
                                <span class="term-years">20</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip active" data-term="30" onclick="selectTerm(30, event)">
                                <span class="term-years">30</span>
                                <span class="term-label">Years</span>
                            </button>
                        </div>

                        <!-- Custom Term Input -->
                        <div class="custom-term-group">
                            <label for="custom-term" class="custom-term-label">Custom Term (5-40 years)</label>
                            <div class="input-group">
                                <input type="number" id="custom-term" class="form-control" 
                                       min="5" max="40" placeholder="Enter years"
                                       aria-label="Custom loan term in years"
                                       oninput="selectCustomTerm()">
                                <span class="input-suffix" aria-hidden="true">Years</span>
                            </div>
                        </div>
                    </div>

                    <!-- Half Size Loan Type Cards -->
                    <div class="loan-type-section">
                        <h3 class="subsection-title">
                            <span class="step-number">🏦</span>
                            Loan Type
                            <span class="subsection-help">Choose the best loan program</span>
                        </h3>
                        
                        <div class="loan-type-grid half-size" role="group" aria-label="Loan type options">
                            <button type="button" class="loan-type-btn active" data-loan-type="conventional" 
                                    onclick="selectLoanType('conventional', event)" aria-pressed="true">
                                <div class="loan-icon">
                                    <i class="fas fa-university" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">Conventional</h4>
                                    <p class="loan-description">Best rates for good credit</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="fha" 
                                    onclick="selectLoanType('fha', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-home" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">FHA</h4>
                                    <p class="loan-description">First-time buyer friendly</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="va" 
                                    onclick="selectLoanType('va', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-medal" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">VA</h4>
                                    <p class="loan-description">For military & veterans</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="usda" 
                                    onclick="selectLoanType('usda', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-tractor" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">USDA</h4>
                                    <p class="loan-description">For eligible rural areas</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">2</span>
                        Property & Insurance Details
                    </h3>

                    <div class="form-group">
                        <label for="property-tax" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-receipt label-icon" aria-hidden="true"></i>
                                Property Tax (Annual)
                            </span>
                            <span class="label-help">Varies by location 0.5% to 2.5%</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="property-tax" class="form-control" value="9,000" 
                                   placeholder="9,000" oninput="updateCalculation()">
                        </div>
                        <small class="help-text">Property tax varies by location and is typically 0.5% to 2.5% of home value</small>
                    </div>

                    <div class="form-group">
                        <label for="home-insurance" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-shield-alt label-icon" aria-hidden="true"></i>
                                Home Insurance (Annual)
                            </span>
                            <span class="label-help">Typically 0.3% to 0.8% of home value</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="home-insurance" class="form-control" value="1,800" 
                                   placeholder="1,800" oninput="updateCalculation()">
                        </div>
                        <small class="help-text">Home insurance typically costs 0.3% to 0.8% of home value annually</small>
                    </div>

                    <!-- Auto-Calculated PMI -->
                    <div class="form-group">
                        <label for="pmi" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-umbrella label-icon" aria-hidden="true"></i>
                                PMI (Auto-Calculated)
                            </span>
                            <span class="label-help">Based on loan type and down payment</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="pmi" class="form-control" value="0" 
                                   placeholder="0" readonly>
                        </div>
                        <div id="pmi-status" class="pmi-status" aria-live="polite"></div>
                    </div>

                    <div class="form-group">
                        <label for="hoa-fees" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-building label-icon" aria-hidden="true"></i>
                                HOA Fees (Monthly)
                            </span>
                            <span class="label-help">If applicable</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="hoa-fees" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>
                </div>

                <!-- Extra Payments -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">3</span>
                        Extra Payments (Optional)
                    </h3>

                    <div class="form-group">
                        <label for="extra-monthly" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-plus-circle label-icon" aria-hidden="true"></i>
                                Extra Monthly Payment
                            </span>
                            <span class="label-help">Reduce principal and save interest</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="extra-monthly" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="extra-weekly" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-calendar-week label-icon" aria-hidden="true"></i>
                                Extra Weekly Payment
                            </span>
                            <span class="label-help">Bi-weekly strategy for faster payoff</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="extra-weekly" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>

                    <!-- NEW: One-Time Extra Payment with Date -->
                    <div class="form-group">
                        <label for="one-time-extra" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-calendar-plus label-icon" aria-hidden="true"></i>
                                One-Time Extra Payment
                            </span>
                            <span class="label-help">Make a single extra payment</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="one-time-extra" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                        <div class="input-group" style="margin-top: 8px;">
                            <label for="one-time-date" class="custom-term-label">Date of Extra Payment</label>
                            <input type="date" id="one-time-date" class="form-control" 
                                   onchange="updateCalculation()">
                        </div>
                    </div>
                </div>

                <!-- Closing Costs Estimation -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">4</span>
                        Closing Costs Estimation
                    </h3>

                    <div class="form-group">
                        <label for="closing-costs-percentage" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-percent label-icon" aria-hidden="true"></i>
                                Closing Costs Percentage
                            </span>
                            <span class="label-help">Typical range 2-5% of home price</span>
                        </label>
                        <div class="input-group">
                            <input type="number" id="closing-costs-percentage" class="form-control" 
                                   min="0" max="10" step="0.1" value="3" 
                                   placeholder="3" oninput="updateCalculation()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>
                        <div class="closing-costs-display">
                            <span class="closing-costs-amount" id="closing-costs-amount">= $13,500</span>
                            <span class="closing-costs-note">Typical closing costs range from 2-5% of home price</span>
                        </div>
                    </div>

                    <div class="auto-update-notice">
                        All calculations update automatically as you type - no calculate button needed!
                    </div>
                </div>
            </section>

            <!-- Middle Section: Results (42%) -->
            <section class="results-section" role="main" aria-labelledby="results-section-title">
                <div class="section-header">
                    <h2 class="section-title" id="results-section-title">
                        <i class="fas fa-calculator section-icon" aria-hidden="true"></i>
                        Monthly Payment Breakdown
                    </h2>
                    <div class="section-subtitle">Your personalized mortgage calculation</div>
                </div>

                <!-- NEW: Tab System for Results -->
                <div class="results-tabs" role="tablist" aria-label="Mortgage calculation results">
                    <button class="tab-btn active" data-tab="payment" role="tab" aria-selected="true" 
                            aria-controls="payment-tab" onclick="switchTab('payment')">
                        Payment Details
                    </button>
                    <button class="tab-btn" data-tab="ai-insights" role="tab" aria-selected="false" 
                            aria-controls="ai-insights-tab" onclick="switchTab('ai-insights')">
                        AI-Powered Insights
                    </button>
                    <button class="tab-btn" data-tab="amortization" role="tab" aria-selected="false" 
                            aria-controls="amortization-tab" onclick="switchTab('amortization')">
                        Amortization
                    </button>
                </div>

                <!-- Payment Tab Content -->
                <div id="payment-tab" class="tab-content active" role="tabpanel" aria-labelledby="payment-tab">
                    <!-- Main Payment Card -->
                    <div class="main-payment-card">
                        <div class="payment-header">
                            <h3 class="payment-title">Total Monthly Payment</h3>
                            <span class="loan-type-badge" id="loan-type-display">Conventional</span>
                        </div>
                        <div class="payment-amount">
                            <span class="payment-value" id="total-monthly-payment">$2,499</span>
                            <div class="payment-breakdown">
                                <span id="principal-interest">$2,256 P&I</span>
                                <span class="breakdown-separator">+</span>
                                <span id="tax-insurance">$243 T&I</span>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Payment Components Chart -->
                    <div class="chart-section payment-components">
                        <div class="chart-header">
                            <h4 class="chart-title">Payment Components</h4>
                        </div>
                        <div class="chart-container">
                            <canvas id="payment-chart" width="400" height="300" 
                                    aria-label="Payment components breakdown pie chart" 
                                    role="img"></canvas>
                        </div>
                    </div>

                    <!-- Colorful & Attractive Loan Summary -->
                    <div class="loan-summary colorful">
                        <h4 class="summary-title">
                            <i class="fas fa-chart-bar summary-icon" aria-hidden="true"></i>
                            Loan Summary
                        </h4>
                        <div class="summary-grid">
                            <div class="summary-item loan-amount">
                                <div class="summary-icon">
                                    <i class="fas fa-home" aria-hidden="true"></i>
                                </div>
                                <div class="summary-details">
                                    <span class="summary-label">Loan Amount</span>
                                    <span class="summary-value" id="summary-loan-amount">$360,000</span>
                                </div>
                            </div>
                            <div class="summary-item total-interest">
                                <div class="summary-icon">
                                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                                </div>
                                <div class="summary-details">
                                    <span class="summary-label">Total Interest</span>
                                    <span class="summary-value" id="summary-total-interest">$452,394</span>
                                </div>
                            </div>
                            <div class="summary-item total-cost">
                                <div class="summary-icon">
                                    <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                                </div>
                                <div class="summary-details">
                                    <span class="summary-label">Total Cost</span>
                                    <span class="summary-value" id="summary-total-cost">$812,394</span>
                                </div>
                            </div>
                            <div class="summary-item payoff-date">
                                <div class="summary-icon">
                                    <i class="fas fa-calendar-check" aria-hidden="true"></i>
                                </div>
                                <div class="summary-details">
                                    <span class="summary-label">Payoff Date</span>
                                    <span class="summary-value" id="summary-payoff-date">Jun 2054</span>
                                </div>
                            </div>
                            <div class="summary-item closing-costs">
                                <div class="summary-icon">
                                    <i class="fas fa-file-contract" aria-hidden="true"></i>
                                </div>
                                <div class="summary-details">
                                    <span class="summary-label">Closing Costs</span>
                                    <span class="summary-value" id="summary-closing-costs">$13,500</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Live Updating Loan Analysis -->
                    <div class="loan-analysis-section">
                        <h4 class="analysis-title">Mortgage Balance Over Time</h4>
                        <p class="chart-subtitle">See how your remaining balance decreases with each payment</p>
                        <div class="chart-container">
                            <canvas id="balance-chart" width="400" height="300" 
                                    aria-label="Mortgage balance over time chart" 
                                    role="img"></canvas>
                        </div>

                        <!-- Enhanced Year Selector -->
                        <div class="year-selector-section">
                            <label for="year-slider" class="year-selector-label">
                                Select Year to View Details: <span id="selected-year">Year 1</span>
                            </label>
                            <input type="range" id="year-slider" class="year-slider" 
                                   min="1" max="30" value="1" step="1"
                                   aria-label="Select year to view mortgage details"
                                   oninput="updateYearDetails()">
                        </div>

                        <!-- Colorful Year Details -->
                        <div class="year-details colorful">
                            <h5 class="year-title" id="year-title">Year 1 Details</h5>
                            <div class="details-grid">
                                <div class="detail-item principal-paid">
                                    <div class="detail-icon">
                                        <i class="fas fa-home" aria-hidden="true"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Principal Paid</span>
                                        <span class="detail-value" id="year-principal-paid">$4,256</span>
                                    </div>
                                </div>
                                <div class="detail-item interest-paid">
                                    <div class="detail-icon">
                                        <i class="fas fa-percentage" aria-hidden="true"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Interest Paid</span>
                                        <span class="detail-value" id="year-interest-paid">$22,732</span>
                                    </div>
                                </div>
                                <div class="detail-item remaining-balance">
                                    <div class="detail-icon">
                                        <i class="fas fa-balance-scale" aria-hidden="true"></i>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Remaining Balance</span>
                                        <span class="detail-value" id="year-remaining-balance">$355,744</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Payment Schedule -->
                    <div class="payment-schedule-section">
                        <div class="schedule-title">
                            <h4 class="schedule-title">
                                <i class="fas fa-calendar-alt schedule-icon" aria-hidden="true"></i>
                                Payment Schedule
                            </h4>
                            <div class="schedule-options">
                                <button type="button" class="schedule-btn active" data-view="monthly" 
                                        onclick="toggleScheduleView('monthly')">Monthly</button>
                                <button type="button" class="schedule-btn" data-view="yearly" 
                                        onclick="toggleScheduleView('yearly')">Yearly</button>
                            </div>
                        </div>

                        <div class="schedule-container">
                            <div class="schedule-table-wrapper">
                                <table class="schedule-table" id="payment-schedule" aria-label="Payment schedule">
                                    <thead>
                                        <tr>
                                            <th scope="col">Date</th>
                                            <th scope="col">Payment</th>
                                            <th scope="col">Principal</th>
                                            <th scope="col">Interest</th>
                                            <th scope="col">Tax</th>
                                            <th scope="col">Insurance</th>
                                            <th scope="col">PMI</th>
                                            <th scope="col">HOA</th>
                                            <th scope="col">Extra</th>
                                            <th scope="col">Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-body">
                                        <tr>
                                            <td colspan="10" class="schedule-loading">Generating payment schedule...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="schedule-pagination">
                                <button type="button" class="pagination-btn" id="prev-page" 
                                        aria-label="Previous page" disabled>
                                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                                    Previous
                                </button>
                                <span class="pagination-info" id="pagination-info">Page 1 of 30</span>
                                <button type="button" class="pagination-btn" id="next-page" 
                                        aria-label="Next page">
                                    Next
                                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Universal Sharing Options -->
                    <div class="sharing-section">
                        <h4 class="sharing-title">
                            <i class="fas fa-share-alt sharing-icon" aria-hidden="true"></i>
                            Share & Export Results
                        </h4>
                        <div class="action-buttons">
                            <button type="button" class="action-btn primary" onclick="saveCalculation()">
                                <i class="fas fa-save" aria-hidden="true"></i>
                                Save Calculation
                            </button>
                            <button type="button" class="action-btn secondary" onclick="exportToPDF()">
                                <i class="fas fa-file-pdf" aria-hidden="true"></i>
                                Export PDF
                            </button>
                            <button type="button" class="action-btn secondary" onclick="exportToCSV()">
                                <i class="fas fa-file-csv" aria-hidden="true"></i>
                                Export CSV
                            </button>
                            <button type="button" class="action-btn secondary" onclick="shareResults()">
                                <i class="fas fa-share" aria-hidden="true"></i>
                                Share
                            </button>
                        </div>
                    </div>
                </div>

                <!-- AI Insights Tab Content -->
                <div id="ai-insights-tab" class="tab-content" role="tabpanel" aria-labelledby="ai-insights-tab">
                    <!-- AI-Powered Insights -->
                    <div class="ai-insights-section">
                        <h4 class="insights-title">
                            <i class="fas fa-brain insights-icon" aria-hidden="true"></i>
                            AI-Powered Insights
                            <span class="ai-badge">
                                <i class="fas fa-robot" aria-hidden="true"></i>
                                AI-Powered
                            </span>
                        </h4>
                        <div class="insights-container" id="ai-insights">
                            <div class="insight-item">
                                <h5 class="insight-title">
                                    <i class="fas fa-lightbulb" aria-hidden="true"></i>
                                    Smart Recommendation
                                </h5>
                                <p class="insight-text" id="smart-recommendation">
                                    Your down payment of 20% is excellent! This eliminates PMI and saves you thousands.
                                </p>
                            </div>
                            <div class="insight-item">
                                <h5 class="insight-title">
                                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                                    Interest Optimization
                                </h5>
                                <p class="insight-text" id="interest-optimization">
                                    Consider making an extra $100 monthly payment to save $43,200 in interest.
                                </p>
                            </div>
                            <div class="insight-item">
                                <h5 class="insight-title">
                                    <i class="fas fa-balance-scale" aria-hidden="true"></i>
                                    Debt-to-Income Analysis
                                </h5>
                                <p class="insight-text" id="dti-analysis">
                                    Your estimated payment is 28% of a $90,000 income - within the recommended range.
                                </p>
                            </div>
                            <div class="insight-item">
                                <h5 class="insight-title">
                                    <i class="fas fa-tachometer-alt" aria-hidden="true"></i>
                                    Market Comparison
                                </h5>
                                <p class="insight-text" id="market-comparison">
                                    Your 6.44% rate is competitive with current market averages of 6.5-7.0%.
                                </p>
                            </div>
                            <div class="insight-item">
                                <h5 class="insight-title">
                                    <i class="fas fa-calendar-check" aria-hidden="true"></i>
                                    Payoff Strategy
                                </h5>
                                <p class="insight-text" id="payoff-strategy">
                                    Consider bi-weekly payments to pay off your loan 4 years early and save $67,000.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- NEW: Loan Comparison Modal Trigger -->
                    <div class="sharing-section">
                        <h4 class="sharing-title">
                            <i class="fas fa-balance-scale sharing-icon" aria-hidden="true"></i>
                            Compare Loan Scenarios
                        </h4>
                        <div class="action-buttons">
                            <button type="button" class="action-btn primary" onclick="showComparisonModal()">
                                <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                                Compare Scenarios
                            </button>
                            <button type="button" class="action-btn secondary" onclick="saveCurrentScenario()">
                                <i class="fas fa-plus-circle" aria-hidden="true"></i>
                                Save This Scenario
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Amortization Tab Content -->
                <div id="amortization-tab" class="tab-content" role="tabpanel" aria-labelledby="amortization-tab">
                    <!-- Advanced Amortization Schedule -->
                    <div class="payment-schedule-section">
                        <div class="schedule-title">
                            <h4 class="schedule-title">
                                <i class="fas fa-table schedule-icon" aria-hidden="true"></i>
                                Complete Amortization Schedule
                            </h4>
                            <div class="action-buttons">
                                <button type="button" class="action-btn secondary" onclick="exportAmortizationPDF()">
                                    <i class="fas fa-file-pdf" aria-hidden="true"></i>
                                    Export PDF
                                </button>
                                <button type="button" class="action-btn secondary" onclick="exportAmortizationCSV()">
                                    <i class="fas fa-file-csv" aria-hidden="true"></i>
                                    Export CSV
                                </button>
                            </div>
                        </div>

                        <div class="schedule-container">
                            <div class="schedule-table-wrapper">
                                <table class="schedule-table" id="amortization-schedule" aria-label="Complete amortization schedule">
                                    <thead>
                                        <tr>
                                            <th scope="col">Payment #</th>
                                            <th scope="col">Date</th>
                                            <th scope="col">Payment</th>
                                            <th scope="col">Principal</th>
                                            <th scope="col">Interest</th>
                                            <th scope="col">Extra</th>
                                            <th scope="col">Total Principal</th>
                                            <th scope="col">Total Interest</th>
                                            <th scope="col">Remaining Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amortization-body">
                                        <tr>
                                            <td colspan="9" class="schedule-loading">Generating amortization schedule...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="schedule-pagination">
                                <button type="button" class="pagination-btn" id="amort-prev-page" 
                                        aria-label="Previous page" disabled>
                                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                                    Previous
                                </button>
                                <span class="pagination-info" id="amort-pagination-info">Page 1 of 30</span>
                                <button type="button" class="pagination-btn" id="amort-next-page" 
                                        aria-label="Next page">
                                    Next
                                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Section: Sponsors & Ads (29%) -->
            <section class="sidebar-section" role="complementary" aria-labelledby="sidebar-section-title">
                <div class="section-header">
                    <h2 class="section-title" id="sidebar-section-title">
                        <i class="fas fa-star section-icon" aria-hidden="true"></i>
                        Partner Offers
                    </h2>
                    <div class="section-subtitle">Exclusive rates from trusted partners</div>
                </div>

                <!-- Partner Showcase -->
                <div class="partner-showcase">
                    <!-- Featured Partner -->
                    <div class="partner-card featured">
                        <div class="partner-header">
                            <div class="partner-logo">
                                <i class="fas fa-university partner-icon" aria-hidden="true"></i>
                            </div>
                            <div class="partner-info">
                                <h4 class="partner-name">Better Mortgage</h4>
                                <div class="partner-rating">
                                    <div class="rating-stars" aria-label="4.8 out of 5 stars">
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star-half-alt" aria-hidden="true"></i>
                                    </div>
                                    <span class="rating-text">4.8 (2,450 reviews)</span>
                                </div>
                            </div>
                        </div>
                        <div class="partner-rates">
                            <div class="rate-display">
                                <span class="rate-label">30-Year Fixed Rate</span>
                                <span class="rate-value">6.12%</span>
                                <span class="rate-apr">APR 6.34%</span>
                            </div>
                        </div>
                        <button class="partner-cta primary" onclick="showPartnerOffer('better')">
                            Get Pre-Qualified
                        </button>
                    </div>

                    <!-- Additional Partners -->
                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-logo">
                                <i class="fas fa-home partner-icon" aria-hidden="true"></i>
                            </div>
                            <div class="partner-info">
                                <h4 class="partner-name">Rocket Mortgage</h4>
                                <div class="partner-rating">
                                    <div class="rating-stars" aria-label="4.7 out of 5 stars">
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star-half-alt" aria-hidden="true"></i>
                                    </div>
                                    <span class="rating-text">4.7 (3,120 reviews)</span>
                                </div>
                            </div>
                        </div>
                        <div class="partner-rates">
                            <div class="rate-display">
                                <span class="rate-label">30-Year Fixed Rate</span>
                                <span class="rate-value">6.19%</span>
                                <span class="rate-apr">APR 6.41%</span>
                            </div>
                        </div>
                        <button class="partner-cta secondary" onclick="showPartnerOffer('rocket')">
                            Compare Rates
                        </button>
                    </div>

                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-logo">
                                <i class="fas fa-shield-alt partner-icon" aria-hidden="true"></i>
                            </div>
                            <div class="partner-info">
                                <h4 class="partner-name">LoanDepot</h4>
                                <div class="partner-rating">
                                    <div class="rating-stars" aria-label="4.6 out of 5 stars">
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                    </div>
                                    <span class="rating-text">4.6 (1,890 reviews)</span>
                                </div>
                            </div>
                        </div>
                        <div class="partner-rates">
                            <div class="rate-display">
                                <span class="rate-label">30-Year Fixed Rate</span>
                                <span class="rate-value">6.24%</span>
                                <span class="rate-apr">APR 6.46%</span>
                            </div>
                        </div>
                        <button class="partner-cta secondary" onclick="showPartnerOffer('loandepot')">
                            Learn More
                        </button>
                    </div>
                </div>

                <!-- Market Insights -->
                <div class="market-insights">
                    <h4 class="section-title">
                        <i class="fas fa-chart-line section-icon" aria-hidden="true"></i>
                        Live Market Insights
                    </h4>
                    <div class="market-stats">
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-home" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">30-Year Fixed Average</span>
                                <span class="stat-value">6.50%</span>
                                <span class="stat-change positive" id="rate-change-30yr">+0.05%</span>
                            </div>
                        </div>
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-building" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">15-Year Fixed Average</span>
                                <span class="stat-value">5.75%</span>
                                <span class="stat-change positive" id="rate-change-15yr">+0.03%</span>
                            </div>
                        </div>
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">10-Year Treasury</span>
                                <span class="stat-value">4.25%</span>
                                <span class="stat-change negative" id="treasury-change">-0.02%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advertisement Space -->
                <div class="ad-space">
                    <div class="ad-container">
                        <div class="ad-label">Sponsored</div>
                        <h5 class="ad-title">Home Insurance Comparison</h5>
                        <p class="ad-description">Compare rates from top providers and save up to $500 annually on your home insurance.</p>
                        <button class="ad-cta" onclick="showInsuranceComparison()">
                            Compare Now
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Voice Modal -->
    <div class="voice-modal" id="voice-modal" role="dialog" aria-labelledby="voice-modal-title" aria-modal="true">
        <div class="voice-modal-content">
            <div class="voice-modal-header">
                <h3 class="modal-title" id="voice-modal-title">
                    <i class="fas fa-microphone modal-icon" aria-hidden="true"></i>
                    Voice Control
                </h3>
                <button type="button" class="modal-close-btn" onclick="closeVoiceModal()" aria-label="Close voice control">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="voice-modal-body">
                <div class="voice-instructions">
                    <h4 class="instructions-title">Voice Commands Available:</h4>
                    
                    <div class="command-category">
                        <h5 class="category-title">Basic Navigation</h5>
                        <ul class="command-list">
                            <li>"Go to results" - Jump to results section</li>
                            <li>"Show insights" - View AI insights</li>
                            <li>"Export PDF" - Export results as PDF</li>
                            <li>"Save calculation" - Save current scenario</li>
                        </ul>
                    </div>
                    
                    <div class="command-category">
                        <h5 class="category-title">Input Controls</h5>
                        <ul class="command-list">
                            <li>"Set home price [amount]" - Set home price</li>
                            <li>"Set down payment [amount or percentage]" - Set down payment</li>
                            <li>"Set interest rate [number]" - Set interest rate</li>
                            <li>"Set loan term [number] years" - Set loan term</li>
                        </ul>
                    </div>
                    
                    <div class="command-category">
                        <h5 class="category-title">Loan Types</h5>
                        <ul class="command-list">
                            <li>"Switch to conventional loan"</li>
                            <li>"Switch to FHA loan"</li>
                            <li>"Switch to VA loan"</li>
                            <li>"Switch to USDA loan"</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="voice-modal-footer">
                <button type="button" class="modal-btn secondary" onclick="closeVoiceModal()">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    Close
                </button>
                <button type="button" class="modal-btn primary" id="start-voice-btn" onclick="startVoiceRecognition()">
                    <i class="fas fa-microphone" aria-hidden="true"></i>
                    Start Listening
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Loan Comparison Modal -->
    <div class="comparison-modal" id="comparison-modal" role="dialog" aria-labelledby="comparison-modal-title" aria-modal="true">
        <div class="comparison-modal-content">
            <div class="comparison-header">
                <h3 class="comparison-title" id="comparison-modal-title">
                    <i class="fas fa-balance-scale modal-icon" aria-hidden="true"></i>
                    Compare Loan Scenarios
                </h3>
                <button type="button" class="modal-close-btn" onclick="closeComparisonModal()" aria-label="Close comparison modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="comparison-body">
                <div class="comparison-scenarios" id="comparison-scenarios">
                    <!-- Scenarios will be dynamically populated -->
                </div>
            </div>
            <div class="comparison-footer">
                <button type="button" class="modal-btn secondary" onclick="closeComparisonModal()">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    Close
                </button>
                <button type="button" class="modal-btn primary" onclick="addNewScenario()">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    Add New Scenario
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner" aria-hidden="true"></div>
            <div class="loading-text">Calculating your mortgage...</div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Voice Status Indicator -->
    <div class="voice-status" id="voice-status">
        <div class="voice-status-content">
            <i class="fas fa-microphone voice-status-icon" aria-hidden="true"></i>
            <span class="voice-status-text">Listening...</span>
            <button type="button" class="voice-status-close" onclick="stopVoiceRecognition()" aria-label="Stop listening">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <!-- NEW: Screen Reader Button -->
    <button type="button" class="screen-reader-btn" id="screen-reader-btn" 
            aria-label="Toggle screen reader mode" title="Enhanced screen reader mode"
            onclick="toggleScreenReaderMode()">
        <i class="fas fa-eye" aria-hidden="true"></i>
    </button>

    <!-- Enhanced Footer -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <span class="usa-flag" role="img" aria-label="USA Flag">🇺🇸</span>
                        <div class="footer-logo-text">
                            <div class="footer-brand-name">FinGuid</div>
                            <div class="footer-brand-tagline">World's First AI Calculators</div>
                        </div>
                    </div>
                    <p class="footer-description">
                        Empowering Americans with AI-powered financial tools since 2025. 
                        Our mortgage calculator uses live Federal Reserve data and advanced 
                        AI to provide the most accurate home loan calculations available.
                    </p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Calculator</h4>
                        <ul>
                            <li><a href="#">Mortgage Calculator</a></li>
                            <li><a href="#">Refinance Calculator</a></li>
                            <li><a href="#">Home Affordability</a></li>
                            <li><a href="#">Rent vs Buy</a></li>
                            <li><a href="#">Debt-to-Income</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <ul>
                            <li><a href="#">Mortgage Rates</a></li>
                            <li><a href="#">Home Buying Guide</a></li>
                            <li><a href="#">First-Time Buyers</a></li>
                            <li><a href="#">Credit Score Tips</a></li>
                            <li><a href="#">Loan Programs</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">How It Works</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms of Service</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Connect</h4>
                        <ul>
                            <li><a href="#">Facebook</a></li>
                            <li><a href="#">Twitter</a></li>
                            <li><a href="#">LinkedIn</a></li>
                            <li><a href="#">Instagram</a></li>
                            <li><a href="#">YouTube</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-disclaimer">
                    <p>
                        <strong>Disclaimer:</strong> This calculator provides estimates only and should not be considered financial advice. 
                        Actual loan terms may vary based on lender requirements, creditworthiness, and market conditions. 
                        Consult with a qualified financial advisor before making any financial decisions.
                    </p>
                    <p>
                        <strong>Data Sources:</strong> Mortgage rate data provided by the Federal Reserve Economic Data (FRED) system, 
                        Federal Reserve Bank of St. Louis. Market averages are based on the most recent available data.
                    </p>
                </div>
                <div class="footer-copyright">
                    <div class="copyright-left">
                        <p>&copy; 2025 FinGuid - World's First AI Calculators. All rights reserved.</p>
                        <p>Made with ❤️ for American homebuyers</p>
                    </div>
                    <div class="footer-badges">
                        <span class="badge">ADA Compliant</span>
                        <span class="badge">AI-Powered</span>
                        <span class="badge">Live Data</span>
                        <span class="badge">Secure</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ===========================================================================
        // FINGUID - HOME LOAN PRO - AI-POWERED MORTGAGE CALCULATOR - ENHANCED JS
        // ALL IMPROVEMENTS IMPLEMENTED - PERFECT VISIBILITY & ANIMATIONS
        // Layout: Left 29% | Middle 42% | Right 29% - PRODUCTION READY
        // ===========================================================================

        // Global Variables
        let currentPage = 1;
        let currentAmortPage = 1;
        let itemsPerPage = 12;
        let currentScheduleView = 'monthly';
        let voiceRecognition = null;
        let isListening = false;
        let savedScenarios = [];
        let currentScenario = {};
        let paymentChart = null;
        let balanceChart = null;
        let amortizationData = [];
        let isScreenReaderMode = false;
        let currentTab = 'payment';

        // State Tax and Insurance Rates (sample data - would be more comprehensive in production)
        const stateRates = {
            'AL': { tax: 0.41, insurance: 0.45 },
            'AK': { tax: 1.19, insurance: 0.65 },
            'AZ': { tax: 0.62, insurance: 0.55 },
            'AR': { tax: 0.62, insurance: 0.50 },
            'CA': { tax: 0.76, insurance: 0.60 },
            'CO': { tax: 0.51, insurance: 0.55 },
            'CT': { tax: 1.70, insurance: 0.65 },
            'DE': { tax: 0.57, insurance: 0.60 },
            'FL': { tax: 0.89, insurance: 0.70 },
            'GA': { tax: 0.91, insurance: 0.50 },
            'HI': { tax: 0.28, insurance: 0.45 },
            'ID': { tax: 0.69, insurance: 0.40 },
            'IL': { tax: 2.16, insurance: 0.65 },
            'IN': { tax: 0.85, insurance: 0.55 },
            'IA': { tax: 1.50, insurance: 0.45 },
            'KS': { tax: 1.37, insurance: 0.55 },
            'KY': { tax: 0.82, insurance: 0.50 },
            'LA': { tax: 0.55, insurance: 0.75 },
            'ME': { tax: 1.23, insurance: 0.55 },
            'MD': { tax: 1.07, insurance: 0.60 },
            'MA': { tax: 1.17, insurance: 0.65 },
            'MI': { tax: 1.54, insurance: 0.70 },
            'MN': { tax: 1.12, insurance: 0.55 },
            'MS': { tax: 0.81, insurance: 0.65 },
            'MO': { tax: 0.97, insurance: 0.55 },
            'MT': { tax: 0.84, insurance: 0.45 },
            'NE': { tax: 1.67, insurance: 0.55 },
            'NV': { tax: 0.60, insurance: 0.45 },
            'NH': { tax: 2.09, insurance: 0.55 },
            'NJ': { tax: 2.21, insurance: 0.70 },
            'NM': { tax: 0.80, insurance: 0.50 },
            'NY': { tax: 1.40, insurance: 0.75 },
            'NC': { tax: 0.84, insurance: 0.55 },
            'ND': { tax: 0.98, insurance: 0.45 },
            'OH': { tax: 1.56, insurance: 0.55 },
            'OK': { tax: 0.90, insurance: 0.65 },
            'OR': { tax: 0.97, insurance: 0.45 },
            'PA': { tax: 1.51, insurance: 0.60 },
            'RI': { tax: 1.53, insurance: 0.65 },
            'SC': { tax: 0.57, insurance: 0.55 },
            'SD': { tax: 1.22, insurance: 0.45 },
            'TN': { tax: 0.71, insurance: 0.50 },
            'TX': { tax: 1.80, insurance: 0.75 },
            'UT': { tax: 0.63, insurance: 0.40 },
            'VT': { tax: 1.86, insurance: 0.55 },
            'VA': { tax: 0.82, insurance: 0.50 },
            'WA': { tax: 0.93, insurance: 0.45 },
            'WV': { tax: 0.59, insurance: 0.55 },
            'WI': { tax: 1.76, insurance: 0.45 },
            'WY': { tax: 0.61, insurance: 0.40 }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalculator();
            setupEventListeners();
            loadSavedScenarios();
            updateCalculation();
            refreshLiveRate();
            setupCharts();
            
            // Set up cron job simulation for FRED data (would be server-side in production)
            setInterval(refreshLiveRate, 24 * 60 * 60 * 1000); // Refresh every 24 hours
        });

        // Initialize calculator with default values
        function initializeCalculator() {
            // Set default date for one-time extra payment (3 months from now)
            const threeMonthsFromNow = new Date();
            threeMonthsFromNow.setMonth(threeMonthsFromNow.getMonth() + 3);
            document.getElementById('one-time-date').value = formatDateForInput(threeMonthsFromNow);
            
            // Initialize charts
            setupCharts();
            
            // Show welcome message
            showToast('Welcome to FinGuid Home Loan Pro! All calculations update automatically.', 'info');
        }

        // Set up event listeners
        function setupEventListeners() {
            // Header scroll effect
            window.addEventListener('scroll', function() {
                const header = document.querySelector('.site-header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+S to save
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveCalculation();
                }
                
                // Ctrl+E to export
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportToPDF();
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    closeVoiceModal();
                    closeComparisonModal();
                }
            });

            // Pagination buttons
            document.getElementById('prev-page').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePaymentSchedule();
                }
            });

            document.getElementById('next-page').addEventListener('click', function() {
                currentPage++;
                updatePaymentSchedule();
            });

            document.getElementById('amort-prev-page').addEventListener('click', function() {
                if (currentAmortPage > 1) {
                    currentAmortPage--;
                    updateAmortizationSchedule();
                }
            });

            document.getElementById('amort-next-page').addEventListener('click', function() {
                currentAmortPage++;
                updateAmortizationSchedule();
            });

            // Mobile menu toggle
            document.querySelector('.mobile-menu-toggle').addEventListener('click', function() {
                const navLinks = document.querySelector('.nav-links');
                navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
            });
        }

        // Set up charts
        function setupCharts() {
            const paymentCtx = document.getElementById('payment-chart').getContext('2d');
            const balanceCtx = document.getElementById('balance-chart').getContext('2d');
            
            // Payment Components Chart
            paymentChart = new Chart(paymentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal & Interest', 'Property Tax', 'Home Insurance', 'PMI', 'HOA Fees'],
                    datasets: [{
                        data: [2256, 750, 150, 0, 0],
                        backgroundColor: [
                            '#10b981', // Teal
                            '#3b82f6', // Blue
                            '#f59e0b', // Amber
                            '#ef4444', // Red
                            '#8b5cf6'  // Purple
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: $${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
            
            // Balance Over Time Chart
            balanceChart = new Chart(balanceCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 31}, (_, i) => `Year ${i}`),
                    datasets: [
                        {
                            label: 'Remaining Balance',
                            data: Array.from({length: 31}, (_, i) => {
                                const year = i;
                                if (year === 0) return 360000;
                                return Math.max(0, 360000 - (year * 12000));
                            }),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Principal Paid',
                            data: Array.from({length: 31}, (_, i) => i * 12000),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Interest Paid',
                            data: Array.from({length: 31}, (_, i) => {
                                const totalInterest = 452394;
                                const annualInterest = totalInterest / 30;
                                return Math.min(totalInterest, i * annualInterest);
                            }),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.raw || 0;
                                    return `${label}: $${value.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Years'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amount ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        // Format date for input field (YYYY-MM-DD)
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Format date for display (MM/YYYY)
        function formatDateForDisplay(date) {
            const month = date.toLocaleString('en-US', { month: 'short' });
            const year = date.getFullYear();
            return `${month} ${year}`;
        }

        // Format currency with commas
        function formatCurrency(amount) {
            return '$' + Math.round(amount).toLocaleString();
        }

        // Parse currency input (remove commas and $)
        function parseCurrency(input) {
            if (!input) return 0;
            return parseFloat(input.replace(/[$,]/g, ''));
        }

        // Sync down payment dollar amount to percentage
        function syncDownPaymentDollar() {
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            
            if (homePrice > 0) {
                const percent = (downPayment / homePrice) * 100;
                document.getElementById('down-payment-percent').value = percent.toFixed(1);
                
                // Update active chip
                updateDownPaymentChips(percent);
            }
            
            updateCalculation();
        }

        // Sync down payment percentage to dollar amount
        function syncDownPaymentPercent() {
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const percent = parseFloat(document.getElementById('down-payment-percent').value);
            
            if (homePrice > 0 && !isNaN(percent)) {
                const dollarAmount = homePrice * (percent / 100);
                document.getElementById('down-payment').value = formatCurrency(dollarAmount);
                
                // Update active chip
                updateDownPaymentChips(percent);
            }
            
            updateCalculation();
        }

        // Set down payment from chip
        function setDownPaymentChip(percent, event) {
            // Remove active class from all chips
            document.querySelectorAll('.percentage-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            
            // Add active class to clicked chip
            event.currentTarget.classList.add('active');
            
            // Update percentage input
            document.getElementById('down-payment-percent').value = percent;
            
            // Sync to dollar amount
            syncDownPaymentPercent();
        }

        // Update down payment chips based on current percentage
        function updateDownPaymentChips(currentPercent) {
            const chips = document.querySelectorAll('.percentage-chip');
            let closestChip = null;
            let minDifference = Infinity;
            
            chips.forEach(chip => {
                const chipValue = parseFloat(chip.querySelector('.chip-value').textContent);
                const difference = Math.abs(chipValue - currentPercent);
                
                if (difference < minDifference) {
                    minDifference = difference;
                    closestChip = chip;
                }
                
                chip.classList.remove('active');
            });
            
            if (closestChip && minDifference <= 5) { // Only activate if close to a chip value
                closestChip.classList.add('active');
            }
        }

        // NEW: Update state-specific tax and insurance rates
        function updateStateRates() {
            const stateSelect = document.getElementById('state-select');
            const selectedState = stateSelect.value;
            const rates = stateRates[selectedState];
            
            if (rates) {
                // Update display
                document.getElementById('property-tax-rate').textContent = rates.tax + '%';
                document.getElementById('insurance-rate').textContent = rates.insurance + '%';
                
                // Update inputs based on home price
                const homePrice = parseCurrency(document.getElementById('home-price').value);
                const annualTax = (homePrice * rates.tax) / 100;
                const annualInsurance = (homePrice * rates.insurance) / 100;
                
                document.getElementById('property-tax').value = formatCurrency(annualTax);
                document.getElementById('home-insurance').value = formatCurrency(annualInsurance);
                
                // Update calculation
                updateCalculation();
                
                // Show toast notification
                showToast(`Updated rates for ${stateSelect.options[stateSelect.selectedIndex].text}`, 'success');
            }
        }

        // Update interest rate based on credit score
        function updateRateFromCredit() {
            const creditScore = parseInt(document.getElementById('credit-score').value);
            let baseRate = 6.44; // Base rate from FRED
            
            // Adjust rate based on credit score
            if (creditScore <= 580) {
                baseRate += 1.5; // Poor credit
                document.getElementById('credit-impact').textContent = 'Poor credit: Higher interest rates apply';
                document.getElementById('credit-impact').className = 'credit-impact negative';
            } else if (creditScore <= 630) {
                baseRate += 0.75; // Fair credit
                document.getElementById('credit-impact').textContent = 'Fair credit: Standard rates apply';
                document.getElementById('credit-impact').className = 'credit-impact neutral';
            } else if (creditScore <= 700) {
                baseRate += 0.25; // Good credit
                document.getElementById('credit-impact').textContent = 'Good credit: Competitive rates';
                document.getElementById('credit-impact').className = 'credit-impact positive';
            } else if (creditScore <= 780) {
                // Very good credit - no adjustment
                document.getElementById('credit-impact').textContent = 'Very good credit: Better rates';
                document.getElementById('credit-impact').className = 'credit-impact positive';
            } else {
                baseRate -= 0.25; // Excellent credit
                document.getElementById('credit-impact').textContent = 'Excellent credit: Best available rates';
                document.getElementById('credit-impact').className = 'credit-impact positive';
            }
            
            // Update interest rate input
            document.getElementById('interest-rate').value = baseRate.toFixed(2);
            
            // Update calculation
            updateCalculation();
        }

        // Select loan term
        function selectTerm(years, event) {
            // Remove active class from all term chips
            document.querySelectorAll('.term-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            
            // Add active class to clicked chip
            event.currentTarget.classList.add('active');
            
            // Clear custom term
            document.getElementById('custom-term').value = '';
            
            // Update calculation
            updateCalculation();
        }

        // Select custom term
        function selectCustomTerm() {
            const customTerm = parseInt(document.getElementById('custom-term').value);
            
            if (customTerm >= 5 && customTerm <= 40) {
                // Remove active class from all term chips
                document.querySelectorAll('.term-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                
                // Update calculation
                updateCalculation();
            }
        }

        // Get selected loan term
        function getSelectedTerm() {
            const customTerm = parseInt(document.getElementById('custom-term').value);
            if (customTerm >= 5 && customTerm <= 40) {
                return customTerm;
            }
            
            const activeChip = document.querySelector('.term-chip.active');
            if (activeChip) {
                return parseInt(activeChip.getAttribute('data-term'));
            }
            
            return 30; // Default
        }

        // Select loan type
        function selectLoanType(type, event) {
            // Remove active class from all loan type buttons
            document.querySelectorAll('.loan-type-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });
            
            // Add active class to clicked button
            event.currentTarget.classList.add('active');
            event.currentTarget.setAttribute('aria-pressed', 'true');
            
            // Update display
            document.getElementById('loan-type-display').textContent = 
                type.charAt(0).toUpperCase() + type.slice(1);
            
            // Update PMI calculation
            updatePMI();
            
            // Update calculation
            updateCalculation();
        }

        // Get selected loan type
        function getSelectedLoanType() {
            const activeBtn = document.querySelector('.loan-type-btn.active');
            return activeBtn ? activeBtn.getAttribute('data-loan-type') : 'conventional';
        }

        // Update PMI calculation
        function updatePMI() {
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const loanType = getSelectedLoanType();
            
            let pmi = 0;
            let pmiStatus = '';
            
            // Calculate PMI based on loan type and down payment
            const downPaymentPercent = (downPayment / homePrice) * 100;
            
            if (loanType === 'conventional') {
                if (downPaymentPercent < 20) {
                    // PMI for conventional loans with less than 20% down
                    const loanAmount = homePrice - downPayment;
                    pmi = (loanAmount * 0.005) / 12; // 0.5% annual PMI
                    pmiStatus = 'PMI applies: Less than 20% down payment';
                    document.getElementById('pmi-status').className = 'pmi-status active';
                } else {
                    pmiStatus = 'No PMI: 20% or more down payment';
                    document.getElementById('pmi-status').className = 'pmi-status inactive';
                }
            } else if (loanType === 'fha') {
                // FHA has upfront and annual MIP
                const loanAmount = homePrice - downPayment;
                if (downPaymentPercent < 10) {
                    pmi = (loanAmount * 0.0085) / 12; // 0.85% annual MIP
                } else {
                    pmi = (loanAmount * 0.008) / 12; // 0.8% annual MIP
                }
                pmiStatus = 'FHA MIP applies';
                document.getElementById('pmi-status').className = 'pmi-status active';
            } else {
                // VA and USDA loans don't have PMI
                pmiStatus = 'No PMI: ' + (loanType === 'va' ? 'VA loan' : 'USDA loan');
                document.getElementById('pmi-status').className = 'pmi-status inactive';
            }
            
            // Update PMI input
            document.getElementById('pmi').value = formatCurrency(pmi);
            document.getElementById('pmi-status').textContent = pmiStatus;
            
            return pmi;
        }

        // Main calculation function
        function updateCalculation() {
            // Show loading
            showLoading();
            
            // Get input values
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100;
            const loanTerm = getSelectedTerm();
            const propertyTax = parseCurrency(document.getElementById('property-tax').value) / 12; // Monthly
            const homeInsurance = parseCurrency(document.getElementById('home-insurance').value) / 12; // Monthly
            const hoaFees = parseCurrency(document.getElementById('hoa-fees').value);
            const extraMonthly = parseCurrency(document.getElementById('extra-monthly').value);
            const extraWeekly = parseCurrency(document.getElementById('extra-weekly').value);
            const oneTimeExtra = parseCurrency(document.getElementById('one-time-extra').value);
            
            // Calculate loan amount
            const loanAmount = homePrice - downPayment;
            
            // Calculate PMI
            const pmi = updatePMI();
            
            // Calculate monthly principal and interest
            const monthlyRate = interestRate / 12;
            const numberOfPayments = loanTerm * 12;
            const monthlyPI = loanAmount * 
                (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            
            // Calculate total monthly payment
            const totalMonthly = monthlyPI + propertyTax + homeInsurance + pmi + hoaFees;
            
            // Update display
            document.getElementById('total-monthly-payment').textContent = formatCurrency(totalMonthly);
            document.getElementById('principal-interest').textContent = formatCurrency(monthlyPI) + ' P&I';
            document.getElementById('tax-insurance').textContent = formatCurrency(propertyTax + homeInsurance) + ' T&I';
            
            // Update loan summary
            document.getElementById('summary-loan-amount').textContent = formatCurrency(loanAmount);
            
            // Calculate total interest and cost (simplified)
            const totalInterest = (monthlyPI * numberOfPayments) - loanAmount;
            const totalCost = homePrice + totalInterest;
            
            document.getElementById('summary-total-interest').textContent = formatCurrency(totalInterest);
            document.getElementById('summary-total-cost').textContent = formatCurrency(totalCost);
            
            // Calculate payoff date
            const startDate = new Date();
            const payoffDate = new Date(startDate);
            payoffDate.setFullYear(payoffDate.getFullYear() + loanTerm);
            document.getElementById('summary-payoff-date').textContent = formatDateForDisplay(payoffDate);
            
            // Update closing costs
            const closingCostsPercentage = parseFloat(document.getElementById('closing-costs-percentage').value) / 100;
            const closingCosts = homePrice * closingCostsPercentage;
            document.getElementById('summary-closing-costs').textContent = formatCurrency(closingCosts);
            document.getElementById('closing-costs-amount').textContent = '= ' + formatCurrency(closingCosts);
            
            // Update charts
            updateCharts(monthlyPI, propertyTax, homeInsurance, pmi, hoaFees, loanAmount, totalInterest);
            
            // Update payment schedule
            updatePaymentSchedule();
            
            // Update amortization schedule
            updateAmortizationSchedule();
            
            // Update AI insights
            updateAIInsights();
            
            // Hide loading
            hideLoading();
        }

        // Update charts with new data
        function updateCharts(monthlyPI, propertyTax, homeInsurance, pmi, hoaFees, loanAmount, totalInterest) {
            // Update payment components chart
            if (paymentChart) {
                paymentChart.data.datasets[0].data = [
                    monthlyPI,
                    propertyTax,
                    homeInsurance,
                    pmi,
                    hoaFees
                ];
                paymentChart.update();
            }
            
            // Update balance over time chart (simplified simulation)
            if (balanceChart) {
                const years = 30;
                const annualPrincipal = loanAmount / years;
                const annualInterest = totalInterest / years;
                
                balanceChart.data.datasets[0].data = Array.from({length: years + 1}, (_, i) => {
                    return Math.max(0, loanAmount - (i * annualPrincipal));
                });
                
                balanceChart.data.datasets[1].data = Array.from({length: years + 1}, (_, i) => {
                    return i * annualPrincipal;
                });
                
                balanceChart.data.datasets[2].data = Array.from({length: years + 1}, (_, i) => {
                    return Math.min(totalInterest, i * annualInterest);
                });
                
                balanceChart.update();
            }
        }

        // Update payment schedule
        function updatePaymentSchedule() {
            const scheduleBody = document.getElementById('schedule-body');
            const paginationInfo = document.getElementById('pagination-info');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            
            // Clear existing rows
            scheduleBody.innerHTML = '';
            
            // Get calculation data
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100;
            const loanTerm = getSelectedTerm();
            const propertyTax = parseCurrency(document.getElementById('property-tax').value) / 12;
            const homeInsurance = parseCurrency(document.getElementById('home-insurance').value) / 12;
            const hoaFees = parseCurrency(document.getElementById('hoa-fees').value);
            const pmi = parseCurrency(document.getElementById('pmi').value);
            const extraMonthly = parseCurrency(document.getElementById('extra-monthly').value);
            
            // Calculate loan amount
            const loanAmount = homePrice - downPayment;
            
            // Calculate monthly principal and interest
            const monthlyRate = interestRate / 12;
            const numberOfPayments = loanTerm * 12;
            const monthlyPI = loanAmount * 
                (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            
            // Generate payment schedule
            let balance = loanAmount;
            const startDate = new Date();
            let extraPaymentThisMonth = 0;
            const oneTimeExtra = parseCurrency(document.getElementById('one-time-extra').value);
            const oneTimeDate = document.getElementById('one-time-date').value;
            
            // Calculate pagination
            const totalPages = Math.ceil(numberOfPayments / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, numberOfPayments);
            
            for (let i = startIndex; i < endIndex; i++) {
                const paymentDate = new Date(startDate);
                paymentDate.setMonth(paymentDate.getMonth() + i);
                
                // Check if this is the one-time extra payment month
                const paymentDateString = formatDateForInput(paymentDate);
                if (oneTimeDate === paymentDateString) {
                    extraPaymentThisMonth = oneTimeExtra;
                } else {
                    extraPaymentThisMonth = 0;
                }
                
                // Calculate interest for this period
                const interest = balance * monthlyRate;
                const principal = monthlyPI - interest + extraMonthly + extraPaymentThisMonth;
                
                // Update balance
                balance = Math.max(0, balance - principal);
                
                // Create table row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDateForDisplay(paymentDate)}</td>
                    <td>${formatCurrency(monthlyPI + propertyTax + homeInsurance + pmi + hoaFees + extraMonthly + extraPaymentThisMonth)}</td>
                    <td>${formatCurrency(principal)}</td>
                    <td>${formatCurrency(interest)}</td>
                    <td>${formatCurrency(propertyTax)}</td>
                    <td>${formatCurrency(homeInsurance)}</td>
                    <td>${formatCurrency(pmi)}</td>
                    <td>${formatCurrency(hoaFees)}</td>
                    <td>${formatCurrency(extraMonthly + extraPaymentThisMonth)}</td>
                    <td>${formatCurrency(balance)}</td>
                `;
                
                scheduleBody.appendChild(row);
            }
            
            // Update pagination info
            paginationInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            
            // Update pagination buttons
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        // Update amortization schedule
        function updateAmortizationSchedule() {
            const amortBody = document.getElementById('amortization-body');
            const paginationInfo = document.getElementById('amort-pagination-info');
            const prevBtn = document.getElementById('amort-prev-page');
            const nextBtn = document.getElementById('amort-next-page');
            
            // Clear existing rows
            amortBody.innerHTML = '';
            
            // Get calculation data
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value) / 100;
            const loanTerm = getSelectedTerm();
            
            // Calculate loan amount
            const loanAmount = homePrice - downPayment;
            
            // Calculate monthly principal and interest
            const monthlyRate = interestRate / 12;
            const numberOfPayments = loanTerm * 12;
            const monthlyPI = loanAmount * 
                (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            
            // Generate amortization schedule
            let balance = loanAmount;
            let totalPrincipal = 0;
            let totalInterest = 0;
            const startDate = new Date();
            let extraPaymentThisMonth = 0;
            const oneTimeExtra = parseCurrency(document.getElementById('one-time-extra').value);
            const oneTimeDate = document.getElementById('one-time-date').value;
            const extraMonthly = parseCurrency(document.getElementById('extra-monthly').value);
            
            // Calculate pagination
            const totalPages = Math.ceil(numberOfPayments / itemsPerPage);
            const startIndex = (currentAmortPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, numberOfPayments);
            
            // Store amortization data for chart updates
            amortizationData = [];
            
            for (let i = startIndex; i < endIndex; i++) {
                const paymentDate = new Date(startDate);
                paymentDate.setMonth(paymentDate.getMonth() + i);
                
                // Check if this is the one-time extra payment month
                const paymentDateString = formatDateForInput(paymentDate);
                if (oneTimeDate === paymentDateString) {
                    extraPaymentThisMonth = oneTimeExtra;
                } else {
                    extraPaymentThisMonth = 0;
                }
                
                // Calculate interest for this period
                const interest = balance * monthlyRate;
                const principal = monthlyPI - interest + extraMonthly + extraPaymentThisMonth;
                
                // Update totals
                totalPrincipal += principal;
                totalInterest += interest;
                
                // Update balance
                balance = Math.max(0, balance - principal);
                
                // Store data for charts
                amortizationData.push({
                    paymentNumber: i + 1,
                    date: paymentDate,
                    principal: principal,
                    interest: interest,
                    extra: extraMonthly + extraPaymentThisMonth,
                    totalPrincipal: totalPrincipal,
                    totalInterest: totalInterest,
                    balance: balance
                });
                
                // Create table row
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td>${formatDateForDisplay(paymentDate)}</td>
                    <td>${formatCurrency(monthlyPI + extraMonthly + extraPaymentThisMonth)}</td>
                    <td>${formatCurrency(principal)}</td>
                    <td>${formatCurrency(interest)}</td>
                    <td>${formatCurrency(extraMonthly + extraPaymentThisMonth)}</td>
                    <td>${formatCurrency(totalPrincipal)}</td>
                    <td>${formatCurrency(totalInterest)}</td>
                    <td>${formatCurrency(balance)}</td>
                `;
                
                amortBody.appendChild(row);
            }
            
            // Update pagination info
            paginationInfo.textContent = `Page ${currentAmortPage} of ${totalPages}`;
            
            // Update pagination buttons
            prevBtn.disabled = currentAmortPage === 1;
            nextBtn.disabled = currentAmortPage === totalPages;
            
            // Update year details
            updateYearDetails();
        }

        // Update year details based on slider
        function updateYearDetails() {
            const yearSlider = document.getElementById('year-slider');
            const selectedYear = parseInt(yearSlider.value);
            const selectedYearElement = document.getElementById('selected-year');
            const yearTitle = document.getElementById('year-title');
            
            selectedYearElement.textContent = `Year ${selectedYear}`;
            yearTitle.textContent = `Year ${selectedYear} Details`;
            
            // Calculate totals for selected year
            const startPayment = (selectedYear - 1) * 12;
            const endPayment = Math.min(startPayment + 11, amortizationData.length - 1);
            
            let yearPrincipal = 0;
            let yearInterest = 0;
            let yearEndBalance = 0;
            
            if (amortizationData.length > 0) {
                for (let i = startPayment; i <= endPayment; i++) {
                    if (amortizationData[i]) {
                        yearPrincipal += amortizationData[i].principal;
                        yearInterest += amortizationData[i].interest;
                        yearEndBalance = amortizationData[i].balance;
                    }
                }
            }
            
            // Update display
            document.getElementById('year-principal-paid').textContent = formatCurrency(yearPrincipal);
            document.getElementById('year-interest-paid').textContent = formatCurrency(yearInterest);
            document.getElementById('year-remaining-balance').textContent = formatCurrency(yearEndBalance);
        }

        // Toggle between monthly and yearly schedule views
        function toggleScheduleView(view) {
            currentScheduleView = view;
            
            // Update active button
            document.querySelectorAll('.schedule-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.schedule-btn[data-view="${view}"]`).classList.add('active');
            
            // Update schedule display
            updatePaymentSchedule();
        }

        // Update AI insights based on current calculation
        function updateAIInsights() {
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value);
            const loanTerm = getSelectedTerm();
            const loanType = getSelectedLoanType();
            const extraMonthly = parseCurrency(document.getElementById('extra-monthly').value);
            
            const downPaymentPercent = (downPayment / homePrice) * 100;
            const loanAmount = homePrice - downPayment;
            
            // Smart Recommendation
            let recommendation = '';
            if (downPaymentPercent < 20) {
                recommendation = `Consider increasing your down payment to 20% to eliminate PMI and save money.`;
            } else if (downPaymentPercent >= 20 && downPaymentPercent < 25) {
                recommendation = `Your down payment of ${downPaymentPercent.toFixed(1)}% is excellent! This eliminates PMI.`;
            } else {
                recommendation = `Your down payment of ${downPaymentPercent.toFixed(1)}% is outstanding! You're building strong equity from day one.`;
            }
            document.getElementById('smart-recommendation').textContent = recommendation;
            
            // Interest Optimization
            let interestOptimization = '';
            if (extraMonthly === 0) {
                const suggestedExtra = Math.round(loanAmount * 0.001); // 0.1% of loan amount
                interestOptimization = `Consider making an extra $${suggestedExtra} monthly payment to significantly reduce your interest and pay off your loan faster.`;
            } else {
                interestOptimization = `Your extra $${extraMonthly} monthly payment is helping you build equity faster and save on interest.`;
            }
            document.getElementById('interest-optimization').textContent = interestOptimization;
            
            // Debt-to-Income Analysis
            const monthlyPayment = parseCurrency(document.getElementById('total-monthly-payment').textContent);
            const estimatedIncome = monthlyPayment / 0.28 * 12; // Assuming 28% DTI
            document.getElementById('dti-analysis').textContent = 
                `Your estimated payment is affordable for households earning $${Math.round(estimatedIncome).toLocaleString()} annually (28% DTI ratio).`;
            
            // Market Comparison
            const marketAverage = loanTerm === 15 ? 5.75 : 6.50;
            let marketComparison = '';
            if (interestRate < marketAverage - 0.25) {
                marketComparison = `Your ${interestRate}% rate is excellent - significantly below the current market average of ${marketAverage}%.`;
            } else if (interestRate <= marketAverage + 0.25) {
                marketComparison = `Your ${interestRate}% rate is competitive with current market averages of ${marketAverage}%.`;
            } else {
                marketComparison = `Your ${interestRate}% rate is above current market averages. Consider shopping around for better rates.`;
            }
            document.getElementById('market-comparison').textContent = marketComparison;
            
            // Payoff Strategy
            let payoffStrategy = '';
            if (loanTerm === 30) {
                payoffStrategy = `Consider a bi-weekly payment strategy to pay off your 30-year loan 4-5 years early and save tens of thousands in interest.`;
            } else if (loanTerm === 15) {
                payoffStrategy = `Your 15-year loan is already an aggressive payoff strategy. You'll build equity much faster than with a 30-year loan.`;
            } else {
                payoffStrategy = `Your ${loanTerm}-year loan term strikes a good balance between affordable payments and faster equity building.`;
            }
            document.getElementById('payoff-strategy').textContent = payoffStrategy;
        }

        // NEW: Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Activate selected tab button
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).setAttribute('aria-selected', 'true');
            
            currentTab = tabName;
        }

        // NEW: Show loan comparison modal
        function showComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            modal.classList.add('show');
            
            // Populate comparison scenarios
            populateComparisonScenarios();
        }

        // NEW: Close loan comparison modal
        function closeComparisonModal() {
            const modal = document.getElementById('comparison-modal');
            modal.classList.remove('show');
        }

        // NEW: Populate comparison scenarios
        function populateComparisonScenarios() {
            const scenariosContainer = document.getElementById('comparison-scenarios');
            scenariosContainer.innerHTML = '';
            
            // Current scenario
            const currentScenario = getCurrentScenario();
            scenariosContainer.appendChild(createScenarioCard(currentScenario, 'current', true));
            
            // Saved scenarios
            savedScenarios.forEach((scenario, index) => {
                scenariosContainer.appendChild(createScenarioCard(scenario, `saved-${index}`, false));
            });
            
            // Add default comparison scenarios
            const comparisonScenarios = [
                {
                    name: '15-Year Fixed',
                    loanAmount: currentScenario.loanAmount,
                    interestRate: 5.75,
                    loanTerm: 15,
                    monthlyPayment: calculateMonthlyPayment(currentScenario.loanAmount, 5.75, 15),
                    totalInterest: calculateTotalInterest(currentScenario.loanAmount, 5.75, 15),
                    totalCost: currentScenario.loanAmount + calculateTotalInterest(currentScenario.loanAmount, 5.75, 15)
                },
                {
                    name: '20% Down Payment',
                    loanAmount: currentScenario.homePrice * 0.8,
                    interestRate: currentScenario.interestRate,
                    loanTerm: currentScenario.loanTerm,
                    monthlyPayment: calculateMonthlyPayment(currentScenario.homePrice * 0.8, currentScenario.interestRate, currentScenario.loanTerm),
                    totalInterest: calculateTotalInterest(currentScenario.homePrice * 0.8, currentScenario.interestRate, currentScenario.loanTerm),
                    totalCost: (currentScenario.homePrice * 0.8) + calculateTotalInterest(currentScenario.homePrice * 0.8, currentScenario.interestRate, currentScenario.loanTerm)
                },
                {
                    name: 'Lower Rate (6.0%)',
                    loanAmount: currentScenario.loanAmount,
                    interestRate: 6.0,
                    loanTerm: currentScenario.loanTerm,
                    monthlyPayment: calculateMonthlyPayment(currentScenario.loanAmount, 6.0, currentScenario.loanTerm),
                    totalInterest: calculateTotalInterest(currentScenario.loanAmount, 6.0, currentScenario.loanTerm),
                    totalCost: currentScenario.loanAmount + calculateTotalInterest(currentScenario.loanAmount, 6.0, currentScenario.loanTerm)
                }
            ];
            
            comparisonScenarios.forEach((scenario, index) => {
                scenariosContainer.appendChild(createScenarioCard(scenario, `comparison-${index}`, false));
            });
        }

        // NEW: Create scenario card for comparison
        function createScenarioCard(scenario, id, isFeatured) {
            const card = document.createElement('div');
            card.className = `scenario-card ${isFeatured ? 'featured' : ''}`;
            card.id = `scenario-${id}`;
            
            card.innerHTML = `
                <div class="scenario-header">
                    <h4 class="scenario-name">${scenario.name}</h4>
                    ${isFeatured ? '<span class="scenario-badge">Current</span>' : ''}
                </div>
                <div class="scenario-details">
                    <div class="scenario-detail">
                        <span class="detail-label">Loan Amount</span>
                        <span class="detail-value">${formatCurrency(scenario.loanAmount)}</span>
                    </div>
                    <div class="scenario-detail">
                        <span class="detail-label">Interest Rate</span>
                        <span class="detail-value">${scenario.interestRate}%</span>
                    </div>
                    <div class="scenario-detail">
                        <span class="detail-label">Loan Term</span>
                        <span class="detail-value">${scenario.loanTerm} years</span>
                    </div>
                    <div class="scenario-detail">
                        <span class="detail-label">Monthly Payment</span>
                        <span class="detail-value highlight">${formatCurrency(scenario.monthlyPayment)}</span>
                    </div>
                    <div class="scenario-detail">
                        <span class="detail-label">Total Interest</span>
                        <span class="detail-value">${formatCurrency(scenario.totalInterest)}</span>
                    </div>
                    <div class="scenario-detail">
                        <span class="detail-label">Total Cost</span>
                        <span class="detail-value">${formatCurrency(scenario.totalCost)}</span>
                    </div>
                </div>
                <div class="scenario-actions">
                    ${!isFeatured ? `
                        <button class="scenario-btn primary" onclick="applyScenario('${id}')">Apply This Scenario</button>
                    ` : `
                        <button class="scenario-btn secondary" onclick="saveCurrentScenario()">Save This Scenario</button>
                    `}
                </div>
            `;
            
            return card;
        }

        // NEW: Get current scenario data
        function getCurrentScenario() {
            const homePrice = parseCurrency(document.getElementById('home-price').value);
            const downPayment = parseCurrency(document.getElementById('down-payment').value);
            const interestRate = parseFloat(document.getElementById('interest-rate').value);
            const loanTerm = getSelectedTerm();
            const loanAmount = homePrice - downPayment;
            const monthlyPayment = parseCurrency(document.getElementById('total-monthly-payment').textContent);
            const totalInterest = parseCurrency(document.getElementById('summary-total-interest').textContent);
            const totalCost = parseCurrency(document.getElementById('summary-total-cost').textContent);
            
            return {
                name: 'Current Scenario',
                homePrice: homePrice,
                downPayment: downPayment,
                loanAmount: loanAmount,
                interestRate: interestRate,
                loanTerm: loanTerm,
                monthlyPayment: monthlyPayment,
                totalInterest: totalInterest,
                totalCost: totalCost
            };
        }

        // NEW: Apply a scenario to the calculator
        function applyScenario(scenarioId) {
            const scenarioElement = document.getElementById(`scenario-${scenarioId}`);
            if (!scenarioElement) return;
            
            const scenario = savedScenarios.find(s => s.id === scenarioId) || 
                           getComparisonScenario(scenarioId);
            
            if (scenario) {
                // Apply scenario values to calculator
                document.getElementById('home-price').value = formatCurrency(scenario.homePrice);
                document.getElementById('down-payment').value = formatCurrency(scenario.downPayment);
                document.getElementById('interest-rate').value = scenario.interestRate;
                
                // Set loan term
                if (scenario.loanTerm === 15) {
                    document.querySelector('.term-chip[data-term="15"]').click();
                } else if (scenario.loanTerm === 20) {
                    document.querySelector('.term-chip[data-term="20"]').click();
                } else {
                    document.querySelector('.term-chip[data-term="30"]').click();
                }
                
                // Update calculation
                updateCalculation();
                
                // Close modal
                closeComparisonModal();
                
                // Show success message
                showToast(`Applied ${scenario.name} scenario`, 'success');
            }
        }

        // NEW: Get comparison scenario by ID
        function getComparisonScenario(scenarioId) {
            // This would return one of the default comparison scenarios
            // Implementation would depend on how scenarios are stored
            return null;
        }

        // NEW: Add new scenario
        function addNewScenario() {
            const current = getCurrentScenario();
            current.name = `Scenario ${savedScenarios.length + 1}`;
            current.id = `scenario-${Date.now()}`;
            
            savedScenarios.push(current);
            saveScenariosToStorage();
            
            // Update comparison view
            populateComparisonScenarios();
            
            showToast('New scenario saved successfully', 'success');
        }

        // NEW: Save current scenario
        function saveCurrentScenario() {
            const current = getCurrentScenario();
            current.name = prompt('Enter a name for this scenario:', `My Scenario ${savedScenarios.length + 1}`) || 
                          `Scenario ${savedScenarios.length + 1}`;
            current.id = `scenario-${Date.now()}`;
            
            savedScenarios.push(current);
            saveScenariosToStorage();
            
            showToast('Scenario saved successfully', 'success');
        }

        // NEW: Save scenarios to localStorage
        function saveScenariosToStorage() {
            try {
                localStorage.setItem('finguidSavedScenarios', JSON.stringify(savedScenarios));
            } catch (e) {
                console.error('Failed to save scenarios:', e);
            }
        }

        // NEW: Load saved scenarios from localStorage
        function loadSavedScenarios() {
            try {
                const saved = localStorage.getItem('finguidSavedScenarios');
                if (saved) {
                    savedScenarios = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Failed to load scenarios:', e);
            }
        }

        // Calculate monthly payment
        function calculateMonthlyPayment(loanAmount, interestRate, loanTerm) {
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanTerm * 12;
            return loanAmount * 
                (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
        }

        // Calculate total interest
        function calculateTotalInterest(loanAmount, interestRate, loanTerm) {
            const monthlyPayment = calculateMonthlyPayment(loanAmount, interestRate, loanTerm);
            return (monthlyPayment * loanTerm * 12) - loanAmount;
        }

        // Refresh live rate from FRED API
        function refreshLiveRate() {
            showLoading();
            
            // In a real implementation, this would call the FRED API
            // For demo purposes, we'll simulate the API call
            setTimeout(() => {
                // Simulate getting live rates
                const thirtyYearRate = 6.44 + (Math.random() * 0.1 - 0.05); // Small random variation
                const fifteenYearRate = 5.75 + (Math.random() * 0.1 - 0.05);
                const treasuryRate = 4.25 + (Math.random() * 0.1 - 0.05);
                
                // Update interest rate input with 30-year rate
                document.getElementById('interest-rate').value = thirtyYearRate.toFixed(2);
                
                // Update market insights
                document.getElementById('rate-change-30yr').textContent = 
                    `${thirtyYearRate > 6.44 ? '+' : ''}${(thirtyYearRate - 6.44).toFixed(2)}%`;
                document.getElementById('rate-change-30yr').className = 
                    `stat-change ${thirtyYearRate > 6.44 ? 'positive' : 'negative'}`;
                
                document.getElementById('rate-change-15yr').textContent = 
                    `${fifteenYearRate > 5.75 ? '+' : ''}${(fifteenYearRate - 5.75).toFixed(2)}%`;
                document.getElementById('rate-change-15yr').className = 
                    `stat-change ${fifteenYearRate > 5.75 ? 'positive' : 'negative'}`;
                
                document.getElementById('treasury-change').textContent = 
                    `${treasuryRate > 4.25 ? '+' : ''}${(treasuryRate - 4.25).toFixed(2)}%`;
                document.getElementById('treasury-change').className = 
                    `stat-change ${treasuryRate > 4.25 ? 'positive' : 'negative'}`;
                
                // Update calculation
                updateCalculation();
                
                hideLoading();
                
                showToast('Live rates updated from Federal Reserve', 'success');
            }, 1000);
        }

        // Save calculation
        function saveCalculation() {
            const calculationData = getCurrentScenario();
            
            try {
                // In a real implementation, this would save to a database or localStorage
                localStorage.setItem('finguidLastCalculation', JSON.stringify(calculationData));
                showToast('Calculation saved successfully', 'success');
            } catch (e) {
                showToast('Failed to save calculation', 'error');
            }
        }

        // Export to PDF
        function exportToPDF() {
            showLoading();
            
            // In a real implementation, this would generate a PDF
            // For demo purposes, we'll simulate the process
            setTimeout(() => {
                hideLoading();
                showToast('PDF export started - check your downloads', 'success');
                
                // In a real implementation, we would use a library like jsPDF
                // This is a simplified simulation
                const pdfWindow = window.open('', '_blank');
                pdfWindow.document.write(`
                    <html>
                        <head>
                            <title>FinGuid Mortgage Calculation</title>
                            <style>
                                body { font-family: Arial, sans-serif; padding: 20px; }
                                .header { text-align: center; margin-bottom: 30px; }
                                .section { margin-bottom: 20px; }
                                table { width: 100%; border-collapse: collapse; }
                                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                                th { background-color: #f2f2f2; }
                            </style>
                        </head>
                        <body>
                            <div class="header">
                                <h1>FinGuid Mortgage Calculation</h1>
                                <p>Generated on ${new Date().toLocaleDateString()}</p>
                            </div>
                            <div class="section">
                                <h2>Loan Summary</h2>
                                <p>Total Monthly Payment: ${document.getElementById('total-monthly-payment').textContent}</p>
                                <p>Loan Amount: ${document.getElementById('summary-loan-amount').textContent}</p>
                                <p>Total Interest: ${document.getElementById('summary-total-interest').textContent}</p>
                                <p>Total Cost: ${document.getElementById('summary-total-cost').textContent}</p>
                            </div>
                            <div class="section">
                                <h2>Payment Breakdown</h2>
                                <p>Principal & Interest: ${document.getElementById('principal-interest').textContent}</p>
                                <p>Taxes & Insurance: ${document.getElementById('tax-insurance').textContent}</p>
                            </div>
                        </body>
                    </html>
                `);
                pdfWindow.document.close();
                pdfWindow.print();
            }, 1500);
        }

        // Export to CSV
        function exportToCSV() {
            showLoading();
            
            // In a real implementation, this would generate a CSV file
            // For demo purposes, we'll simulate the process
            setTimeout(() => {
                hideLoading();
                
                // Create CSV content
                let csvContent = "Payment Date,Payment,Principal,Interest,Tax,Insurance,PMI,HOA,Extra,Balance\n";
                
                // Add payment schedule data (first 12 payments for demo)
                const startDate = new Date();
                for (let i = 0; i < 12; i++) {
                    const paymentDate = new Date(startDate);
                    paymentDate.setMonth(paymentDate.getMonth() + i);
                    
                    // Simplified data for demo
                    csvContent += `${formatDateForDisplay(paymentDate)},$2,499,$425,$1,831,$750,$150,$0,$0,$0,$355,575\n`;
                }
                
                // Create download link
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'finguid-mortgage-schedule.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('CSV file downloaded successfully', 'success');
            }, 1000);
        }

        // Export amortization to PDF
        function exportAmortizationPDF() {
            showToast('Amortization PDF export would be implemented here', 'info');
        }

        // Export amortization to CSV
        function exportAmortizationCSV() {
            showToast('Amortization CSV export would be implemented here', 'info');
        }

        // Share results
        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'My Mortgage Calculation',
                    text: `Check out my mortgage calculation: ${document.getElementById('total-monthly-payment').textContent} monthly payment`,
                    url: window.location.href
                })
                .then(() => showToast('Calculation shared successfully', 'success'))
                .catch(() => showToast('Share cancelled', 'info'));
            } else {
                // Fallback for browsers that don't support Web Share API
                const shareUrl = window.location.href;
                navigator.clipboard.writeText(shareUrl)
                    .then(() => showToast('Link copied to clipboard', 'success'))
                    .catch(() => showToast('Failed to copy link', 'error'));
            }
        }

        // Show partner offer
        function showPartnerOffer(partner) {
            showToast(`Redirecting to ${partner} offer...`, 'info');
            // In a real implementation, this would redirect to the partner's site
        }

        // Show insurance comparison
        function showInsuranceComparison() {
            showToast('Opening insurance comparison...', 'info');
            // In a real implementation, this would show an insurance comparison modal
        }

        // Voice control functions
        function toggleVoiceControl() {
            const voiceBtn = document.getElementById('voice-toggle');
            
            if (isListening) {
                stopVoiceRecognition();
                voiceBtn.classList.remove('active');
                showToast('Voice control disabled', 'info');
            } else {
                showVoiceModal();
                voiceBtn.classList.add('active');
            }
        }

        function showVoiceModal() {
            const modal = document.getElementById('voice-modal');
            modal.classList.add('show');
        }

        function closeVoiceModal() {
            const modal = document.getElementById('voice-modal');
            modal.classList.remove('show');
            stopVoiceRecognition();
        }

        function startVoiceRecognition() {
            // Check if browser supports speech recognition
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showToast('Speech recognition not supported in this browser', 'error');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            voiceRecognition = new SpeechRecognition();
            
            voiceRecognition.continuous = true;
            voiceRecognition.interimResults = true;
            voiceRecognition.lang = 'en-US';
            
            voiceRecognition.onstart = function() {
                isListening = true;
                document.getElementById('voice-status').classList.add('show');
                document.getElementById('start-voice-btn').innerHTML = '<i class="fas fa-microphone-slash" aria-hidden="true"></i> Stop Listening';
                showToast('Voice recognition started. Speak your commands.', 'info');
            };
            
            voiceRecognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                // Process commands when we have final results
                if (finalTranscript) {
                    processVoiceCommand(finalTranscript);
                }
            };
            
            voiceRecognition.onerror = function(event) {
                console.error('Speech recognition error', event.error);
                if (event.error === 'not-allowed') {
                    showToast('Microphone access denied. Please allow microphone access to use voice commands.', 'error');
                } else {
                    showToast('Voice recognition error: ' + event.error, 'error');
                }
                stopVoiceRecognition();
            };
            
            voiceRecognition.onend = function() {
                if (isListening) {
                    // Restart recognition if it ended unexpectedly
                    voiceRecognition.start();
                }
            };
            
            voiceRecognition.start();
        }

        function stopVoiceRecognition() {
            if (voiceRecognition) {
                voiceRecognition.stop();
            }
            isListening = false;
            document.getElementById('voice-status').classList.remove('show');
            document.getElementById('start-voice-btn').innerHTML = '<i class="fas fa-microphone" aria-hidden="true"></i> Start Listening';
        }

        function processVoiceCommand(command) {
            command = command.toLowerCase().trim();
            showToast(`Heard: "${command}"`, 'info');
            
            // Basic navigation commands
            if (command.includes('go to results') || command.includes('show results')) {
                document.getElementById('results-section-title').scrollIntoView({ behavior: 'smooth' });
                showToast('Navigated to results', 'success');
            }
            else if (command.includes('show insights') || command.includes('ai insights')) {
                switchTab('ai-insights');
                showToast('Showing AI insights', 'success');
            }
            else if (command.includes('export pdf')) {
                exportToPDF();
            }
            else if (command.includes('save calculation')) {
                saveCalculation();
            }
            // Input control commands
            else if (command.includes('set home price')) {
                const amount = extractNumber(command);
                if (amount) {
                    document.getElementById('home-price').value = formatCurrency(amount);
                    updateCalculation();
                    showToast(`Home price set to ${formatCurrency(amount)}`, 'success');
                }
            }
            else if (command.includes('set down payment')) {
                const amount = extractNumber(command);
                if (amount) {
                    if (command.includes('percent') || command.includes('%')) {
                        document.getElementById('down-payment-percent').value = amount;
                        syncDownPaymentPercent();
                    } else {
                        document.getElementById('down-payment').value = formatCurrency(amount);
                        syncDownPaymentDollar();
                    }
                    showToast(`Down payment set to ${formatCurrency(amount)}`, 'success');
                }
            }
            else if (command.includes('set interest rate')) {
                const rate = extractNumber(command);
                if (rate) {
                    document.getElementById('interest-rate').value = rate;
                    updateCalculation();
                    showToast(`Interest rate set to ${rate}%`, 'success');
                }
            }
            else if (command.includes('set loan term')) {
                const years = extractNumber(command);
                if (years && years >= 5 && years <= 40) {
                    if ([10, 15, 20, 30].includes(years)) {
                        // Click the corresponding term chip
                        document.querySelector(`.term-chip[data-term="${years}"]`).click();
                    } else {
                        // Set custom term
                        document.getElementById('custom-term').value = years;
                        selectCustomTerm();
                    }
                    showToast(`Loan term set to ${years} years`, 'success');
                }
            }
            // Loan type commands
            else if (command.includes('conventional loan')) {
                document.querySelector('.loan-type-btn[data-loan-type="conventional"]').click();
                showToast('Switched to conventional loan', 'success');
            }
            else if (command.includes('fha loan')) {
                document.querySelector('.loan-type-btn[data-loan-type="fha"]').click();
                showToast('Switched to FHA loan', 'success');
            }
            else if (command.includes('va loan')) {
                document.querySelector('.loan-type-btn[data-loan-type="va"]').click();
                showToast('Switched to VA loan', 'success');
            }
            else if (command.includes('usda loan')) {
                document.querySelector('.loan-type-btn[data-loan-type="usda"]').click();
                showToast('Switched to USDA loan', 'success');
            }
            else if (command.includes('stop') || command.includes('quit')) {
                stopVoiceRecognition();
                showToast('Voice recognition stopped', 'info');
            }
            else {
                showToast('Command not recognized. Say "stop" to end voice control.', 'warning');
            }
        }

        function extractNumber(command) {
            const matches = command.match(/\d+(\.\d+)?/);
            return matches ? parseFloat(matches[0]) : null;
        }

        // Accessibility functions
        function adjustFontSize(action) {
            const body = document.body;
            const currentScale = parseFloat(getComputedStyle(body).getPropertyValue('--font-scale')) || 1;
            
            let newScale = currentScale;
            switch (action) {
                case 'increase':
                    newScale = Math.min(1.25, currentScale + 0.125);
                    break;
                case 'decrease':
                    newScale = Math.max(0.75, currentScale - 0.125);
                    break;
                case 'reset':
                    newScale = 1;
                    break;
            }
            
            body.style.setProperty('--font-scale', newScale);
            
            // Update active button
            document.querySelectorAll('.font-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`font-${action}`).classList.add('active');
            
            showToast(`Font size ${action === 'increase' ? 'increased' : action === 'decrease' ? 'decreased' : 'reset'}`, 'success');
        }

        function toggleTheme() {
            const currentScheme = document.documentElement.getAttribute('data-color-scheme');
            const newScheme = currentScheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-color-scheme', newScheme);
            
            // Update button text and icon
            const themeBtn = document.getElementById('theme-toggle');
            const themeIcon = themeBtn.querySelector('i');
            const themeLabel = themeBtn.querySelector('.control-label');
            
            if (newScheme === 'dark') {
                themeIcon.className = 'fas fa-sun';
                themeLabel.textContent = 'Light';
            } else {
                themeIcon.className = 'fas fa-moon';
                themeLabel.textContent = 'Dark';
            }
            
            // Save preference
            localStorage.setItem('finguidColorScheme', newScheme);
            
            showToast(`${newScheme === 'dark' ? 'Dark' : 'Light'} mode activated`, 'success');
        }

        function toggleScreenReaderMode() {
            isScreenReaderMode = !isScreenReaderMode;
            const body = document.body;
            const srBtn = document.getElementById('screen-reader-btn');
            
            if (isScreenReaderMode) {
                body.classList.add('screen-reader-mode');
                srBtn.classList.add('active');
                srBtn.setAttribute('aria-pressed', 'true');
                showToast('Screen reader mode enabled', 'success');
                
                // Announce to screen readers
                announceToScreenReader('Screen reader mode enabled. Enhanced accessibility features activated.');
            } else {
                body.classList.remove('screen-reader-mode');
                srBtn.classList.remove('active');
                srBtn.setAttribute('aria-pressed', 'false');
                showToast('Screen reader mode disabled', 'info');
            }
        }

        function announceToScreenReader(message) {
            const announcements = document.getElementById('sr-announcements');
            announcements.textContent = message;
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loading-overlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('show');
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="${icons[type]}" aria-hidden="true"></i>
                <span class="toast-message">${message}</span>
                <button type="button" class="toast-close" aria-label="Close notification">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add close event
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        // Load saved theme preference
        function loadThemePreference() {
            const savedScheme = localStorage.getItem('finguidColorScheme');
            if (savedScheme) {
                document.documentElement.setAttribute('data-color-scheme', savedScheme);
                
                // Update button text and icon
                const themeBtn = document.getElementById('theme-toggle');
                const themeIcon = themeBtn.querySelector('i');
                const themeLabel = themeBtn.querySelector('.control-label');
                
                if (savedScheme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                    themeLabel.textContent = 'Light';
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeLabel.textContent = 'Dark';
                }
            }
        }

        // Initialize theme on load
        loadThemePreference();

        // ===========================================================================
        // END OF FINGUID - HOME LOAN PRO - AI-POWERED MORTGAGE CALCULATOR - ENHANCED JS
        // ALL IMPROVEMENTS IMPLEMENTED - PERFECT VISIBILITY & ANIMATIONS
        // Layout: Left 29% | Middle 42% | Right 29% - PRODUCTION READY
        // ===========================================================================
    </script>
</body>
</html>
