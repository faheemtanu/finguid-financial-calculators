<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finguid - Mortgage Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Additional styles specific to the mortgage calculator */
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-32);
            margin-bottom: var(--space-32);
        }
        
        @media (max-width: 968px) {
            .calculator-container {
                grid-template-columns: 1fr;
            }
        }
        
        .calculator-form, .calculator-results {
            background: var(--color-surface);
            padding: var(--space-32);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--color-card-border);
        }
        
        .form-group {
            margin-bottom: var(--space-24);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }
        
        .form-input {
            width: 100%;
            padding: var(--space-12);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            transition: border-color var(--duration-normal) var(--ease-standard), 
                        box-shadow var(--duration-normal) var(--ease-standard);
            background-color: var(--color-surface);
            color: var(--color-text);
        }
        
        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: var(--focus-ring);
            outline: none;
        }
        
        .slider-container {
            margin-top: var(--space-8);
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--color-border);
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
        }
        
        .result-section {
            background: var(--color-bg-1);
            padding: var(--space-24);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-primary);
            margin-bottom: var(--space-24);
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: var(--space-12) 0;
            border-bottom: 1px solid var(--color-border);
        }
        
        .payment-item:last-child {
            border-bottom: none;
        }
        
        .payment-label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
        }
        
        .payment-value {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            font-size: var(--font-size-lg);
        }
        
        .highlight-payment {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            padding: var(--space-24);
            border-radius: var(--radius-lg);
            text-align: center;
            margin-top: var(--space-24);
        }
        
        .highlight-payment .payment-label {
            color: var(--color-btn-primary-text);
            font-size: var(--font-size-lg);
        }
        
        .highlight-payment .payment-value {
            color: var(--color-btn-primary-text);
            font-size: var(--font-size-2xl);
            margin-top: var(--space-8);
        }
        
        .ai-insights {
            background: rgba(var(--color-success-rgb), var(--status-bg-opacity));
            border-left: 4px solid var(--color-success);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin-top: var(--space-16);
        }
        
        .ai-insights h4 {
            color: var(--color-success);
            margin-bottom: var(--space-8);
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }
        
        .ai-insights ul {
            padding-left: var(--space-20);
            color: var(--color-text);
        }
        
        .ai-insights li {
            margin-bottom: var(--space-8);
        }
        
        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-16);
            font-size: var(--font-size-sm);
        }
        
        .amortization-table th {
            background: var(--color-bg-1);
            padding: var(--space-12);
            text-align: left;
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            border-bottom: 2px solid var(--color-border);
        }
        
        .amortization-table td {
            padding: var(--space-12);
            border-bottom: 1px solid var(--color-border);
        }
        
        .amortization-table tr:hover {
            background: var(--color-bg-1);
        }
        
        .download-options {
            display: flex;
            gap: var(--space-16);
            margin-top: var(--space-24);
        }
        
        @media (max-width: 768px) {
            .download-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="navbar">
                <a href="index.html" class="nav-brand">
                    <i class="fas fa-calculator"></i>
                    <span class="brand-text">Finguid Calculators</span>
                </a>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <nav class="nav-menu" id="navMenu">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="calculators.html" class="nav-link">Calculators</a>
                    <a href="resources.html" class="nav-link">Resources</a>
                    <a href="partners.html" class="nav-link">Partners</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <h1 class="page-title">Mortgage Calculator</h1>
            
            <div class="calculator-container">
                <div class="calculator-form">
                    <h2>Loan Details</h2>
                    <div class="form-group">
                        <label for="loanAmount" class="form-label">Loan Amount ($)</label>
                        <input type="number" id="loanAmount" class="form-input" value="300000" min="0">
                        <div class="slider-container">
                            <input type="range" min="0" max="1000000" value="300000" class="slider" id="loanAmountSlider">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="interestRate" class="form-label">Interest Rate (%)</label>
                        <input type="number" id="interestRate" class="form-input" value="4.5" min="0" step="0.1">
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="4.5" step="0.1" class="slider" id="interestRateSlider">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanTerm" class="form-label">Loan Term (years)</label>
                        <input type="number" id="loanTerm" class="form-input" value="30" min="1" max="40">
                        <div class="slider-container">
                            <input type="range" min="1" max="40" value="30" class="slider" id="loanTermSlider">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="propertyTax" class="form-label">Annual Property Tax ($)</label>
                        <input type="number" id="propertyTax" class="form-input" value="3600" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="insurance" class="form-label">Annual Insurance ($)</label>
                        <input type="number" id="insurance" class="form-input" value="1200" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="pmi" class="form-label">PMI (% of loan annually, if applicable)</label>
                        <input type="number" id="pmi" class="form-input" value="0.5" min="0" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label for="hoa" class="form-label">Monthly HOA Fees ($)</label>
                        <input type="number" id="hoa" class="form-input" value="0" min="0">
                    </div>
                    
                    <button class="btn btn-primary btn-full-width" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calculate Mortgage
                    </button>
                </div>
                
                <div class="calculator-results">
                    <div class="result-section">
                        <h3><i class="fas fa-receipt"></i> Payment Breakdown</h3>
                        <div class="payment-item">
                            <span class="payment-label">Principal & Interest</span>
                            <span class="payment-value" id="principalInterest">$1,520.06</span>
                        </div>
                        <div class="payment-item">
                            <span class="payment-label">Property Tax</span>
                            <span class="payment-value" id="propertyTaxResult">$300.00</span>
                        </div>
                        <div class="payment-item">
                            <span class="payment-label">Home Insurance</span>
                            <span class="payment-value" id="insuranceResult">$100.00</span>
                        </div>
                        <div class="payment-item">
                            <span class="payment-label">PMI</span>
                            <span class="payment-value" id="pmiResult">$0.00</span>
                        </div>
                        <div class="payment-item">
                            <span class="payment-label">HOA Fees</span>
                            <span class="payment-value" id="hoaResult">$0.00</span>
                        </div>
                        <div class="highlight-payment">
                            <div class="payment-label">Your Monthly Payment</div>
                            <div class="payment-value" id="totalPayment">$1,920.06</div>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h3><i class="fas fa-robot"></i> AI-Powered Insights</h3>
                        <div class="ai-insights">
                            <h4><i class="fas fa-lightbulb"></i> Smart Recommendations</h4>
                            <ul id="aiInsightsList">
                                <li>Consider making an extra $100 payment monthly to shorten your loan term by 4 years</li>
                                <li>Your debt-to-income ratio is healthy at 28%</li>
                                <li>Refinancing could save you money if rates drop below 3.8%</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="result-section">
                        <h3><i class="fas fa-calendar-alt"></i> Amortization Schedule</h3>
                        <div style="overflow-x: auto;">
                            <table class="amortization-table">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Principal</th>
                                        <th>Interest</th>
                                        <th>Total Interest</th>
                                        <th>Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="amortizationBody">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="download-options">
                        <button class="btn btn-primary" id="downloadPDF">
                            <i class="fas fa-file-pdf"></i> Download PDF Report
                        </button>
                        <button class="btn btn-secondary" id="downloadCSV">
                            <i class="fas fa-file-csv"></i> Download CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <i class="fas fa-calculator"></i>
                        Finguid Calculators
                    </div>
                    <p>We provide accurate financial calculators to help you make informed decisions about your financial future.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Calculator Categories</h4>
                    <ul>
                        <li><a href="calculators.html#mortgage">Mortgage Calculators</a></li>
                        <li><a href="calculators.html#auto">Auto Loan Calculators</a></li>
                        <li><a href="calculators.html#investment">Investment Calculators</a></li>
                        <li><a href="calculators.html#retirement">Retirement Calculators</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2023 Finguid Calculators. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.getElementById('navMenu');
            
            hamburger.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                hamburger.classList.toggle('active');
            });
            
            // Get DOM elements
            const loanAmountInput = document.getElementById('loanAmount');
            const loanAmountSlider = document.getElementById('loanAmountSlider');
            const interestRateInput = document.getElementById('interestRate');
            const interestRateSlider = document.getElementById('interestRateSlider');
            const loanTermInput = document.getElementById('loanTerm');
            const loanTermSlider = document.getElementById('loanTermSlider');
            const propertyTaxInput = document.getElementById('propertyTax');
            const insuranceInput = document.getElementById('insurance');
            const pmiInput = document.getElementById('pmi');
            const hoaInput = document.getElementById('hoa');
            const calculateBtn = document.getElementById('calculateBtn');
            
            // Result elements
            const principalInterestEl = document.getElementById('principalInterest');
            const propertyTaxResultEl = document.getElementById('propertyTaxResult');
            const insuranceResultEl = document.getElementById('insuranceResult');
            const pmiResultEl = document.getElementById('pmiResult');
            const hoaResultEl = document.getElementById('hoaResult');
            const totalPaymentEl = document.getElementById('totalPayment');
            const aiInsightsListEl = document.getElementById('aiInsightsList');
            const amortizationBodyEl = document.getElementById('amortizationBody');
            
            // Download buttons
            const downloadPDF = document.getElementById('downloadPDF');
            const downloadCSV = document.getElementById('downloadCSV');
            
            // Store calculation data for export
            let calculationData = {
                inputs: {},
                results: {},
                amortization: []
            };
            
            // Sync sliders with input fields
            loanAmountInput.addEventListener('input', () => {
                loanAmountSlider.value = loanAmountInput.value;
                calculateMortgage();
            });
            
            loanAmountSlider.addEventListener('input', () => {
                loanAmountInput.value = loanAmountSlider.value;
                calculateMortgage();
            });
            
            interestRateInput.addEventListener('input', () => {
                interestRateSlider.value = interestRateInput.value;
                calculateMortgage();
            });
            
            interestRateSlider.addEventListener('input', () => {
                interestRateInput.value = interestRateSlider.value;
                calculateMortgage();
            });
            
            loanTermInput.addEventListener('input', () => {
                loanTermSlider.value = loanTermInput.value;
                calculateMortgage();
            });
            
            loanTermSlider.addEventListener('input', () => {
                loanTermInput.value = loanTermSlider.value;
                calculateMortgage();
            });
            
            // Update on other input changes
            propertyTaxInput.addEventListener('input', calculateMortgage);
            insuranceInput.addEventListener('input', calculateMortgage);
            pmiInput.addEventListener('input', calculateMortgage);
            hoaInput.addEventListener('input', calculateMortgage);
            
            calculateBtn.addEventListener('click', calculateMortgage);
            
            // Initial calculation
            calculateMortgage();
            
            function calculateMortgage() {
                // Get input values
                const loanAmount = parseFloat(loanAmountInput.value);
                const interestRate = parseFloat(interestRateInput.value) / 100 / 12; // Monthly interest rate
                const loanTerm = parseFloat(loanTermInput.value) * 12; // Months
                const propertyTax = parseFloat(propertyTaxInput.value) || 0;
                const insurance = parseFloat(insuranceInput.value) || 0;
                const pmiRate = parseFloat(pmiInput.value) / 100 || 0;
                const hoa = parseFloat(hoaInput.value) || 0;
                
                // Store input data
                calculationData.inputs = {
                    loanAmount,
                    interestRate: interestRate * 12 * 100, // Convert back to annual percentage
                    loanTerm: loanTerm / 12, // Convert back to years
                    propertyTax,
                    insurance,
                    pmi: pmiRate * 100, // Convert to percentage
                    hoa
                };
                
                // Calculate monthly payment (principal and interest)
                const x = Math.pow(1 + interestRate, loanTerm);
                const monthlyPI = (loanAmount * x * interestRate) / (x - 1);
                
                // Calculate PMI if down payment is less than 20%
                const pmiMonthly = loanAmount > 0 && pmiRate > 0 ? (loanAmount * pmiRate) / 12 : 0;
                
                // Calculate additional monthly costs
                const monthlyTax = propertyTax / 12;
                const monthlyInsurance = insurance / 12;
                
                // Calculate total monthly payment
                const totalMonthly = monthlyPI + monthlyTax + monthlyInsurance + pmiMonthly + hoa;
                
                // Format numbers as currency
                const formatter = new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2
                });
                
                // Update the UI with calculated values
                principalInterestEl.textContent = formatter.format(monthlyPI);
                propertyTaxResultEl.textContent = formatter.format(monthlyTax);
                insuranceResultEl.textContent = formatter.format(monthlyInsurance);
                pmiResultEl.textContent = formatter.format(pmiMonthly);
                hoaResultEl.textContent = formatter.format(hoa);
                totalPaymentEl.textContent = formatter.format(totalMonthly);
                
                // Store result data
                calculationData.results = {
                    principalInterest: monthlyPI,
                    propertyTax: monthlyTax,
                    insurance: monthlyInsurance,
                    pmi: pmiMonthly,
                    hoa,
                    totalPayment: totalMonthly
                };
                
                // Generate amortization schedule
                generateAmortizationSchedule(loanAmount, interestRate, loanTerm, monthlyPI);
                
                // Generate AI insights
                generateAIInsights(loanAmount, interestRate, loanTerm, monthlyPI, totalMonthly);
            }
            
            function generateAmortizationSchedule(principal, monthlyRate, term, monthlyPayment) {
                let balance = principal;
                let totalInterest = 0;
                let html = '';
                calculationData.amortization = [];
                
                // Calculate yearly breakdown
                for (let year = 1; year <= term / 12; year++) {
                    let yearPrincipal = 0;
                    let yearInterest = 0;
                    
                    for (let month = 1; month <= 12; month++) {
                        if (balance <= 0) break;
                        
                        const interestPayment = balance * monthlyRate;
                        const principalPayment = monthlyPayment - interestPayment;
                        
                        yearPrincipal += principalPayment;
                        yearInterest += interestPayment;
                        totalInterest += interestPayment;
                        
                        balance -= principalPayment;
                    }
                    
                    if (yearPrincipal > 0) {
                        html += `
                            <tr>
                                <td>${year}</td>
                                <td>${formatCurrency(yearPrincipal)}</td>
                                <td>${formatCurrency(yearInterest)}</td>
                                <td>${formatCurrency(totalInterest)}</td>
                                <td>${formatCurrency(balance)}</td>
                            </tr>
                        `;
                        
                        // Store for export
                        calculationData.amortization.push({
                            year,
                            principal: yearPrincipal,
                            interest: yearInterest,
                            totalInterest,
                            balance
                        });
                    }
                }
                
                amortizationBodyEl.innerHTML = html;
            }
            
            function generateAIInsights(loanAmount, interestRate, loanTerm, monthlyPI, totalMonthly) {
                const insights = [];
                
                // Generate insights based on loan parameters
                if (interestRate * 12 > 0.05) {
                    insights.push("Consider refinancing if rates drop below " + (interestRate * 12 - 0.01).toFixed(2) + "% to save on interest");
                }
                
                if (loanTerm > 360) {
                    insights.push("A 15-year mortgage could save you significant interest but increase monthly payments");
                }
                
                const totalCost = monthlyPI * loanTerm;
                const totalInterest = totalCost - loanAmount;
                insights.push("You'll pay " + formatCurrency(totalInterest) + " in interest over the loan term");
                
                // Debt-to-income ratio insight (assuming $6000 monthly income for example)
                const estimatedIncome = 6000;
                const dti = (totalMonthly / estimatedIncome) * 100;
                insights.push("Your estimated debt-to-income ratio is " + dti.toFixed(0) + "% " + 
                             (dti > 43 ? "(above recommended level)" : "(within healthy range)"));
                
                // Update AI insights list
                aiInsightsListEl.innerHTML = '';
                insights.forEach(insight => {
                    const li = document.createElement('li');
                    li.textContent = insight;
                    aiInsightsListEl.appendChild(li);
                });
            }
            
            function formatCurrency(value) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(value);
            }
            
            // PDF download functionality
            downloadPDF.addEventListener('click', function() {
                // Use jsPDF library
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Mortgage Calculation Report', 105, 15, { align: 'center' });
                
                // Add calculation details
                doc.setFontSize(12);
                let yPosition = 30;
                
                doc.text('Loan Details:', 14, yPosition);
                yPosition += 8;
                doc.text(`Loan Amount: ${formatCurrency(calculationData.inputs.loanAmount)}`, 20, yPosition);
                yPosition += 8;
                doc.text(`Interest Rate: ${calculationData.inputs.interestRate.toFixed(2)}%`, 20, yPosition);
                yPosition += 8;
                doc.text(`Loan Term: ${calculationData.inputs.loanTerm} years`, 20, yPosition);
                yPosition += 8;
                doc.text(`Property Tax: ${formatCurrency(calculationData.inputs.propertyTax)} annually`, 20, yPosition);
                yPosition += 8;
                doc.text(`Insurance: ${formatCurrency(calculationData.inputs.insurance)} annually`, 20, yPosition);
                yPosition += 8;
                doc.text(`PMI: ${calculationData.inputs.pmi.toFixed(2)}%`, 20, yPosition);
                yPosition += 8;
                doc.text(`HOA Fees: ${formatCurrency(calculationData.inputs.hoa)} monthly`, 20, yPosition);
                yPosition += 15;
                
                // Add payment breakdown
                doc.text('Payment Breakdown:', 14, yPosition);
                yPosition += 8;
                doc.text(`Principal & Interest: ${formatCurrency(calculationData.results.principalInterest)}`, 20, yPosition);
                yPosition += 8;
                doc.text(`Property Tax: ${formatCurrency(calculationData.results.propertyTax)}`, 20, yPosition);
                yPosition += 8;
                doc.text(`Insurance: ${formatCurrency(calculationData.results.insurance)}`, 20, yPosition);
                yPosition += 8;
                doc.text(`PMI: ${formatCurrency(calculationData.results.pmi)}`, 20, yPosition);
                yPosition += 8;
                doc.text(`HOA Fees: ${formatCurrency(calculationData.results.hoa)}`, 20, yPosition);
                yPosition += 8;
                doc.setFont(undefined, 'bold');
                doc.text(`Total Monthly Payment: ${formatCurrency(calculationData.results.totalPayment)}`, 20, yPosition);
                doc.setFont(undefined, 'normal');
                yPosition += 15;
                
                // Add amortization table if there's space
                if (yPosition < 200) {
                    doc.text('Amortization Schedule (Yearly):', 14, yPosition);
                    yPosition += 8;
                    
                    const tableColumn = ["Year", "Principal", "Interest", "Total Interest", "Balance"];
                    const tableRows = [];
                    
                    calculationData.amortization.forEach(row => {
                        const rowData = [
                            row.year,
                            formatCurrency(row.principal),
                            formatCurrency(row.interest),
                            formatCurrency(row.totalInterest),
                            formatCurrency(row.balance)
                        ];
                        tableRows.push(rowData);
                    });
                    
                    doc.autoTable({
                        head: [tableColumn],
                        body: tableRows,
                        startY: yPosition,
                        theme: 'grid',
                        headStyles: { fillColor: [41, 150, 161] }
                    });
                }
                
                // Save the PDF
                doc.save('mortgage-calculation-report.pdf');
            });
            
            // CSV download functionality
            downloadCSV.addEventListener('click', function() {
                // Create CSV content
                let csvContent = "Mortgage Calculation Report\n\n";
                
                // Add inputs section
                csvContent += "Loan Details:\n";
                csvContent += `Loan Amount,${formatCurrency(calculationData.inputs.loanAmount).replace(/[$,]/g, '')}\n`;
                csvContent += `Interest Rate,${calculationData.inputs.interestRate.toFixed(2)}%\n`;
                csvContent += `Loan Term,${calculationData.inputs.loanTerm} years\n`;
                csvContent += `Property Tax,${formatCurrency(calculationData.inputs.propertyTax).replace(/[$,]/g, '')}\n`;
                csvContent += `Insurance,${formatCurrency(calculationData.inputs.insurance).replace(/[$,]/g, '')}\n`;
                csvContent += `PMI,${calculationData.inputs.pmi.toFixed(2)}%\n`;
                csvContent += `HOA Fees,${formatCurrency(calculationData.inputs.hoa).replace(/[$,]/g, '')}\n\n`;
                
                // Add results section
                csvContent += "Payment Breakdown:\n";
                csvContent += `Principal & Interest,${formatCurrency(calculationData.results.principalInterest).replace(/[$,]/g, '')}\n`;
                csvContent += `Property Tax,${formatCurrency(calculationData.results.propertyTax).replace(/[$,]/g, '')}\n`;
                csvContent += `Insurance,${formatCurrency(calculationData.results.insurance).replace(/[$,]/g, '')}\n`;
                csvContent += `PMI,${formatCurrency(calculationData.results.pmi).replace(/[$,]/g, '')}\n`;
                csvContent += `HOA Fees,${formatCurrency(calculationData.results.hoa).replace(/[$,]/g, '')}\n`;
                csvContent += `Total Monthly Payment,${formatCurrency(calculationData.results.totalPayment).replace(/[$,]/g, '')}\n\n`;
                
                // Add amortization schedule
                csvContent += "Amortization Schedule:\n";
                csvContent += "Year,Principal,Interest,Total Interest,Balance\n";
                
                calculationData.amortization.forEach(row => {
                    csvContent += `${row.year},${row.principal},${row.interest},${row.totalInterest},${row.balance}\n`;
                });
                
                // Create download link
                const encodedUri = encodeURI("data:text/csv;charset=utf-8," + csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "mortgage-calculation-report.csv");
                document.body.appendChild(link);
                
                // Trigger download
                link.click();
                document.body.removeChild(link);
            });
        });
    </script>
</body>
</html>
