<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="America's most advanced mortgage calculator with AI insights, live rates, and comprehensive loan analysis. Calculate monthly payments, compare loan types, and get personalized recommendations.">
    <title>üá∫üá∏ USA Mortgage Calculator - World's #1 AI-Enhanced Calculator | FinGuid</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="mortgage-calculator.css">
    
    <!-- PWA and Mobile -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#14B8A6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="FinGuid USA">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    
    <!-- Open Graph and Twitter Cards -->
    <meta property="og:title" content="üá∫üá∏ USA Mortgage Calculator - AI-Enhanced">
    <meta property="og:description" content="Calculate mortgage payments with AI insights, live rates, and comprehensive loan analysis">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://finguid.com/mortgage-calculator">
    <meta property="og:image" content="https://finguid.com/og-image.jpg">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üá∫üá∏ USA Mortgage Calculator">
    <meta name="twitter:description" content="America's most advanced mortgage calculator">
    <meta name="twitter:image" content="https://finguid.com/twitter-card.jpg">
</head>
<body data-theme="light">
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-banner-content">
            <div class="pwa-icon">üì±</div>
            <div class="pwa-text">
                <strong>Install FinGuid USA</strong>
                <span>Get the full experience with offline access</span>
            </div>
            <div class="pwa-actions">
                <button id="pwa-install-btn" class="pwa-install-btn">Install</button>
                <button id="pwa-dismiss-btn" class="pwa-dismiss-btn" aria-label="Dismiss install prompt">√ó</button>
            </div>
        </div>
    </div>
    
    <!-- Header with Enhanced Accessibility Controls -->
    <header class="site-header" role="banner">
        <div class="nav-container">
            <!-- Brand Logo -->
            <div class="brand-logo">
                <a href="/" class="logo-link" aria-label="FinGuid USA Home">
                    <span class="logo-text">
                        <strong>FinGuid</strong>
                        <span class="tagline">World's #1 AI Calculator üá∫üá∏</span>
                    </span>
                    <span class="usa-badge" role="img" aria-label="USA">üá∫üá∏</span>
                </a>
            </div>
            
            <!-- ENHANCED HEADER ACCESSIBILITY CONTROLS - HIDER DESIGN IMPROVEMENT 6 -->
            <div class="header-accessibility-controls">
                <button id="font-decrease" class="header-control-btn" onclick="adjustFontSize(-0.1)" aria-label="Decrease font size" title="Decrease Text Size">
                    <i class="fas fa-search-minus" aria-hidden="true"></i>
                    <span class="header-control-text">A-</span>
                </button>
                <button id="font-increase" class="header-control-btn" onclick="adjustFontSize(0.1)" aria-label="Increase font size" title="Increase Text Size">
                    <i class="fas fa-search-plus" aria-hidden="true"></i>
                    <span class="header-control-text">A+</span>
                </button>
                <button id="font-reset" class="header-control-btn" onclick="resetFontSize()" aria-label="Reset font size" title="Reset Text Size">
                    <i class="fas fa-undo" aria-hidden="true"></i>
                    <span class="header-control-text">Reset</span>
                </button>
                <button id="theme-toggle" class="header-control-btn" onclick="toggleTheme()" aria-label="Toggle dark mode" title="Toggle Dark/Light Mode">
                    <i class="fas fa-moon theme-icon" aria-hidden="true"></i>
                    <span class="header-control-text">Dark</span>
                </button>
                <button id="screen-reader-toggle" class="header-control-btn" onclick="toggleScreenReaderMode()" aria-label="Toggle screen reader mode" title="Enhanced Screen Reader Mode">
                    <i class="fas fa-universal-access" aria-hidden="true"></i>
                    <span class="header-control-text">SR</span>
                </button>
            </div>
            
            <!-- Main Navigation -->
            <nav class="nav-links" role="navigation" aria-label="Main navigation">
                <a href="/" class="nav-link" onclick="navigateTo('/')" aria-current="page">Home</a>
                <a href="/calculators" class="nav-link" onclick="navigateTo('/calculators')">Calculators</a>
                <a href="/resources" class="nav-link" onclick="navigateTo('/resources')">Resources</a>
                <a href="/rates" class="nav-link" onclick="navigateTo('/rates')">Live Rates</a>
                <a href="/about" class="nav-link" onclick="navigateTo('/about')">About</a>
            </nav>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-expanded="false" aria-controls="mobile-menu" aria-label="Toggle navigation menu">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </button>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="mobile-menu" role="navigation" aria-label="Mobile navigation">
            <div class="mobile-menu-content">
                <a href="/" class="mobile-nav-link" onclick="navigateTo('/')">üè† Home</a>
                <a href="/calculators" class="mobile-nav-link" onclick="navigateTo('/calculators')">üßÆ Calculators</a>
                <a href="/resources" class="mobile-nav-link" onclick="navigateTo('/resources')">üìö Resources</a>
                <a href="/rates" class="mobile-nav-link" onclick="navigateTo('/rates')">üìä Live Rates</a>
                <a href="/about" class="mobile-nav-link" onclick="navigateTo('/about')">‚ÑπÔ∏è About</a>
            </div>
        </div>
    </header>
    
    <!-- REDUCED HEIGHT USA HERO SECTION - IMPROVEMENT 1 -->
    <section class="usa-hero reduced-height" role="banner">
        <div class="hero-container">
            <h1 class="hero-title">
                <span class="flag-icon" role="img" aria-label="American flag">üá∫üá∏</span>
                <strong>America's #1 AI-Enhanced Mortgage Calculator</strong>
                <span class="ai-badge">AI POWERED</span>
            </h1>
            <p class="hero-description">
                Get instant mortgage calculations, live USA rates, and AI-powered insights for smarter homebuying decisions
            </p>
            
            <!-- COMPACT LIVE RATES SECTION - IMPROVEMENT 1 -->
            <div class="hero-live-rates">
                <div class="live-rates-title">
                    <strong>Current USA Rates LIVE</strong>
                    <span class="live-indicator">LIVE</span>
                </div>
                <div class="hero-rates-grid">
                    <div class="hero-rate-item">
                        <div class="rate-label">30-Year Fixed</div>
                        <div id="hero-rate-30-year" class="rate-value">6.44%</div>
                        <div class="rate-change positive">+0.15%</div>
                    </div>
                    <div class="hero-rate-item">
                        <div class="rate-label">15-Year Fixed</div>
                        <div id="hero-rate-15-year" class="rate-value">5.74%</div>
                        <div class="rate-change negative">-0.08%</div>
                    </div>
                    <div class="hero-rate-item">
                        <div class="rate-label">5/1 ARM</div>
                        <div id="hero-rate-arm" class="rate-value">5.90%</div>
                        <div class="rate-change neutral">0.00%</div>
                    </div>
                    <div class="hero-rate-item">
                        <div class="rate-label">FHA 30-Year</div>
                        <div id="hero-rate-fha" class="rate-value">6.45%</div>
                        <div class="rate-change positive">+0.05%</div>
                    </div>
                </div>
                <div class="rates-update-time">
                    <i class="fas fa-sync-alt" aria-hidden="true"></i>
                    <span id="rates-last-update">Updated: Just now</span>
                    <span>USA Market Average</span>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Main Calculator Content -->
    <main id="main-content" class="calculator-container" role="main">
        
        <!-- LEFT COLUMN: Input Section (30%) -->
        <section class="input-section" role="region" aria-labelledby="loan-details-heading">
            <div class="section-header">
                <h2 id="loan-details-heading" class="section-title">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    USA Loan Details
                </h2>
            </div>
            
            <!-- SECTION 1: Primary Information -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">1</span>
                    Primary Information
                </h3>
                
                <!-- Home Price -->
                <div class="form-group">
                    <label for="home-price" class="form-label">
                        <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                        Home Price
                        <span class="usa-context">Enter the total purchase price of your home</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="home-price" class="form-control" placeholder="450,000" aria-describedby="home-price-help">
                    </div>
                    <small id="home-price-help" class="help-text">Enter the total purchase price of your home</small>
                    
                    <div class="suggestion-chips">
                        <button class="suggestion-chip" onclick="setQuickValue('home-price', 300000)">$300K</button>
                        <button class="suggestion-chip" onclick="setQuickValue('home-price', 450000)">$450K</button>
                        <button class="suggestion-chip" onclick="setQuickValue('home-price', 600000)">$600K</button>
                        <button class="suggestion-chip" onclick="setQuickValue('home-price', 750000)">$750K</button>
                        <button class="suggestion-chip" onclick="setQuickValue('home-price', 1000000)">$1M</button>
                    </div>
                </div>
                
                <!-- SYNCHRONIZED DOWN PAYMENT - IMPROVEMENT 3 -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-percentage" aria-hidden="true"></i>
                        Down Payment
                        <span class="usa-context">Minimum 3% for most loans, 20% avoids PMI</span>
                    </label>
                    
                    <div class="input-toggle">
                        <button type="button" class="toggle-btn active" onclick="showDownPaymentType('dollar')">Dollar Amount</button>
                        <button type="button" class="toggle-btn" onclick="showDownPaymentType('percent')">Percentage</button>
                    </div>
                    
                    <div id="down-payment-dollar" class="input-variant active">
                        <div class="input-group">
                            <span class="input-prefix">$</span>
                            <input type="text" id="down-payment" class="form-control" placeholder="90,000" oninput="updateDownPaymentPercent()" aria-describedby="down-payment-help">
                        </div>
                    </div>
                    
                    <div id="down-payment-percent" class="input-variant">
                        <div class="input-group">
                            <input type="number" id="down-payment-percent" class="form-control" placeholder="20" min="0" max="99" step="0.1" oninput="updateDownPaymentFromPercent()" aria-describedby="down-payment-percent-help">
                            <span class="input-suffix">%</span>
                        </div>
                    </div>
                    
                    <small id="down-payment-help" class="help-text">Amount you'll pay upfront. 20% or more eliminates PMI requirements.</small>
                    
                    <div class="suggestion-chips">
                        <button class="suggestion-chip" onclick="setQuickValue('down-payment-percent', 3)">3%</button>
                        <button class="suggestion-chip" onclick="setQuickValue('down-payment-percent', 5)">5%</button>
                        <button class="suggestion-chip" onclick="setQuickValue('down-payment-percent', 10)">10%</button>
                        <button class="suggestion-chip" onclick="setQuickValue('down-payment-percent', 20)">20%</button>
                        <button class="suggestion-chip" onclick="setQuickValue('down-payment-percent', 25)">25%</button>
                    </div>
                </div>
                
                <!-- ZIP Code -->
                <div class="form-group">
                    <label for="zip-code" class="form-label">
                        <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                        ZIP Code
                        <span class="optional-text">(Optional)</span>
                    </label>
                    <input type="text" id="zip-code" class="form-control" placeholder="90210" maxlength="5" pattern="[0-9]{5}" aria-describedby="zip-code-help">
                    <small id="zip-code-help" class="help-text">Used to auto-calculate property tax and insurance based on local rates</small>
                    <div id="zip-code-status" class="zip-status" style="display: none;"></div>
                    <div id="city-state-display" class="city-state-display" style="display: none;"></div>
                </div>
                
                <!-- Credit Score -->
                <div class="form-group">
                    <label for="credit-score" class="form-label">
                        <i class="fas fa-chart-line" aria-hidden="true"></i>
                        Credit Score
                        <span class="rate-impact-text">Higher scores get better rates</span>
                    </label>
                    <select id="credit-score" class="form-control" aria-describedby="credit-score-help">
                        <option value="800">800+ (Excellent)</option>
                        <option value="750">750-799 (Very Good)</option>
                        <option value="700" selected>700-749 (Good)</option>
                        <option value="650">650-699 (Fair)</option>
                        <option value="600">600-649 (Poor)</option>
                        <option value="580">580-599 (Bad)</option>
                    </select>
                    <small id="credit-score-help" class="help-text">Higher credit scores typically qualify for lower interest rates</small>
                    <div id="credit-impact" style="display: none;"></div>
                </div>
                
                <!-- Interest Rate -->
                <div class="form-group">
                    <label for="interest-rate" class="form-label">
                        <i class="fas fa-percent" aria-hidden="true"></i>
                        Interest Rate
                        <span class="rate-impact-text">Current market rates shown above</span>
                    </label>
                    <div class="input-group">
                        <input type="number" id="interest-rate" class="form-control" placeholder="6.44" min="0.1" max="20" step="0.01" aria-describedby="interest-rate-help">
                        <span class="input-suffix">%</span>
                    </div>
                    <small id="interest-rate-help" class="help-text">
                        <span class="live-rate-source">Source: Live USA Market Rates</span>
                        <span id="rates-last-update">Updated: Just now</span>
                    </small>
                </div>
            </div>
            
            <!-- LOAN TYPE WITH INFO ICON - IMPROVEMENT 4 -->
            <div class="loan-type-group">
                <h3 class="subsection-title">
                    <span class="step-number">2</span>
                    Loan Type
                    <button class="info-icon-btn" onclick="window.open('/blog/loan-types', '_blank')" aria-label="Learn about loan types" title="Learn about different loan types">
                        <i class="fas fa-info" aria-hidden="true"></i>
                    </button>
                </h3>
                
                <div class="loan-type-selector-compact">
                    <button type="button" class="loan-type-btn-compact active" data-loan-type="conventional" onclick="selectLoanType('conventional')">
                        <i class="fas fa-university" aria-hidden="true"></i>
                        <span>Conventional</span>
                    </button>
                    <button type="button" class="loan-type-btn-compact" data-loan-type="fha" onclick="selectLoanType('fha')">
                        <i class="fas fa-home" aria-hidden="true"></i>
                        <span>FHA</span>
                    </button>
                    <button type="button" class="loan-type-btn-compact" data-loan-type="va" onclick="selectLoanType('va')">
                        <i class="fas fa-medal" aria-hidden="true"></i>
                        <span>VA</span>
                    </button>
                    <button type="button" class="loan-type-btn-compact" data-loan-type="usda" onclick="selectLoanType('usda')">
                        <i class="fas fa-leaf" aria-hidden="true"></i>
                        <span>USDA</span>
                    </button>
                </div>
                <div class="loan-type-display">
                    Selected: <span id="loan-type-display">Conventional Loan</span>
                </div>
            </div>
            
            <!-- Loan Term -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-calendar" aria-hidden="true"></i>
                    Loan Term
                    <span class="usa-context">Most popular: 30 years</span>
                </label>
                <div class="term-selector">
                    <button type="button" class="term-chip" data-term="15" onclick="selectTerm(15)">
                        <span class="term-years">15</span>
                        <span class="term-label">years</span>
                    </button>
                    <button type="button" class="term-chip active" data-term="30" onclick="selectTerm(30)">
                        <span class="term-years">30</span>
                        <span class="term-label">years</span>
                    </button>
                </div>
                <div class="form-group">
                    <input type="number" id="custom-term" class="form-control" placeholder="Custom term (5-50 years)" min="5" max="50" aria-describedby="custom-term-help">
                    <small id="custom-term-help" class="help-text">Custom loan term between 5-50 years (overrides above selections)</small>
                </div>
            </div>
            
            <!-- Property & Insurance Details -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">3</span>
                    Property & Insurance Details
                </h3>
                
                <!-- State -->
                <div class="form-group">
                    <label for="property-state" class="form-label">
                        <i class="fas fa-map-marked-alt" aria-hidden="true"></i>
                        Property State
                        <span class="auto-calc-text">Used to auto-calculate taxes & insurance</span>
                    </label>
                    <select id="property-state" class="form-control" aria-describedby="state-help">
                        <option value="">Select State</option>
                    </select>
                    <small id="state-help" class="help-text">Used to auto-calculate property tax and insurance based on state rates</small>
                </div>
                
                <!-- Property Tax -->
                <div class="form-group">
                    <label for="property-tax" class="form-label">
                        <i class="fas fa-coins" aria-hidden="true"></i>
                        Annual Property Tax
                        <span class="auto-calc-text">Auto-calculated from state data</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="property-tax" class="form-control" placeholder="9,000" aria-describedby="property-tax-help">
                    </div>
                    <small id="property-tax-help" class="help-text">Auto-calculated based on state tax rate and home price</small>
                </div>
                
                <!-- Home Insurance -->
                <div class="form-group">
                    <label for="home-insurance" class="form-label">
                        <i class="fas fa-shield-alt" aria-hidden="true"></i>
                        Annual Home Insurance
                        <span class="auto-calc-text">Auto-calculated from state data</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="home-insurance" class="form-control" placeholder="1,800" aria-describedby="home-insurance-help">
                    </div>
                    <small id="home-insurance-help" class="help-text">Auto-calculated based on state insurance rate and home price</small>
                </div>
                
                <!-- PMI -->
                <div class="form-group">
                    <label for="pmi" class="form-label">
                        <i class="fas fa-umbrella" aria-hidden="true"></i>
                        Annual PMI/MIP
                        <span class="auto-calc-text">Auto-calculated based on down payment</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="pmi" class="form-control" placeholder="0" aria-describedby="pmi-help">
                    </div>
                    <small id="pmi-help" class="help-text">Auto-calculated at 0.5% annually for down payments less than 20%</small>
                    <div id="pmi-status" class="pmi-status" style="display: none;"></div>
                </div>
                
                <!-- HOA Fees -->
                <div class="form-group">
                    <label for="hoa-fees" class="form-label">
                        <i class="fas fa-building" aria-hidden="true"></i>
                        Monthly HOA Fees
                        <span class="optional-text">(Optional)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="hoa-fees" class="form-control" placeholder="0" aria-describedby="hoa-help">
                    </div>
                    <small id="hoa-help" class="help-text">Homeowner Association monthly fees (condos, planned communities)</small>
                </div>
            </div>
            
            <!-- Extra Payments -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">4</span>
                    Extra Payments <span class="optional-text">(Optional)</span>
                </h3>
                
                <div class="form-group">
                    <label for="extra-monthly" class="form-label">
                        <i class="fas fa-plus-circle" aria-hidden="true"></i>
                        Extra Monthly Payment
                        <span class="savings-preview">See savings in AI insights</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="extra-monthly" class="form-control" placeholder="0" aria-describedby="extra-monthly-help">
                    </div>
                    <small id="extra-monthly-help" class="help-text">See impact on interest savings and loan term in AI insights</small>
                </div>
                
                <div class="form-group">
                    <label for="extra-biweekly" class="form-label">
                        <i class="fas fa-calendar-plus" aria-hidden="true"></i>
                        Extra Bi-Weekly Payment
                        <span class="savings-preview">Accelerates payoff</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="extra-biweekly" class="form-control" placeholder="0" aria-describedby="extra-biweekly-help">
                    </div>
                    <small id="extra-biweekly-help" class="help-text">Additional bi-weekly payment to accelerate loan payoff</small>
                </div>
            </div>
            
            <!-- Closing Costs -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">5</span>
                    Closing Costs Estimation
                </h3>
                
                <div class="form-group">
                    <label for="closing-costs-percentage" class="form-label">
                        <i class="fas fa-calculator" aria-hidden="true"></i>
                        Closing Costs Percentage
                    </label>
                    <div class="input-group">
                        <input type="number" id="closing-costs-percentage" class="form-control" placeholder="3" min="0" max="10" step="0.1" aria-describedby="closing-costs-help">
                        <span class="input-suffix">%</span>
                    </div>
                    <small id="closing-costs-help" class="help-text">Typical closing costs range from 2-5% of home price</small>
                    <div id="closing-costs-amount" class="closing-costs-amount">= $13,500</div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="action-btn primary" onclick="performCalculation()">
                    <i class="fas fa-calculator" aria-hidden="true"></i>
                    Recalculate
                </button>
                <button type="button" class="action-btn secondary" onclick="clearAllInputs()">
                    <i class="fas fa-eraser" aria-hidden="true"></i>
                    Clear All
                </button>
            </div>
            
            <div class="auto-calc-note">
                <i class="fas fa-magic" aria-hidden="true"></i>
                All calculations update automatically as you type - no calculate button needed!
            </div>
        </section>
        
        <!-- MIDDLE COLUMN: Results Section (40%) -->
        <section class="results-section" role="region" aria-labelledby="results-heading">
            <div class="section-header">
                <h2 id="results-heading" class="section-title">
                    <i class="fas fa-chart-bar" aria-hidden="true"></i>
                    Monthly Payment Breakdown
                </h2>
            </div>
            
            <!-- Results Tabs -->
            <div class="results-tabs" role="tablist">
                <button class="tab-btn active" data-tab="payment-summary" onclick="showTab('payment-summary')" role="tab" aria-selected="true">
                    <i class="fas fa-money-bill-wave" aria-hidden="true"></i>
                    Payment
                </button>
                <button class="tab-btn" data-tab="loan-breakdown" onclick="showTab('loan-breakdown')" role="tab" aria-selected="false">
                    <i class="fas fa-chart-pie" aria-hidden="true"></i>
                    Breakdown
                </button>
                <button class="tab-btn" data-tab="timeline-view" onclick="showTab('timeline-view')" role="tab" aria-selected="false">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    Timeline
                </button>
            </div>
            
            <!-- Payment Summary Tab -->
            <div id="payment-summary" class="tab-content active" role="tabpanel">
                <!-- Main Payment Card -->
                <div class="main-payment-card">
                    <div class="payment-header">
                        <h3>Total Monthly Payment</h3>
                        <span id="loan-type-badge" class="loan-type-badge">Conventional Loan</span>
                    </div>
                    <div class="payment-amount">
                        <span id="total-payment" class="amount-value">$2,768</span>
                        <div class="payment-breakdown-summary">
                            <span id="pi-summary">$2,025 P&I</span>
                            <span class="separator">+</span>
                            <span id="escrow-summary">$743 Escrow</span>
                        </div>
                    </div>
                </div>
                
                <!-- PAYMENT COMPONENTS CHART WITH AMOUNTS - IMPROVEMENT 2 -->
                <div class="payment-components-chart">
                    <h3>
                        <i class="fas fa-chart-pie" aria-hidden="true"></i>
                        Payment Components
                    </h3>
                    <div class="chart-container">
                        <canvas id="payment-components-chart" aria-label="Payment components breakdown chart"></canvas>
                    </div>
                    <!-- AMOUNTS DISPLAY BELOW CHART - IMPROVEMENT 2 -->
                    <div class="payment-amounts-display">
                        <div class="amount-item">
                            <div class="amount-color" style="background: rgba(20, 184, 166, 0.8);"></div>
                            <span class="amount-label">Principal & Interest</span>
                            <span id="pi-amount" class="amount-value">$2,025</span>
                        </div>
                        <div class="amount-item">
                            <div class="amount-color" style="background: rgba(59, 130, 246, 0.8);"></div>
                            <span class="amount-label">Property Tax</span>
                            <span id="tax-amount" class="amount-value">$750</span>
                        </div>
                        <div class="amount-item">
                            <div class="amount-color" style="background: rgba(251, 146, 60, 0.8);"></div>
                            <span class="amount-label">Home Insurance</span>
                            <span id="insurance-amount" class="amount-value">$150</span>
                        </div>
                        <div id="pmi-amount-display" class="amount-item" style="display: none;">
                            <div class="amount-color" style="background: rgba(239, 68, 68, 0.8);"></div>
                            <span class="amount-label">PMI</span>
                            <span id="pmi-chart-amount" class="amount-value">$0</span>
                        </div>
                        <div id="hoa-amount-display" class="amount-item" style="display: none;">
                            <div class="amount-color" style="background: rgba(168, 85, 247, 0.8);"></div>
                            <span class="amount-label">HOA Fees</span>
                            <span id="hoa-chart-amount" class="amount-value">$0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Loan Summary -->
                <div class="loan-summary">
                    <h3>
                        <i class="fas fa-file-contract" aria-hidden="true"></i>
                        Loan Summary
                    </h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">Loan Amount</span>
                            <span id="loan-amount-summary" class="summary-value">$360,000</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total Interest</span>
                            <span id="total-interest-summary" class="summary-value">$367,520</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total Cost</span>
                            <span id="total-cost-summary" class="summary-value">$727,520</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Payoff Date</span>
                            <span id="payoff-date-summary" class="summary-value">Oct 2054</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Closing Costs</span>
                            <span id="closing-costs-summary" class="summary-value">$13,500</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Loan Breakdown Tab -->
            <div id="loan-breakdown" class="tab-content" role="tabpanel">
                <div class="chart-section">
                    <div class="chart-header">
                        <h3>Mortgage Balance Over Time</h3>
                        <div class="chart-controls">
                            <button class="chart-control-btn" aria-label="Chart settings">
                                <i class="fas fa-cog" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chart-subtitle">
                        <span id="chart-loan-details">Loan: $360,000 | Term: 30 years | Rate: 6.44%</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="mortgage-timeline-chart" aria-label="Mortgage balance timeline chart"></canvas>
                    </div>
                    
                    <!-- Year Slider -->
                    <div class="year-slider-section">
                        <label for="year-range" class="slider-label">
                            <i class="fas fa-sliders-h" aria-hidden="true"></i>
                            Select Year to View Details
                        </label>
                        <input type="range" id="year-range" class="year-slider" min="1" max="30" value="15" aria-describedby="year-details">
                    </div>
                    
                    <div class="year-display">
                        <div id="year-label">Year 15</div>
                    </div>
                    
                    <div class="year-details" id="year-details">
                        <div class="detail-item">
                            <span class="detail-label">Principal Paid</span>
                            <span id="principal-paid" class="detail-value">$125,000</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Interest Paid</span>
                            <span id="interest-paid" class="detail-value">$200,000</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Remaining Balance</span>
                            <span id="remaining-balance" class="detail-value">$195,000</span>
                        </div>
                    </div>
                </div>
                
                <!-- AI-Powered Insights -->
                <div class="ai-insights-section">
                    <div class="insights-header">
                        <h3>
                            <i class="fas fa-brain" aria-hidden="true"></i>
                            AI-Powered Insights
                            <span class="ai-badge">AI POWERED</span>
                        </h3>
                        <button class="refresh-btn" onclick="generateAIInsights()" aria-label="Refresh AI insights">
                            <i class="fas fa-sync-alt" aria-hidden="true"></i>
                            Refresh
                        </button>
                    </div>
                    <div id="insights-container" class="insights-container">
                        <p class="no-insights">Enter loan details to see AI-powered insights</p>
                    </div>
                </div>
            </div>
            
            <!-- Timeline View Tab -->
            <div id="timeline-view" class="tab-content" role="tabpanel">
                <!-- PAYMENT SCHEDULE - MONTHLY AND YEARLY ONLY (IMPROVEMENT 5) -->
                <div class="schedule-section">
                    <h3>
                        <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                        Payment Schedule
                    </h3>
                    
                    <!-- Schedule Type Toggle - REMOVED WEEKLY (IMPROVEMENT 5) -->
                    <div class="schedule-type-toggle">
                        <button class="schedule-type-btn active" onclick="toggleScheduleType('monthly')">
                            <i class="fas fa-calendar" aria-hidden="true"></i>
                            Monthly
                        </button>
                        <button class="schedule-type-btn" onclick="toggleScheduleType('yearly')">
                            <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                            Yearly
                        </button>
                    </div>
                    
                    <!-- Export Options -->
                    <div class="schedule-export">
                        <button class="export-btn" onclick="exportScheduleCSV()">
                            <i class="fas fa-file-csv" aria-hidden="true"></i>
                            Export CSV
                        </button>
                        <button class="export-btn" onclick="exportSchedulePDF()">
                            <i class="fas fa-file-pdf" aria-hidden="true"></i>
                            Export PDF
                        </button>
                        <button class="export-btn" onclick="printSchedule()">
                            <i class="fas fa-print" aria-hidden="true"></i>
                            Print
                        </button>
                    </div>
                    
                    <!-- Schedule Table -->
                    <div class="schedule-container">
                        <div class="schedule-table-wrapper">
                            <table id="amortization-table" class="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Payment #</th>
                                        <th>Date</th>
                                        <th>Payment</th>
                                        <th>Principal</th>
                                        <th>Interest</th>
                                        <th>Balance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="6" style="text-align: center;">Auto-calculating payment schedule...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="schedule-pagination">
                            <button id="prev-payments" class="pagination-btn" onclick="showPreviousPayments()">
                                <i class="fas fa-chevron-left" aria-hidden="true"></i>
                                Previous
                            </button>
                            <span id="schedule-info" class="pagination-info">Payments 1-6 of 360</span>
                            <button id="next-payments" class="pagination-btn" onclick="showNextPayments()">
                                Next
                                <i class="fas fa-chevron-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Universal Sharing Section -->
            <div class="universal-sharing-section">
                <h3>
                    <i class="fas fa-share-alt" aria-hidden="true"></i>
                    Share & Export Results
                </h3>
                <div class="sharing-buttons">
                    <button class="share-btn primary" onclick="shareResults()">
                        <i class="fas fa-share" aria-hidden="true"></i>
                        Share Results
                    </button>
                    <button class="share-btn secondary" onclick="downloadPDF()">
                        <i class="fas fa-download" aria-hidden="true"></i>
                        Download PDF
                    </button>
                    <button class="share-btn secondary" onclick="printResults()">
                        <i class="fas fa-print" aria-hidden="true"></i>
                        Print
                    </button>
                    <button class="share-btn secondary" onclick="saveResults()">
                        <i class="fas fa-save" aria-hidden="true"></i>
                        Save Results
                    </button>
                    <button class="share-btn compare" onclick="openComparisonPage()">
                        <i class="fas fa-balance-scale" aria-hidden="true"></i>
                        Compare Loans
                    </button>
                </div>
            </div>
        </section>
        
        <!-- RIGHT COLUMN: Sidebar Section (30%) -->
        <section class="sidebar-section" role="complementary" aria-labelledby="sidebar-heading">
            <div class="section-header">
                <h2 id="sidebar-heading" class="section-title">
                    <i class="fas fa-info-circle" aria-hidden="true"></i>
                    Market Insights & Resources
                </h2>
            </div>
            
            <!-- Featured Lenders -->
            <div class="lender-cards">
                <h3>
                    <i class="fas fa-bank" aria-hidden="true"></i>
                    Featured USA Lenders
                </h3>
                
                <div class="lender-card featured">
                    <div class="lender-header">
                        <div class="lender-logo">üèõÔ∏è</div>
                        <div class="lender-info">
                            <h4>Rocket Mortgage</h4>
                            <div class="lender-rating">
                                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <span class="rating-text">4.8/5 (12,543 reviews)</span>
                            </div>
                        </div>
                    </div>
                    <div class="lender-features">
                        <div class="feature-item">
                            <i class="fas fa-check" aria-hidden="true"></i>
                            Same-day approval
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check" aria-hidden="true"></i>
                            100% online process
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check" aria-hidden="true"></i>
                            No lender fees
                        </div>
                    </div>
                    <div class="lender-rates">
                        <div class="rate-info">
                            <span class="rate-label">30-Year Fixed APR</span>
                            <span class="rate-value">6.42%</span>
                        </div>
                    </div>
                    <button class="lender-cta" onclick="trackLender('Rocket Mortgage')">
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                        Get Pre-Approved
                    </button>
                </div>
                
                <div class="lender-card">
                    <div class="lender-header">
                        <div class="lender-logo">üè¶</div>
                        <div class="lender-info">
                            <h4>Better Mortgage</h4>
                            <div class="lender-rating">
                                <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                                <span class="rating-text">4.7/5 (8,921 reviews)</span>
                            </div>
                        </div>
                    </div>
                    <div class="lender-features">
                        <div class="feature-item">
                            <i class="fas fa-check" aria-hidden="true"></i>
                            3-minute pre-approval
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check" aria-hidden="true"></i>
                            Digital mortgage process
                        </div>
                    </div>
                    <div class="lender-rates">
                        <div class="rate-info">
                            <span class="rate-label">30-Year Fixed APR</span>
                            <span class="rate-value">6.38%</span>
                        </div>
                    </div>
                    <button class="lender-cta" onclick="trackLender('Better Mortgage')">
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                        Get Pre-Approved
                    </button>
                </div>
            </div>
            
            <!-- Market Insights -->
            <div class="market-insights">
                <h3>
                    <i class="fas fa-chart-area" aria-hidden="true"></i>
                    USA Market Insights
                </h3>
                <div class="market-stats">
                    <div class="stat-item">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <div class="stat-label">Avg Home Price</div>
                            <div class="stat-value">$428,700</div>
                            <div class="stat-change positive">+5.2%</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üè†</div>
                        <div class="stat-info">
                            <div class="stat-label">Housing Inventory</div>
                            <div class="stat-value">3.2 months</div>
                            <div class="stat-change negative">+0.3 months</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-info">
                            <div class="stat-label">Mortgage Applications</div>
                            <div class="stat-value">-12.4%</div>
                            <div class="stat-change negative">Weekly change</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Government Programs -->
            <div class="government-programs">
                <h3>
                    <i class="fas fa-university" aria-hidden="true"></i>
                    USA Housing Programs
                </h3>
                <div class="program-list">
                    <div class="program-item">
                        <div class="program-icon">üèõÔ∏è</div>
                        <div class="program-info">
                            <h4>FHA Loans</h4>
                            <p>3.5% down payment, flexible credit requirements</p>
                            <a href="#" class="program-link">Learn More</a>
                        </div>
                    </div>
                    <div class="program-item">
                        <div class="program-icon">üéñÔ∏è</div>
                        <div class="program-info">
                            <h4>VA Loans</h4>
                            <p>0% down for eligible veterans and service members</p>
                            <a href="#" class="program-link">Check Eligibility</a>
                        </div>
                    </div>
                    <div class="program-item">
                        <div class="program-icon">üåæ</div>
                        <div class="program-info">
                            <h4>USDA Rural</h4>
                            <p>0% down for eligible rural and suburban areas</p>
                            <a href="#" class="program-link">Check Area</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sponsor Section -->
            <div class="sponsor-section">
                <h3>
                    <i class="fas fa-star" aria-hidden="true"></i>
                    Recommended Partners
                </h3>
                
                <div class="sponsor-ad">
                    <div class="ad-content">
                        <div class="ad-logo">üè°</div>
                        <div class="ad-text">
                            <h4>Find Your Dream Home</h4>
                            <p>Browse millions of listings with Zillow's powerful search</p>
                        </div>
                    </div>
                    <button class="ad-cta">Explore Homes</button>
                </div>
                
                <div class="sponsor-ad">
                    <div class="ad-content">
                        <div class="ad-logo">üí°</div>
                        <div class="ad-text">
                            <h4>Credit Score Improvement</h4>
                            <p>Boost your score with Credit Karma's free tools</p>
                        </div>
                    </div>
                    <button class="ad-cta">Check Score</button>
                </div>
                
                <div class="sponsor-ad">
                    <div class="ad-content">
                        <div class="ad-logo">üîí</div>
                        <div class="ad-text">
                            <h4>Home Insurance Quotes</h4>
                            <p>Compare rates and save with Lemonade Insurance</p>
                        </div>
                    </div>
                    <button class="ad-cta">Get Quotes</button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Enhanced Footer -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>
                        <i class="fas fa-calculator" aria-hidden="true"></i>
                        FinGuid USA
                    </h3>
                    <p>
                        World's most advanced AI-enhanced mortgage calculator designed specifically for American homebuyers. 
                        Get accurate calculations, live market rates, and personalized insights to make informed decisions.
                    </p>
                    <div class="footer-social">
                        <a href="#" class="social-link" aria-label="Follow us on Twitter">
                            <i class="fab fa-twitter" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Follow us on Facebook">
                            <i class="fab fa-facebook" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Follow us on LinkedIn">
                            <i class="fab fa-linkedin" aria-hidden="true"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Subscribe to our YouTube channel">
                            <i class="fab fa-youtube" aria-hidden="true"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Calculators</h4>
                        <ul>
                            <li><a href="#">Mortgage Calculator</a></li>
                            <li><a href="#">Affordability Calculator</a></li>
                            <li><a href="#">Refinance Calculator</a></li>
                            <li><a href="#">PMI Calculator</a></li>
                            <li><a href="#">Property Tax Calculator</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <ul>
                            <li><a href="#">First-Time Buyer Guide</a></li>
                            <li><a href="#">Loan Types Explained</a></li>
                            <li><a href="#">Down Payment Assistance</a></li>
                            <li><a href="#">Credit Score Tips</a></li>
                            <li><a href="#">Market Trends</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-column">
                        <h4>Rates & News</h4>
                        <ul>
                            <li><a href="#">Current Mortgage Rates</a></li>
                            <li><a href="#">Rate Predictions</a></li>
                            <li><a href="#">Housing Market News</a></li>
                            <li><a href="#">Economic Updates</a></li>
                            <li><a href="#">Lender Reviews</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-column">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="#">About FinGuid</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms of Service</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Careers</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-disclaimer">
                    <p>
                        <strong>Important Disclaimer:</strong> This calculator provides estimates for educational purposes only. 
                        Actual loan terms, payments, and rates may vary based on lender requirements, credit history, and market conditions. 
                        Always consult with qualified mortgage professionals before making financial decisions.
                    </p>
                    <p>
                        FinGuid is not a lender and does not provide loans. We connect users with mortgage professionals and provide educational content to support informed homebuying decisions.
                    </p>
                </div>
                
                <div class="footer-copyright">
                    <p>¬© 2025 FinGuid USA. All rights reserved. World's First AI Calculator Platform for Americans üá∫üá∏</p>
                    <div class="footer-badges">
                        <span class="badge">üîí SSL Secured</span>
                        <span class="badge">üá∫üá∏ USA Market</span>
                        <span class="badge">ü§ñ AI Powered</span>
                        <span class="badge">üì± PWA Ready</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Main Application JavaScript -->
    <script src="mortgage-calculator.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
