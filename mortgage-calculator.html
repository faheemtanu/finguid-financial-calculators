<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† AI-Enhanced Mortgage Calculator | Finguid - USA Financial Calculators</title>
    <meta name="description" content="Calculate your mortgage payments with our AI-enhanced calculator. Includes state-specific taxes, PMI, insurance, and smart insights. Free mortgage calculator with voice search.">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè†</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Color Variables */
            --primary: #21808d;
            --primary-dark: #1a6873;
            --secondary: #5e5240;
            --light-bg: #f8f9fa;
            --dark-bg: #343a40;
            --text-light: #ffffff;
            --text-dark: #212529;
            --border-color: #dee2e6;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1), 0 5px 10px rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--light-bg);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }

        /* Header Styles */
        .header {
            background-color: white;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary);
            text-decoration: none;
        }

        .brand-icon {
            width: 32px;
            height: 32px;
            background: var(--primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .nav-menu {
            display: flex;
            gap: var(--space-lg);
        }

        .nav-link {
            color: var(--gray-700);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary);
        }

        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            background: none;
            border: none;
            cursor: pointer;
        }

        .mobile-menu-toggle span {
            width: 25px;
            height: 3px;
            background-color: var(--gray-700);
            margin: 2px 0;
            transition: 0.3s;
        }

        /* Page Header - Reduced padding to remove extra space */
        .page-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: var(--space-xl) 0;
            text-align: center;
        }

        .page-title {
            font-size: 2.25rem;
            font-weight: 800;
            margin-bottom: var(--space-md);
        }

        .page-subtitle {
            font-size: 1.125rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: var(--space-xl) 0;
        }

        .calculator-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-xl);
        }

        @media (max-width: 968px) {
            .calculator-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Calculator Panel */
        .calculator-panel {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
        }

        .panel-header {
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-color);
        }

        .panel-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
        }

        .panel-header p {
            color: var(--gray-600);
        }

        .form-section {
            margin-bottom: var(--space-lg);
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-title i {
            color: var(--primary);
        }

        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--space-xs);
            font-size: 0.9rem;
        }

        .label-help {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-weight: 400;
        }

        .input-group {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
        }

        .form-input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            background-color: white;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        /* Down Payment Tabs */
        .dp-tabs {
            display: flex;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: 3px;
            margin-bottom: var(--space-sm);
        }

        .tab-btn {
            flex: 1;
            padding: 6px 12px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        /* PMI Banner */
        .pmi-banner {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            margin-top: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.9rem;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }

        .pmi-banner.hidden {
            display: none;
        }

        /* Term Buttons - Updated with additional options */
        .term-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
        }

        .chip {
            padding: 6px 12px;
            background: var(--gray-100);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        .chip:hover {
            border-color: var(--primary);
            color: var(--text-dark);
        }

        .chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .or-text {
            align-self: center;
            color: var(--gray-500);
            font-size: 0.9rem;
            margin: 0 8px;
        }

        .custom-term {
            max-width: 100px;
        }

        /* Advanced Options */
        .advanced-toggle {
            width: 100%;
            padding: var(--space-md);
            background: var(--gray-100);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: var(--space-md);
            transition: all 0.2s;
        }

        .advanced-toggle:hover {
            background: var(--gray-200);
        }

        .advanced-toggle.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .advanced-toggle .arrow {
            transition: transform 0.3s;
        }

        .advanced-toggle.active .arrow {
            transform: rotate(180deg);
        }

        .advanced-panel {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            background: var(--gray-100);
        }

        .advanced-panel.hidden {
            display: none;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.3);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            background: var(--gray-100);
        }

        .btn-full-width {
            width: 100%;
        }

        .action-buttons {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--border-color);
        }

        /* Results Panel */
        .results-panel {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .results-summary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: var(--space-xl);
            color: white;
            text-align: center;
        }

        .main-result {
            margin-bottom: var(--space-lg);
        }

        .result-label {
            font-size: 1.125rem;
            opacity: 0.9;
            margin-bottom: var(--space-xs);
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: var(--space-xs) 0;
        }

        .key-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
        }

        .metric {
            background: rgba(255, 255, 255, 0.15);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .metric-label {
            display: block;
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .metric-value {
            display: block;
            font-weight: 700;
            font-size: 1.125rem;
        }

        /* Breakdown Section */
        .breakdown-section {
            padding: var(--space-xl);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .section-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .breakdown-table {
            display: grid;
            gap: var(--space-sm);
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            background: var(--gray-100);
            border-left: 4px solid var(--primary);
        }

        .breakdown-row:nth-child(2) { border-left-color: #a84b2f; }
        .breakdown-row:nth-child(3) { border-left-color: #626c71; }
        .breakdown-row:nth-child(4) { border-left-color: #ef4444; }
        .breakdown-row:nth-child(5) { border-left-color: #94a3b8; }

        .breakdown-label {
            font-weight: 500;
            color: var(--text-dark);
        }

        .breakdown-value {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.125rem;
        }

        /* Charts Section */
        .charts-section {
            padding: var(--space-xl);
            border-top: 1px solid var(--border-color);
        }

        .chart-container {
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-md);
        }

        .chart-container h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: var(--space-md);
            text-align: center;
        }

        #breakdownChart {
            max-width: 100%;
            height: auto;
            margin: 0 auto;
            display: block;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-md);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Insights Section */
        .insights-section {
            padding: var(--space-xl);
            border-top: 1px solid var(--border-color);
            background: var(--gray-100);
        }

        .insights-list {
            list-style: none;
            display: grid;
            gap: var(--space-md);
        }

        .insight-item {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            background: white;
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary);
        }

        .insight-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.125rem;
        }

        .insight-content h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .insight-content p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        /* Result Actions */
        .result-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            padding: var(--space-xl);
            border-top: 1px solid var(--border-color);
            background: var(--gray-100);
        }

        /* Amortization Section */
        .amortization-section {
            margin-top: var(--space-xl);
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .amortization-header {
            padding: var(--space-xl);
            background: var(--gray-100);
            border-bottom: 1px solid var(--border-color);
        }

        .table-container {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .amortization-table th {
            background: var(--gray-100);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid var(--border-color);
            position: sticky;
            top: 0;
        }

        .amortization-table td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-dark);
        }

        .amortization-table tr:hover {
            background: var(--gray-100);
        }

        .amortization-table .currency {
            text-align: right;
            font-weight: 500;
        }

        /* Comparison Section */
        .comparison-section {
            margin-top: var(--space-xl);
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .predefined-scenarios {
            margin-bottom: var(--space-xl);
        }

        .scenario-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
        }

        .scenario-btn {
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            color: white;
        }

        .scenario-btn:nth-child(1) {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .scenario-btn:nth-child(2) {
            background: linear-gradient(135deg, #a84b2f 0%, #8a3e27 100%);
        }

        .scenario-btn:nth-child(3) {
            background: linear-gradient(135deg, #626c71 0%, #50595d 100%);
        }

        .scenario-btn:nth-child(4) {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .comparison-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-lg);
        }

        .comparison-card {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
            border-top: 4px solid var(--primary);
            border: 1px solid var(--border-color);
        }

        .comparison-card:nth-child(2) { border-top-color: #a84b2f; }
        .comparison-card:nth-child(3) { border-top-color: #626c71; }
        .comparison-card:nth-child(4) { border-top-color: #ef4444; }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .comparison-title {
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--primary);
        }

        .comparison-savings {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .comparison-details {
            display: grid;
            gap: 8px;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-row:last-child {
            border-bottom: none;
        }

        /* Footer Styles */
        .footer {
            background: var(--gray-800);
            color: white;
            padding: var(--space-2xl) 0 var(--space-xl);
            margin-top: auto;
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-xl);
        }

        @media (max-width: 968px) {
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .footer-container {
                grid-template-columns: 1fr;
            }
        }

        .footer-brand {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .footer-brand h3 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .footer-brand p {
            color: var(--gray-400);
            font-size: 0.9rem;
        }

        .footer-heading {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: white;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: var(--space-sm);
        }

        .footer-links a {
            color: var(--gray-400);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-contact {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--gray-400);
            font-size: 0.9rem;
        }

        .social-links {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .social-link {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: background 0.2s;
        }

        .social-link:hover {
            background: var(--primary);
        }

        .footer-bottom {
            margin-top: var(--space-2xl);
            padding-top: var(--space-md);
            border-top: 1px solid var(--gray-700);
            text-align: center;
            color: var(--gray-400);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .page-title {
                font-size: 1.75rem;
            }
            
            .page-subtitle {
                font-size: 1rem;
            }
            
            .result-value {
                font-size: 2rem;
            }
            
            .key-metrics {
                grid-template-columns: 1fr;
            }
            
            .action-buttons,
            .result-actions {
                flex-direction: column;
            }
            
            .scenario-buttons {
                grid-template-columns: 1fr;
            }
            
            .comparison-cards {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
        }

        @media (max-width: 576px) {
            .calculator-panel,
            .results-panel {
                padding: var(--space-lg);
            }
            
            .results-summary {
                padding: var(--space-lg);
            }
            
            .breakdown-section,
            .charts-section,
            .insights-section {
                padding: var(--space-lg);
            }
            
            .term-buttons {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .or-text {
                margin: 8px 0;
                align-self: flex-start;
            }
            
            .breakdown-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .insight-item {
                flex-direction: column;
                text-align: center;
                gap: var(--space-sm);
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-0 {
            margin-bottom: 0;
        }

        .mt-1 {
            margin-top: var(--space-sm);
        }

        .mt-2 {
            margin-top: var(--space-md);
        }

        .mt-3 {
            margin-top: var(--space-lg);
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <!-- Brand Logo -->
                <a href="https://finguid.com/" class="nav-brand">
                    <div class="brand-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <span class="brand-text">Finguid</span>
                </a>
                
                <!-- Desktop Navigation Menu -->
                <div class="nav-menu">
                    <a href="https://finguid.com/" class="nav-link">Home</a>
                    <a href="https://finguid.com/calculators" class="nav-link active">Calculators</a>
                    <a href="https://finguid.com/resources" class="nav-link">Resources</a>
                    <a href="https://finguid.com/partners" class="nav-link">Partners</a>
                    <a href="https://finguid.com/contact" class="nav-link">Contact</a>
                </div>
                
                <!-- Mobile Menu Toggle -->
                <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Page Header - Reduced padding to remove extra space -->
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">üè† AI-Enhanced Mortgage Calculator</h1>
            <p class="page-subtitle">
                Calculate your mortgage payments with precision. Get state-specific taxes, PMI estimates, 
                and AI-powered insights to make smarter home buying decisions.
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="calculator-layout">
                
                <!-- Calculator Input Panel -->
                <div class="calculator-panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-home"></i> Mortgage Calculator</h2>
                        <p>Enter your mortgage information for precise calculations with AI insights</p>
                    </div>

                    <!-- Basic Loan Details -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-dollar-sign"></i>
                            Loan Details
                        </h3>

                        <!-- Home Price -->
                        <div class="form-group">
                            <label for="home-price" class="form-label">
                                Home Price
                                <span class="label-help">Market value of the home</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="home-price" class="form-input" placeholder="500,000" 
                                       min="50000" max="10000000" step="1000" value="500000">
                            </div>
                        </div>

                        <!-- Down Payment -->
                        <div class="form-group">
                            <label class="form-label">
                                Down Payment
                                <span class="label-help">Amount paid upfront</span>
                            </label>
                            
                            <!-- Down Payment Tabs -->
                            <div class="dp-tabs">
                                <button type="button" id="tab-amount" class="tab-btn active">Amount ($)</button>
                                <button type="button" id="tab-percent" class="tab-btn">Percent (%)</button>
                            </div>
                            
                            <!-- Down Payment Inputs -->
                            <div class="dp-inputs">
                                <div id="dp-amount-wrap" class="dp-input-wrap">
                                    <div class="input-group">
                                        <i class="input-icon fas fa-dollar-sign"></i>
                                        <input type="number" id="dp-amount" class="form-input" placeholder="100,000" 
                                               min="0" step="1000" value="100000">
                                    </div>
                                </div>
                                <div id="dp-percent-wrap" class="dp-input-wrap hidden">
                                    <div class="input-group">
                                        <i class="input-icon fas fa-percent"></i>
                                        <input type="number" id="dp-percent" class="form-input" placeholder="20" 
                                               min="0" max="100" step="0.1" value="20">
                                    </div>
                                </div>
                            </div>

                            <!-- PMI Banner -->
                            <div id="pmi-banner" class="pmi-banner hidden">
                                <i class="fas fa-info-circle"></i>
                                <div>
                                    <strong>PMI Required</strong><br>
                                    Down payment is less than 20% of home value
                                </div>
                            </div>
                        </div>

                        <!-- Interest Rate -->
                        <div class="form-group">
                            <label for="interest-rate" class="form-label">
                                Interest Rate
                                <span class="label-help">Annual percentage rate (APR)</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-percent"></i>
                                <input type="number" id="interest-rate" class="form-input" placeholder="6.5" 
                                       min="0.1" max="30" step="0.01" value="6.5">
                            </div>
                        </div>

                        <!-- Loan Term - Updated with additional options -->
                        <div class="form-group">
                            <label class="form-label">
                                Loan Term
                                <span class="label-help">Length of the mortgage</span>
                            </label>
                            
                            <!-- Term Buttons -->
                            <div class="term-buttons" id="term-buttons">
                                <button type="button" class="chip" data-term="10">10 years</button>
                                <button type="button" class="chip" data-term="15">15 years</button>
                                <button type="button" class="chip" data-term="20">20 years</button>
                                <button type="button" class="chip" data-term="25">25 years</button>
                                <button type="button" class="chip active" data-term="30">30 years</button>
                                <span class="or-text">or</span>
                                <input type="number" id="term-custom" class="form-input custom-term" 
                                       placeholder="Years" min="1" max="40">
                            </div>
                        </div>

                        <!-- State Selection -->
                        <div class="form-group">
                            <label for="state" class="form-label">
                                State
                                <span class="label-help">Auto-calculated based on state average</span>
                            </label>
                            <select id="state" class="form-select">
                                <option value="">Select State</option>
                                <option value="AL">Alabama (AL)</option>
                                <option value="AK">Alaska (AK)</option>
                                <option value="AZ">Arizona (AZ)</option>
                                <option value="AR">Arkansas (AR)</option>
                                <option value="CA" selected>California (CA)</option>
                                <option value="CO">Colorado (CO)</option>
                                <option value="CT">Connecticut (CT)</option>
                                <option value="DE">Delaware (DE)</option>
                                <option value="FL">Florida (FL)</option>
                                <option value="GA">Georgia (GA)</option>
                                <option value="HI">Hawaii (HI)</option>
                                <option value="ID">Idaho (ID)</option>
                                <option value="IL">Illinois (IL)</option>
                                <option value="IN">Indiana (IN)</option>
                                <option value="IA">Iowa (IA)</option>
                                <option value="KS">Kansas (KS)</option>
                                <option value="KY">Kentucky (KY)</option>
                                <option value="LA">Louisiana (LA)</option>
                                <option value="ME">Maine (ME)</option>
                                <option value="MD">Maryland (MD)</option>
                                <option value="MA">Massachusetts (MA)</option>
                                <option value="MI">Michigan (MI)</option>
                                <option value="MN">Minnesota (MN)</option>
                                <option value="MS">Mississippi (MS)</option>
                                <option value="MO">Missouri (MO)</option>
                                <option value="MT">Montana (MT)</option>
                                <option value="NE">Nebraska (NE)</option>
                                <option value="NV">Nevada (NV)</option>
                                <option value="NH">New Hampshire (NH)</option>
                                <option value="NJ">New Jersey (NJ)</option>
                                <option value="NM">New Mexico (NM)</option>
                                <option value="NY">New York (NY)</option>
                                <option value="NC">North Carolina (NC)</option>
                                <option value="ND">North Dakota (ND)</option>
                                <option value="OH">Ohio (OH)</option>
                                <option value="OK">Oklahoma (OK)</option>
                                <option value="OR">Oregon (OR)</option>
                                <option value="PA">Pennsylvania (PA)</option>
                                <option value="RI">Rhode Island (RI)</option>
                                <option value="SC">South Carolina (SC)</option>
                                <option value="SD">South Dakota (SD)</option>
                                <option value="TN">Tennessee (TN)</option>
                                <option value="TX">Texas (TX)</option>
                                <option value="UT">Utah (UT)</option>
                                <option value="VT">Vermont (VT)</option>
                                <option value="VA">Virginia (VA)</option>
                                <option value="WA">Washington (WA)</option>
                                <option value="WV">West Virginia (WV)</option>
                                <option value="WI">Wisconsin (WI)</option>
                                <option value="WY">Wyoming (WY)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Advanced Options -->
                    <button type="button" id="advanced-toggle" class="advanced-toggle">
                        <span><i class="fas fa-sliders-h"></i> Advanced Options</span>
                        <i class="fas fa-chevron-down arrow"></i>
                    </button>

                    <div id="advanced-panel" class="advanced-panel hidden">
                        <!-- Property Tax -->
                        <div class="form-group">
                            <label for="property-tax" class="form-label">
                                Annual Property Tax
                                <span class="label-help">Yearly property tax amount</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="property-tax" class="form-input" placeholder="3,750" 
                                       min="0" step="100" value="3750">
                            </div>
                        </div>

                        <!-- Home Insurance -->
                        <div class="form-group">
                            <label for="home-insurance" class="form-label">
                                Annual Home Insurance
                                <span class="label-help">Yearly insurance premium</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="home-insurance" class="form-input" placeholder="1,200" 
                                       min="0" step="100" value="1200">
                            </div>
                        </div>

                        <!-- PMI Rate -->
                        <div class="form-group">
                            <label for="pmi-rate" class="form-label">
                                PMI Rate
                                <span class="label-help">Private mortgage insurance rate (%)</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-percent"></i>
                                <input type="number" id="pmi-rate" class="form-input" placeholder="0.5" 
                                       min="0" max="3" step="0.01" value="0.5">
                            </div>
                        </div>

                        <!-- HOA Fees -->
                        <div class="form-group">
                            <label for="hoa-fees" class="form-label">
                                Monthly HOA Fees
                                <span class="label-help">Homeowners association dues</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="hoa-fees" class="form-input" placeholder="0" 
                                       min="0" step="10" value="0">
                            </div>
                        </div>

                        <!-- Extra Payments -->
                        <div class="form-group">
                            <label for="extra-monthly" class="form-label">
                                Extra Monthly Payment
                                <span class="label-help">Additional principal payment</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="extra-monthly" class="form-input" placeholder="0" 
                                       min="0" step="50" value="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="extra-once" class="form-label">
                                One-Time Extra Payment
                                <span class="label-help">Extra payment in first month</span>
                            </label>
                            <div class="input-group">
                                <i class="input-icon fas fa-dollar-sign"></i>
                                <input type="number" id="extra-once" class="form-input" placeholder="0" 
                                       min="0" step="100" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="button" id="calculate-btn" class="btn btn-primary btn-full-width">
                            <i class="fas fa-calculator"></i>
                            <span>Calculate Payment</span>
                            <div class="spinner"></div>
                        </button>
                        <button type="button" id="reset-form" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel">
                    <!-- Results Summary -->
                    <div class="results-summary">
                        <div class="main-result">
                            <div class="result-label">Total Monthly Payment</div>
                            <div id="total-payment" class="result-value">$2,923</div>
                        </div>
                        
                        <div class="key-metrics">
                            <div class="metric">
                                <span class="metric-label">Loan Amount</span>
                                <span id="loan-amount" class="metric-value">$400,000</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Total Interest</span>
                                <span id="total-interest" class="metric-value">$422,983</span>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Breakdown -->
                    <div class="breakdown-section">
                        <div class="section-header">
                            <h3>Monthly Breakdown</h3>
                        </div>
                        
                        <div class="breakdown-table">
                            <div class="breakdown-row">
                                <span class="breakdown-label">P&I</span>
                                <span id="pi-amount" class="breakdown-value">$2,590</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Taxes</span>
                                <span id="tax-amount" class="breakdown-value">$313</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Insurance</span>
                                <span id="insurance-amount" class="breakdown-value">$100</span>
                            </div>
                            <div id="row-pmi" class="breakdown-row hidden">
                                <span class="breakdown-label">PMI</span>
                                <span id="pmi-amount" class="breakdown-value">$167</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">HOA</span>
                                <span id="hoa-amount" class="breakdown-value">$0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="charts-section">
                        <div class="chart-container">
                            <h4>Payment Breakdown</h4>
                            <canvas id="breakdownChart" width="300" height="300"></canvas>
                            <div id="legend-breakdown" class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-color" style="background-color: #21808d;"></span>
                                    <span>P&I: $2,590</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color" style="background-color: #a84b2f;"></span>
                                    <span>Taxes: $313</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color" style="background-color: #626c71;"></span>
                                    <span>Insurance: $100</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color" style="background-color: #ef4444;"></span>
                                    <span>PMI: $167</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="insights-section">
                        <div class="section-header">
                            <h3><i class="fas fa-brain"></i> AI Insights</h3>
                            <span class="label-help">Personalized recommendations to save money</span>
                        </div>
                        
                        <ul id="insights-list" class="insights-list">
                            <li class="insight-item">
                                <div class="insight-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="insight-content">
                                    <h4>PMI Impact</h4>
                                    <p>You'll pay $167/month for PMI. Consider increasing your down payment to 20% to eliminate PMI.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <div class="insight-icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="insight-content">
                                    <h4>Interest vs Principal</h4>
                                    <p>Over the life of the loan, 51% of your payments will go toward interest.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <div class="insight-icon">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="insight-content">
                                    <h4>Extra Payment Opportunity</h4>
                                    <p>Adding just $259/month could save $112,983 in interest and pay off your loan 7 years early.</p>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <!-- Result Actions -->
                    <div class="result-actions">
                        <button type="button" id="email-results" class="btn btn-outline">
                            <i class="fas fa-envelope"></i>
                            Email Results
                        </button>
                        <button type="button" id="share-results" class="btn btn-outline">
                            <i class="fas fa-share"></i>
                            Share
                        </button>
                        <button type="button" id="print-results" class="btn btn-outline">
                            <i class="fas fa-print"></i>
                            Print
                        </button>
                    </div>
                </div>
            </div>

            <!-- Amortization Schedule -->
            <div class="amortization-section">
                <div class="amortization-header">
                    <div class="section-header">
                        <h3><i class="fas fa-table"></i> Payment Schedule (First 5 Years)</h3>
                        <button type="button" id="view-full-schedule" class="btn btn-secondary">
                            <i class="fas fa-expand"></i>
                            View Full Schedule
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="amortization-table">
                        <thead>
                            <tr>
                                <th>Payment #</th>
                                <th>Total Payment</th>
                                <th>Principal</th>
                                <th>Interest</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="amortization-body">
                            <tr>
                                <td>1</td>
                                <td class="currency">$2,923.00</td>
                                <td class="currency">$423.33</td>
                                <td class="currency">$2,166.67</td>
                                <td class="currency">$399,576.67</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td class="currency">$2,923.00</td>
                                <td class="currency">$425.63</td>
                                <td class="currency">$2,164.37</td>
                                <td class="currency">$399,151.04</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td class="currency">$2,923.00</td>
                                <td class="currency">$427.94</td>
                                <td class="currency">$2,162.06</td>
                                <td class="currency">$398,723.10</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td class="currency">$2,923.00</td>
                                <td class="currency">$430.26</td>
                                <td class="currency">$2,159.74</td>
                                <td class="currency">$398,292.84</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td class="currency">$2,923.00</td>
                                <td class="currency">$432.59</td>
                                <td class="currency">$2,157.41</td>
                                <td class="currency">$397,860.25</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Loan Comparison Scenarios - Fixed with real calculations -->
            <div class="comparison-section">
                <div class="section-header">
                    <h3><i class="fas fa-balance-scale"></i> Loan Comparison Scenarios</h3>
                    <p>Compare different loan options side by side</p>
                </div>

                <div class="predefined-scenarios">
                    <div class="scenario-buttons">
                        <button type="button" class="scenario-btn" data-scenario="current">
                            <i class="fas fa-home"></i>
                            Current Scenario
                        </button>
                        <button type="button" class="scenario-btn" data-scenario="lower-rate">
                            <i class="fas fa-arrow-down"></i>
                            Lower Interest Rate
                        </button>
                        <button type="button" class="scenario-btn" data-scenario="higher-dp">
                            <i class="fas fa-arrow-up"></i>
                            Higher Down Payment
                        </button>
                        <button type="button" class="scenario-btn" data-scenario="shorter-term">
                            <i class="fas fa-clock"></i>
                            Shorter Term
                        </button>
                    </div>
                </div>

                <div id="comparison-cards" class="comparison-cards">
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h4 class="comparison-title">Current Scenario</h4>
                            <span class="comparison-savings">Baseline</span>
                        </div>
                        <div class="comparison-details">
                            <div class="comparison-row">
                                <span>Monthly Payment</span>
                                <span class="currency">$2,923</span>
                            </div>
                            <div class="comparison-row">
                                <span>Total Interest</span>
                                <span class="currency">$422,983</span>
                            </div>
                            <div class="comparison-row">
                                <span>Loan Term</span>
                                <span>30 years</span>
                            </div>
                            <div class="comparison-row">
                                <span>Interest Rate</span>
                                <span>6.5%</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h4 class="comparison-title">Lower Rate (5.5%)</h4>
                            <span class="comparison-savings">Save $152/mo</span>
                        </div>
                        <div class="comparison-details">
                            <div class="comparison-row">
                                <span>Monthly Payment</span>
                                <span class="currency">$2,771</span>
                            </div>
                            <div class="comparison-row">
                                <span>Total Interest</span>
                                <span class="currency">$347,220</span>
                            </div>
                            <div class="comparison-row">
                                <span>Loan Term</span>
                                <span>30 years</span>
                            </div>
                            <div class="comparison-row">
                                <span>Interest Rate</span>
                                <span>5.5%</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h4 class="comparison-title">Higher Down Payment (25%)</h4>
                            <span class="comparison-savings">Save $208/mo</span>
                        </div>
                        <div class="comparison-details">
                            <div class="comparison-row">
                                <span>Monthly Payment</span>
                                <span class="currency">$2,715</span>
                            </div>
                            <div class="comparison-row">
                                <span>Total Interest</span>
                                <span class="currency">$377,400</span>
                            </div>
                            <div class="comparison-row">
                                <span>Loan Term</span>
                                <span>30 years</span>
                            </div>
                            <div class="comparison-row">
                                <span>Down Payment</span>
                                <span class="currency">$125,000</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card">
                        <div class="comparison-header">
                            <h4 class="comparison-title">Shorter Term (15 years)</h4>
                            <span class="comparison-savings">Save $212k interest</span>
                        </div>
                        <div class="comparison-details">
                            <div class="comparison-row">
                                <span>Monthly Payment</span>
                                <span class="currency">$3,484</span>
                            </div>
                            <div class="comparison-row">
                                <span>Total Interest</span>
                                <span class="currency">$210,761</span>
                            </div>
                            <div class="comparison-row">
                                <span>Loan Term</span>
                                <span>15 years</span>
                            </div>
                            <div class="comparison-row">
                                <span>Interest Rate</span>
                                <span>6.0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Professional Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-container">
                <div class="footer-brand">
                    <h3>
                        <div class="brand-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        Finguid
                    </h3>
                    <p>Smart financial tools and calculators to help you make informed decisions about your money.</p>
                    <div class="social-links">
                        <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                
                <div class="footer-links-column">
                    <h4 class="footer-heading">Calculators</h4>
                    <ul class="footer-links">
                        <li><a href="#">Mortgage Calculator</a></li>
                        <li><a href="#">Loan Calculator</a></li>
                        <li><a href="#">Refinance Calculator</a></li>
                        <li><a href="#">Investment Calculator</a></li>
                        <li><a href="#">Retirement Calculator</a></li>
                    </ul>
                </div>
                
                <div class="footer-links-column">
                    <h4 class="footer-heading">Resources</h4>
                    <ul class="footer-links">
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Financial Guides</a></li>
                        <li><a href="#">Market Trends</a></li>
                        <li><a href="#">Home Buying Tips</a></li>
                        <li><a href="#">Glossary</a></li>
                    </ul>
                </div>
                
                <div class="footer-links-column">
                    <h4 class="footer-heading">Company</h4>
                    <div class="footer-contact">
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>support@finguid.com</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>+1 (555) 123-4567</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>San Francisco, CA</span>
                        </div>
                    </div>
                    <ul class="footer-links mt-2">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2023 Finguid. All rights reserved. | Secure &amp; Encrypted Calculations</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Utility functions
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            };
            
            const formatCurrencyDetailed = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount);
            };
            
            // State property tax rates (annual percentage)
            const stateTaxRates = {
                'AL': 0.41, 'AK': 1.19, 'AZ': 0.62, 'AR': 0.61, 'CA': 0.75,
                'CO': 0.51, 'CT': 2.14, 'DE': 0.57, 'FL': 0.83, 'GA': 0.89,
                'HI': 0.28, 'ID': 0.63, 'IL': 2.27, 'IN': 0.85, 'IA': 1.53,
                'KS': 1.41, 'KY': 0.86, 'LA': 0.55, 'ME': 1.28, 'MD': 1.06,
                'MA': 1.17, 'MI': 1.54, 'MN': 1.12, 'MS': 0.61, 'MO': 0.97,
                'MT': 0.84, 'NE': 1.73, 'NV': 0.53, 'NH': 2.05, 'NJ': 2.49,
                'NM': 0.55, 'NY': 1.69, 'NC': 0.84, 'ND': 0.98, 'OH': 1.56,
                'OK': 0.90, 'OR': 0.87, 'PA': 1.58, 'RI': 1.53, 'SC': 0.57,
                'SD': 1.32, 'TN': 0.64, 'TX': 1.81, 'UT': 0.58, 'VT': 1.90,
                'VA': 0.82, 'WA': 0.94, 'WV': 0.59, 'WI': 1.85, 'WY': 0.62
            };

            // DOM Elements
            const elements = {
                homePrice: document.getElementById('home-price'),
                dpAmount: document.getElementById('dp-amount'),
                dpPercent: document.getElementById('dp-percent'),
                interestRate: document.getElementById('interest-rate'),
                termCustom: document.getElementById('term-custom'),
                state: document.getElementById('state'),
                propertyTax: document.getElementById('property-tax'),
                pmiBanner: document.getElementById('pmi-banner'),
                tabAmount: document.getElementById('tab-amount'),
                tabPercent: document.getElementById('tab-percent'),
                dpAmountWrap: document.getElementById('dp-amount-wrap'),
                dpPercentWrap: document.getElementById('dp-percent-wrap'),
                termButtons: document.getElementById('term-buttons'),
                advancedToggle: document.getElementById('advanced-toggle'),
                advancedPanel: document.getElementById('advanced-panel'),
                totalPayment: document.getElementById('total-payment'),
                loanAmount: document.getElementById('loan-amount'),
                totalInterest: document.getElementById('total-interest'),
                piAmount: document.getElementById('pi-amount'),
                taxAmount: document.getElementById('tax-amount'),
                insuranceAmount: document.getElementById('insurance-amount'),
                pmiAmount: document.getElementById('pmi-amount'),
                hoaAmount: document.getElementById('hoa-amount'),
                rowPmi: document.getElementById('row-pmi'),
                calculateBtn: document.getElementById('calculate-btn'),
                scenarioBtns: document.querySelectorAll('.scenario-btn')
            };

            // Initialize calculator
            function init() {
                setupEventListeners();
                updatePropertyTax();
                calculate();
            }

            // Event listeners setup
            function setupEventListeners() {
                // Down payment tabs
                elements.tabAmount.addEventListener('click', () => switchDPMode(false));
                elements.tabPercent.addEventListener('click', () => switchDPMode(true));

                // Input synchronization
                elements.homePrice.addEventListener('input', handleHomePriceChange);
                elements.dpAmount.addEventListener('input', () => syncDownPayment(false));
                elements.dpPercent.addEventListener('input', () => syncDownPayment(true));
                
                // State selection - fixed to recalculate when changed
                elements.state.addEventListener('change', function() {
                    updatePropertyTax();
                    calculate(); // Added calculate call to update results immediately
                });

                // Term selection
                elements.termButtons.addEventListener('click', (e) => {
                    const btn = e.target.closest('.chip[data-term]');
                    if (btn) setTerm(parseInt(btn.dataset.term));
                });

                elements.termCustom.addEventListener('input', handleCustomTerm);

                // Advanced options
                elements.advancedToggle.addEventListener('click', toggleAdvanced);

                // Auto-calculation on input changes
                const autoCalcInputs = [
                    elements.homePrice, elements.dpAmount, elements.dpPercent,
                    elements.interestRate, elements.propertyTax
                ];

                autoCalcInputs.forEach(input => {
                    input.addEventListener('input', debounce(calculate, 300));
                });

                // Action buttons
                elements.calculateBtn.addEventListener('click', calculate);

                // Comparison scenarios
                elements.scenarioBtns.forEach(btn => {
                    btn.addEventListener('click', () => loadScenario(btn.dataset.scenario));
                });
            }

            // Down payment mode switching
            function switchDPMode(usePercent) {
                if (usePercent) {
                    elements.tabAmount.classList.remove('active');
                    elements.tabPercent.classList.add('active');
                    elements.dpAmountWrap.classList.add('hidden');
                    elements.dpPercentWrap.classList.remove('hidden');
                } else {
                    elements.tabAmount.classList.add('active');
                    elements.tabPercent.classList.remove('active');
                    elements.dpAmountWrap.classList.remove('hidden');
                    elements.dpPercentWrap.classList.add('hidden');
                }
                
                syncDownPayment(usePercent);
            }

            // Sync down payment inputs
            function syncDownPayment(fromPercent) {
                const homePrice = parseFloat(elements.homePrice.value) || 0;
                
                if (fromPercent) {
                    const pct = Math.min(100, Math.max(0, parseFloat(elements.dpPercent.value) || 0));
                    const amt = Math.round(homePrice * pct / 100);
                    elements.dpAmount.value = amt;
                } else {
                    const amt = Math.min(homePrice, Math.max(0, parseFloat(elements.dpAmount.value) || 0));
                    const pct = homePrice > 0 ? (amt / homePrice * 100) : 0;
                    elements.dpPercent.value = pct.toFixed(1);
                }
                
                updatePMIBanner();
            }

            // Handle home price changes
            function handleHomePriceChange() {
                syncDownPayment(elements.tabPercent.classList.contains('active'));
                updatePropertyTax();
            }

            // Update PMI banner
            function updatePMIBanner() {
                const homePrice = parseFloat(elements.homePrice.value) || 0;
                const dpAmount = parseFloat(elements.dpAmount.value) || 0;
                const dpPct = homePrice > 0 ? (dpAmount / homePrice * 100) : 0;
                const needsPMI = dpPct < 20;
                
                if (needsPMI) {
                    elements.pmiBanner.classList.remove('hidden');
                    elements.pmiBanner.innerHTML = `
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>PMI Required</strong><br>
                            Down payment is ${dpPct.toFixed(1)}% (less than 20% of home value)
                        </div>
                    `;
                } else {
                    elements.pmiBanner.classList.add('hidden');
                }
            }

            // Update property tax based on state
            function updatePropertyTax() {
                const homePrice = parseFloat(elements.homePrice.value) || 0;
                const state = elements.state.value;
                
                if (!state) return;
                
                const taxRate = stateTaxRates[state] || 1.0;
                const annualTax = Math.round(homePrice * (taxRate / 100));
                elements.propertyTax.value = annualTax;
            }

            // Term selection
            function setTerm(years) {
                // Remove active class from all term buttons
                document.querySelectorAll('.chip[data-term]').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active class to selected term
                document.querySelector(`.chip[data-term="${years}"]`).classList.add('active');
                
                // Clear custom term input
                elements.termCustom.value = '';
                
                calculate();
            }

            // Handle custom term input
            function handleCustomTerm() {
                const customYears = parseInt(elements.termCustom.value);
                if (customYears >= 1 && customYears <= 40) {
                    // Remove active class from all term buttons
                    document.querySelectorAll('.chip[data-term]').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    calculate();
                }
            }

            // Toggle advanced options
            function toggleAdvanced() {
                elements.advancedPanel.classList.toggle('hidden');
                elements.advancedToggle.classList.toggle('active');
                
                const arrow = elements.advancedToggle.querySelector('.arrow');
                arrow.classList.toggle('fa-chevron-down');
                arrow.classList.toggle('fa-chevron-up');
            }

            // Debounce utility for performance
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // Main calculation function
            function calculate() {
                const homePrice = parseFloat(elements.homePrice.value) || 0;
                const dpAmount = parseFloat(elements.dpAmount.value) || 0;
                const loanAmount = Math.max(0, homePrice - dpAmount);
                const rate = (parseFloat(elements.interestRate.value) || 0) / 100;
                
                // Get active term
                let term = 30;
                const activeTermBtn = document.querySelector('.chip.active');
                if (activeTermBtn) {
                    term = parseInt(activeTermBtn.dataset.term);
                } else if (elements.termCustom.value) {
                    term = parseInt(elements.termCustom.value);
                }
                
                const months = term * 12;

                if (!homePrice || !rate || !term) return;

                // Property costs
                const annualTax = parseFloat(elements.propertyTax.value) || 0;
                const annualInsurance = 1200; // Default value
                const pmiRate = 0.005; // Default PMI rate
                const monthlyHOA = 0; // Default HOA

                // Calculate monthly P&I
                const monthlyRate = rate / 12;
                let monthlyPI = 0;
                
                if (monthlyRate > 0) {
                    monthlyPI = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                                (Math.pow(1 + monthlyRate, months) - 1);
                } else {
                    monthlyPI = loanAmount / months;
                }

                // Other monthly costs
                const monthlyTax = annualTax / 12;
                const monthlyInsurance = annualInsurance / 12;
                const dpPercent = homePrice > 0 ? (dpAmount / homePrice * 100) : 0;
                const needsPMI = dpPercent < 20;
                const monthlyPMI = needsPMI ? (loanAmount * pmiRate / 12) : 0;
                const totalMonthly = monthlyPI + monthlyTax + monthlyInsurance + monthlyPMI + monthlyHOA;

                // Calculate total interest
                const totalInterest = (monthlyPI * months) - loanAmount;

                // Update display
                updateDisplay({
                    loanAmount,
                    totalMonthly,
                    totalInterest,
                    monthlyPI,
                    monthlyTax,
                    monthlyInsurance,
                    monthlyPMI,
                    monthlyHOA,
                    needsPMI
                });
            }

            // Update display
            function updateDisplay(result) {
                elements.totalPayment.textContent = formatCurrency(result.totalMonthly);
                elements.loanAmount.textContent = formatCurrency(result.loanAmount);
                elements.totalInterest.textContent = formatCurrency(result.totalInterest);
                elements.piAmount.textContent = formatCurrency(result.monthlyPI);
                elements.taxAmount.textContent = formatCurrency(result.monthlyTax);
                elements.insuranceAmount.textContent = formatCurrency(result.monthlyInsurance);
                elements.pmiAmount.textContent = formatCurrency(result.monthlyPMI);
                elements.hoaAmount.textContent = formatCurrency(result.monthlyHOA);

                // Show/hide PMI row
                if (result.needsPMI) {
                    elements.rowPmi.classList.remove('hidden');
                } else {
                    elements.rowPmi.classList.add('hidden');
                }
            }

            // Load scenario
            function loadScenario(scenario) {
                // In a real implementation, this would modify the inputs
                // and recalculate for different scenarios
                alert(`Loading ${scenario} scenario...`);
                // For demonstration, we'll just log to console
                console.log(`Scenario: ${scenario}`);
            }

            // Initialize the calculator
            init();
        });
    </script>
</body>
</html>
