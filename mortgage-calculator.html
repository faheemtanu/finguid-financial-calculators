<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1E3A8A">
    
    <!-- Enhanced USA Market SEO -->
    <title>ðŸ‡ºðŸ‡¸ USA Mortgage Calculator 2025 - AI-Enhanced Payment Calculator | FinGuid America</title>
    <meta name="description" content="FREE AI-enhanced USA mortgage calculator with live rates, FHA/VA/USDA loans, state tax data, and PMI calculation. Built for American homebuyers with voice control and accessibility features.">
    <meta name="keywords" content="USA mortgage calculator, American home loan calculator, FHA mortgage calculator, VA loan calculator, USDA loan calculator, mortgage payment calculator USA, AI mortgage calculator, state tax calculator, PMI calculator, closing cost calculator">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Enhanced Stylesheets -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./mortgage-calculator-enhanced-fixed.css">
    
    <!-- Chart.js for Enhanced Visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js" defer></script>
    
    <!-- jsPDF for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/icon-16x16.png">
</head>

<body class="font-scale-100">
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <!-- PWA Install Banner -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-banner-content">
            <div class="pwa-icon">ðŸ“±</div>
            <div class="pwa-text">
                <strong>Install FinGuid USA</strong>
                <span>Get instant access to America's best mortgage calculator</span>
            </div>
            <div class="pwa-actions">
                <button id="pwa-install-btn" class="pwa-install-btn">Install App</button>
                <button id="pwa-dismiss-btn" class="pwa-dismiss-btn" aria-label="Dismiss install banner">&times;</button>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Header with USA Branding -->
    <header class="site-header" role="banner">
        <nav class="nav-container" role="navigation" aria-label="Main navigation">
            <div class="brand-logo">
                <a href="/" class="logo-link" aria-label="FinGuid USA Home">
                    <img src="assets/finguid-usa-logo.svg" alt="FinGuid USA Logo" class="logo-image" width="32" height="32">
                    <span class="brand-text">FinGuid <span class="usa-badge">ðŸ‡ºðŸ‡¸ USA</span></span>
                </a>
                <div class="tagline">World's First AI Calculator Platform for Americans</div>
            </div>
            
            <div class="nav-links" role="menubar">
                <a href="/" class="nav-link" role="menuitem" onclick="navigateTo('/')">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/calculators" class="nav-link" role="menuitem" onclick="navigateTo('/calculators')">
                    <i class="fas fa-calculator"></i> Calculators
                </a>
                <a href="/resources" class="nav-link" role="menuitem" onclick="navigateTo('/resources')">
                    <i class="fas fa-book-open"></i> Resources
                </a>
                <a href="/rates" class="nav-link" role="menuitem" onclick="navigateTo('/rates')">
                    <i class="fas fa-chart-line"></i> Rates
                </a>
            </div>
            
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false" onclick="toggleMobileMenu()">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </nav>
        
        <div id="mobile-menu" class="mobile-menu">
            <div class="mobile-menu-content">
                <a href="/" class="mobile-nav-link" onclick="navigateTo('/')">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/calculators" class="mobile-nav-link" onclick="navigateTo('/calculators')">
                    <i class="fas fa-calculator"></i> Calculators
                </a>
                <a href="/resources" class="mobile-nav-link" onclick="navigateTo('/resources')">
                    <i class="fas fa-book-open"></i> Resources
                </a>
                <a href="/rates" class="mobile-nav-link" onclick="navigateTo('/rates')">
                    <i class="fas fa-chart-line"></i> Rates
                </a>
            </div>
        </div>
    </header>
    
    <!-- Fixed Accessibility Controls - REPOSITIONED -->
    <div class="accessibility-controls-fixed" role="toolbar" aria-label="Accessibility controls">
        <div class="font-controls" role="group" aria-label="Font size controls">
            <button class="control-btn" onclick="adjustFontSize(-0.1)" aria-label="Decrease font size" title="Smaller text">
                <span class="control-text">A-</span>
            </button>
            <button class="control-btn" onclick="resetFontSize()" aria-label="Reset font size" title="Normal text">
                <span class="control-text">A</span>
            </button>
            <button class="control-btn" onclick="adjustFontSize(0.1)" aria-label="Increase font size" title="Larger text">
                <span class="control-text">A+</span>
            </button>
        </div>
        
        <button id="theme-toggle" class="control-btn" onclick="toggleTheme()" aria-label="Toggle dark mode" title="Switch theme">
            <i class="fas fa-moon theme-icon"></i>
            <span class="control-text">Dark</span>
        </button>
        
        <button id="voice-toggle" class="control-btn" onclick="toggleVoiceControl()" aria-label="Toggle voice control" title="Voice commands">
            <i class="fas fa-microphone"></i>
            <span class="control-text">Voice</span>
            <div class="voice-pulse"></div>
        </button>
        
        <button id="screen-reader-toggle" class="control-btn" onclick="toggleScreenReaderMode()" aria-label="Toggle screen reader mode" title="Enhanced screen reader">
            <i class="fas fa-universal-access"></i>
            <span class="control-text">Reader</span>
        </button>
    </div>
    
    <!-- Enhanced USA Hero Section -->
    <section class="usa-hero" role="banner" aria-labelledby="hero-title">
        <div class="hero-container">
            <h1 id="hero-title" class="hero-title">
                <span class="flag-icon">ðŸ‡ºðŸ‡¸</span>
                America's Most Advanced Mortgage Calculator
                <span class="ai-badge">AI-Powered</span>
            </h1>
            <p class="hero-description">
                Calculate mortgage payments with live USA rates, AI insights, and comprehensive loan analysis. 
                Supporting FHA, VA, USDA, and conventional loans with voice control and mobile optimization 
                for American homebuyers in 2025.
            </p>
            <div class="hero-features">
                <span class="feature-badge">ðŸ§  AI Insights</span>
                <span class="feature-badge">ðŸ“Š Live USA Rates</span>
                <span class="feature-badge">ðŸŽ¤ Voice Control</span>
                <span class="feature-badge">ðŸ“± Mobile Optimized</span>
                <span class="feature-badge">â™¿ Fully Accessible</span>
            </div>
        </div>
    </section>
    
    <!-- Main Calculator Content - ENHANCED LAYOUT -->
    <main id="main-content" class="calculator-container" role="main">
        <!-- Left Side - Enhanced Input Section (35% width) -->
        <section class="input-section" role="region" aria-labelledby="input-section-title">
            <div class="section-header">
                <h2 id="input-section-title" class="section-title">
                    <i class="fas fa-home"></i>
                    USA Loan Details
                </h2>
                <div class="action-buttons">
                    <button class="action-btn secondary" onclick="autoFillUSADefaults()" title="Fill with USA market defaults">
                        <i class="fas fa-magic"></i>
                        <span>Auto Fill</span>
                    </button>
                    <button class="action-btn secondary" onclick="clearAllInputs()" title="Clear all form inputs">
                        <i class="fas fa-eraser"></i>
                        <span>Clear All</span>
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Loan Type Selection -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">1</span>
                    Select Your USA Loan Type
                </h3>
                <div class="loan-type-group" role="radiogroup" aria-labelledby="loan-type-title">
                    <div class="loan-type-selector">
                        <button class="loan-type-btn active" data-loan-type="conventional" onclick="selectLoanType('conventional')" role="radio" aria-checked="true">
                            <i class="fas fa-home"></i>
                            <span>Conventional</span>
                            <small>Traditional mortgage</small>
                        </button>
                        <button class="loan-type-btn" data-loan-type="fha" onclick="selectLoanType('fha')" role="radio" aria-checked="false">
                            <i class="fas fa-flag-usa"></i>
                            <span>FHA</span>
                            <small>3.5% down minimum</small>
                        </button>
                        <button class="loan-type-btn" data-loan-type="va" onclick="selectLoanType('va')" role="radio" aria-checked="false">
                            <i class="fas fa-medal"></i>
                            <span>VA</span>
                            <small>Veterans & military</small>
                        </button>
                        <button class="loan-type-btn" data-loan-type="usda" onclick="selectLoanType('usda')" role="radio" aria-checked="false">
                            <i class="fas fa-tractor"></i>
                            <span>USDA</span>
                            <small>Rural & suburban</small>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Home Details Section -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">2</span>
                    Home Purchase Details
                </h3>
                
                <!-- Home Price - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="home-price" class="form-label">
                        <i class="fas fa-home"></i>
                        Home Price
                        <span class="usa-context">(USA Median: $450,000)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="home-price" class="form-control" placeholder="450,000" value="450000"
                               aria-label="Home purchase price" oninput="handleInputChange('homePrice', this.value)">
                    </div>
                    <div class="suggestion-chips">
                        <button class="suggestion-chip" onclick="setSuggestedValue('home-price', 350000)">$350K</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('home-price', 450000)">$450K</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('home-price', 650000)">$650K</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('home-price', 850000)">$850K</button>
                    </div>
                    <small class="help-text">Enter the total purchase price of the home</small>
                </div>
                
                <!-- Down Payment Section - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-piggy-bank"></i>
                        Down Payment
                        <span id="down-payment-requirement" class="optional-text">(Min: 3% down)</span>
                    </label>
                    
                    <div class="input-toggle">
                        <button id="dollar-toggle" class="toggle-btn active" onclick="toggleDownPaymentMode('dollar')">
                            Dollar Amount
                        </button>
                        <button id="percent-toggle" class="toggle-btn" onclick="toggleDownPaymentMode('percent')">
                            Percentage
                        </button>
                    </div>
                    
                    <div id="dollar-input" class="input-variant active">
                        <div class="input-group">
                            <span class="input-prefix">$</span>
                            <input type="text" id="down-payment" class="form-control" placeholder="90,000" value="90000"
                                   aria-label="Down payment dollar amount" oninput="handleInputChange('downPayment', this.value)">
                        </div>
                    </div>
                    
                    <div id="percent-input" class="input-variant">
                        <div class="input-group">
                            <input type="number" id="down-payment-percent" class="form-control" placeholder="20" value="20"
                                   min="0" max="99" step="0.1" aria-label="Down payment percentage" oninput="handleInputChange('downPaymentPercent', this.value)">
                            <span class="input-suffix">%</span>
                        </div>
                    </div>
                    
                    <div class="suggestion-chips">
                        <button class="suggestion-chip" onclick="setSuggestedPercent('down-payment-percent', 3)">3%</button>
                        <button class="suggestion-chip" onclick="setSuggestedPercent('down-payment-percent', 5)">5%</button>
                        <button class="suggestion-chip" onclick="setSuggestedPercent('down-payment-percent', 10)">10%</button>
                        <button class="suggestion-chip" onclick="setSuggestedPercent('down-payment-percent', 20)">20%</button>
                    </div>
                    
                    <small class="help-text">20% or more eliminates PMI requirement for conventional loans</small>
                </div>
                
                <!-- Credit Score -->
                <div class="form-group">
                    <label for="credit-score" class="form-label">
                        <i class="fas fa-chart-line"></i>
                        Credit Score
                        <span class="rate-impact-text">(Affects interest rate)</span>
                    </label>
                    <select id="credit-score" class="form-control" aria-label="Select credit score range" 
                            onchange="handleCreditScoreChange(this.value)">
                        <option value="">Select Credit Score...</option>
                        <option value="800">800+ (Excellent)</option>
                        <option value="750" selected>750-799 (Very Good)</option>
                        <option value="700">700-749 (Good)</option>
                        <option value="650">650-699 (Fair)</option>
                        <option value="600">600-649 (Poor)</option>
                        <option value="580">580-599 (Bad)</option>
                    </select>
                    <small class="help-text">Higher scores get better interest rates</small>
                </div>
            </div>
            
            <!-- Enhanced Loan Terms Section -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">3</span>
                    Loan Terms & Interest Rate
                </h3>
                
                <!-- Interest Rate -->
                <div class="form-group">
                    <label for="interest-rate" class="form-label">
                        <i class="fas fa-percentage"></i>
                        Interest Rate (APR)
                        <span class="live-rate-indicator">
                            <i class="fas fa-circle pulse-dot"></i>
                            Live Rate
                        </span>
                    </label>
                    <div class="input-group">
                        <input type="number" id="interest-rate" class="form-control" placeholder="6.44" value="6.44"
                               min="0.1" max="20" step="0.001" aria-label="Annual interest rate" oninput="handleInputChange('interestRate', this.value)">
                        <span class="input-suffix">%</span>
                    </div>
                    <small class="help-text">Current rates are updated every 15 minutes</small>
                    
                    <!-- Current Rates Display -->
                    <div class="current-rates-display">
                        <h4>
                            Current USA Mortgage Rates
                            <span class="live-indicator">LIVE</span>
                            <span class="usa-context">Last updated: <span id="last-update-time">--:--</span></span>
                        </h4>
                        <div class="rates-grid">
                            <div class="rate-item">
                                <div class="rate-label">30-Year Fixed</div>
                                <div id="rate-30yr" class="rate-value">6.44%</div>
                                <div id="rate-30yr-change" class="rate-change neutral">--</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-label">15-Year Fixed</div>
                                <div id="rate-15yr" class="rate-value">5.74%</div>
                                <div id="rate-15yr-change" class="rate-change neutral">--</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-label">5/1 ARM</div>
                                <div id="rate-arm" class="rate-value">5.90%</div>
                                <div id="rate-arm-change" class="rate-change neutral">--</div>
                            </div>
                            <div class="rate-item">
                                <div class="rate-label">FHA 30-Year</div>
                                <div id="rate-fha" class="rate-value">6.45%</div>
                                <div id="rate-fha-change" class="rate-change neutral">--</div>
                            </div>
                        </div>
                        <p class="rates-disclaimer">
                            Rates shown are national averages and may vary by location, credit score, and lender.
                        </p>
                    </div>
                </div>
                
                <!-- Loan Term -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-calendar-alt"></i>
                        Loan Term
                    </label>
                    <div class="term-selector" role="radiogroup" aria-label="Select loan term">
                        <button class="term-chip" data-term="15" onclick="selectLoanTerm(15)" role="radio" aria-checked="false">
                            <div class="term-years">15</div>
                            <div class="term-label">Years</div>
                            <div class="term-note">Lower Rate</div>
                        </button>
                        <button class="term-chip active" data-term="30" onclick="selectLoanTerm(30)" role="radio" aria-checked="true">
                            <div class="term-years">30</div>
                            <div class="term-label">Years</div>
                            <div class="term-note">Popular Choice</div>
                        </button>
                        <button class="term-chip" data-term="20" onclick="selectLoanTerm(20)" role="radio" aria-checked="false">
                            <div class="term-years">20</div>
                            <div class="term-label">Years</div>
                            <div class="term-note">Balanced</div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Property Details Section -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">4</span>
                    Property Details
                </h3>
                
                <!-- Property Tax - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="property-tax" class="form-label">
                        <i class="fas fa-building"></i>
                        Annual Property Tax
                        <span id="property-tax-rate" class="auto-calc-text">(Auto-calculated by state)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="property-tax" class="form-control" placeholder="9,000" value="9000"
                               aria-label="Annual property tax amount" oninput="handleInputChange('propertyTax', this.value)">
                    </div>
                    <small class="help-text">Varies significantly by state and locality</small>
                </div>
                
                <!-- Home Insurance - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="home-insurance" class="form-label">
                        <i class="fas fa-shield-alt"></i>
                        Annual Home Insurance
                        <span id="home-insurance-rate" class="auto-calc-text">(Auto-calculated by state)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="home-insurance" class="form-control" placeholder="1,800" value="1800"
                               aria-label="Annual homeowners insurance premium" oninput="handleInputChange('homeInsurance', this.value)">
                    </div>
                    <small class="help-text">Required by all lenders for loan approval</small>
                </div>
                
                <!-- PMI - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="pmi" class="form-label">
                        <i class="fas fa-umbrella"></i>
                        PMI (Annual)
                        <span class="auto-calc-text">(Auto-calculated based on down payment)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="pmi" class="form-control" placeholder="0" value="0"
                               aria-label="Annual private mortgage insurance premium" readonly>
                    </div>
                    <div id="pmi-info" class="alert alert-info" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <div class="alert-content">
                            PMI Rate: <span id="pmi-rate-display">0.50%</span> annually
                        </div>
                    </div>
                    <small class="help-text">Required for conventional loans with less than 20% down</small>
                </div>
                
                <!-- HOA Fees - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="hoa-fees" class="form-label">
                        <i class="fas fa-users"></i>
                        Monthly HOA Fees
                        <span class="optional-text">(Optional)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="hoa-fees" class="form-control" placeholder="0" value="0"
                               aria-label="Monthly homeowners association fees" oninput="handleInputChange('hoaFees', this.value)">
                    </div>
                    <small class="help-text">Common in condos, townhomes, and planned communities</small>
                </div>
            </div>
            
            <!-- Enhanced Extra Payments Section -->
            <div class="form-section">
                <h3 class="subsection-title">
                    <span class="step-number">5</span>
                    Extra Payments (Optional)
                </h3>
                
                <!-- FIXED Extra Payment Frequency Toggle -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-plus-circle"></i>
                        Payment Frequency
                    </label>
                    <div class="frequency-toggle" role="radiogroup" aria-label="Select extra payment frequency">
                        <button id="monthly-toggle" class="frequency-btn active" onclick="setExtraPaymentFrequency('monthly')" 
                                role="radio" aria-checked="true">
                            <i class="fas fa-calendar"></i>
                            <span>Monthly</span>
                        </button>
                        <button id="weekly-toggle" class="frequency-btn clickable" onclick="setExtraPaymentFrequency('weekly')" 
                                role="radio" aria-checked="false">
                            <i class="fas fa-calendar-week"></i>
                            <span>Weekly</span>
                        </button>
                    </div>
                </div>
                
                <!-- Extra Monthly Payment - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="extra-monthly" class="form-label">
                        <i class="fas fa-arrow-up"></i>
                        <span id="extra-payment-label">Extra Monthly Payment</span>
                        <span id="extra-payment-preview" class="savings-preview"></span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="extra-monthly" class="form-control" placeholder="0" value="0"
                               aria-label="Extra monthly payment amount" oninput="handleInputChange('extraMonthly', this.value)">
                    </div>
                    <div class="suggestion-chips">
                        <button class="suggestion-chip" onclick="setSuggestedValue('extra-monthly', 0)">$0</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('extra-monthly', 100)">$100</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('extra-monthly', 250)">$250</button>
                        <button class="suggestion-chip" onclick="setSuggestedValue('extra-monthly', 500)">$500</button>
                    </div>
                    <small class="help-text">Even small extra payments can save thousands in interest</small>
                </div>
                
                <!-- One-time Extra Payment - FIXED SINGLE DOLLAR SYMBOL -->
                <div class="form-group">
                    <label for="extra-onetime" class="form-label">
                        <i class="fas fa-hand-holding-usd"></i>
                        One-time Extra Payment
                        <span class="optional-text">(Applied to first payment)</span>
                    </label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="text" id="extra-onetime" class="form-control" placeholder="0" value="0"
                               aria-label="One-time extra payment amount" oninput="handleInputChange('extraOnetime', this.value)">
                    </div>
                    <small class="help-text">Lump sum payments like bonuses or inheritance</small>
                </div>
            </div>
            
            <!-- Auto-Calculate Notice -->
            <div class="auto-calc-notice">
                <i class="fas fa-magic"></i>
                <span>Calculations update automatically as you type</span>
                <i class="fas fa-sparkles"></i>
            </div>
        </section>
        
        <!-- Middle Section - Enhanced Results (45% width - REDUCED FROM 60%) -->
        <section class="results-section" role="region" aria-labelledby="results-section-title">
            <div class="section-header">
                <h2 id="results-section-title" class="section-title">
                    <i class="fas fa-calculator"></i>
                    Payment Analysis
                </h2>
                <!-- GLOBAL ACTION BUTTONS - Enhanced Share, Download, Print, Compare -->
                <div class="action-buttons global-actions">
                    <button class="action-btn secondary" onclick="addToComparison()" title="Add to loan comparison">
                        <i class="fas fa-balance-scale"></i>
                        <span>Compare</span>
                    </button>
                    <button class="action-btn secondary" onclick="shareResults()" title="Share this calculation">
                        <i class="fas fa-share-alt"></i>
                        <span>Share</span>
                    </button>
                    <button class="action-btn secondary" onclick="downloadPDF()" title="Download as PDF">
                        <i class="fas fa-file-pdf"></i>
                        <span>Download</span>
                    </button>
                    <button class="action-btn secondary" onclick="printResults()" title="Print results">
                        <i class="fas fa-print"></i>
                        <span>Print</span>
                    </button>
                </div>
            </div>
            
            <!-- Enhanced Main Payment Display -->
            <div class="main-payment-card">
                <div class="payment-header">
                    <h3>Total Monthly Payment</h3>
                    <span id="active-loan-type" class="loan-type-badge">Conventional Loan</span>
                </div>
                <div class="payment-amount">
                    <span id="total-payment" class="amount-value">$2,847</span>
                    <div class="payment-breakdown-summary">
                        <span id="pi-amount">$2,169 P&I</span>
                        <span class="separator">+</span>
                        <span id="escrow-amount">$678 Escrow</span>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Tab Navigation - FOUR CLICKABLE OPTIONS -->
            <div class="results-tabs">
                <button class="tab-btn active" data-tab="payment-components" onclick="switchTab('payment-components')">
                    <i class="fas fa-chart-pie"></i>
                    Payment Components
                </button>
                <button class="tab-btn" data-tab="mortgage-balance" onclick="switchTab('mortgage-balance')">
                    <i class="fas fa-chart-line"></i>
                    Mortgage Balance Over Time
                </button>
                <button class="tab-btn" data-tab="ai-insights" onclick="switchTab('ai-insights')">
                    <i class="fas fa-brain"></i>
                    AI-Powered Insights
                </button>
                <button class="tab-btn" data-tab="payment-schedule" onclick="switchTab('payment-schedule')">
                    <i class="fas fa-table"></i>
                    Payment Schedule
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Payment Components Tab (Active by default) -->
                <div id="payment-components-tab" class="tab-pane active">
                    <!-- Enhanced Payment Breakdown with Smart Hiding -->
                    <div class="payment-breakdown">
                        <div class="breakdown-items">
                            <!-- Principal & Interest - Always shown -->
                            <div class="breakdown-item" id="pi-breakdown-item">
                                <div class="item-info">
                                    <div class="item-label">Principal & Interest</div>
                                    <div id="principal-interest" class="item-amount">$2,169</div>
                                </div>
                                <div class="item-bar">
                                    <div id="pi-fill" class="item-fill" style="width: 76%"></div>
                                </div>
                                <div id="pi-percent" class="item-percentage">76%</div>
                            </div>
                            
                            <!-- Property Tax - Always shown -->
                            <div class="breakdown-item" id="tax-breakdown-item">
                                <div class="item-info">
                                    <div class="item-label">Property Tax</div>
                                    <div id="monthly-tax" class="item-amount">$750</div>
                                </div>
                                <div class="item-bar">
                                    <div id="tax-fill" class="item-fill" style="width: 26%"></div>
                                </div>
                                <div id="tax-percent" class="item-percentage">26%</div>
                            </div>
                            
                            <!-- Home Insurance - Always shown -->
                            <div class="breakdown-item" id="insurance-breakdown-item">
                                <div class="item-info">
                                    <div class="item-label">Home Insurance</div>
                                    <div id="monthly-insurance" class="item-amount">$150</div>
                                </div>
                                <div class="item-bar">
                                    <div id="insurance-fill" class="item-fill" style="width: 5%"></div>
                                </div>
                                <div id="insurance-percent" class="item-percentage">5%</div>
                            </div>
                            
                            <!-- PMI - Conditionally shown -->
                            <div class="breakdown-item" id="pmi-breakdown-item" style="display: none;">
                                <div class="item-info">
                                    <div class="item-label">Private Mortgage Insurance</div>
                                    <div id="monthly-pmi" class="item-amount">$0</div>
                                </div>
                                <div class="item-bar">
                                    <div id="pmi-fill" class="item-fill" style="width: 0%"></div>
                                </div>
                                <div id="pmi-percent" class="item-percentage">0%</div>
                            </div>
                            
                            <!-- HOA - Conditionally shown -->
                            <div class="breakdown-item" id="hoa-breakdown-item" style="display: none;">
                                <div class="item-info">
                                    <div class="item-label">HOA Fees</div>
                                    <div id="monthly-hoa" class="item-amount">$0</div>
                                </div>
                                <div class="item-bar">
                                    <div id="hoa-fill" class="item-fill" style="width: 0%"></div>
                                </div>
                                <div id="hoa-percent" class="item-percentage">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Enhanced Loan Summary - MOVED BELOW Payment Components -->
                    <div class="loan-summary">
                        <h3>Loan Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">Loan Amount</span>
                                <span id="display-loan-amount" class="summary-value">$360,000</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Total Interest</span>
                                <span id="display-total-interest" class="summary-value">$420,840</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Total Cost</span>
                                <span id="display-total-cost" class="summary-value">$1,230,840</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Payoff Date</span>
                                <span id="display-payoff-date" class="summary-value">Oct 2054</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Closing Costs</span>
                                <span id="display-closing-costs" class="summary-value">$13,500</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mortgage Balance Over Time Tab -->
                <div id="mortgage-balance-tab" class="tab-pane">
                    <!-- FIXED Working Chart Section -->
                    <div class="chart-section">
                        <div class="chart-header">
                            <h3>Mortgage Balance Timeline</h3>
                            <div class="chart-controls">
                                <button class="chart-control-btn" onclick="toggleChartView()" title="Toggle chart view">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        <div id="chart-loan-amount" class="chart-subtitle">Loan: $360,000 | Term: 30 years | Rate: 6.44%</div>
                        
                        <!-- FIXED Chart Container -->
                        <div class="chart-container">
                            <canvas id="mortgage-timeline-chart" aria-label="Mortgage balance timeline chart" width="800" height="400"></canvas>
                        </div>
                        
                        <!-- Enhanced Year Slider -->
                        <div class="year-slider-section">
                            <label for="year-range" class="slider-label">
                                <i class="fas fa-calendar-alt"></i>
                                Select Year to View Details
                            </label>
                            <input type="range" id="year-range" class="year-slider" min="1" max="30" value="15" 
                                   aria-label="Year slider" oninput="updateYearDetails(this.value)">
                            
                            <div class="year-display">
                                <div id="year-label" class="year-value">Year 15</div>
                            </div>
                            
                            <div class="year-details">
                                <div class="detail-item">
                                    <span class="detail-label">Principal Paid</span>
                                    <span id="year-principal-paid" class="detail-value">$95,000</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Interest Paid</span>
                                    <span id="year-interest-paid" class="detail-value">$265,000</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Remaining Balance</span>
                                    <span id="year-remaining-balance" class="detail-value">$265,000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI-Powered Insights Tab -->
                <div id="ai-insights-tab" class="tab-pane">
                    <div class="ai-insights-section">
                        <div class="insights-header">
                            <h3>
                                <i class="fas fa-brain"></i>
                                AI-Powered Financial Insights
                                <span class="ai-badge">AI</span>
                            </h3>
                            <button id="refresh-insights" class="refresh-btn" onclick="generateAIInsights()" aria-label="Refresh AI insights">
                                <i class="fas fa-sync-alt"></i>
                                <span>Refresh Insights</span>
                            </button>
                        </div>
                        
                        <div id="ai-insights" class="insights-container">
                            <p class="text-center text-gray-500">Calculating AI insights...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Schedule Tab -->
                <div id="payment-schedule-tab" class="tab-pane">
                    <!-- FIXED Amortization Schedule -->
                    <div class="schedule-section">
                        <div class="schedule-header">
                            <h3>Amortization Schedule</h3>
                            <div class="schedule-tabs">
                                <button class="tab-btn active" data-tab="monthly" onclick="switchScheduleTab('monthly')">
                                    Monthly
                                </button>
                                <button class="tab-btn" data-tab="yearly" onclick="switchScheduleTab('yearly')">
                                    Yearly
                                </button>
                            </div>
                        </div>
                        
                        <!-- FIXED Schedule Table -->
                        <div class="table-container">
                            <table class="schedule-table" role="table" aria-label="Mortgage amortization schedule">
                                <thead>
                                    <tr>
                                        <th scope="col">Payment #</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">Total Payment</th>
                                        <th scope="col">Principal</th>
                                        <th scope="col">Interest</th>
                                        <th scope="col">Balance</th>
                                    </tr>
                                </thead>
                                <tbody id="amortization-body">
                                    <!-- FIXED - Will show 6 rows only -->
                                    <tr>
                                        <td colspan="6" class="loading-row">Calculating amortization schedule...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- FIXED Schedule Pagination -->
                        <div class="schedule-pagination">
                            <button id="prev-payments" class="pagination-btn" onclick="previousPayments()" aria-label="Previous payments">
                                <i class="fas fa-chevron-left"></i>
                                <span>Previous</span>
                            </button>
                            <span id="pagination-info" class="pagination-info">Payments 1-6 of 360</span>
                            <button id="next-payments" class="pagination-btn" onclick="nextPayments()" aria-label="Next payments">
                                <span>Next</span>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- WORKING Compare Loan Scenarios -->
            <div class="compare-section">
                <div class="compare-header">
                    <h3>
                        <i class="fas fa-balance-scale"></i>
                        Compare Loan Scenarios
                    </h3>
                    <button class="compare-btn" onclick="addToComparison()" aria-label="Add current calculation to comparison">
                        <i class="fas fa-plus"></i>
                        <span>Add to Compare</span>
                    </button>
                </div>
                
                <div class="comparison-container">
                    <div id="comparison-table" style="display: none;">
                        <!-- Comparison table will be populated by JavaScript -->
                    </div>
                    <div id="comparison-placeholder" class="comparison-placeholder">
                        <i class="fas fa-chart-bar"></i>
                        <p>Add scenarios to compare different loan options side-by-side</p>
                        <button class="btn-primary" onclick="addToComparison()">Add Current Scenario</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Right Side - Enhanced Advertising/Sponsor Section (20% width - INCREASED FROM 15%) -->
        <aside class="sidebar-section enhanced-width" role="complementary" aria-labelledby="sidebar-title">
            <div class="section-header">
                <h2 id="sidebar-title" class="section-title">
                    <i class="fas fa-handshake"></i>
                    USA Partners
                </h2>
            </div>
            
            <!-- Enhanced Lender Partners -->
            <div class="lender-cards">
                <div class="lender-card featured">
                    <div class="lender-header">
                        <div class="lender-logo">
                            <img src="assets/lenders/quicken-loans.svg" alt="Quicken Loans" width="80" height="auto">
                        </div>
                        <div class="lender-rating">
                            <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                            <div class="rating-text">4.9/5</div>
                        </div>
                    </div>
                    <div class="lender-content">
                        <h4>Quicken Loans</h4>
                        <div class="lender-rate">6.42% APR</div>
                        <ul class="lender-features">
                            <li><i class="fas fa-check"></i> #1 USA Lender</li>
                            <li><i class="fas fa-check"></i> Fast Online Process</li>
                            <li><i class="fas fa-check"></i> FHA/VA/USDA Loans</li>
                            <li><i class="fas fa-check"></i> Rate Lock Guarantee</li>
                        </ul>
                        <button class="lender-cta-btn" onclick="trackLenderClick('Quicken Loans')">
                            <span>Get Pre-Approved</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="lender-card">
                    <div class="lender-header">
                        <div class="lender-logo">
                            <img src="assets/lenders/chase.svg" alt="Chase" width="80" height="auto">
                        </div>
                        <div class="lender-rating">
                            <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
                            <div class="rating-text">4.7/5</div>
                        </div>
                    </div>
                    <div class="lender-content">
                        <h4>Chase Bank</h4>
                        <div class="lender-rate">6.44% APR</div>
                        <ul class="lender-features">
                            <li><i class="fas fa-check"></i> National Bank</li>
                            <li><i class="fas fa-check"></i> Branch Network</li>
                            <li><i class="fas fa-check"></i> Jumbo Loans</li>
                            <li><i class="fas fa-check"></i> First-Time Buyer Programs</li>
                        </ul>
                        <button class="lender-cta-btn" onclick="trackLenderClick('Chase Bank')">
                            <span>View Rates</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="lender-card">
                    <div class="lender-header">
                        <div class="lender-logo">
                            <img src="assets/lenders/better.svg" alt="Better.com" width="80" height="auto">
                        </div>
                        <div class="lender-rating">
                            <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
                            <div class="rating-text">4.6/5</div>
                        </div>
                    </div>
                    <div class="lender-content">
                        <h4>Better.com</h4>
                        <div class="lender-rate">6.38% APR</div>
                        <ul class="lender-features">
                            <li><i class="fas fa-check"></i> Digital-First</li>
                            <li><i class="fas fa-check"></i> Low Fees</li>
                            <li><i class="fas fa-check"></i> Fast Approval</li>
                            <li><i class="fas fa-check"></i> Technology-Driven</li>
                        </ul>
                        <button class="lender-cta-btn" onclick="trackLenderClick('Better.com')">
                            <span>Start Application</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Resources -->
            <div class="resources-section">
                <div class="resources-header">
                    <h3>
                        <i class="fas fa-graduation-cap"></i>
                        Homebuyer Education
                    </h3>
                </div>
                
                <div class="resource-links">
                    <a href="/first-time-homebuyer-guide" class="resource-link" onclick="trackResourceClick('First-Time Buyer Guide')">
                        <i class="fas fa-home"></i>
                        <div class="resource-content">
                            <span class="resource-title">First-Time Homebuyer Guide</span>
                            <small class="resource-desc">Complete guide to buying your first home in America</small>
                        </div>
                    </a>
                    
                    <a href="/fha-loan-guide" class="resource-link" onclick="trackResourceClick('FHA Loan Guide')">
                        <i class="fas fa-flag-usa"></i>
                        <div class="resource-content">
                            <span class="resource-title">FHA Loan Requirements</span>
                            <small class="resource-desc">Everything you need to know about FHA loans</small>
                        </div>
                    </a>
                    
                    <a href="/va-loan-benefits" class="resource-link" onclick="trackResourceClick('VA Loan Benefits')">
                        <i class="fas fa-medal"></i>
                        <div class="resource-content">
                            <span class="resource-title">VA Loan Benefits</span>
                            <small class="resource-desc">Military and veteran home loan advantages</small>
                        </div>
                    </a>
                    
                    <a href="/mortgage-rates-today" class="resource-link" onclick="trackResourceClick('Current Rates')">
                        <i class="fas fa-chart-line"></i>
                        <div class="resource-content">
                            <span class="resource-title">Current USA Mortgage Rates</span>
                            <small class="resource-desc">Live rates from top American lenders</small>
                        </div>
                    </a>
                </div>
            </div>
            
            <!-- Enhanced Embed Section -->
            <div class="embed-section">
                <div class="embed-header">
                    <h3>
                        <i class="fas fa-code"></i>
                        Embed Calculator
                    </h3>
                    <div class="embed-subtitle">Share on Your Website</div>
                </div>
                
                <p class="embed-description">
                    Add this USA mortgage calculator to your website for free. 
                    Fully responsive and mobile-optimized for your visitors.
                </p>
                
                <div class="embed-code-container">
                    <textarea id="embed-code" class="embed-code" readonly><iframe src="https://finguid.com/mortgage-calculator/embed" width="100%" height="800" frameborder="0" title="USA Mortgage Calculator by FinGuid"></iframe></textarea>
                    <button class="copy-embed-btn" onclick="copyEmbedCode()" aria-label="Copy embed code">
                        <i class="fas fa-copy"></i>
                        <span>Copy</span>
                    </button>
                </div>
                
                <div class="embed-features">
                    <span class="embed-feature">âœ“ Mobile Responsive</span>
                    <span class="embed-feature">âœ“ No Ads</span>
                    <span class="embed-feature">âœ“ Fast Loading</span>
                    <span class="embed-feature">âœ“ USA Focused</span>
                </div>
            </div>
            
            <!-- Newsletter Signup -->
            <div class="newsletter-section">
                <div class="newsletter-header">
                    <h3>
                        <i class="fas fa-envelope"></i>
                        USA Rate Updates
                    </h3>
                </div>
                
                <p class="newsletter-description">
                    Get weekly USA mortgage rate updates and homebuying tips 
                    delivered to your inbox.
                </p>
                
                <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                    <div class="newsletter-input-group">
                        <input type="email" placeholder="your@email.com" required 
                               aria-label="Email address for newsletter">
                        <button type="submit" aria-label="Subscribe to newsletter">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <small class="newsletter-disclaimer">
                        Unsubscribe anytime. We respect your privacy.
                    </small>
                </form>
            </div>
        </aside>
    </main>
    
    <!-- Enhanced Voice Status Display -->
    <div id="voice-status" class="voice-status">
        <div class="voice-indicator">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="voice-content">
            <div id="voice-text" class="voice-text">Voice control active</div>
            <div id="voice-command" class="voice-command">Say "help" for commands</div>
        </div>
        <button class="voice-close" onclick="stopVoiceControl()" aria-label="Stop voice control">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Enhanced Footer -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="brand-info">
                        <img src="assets/finguid-usa-logo.svg" alt="FinGuid USA" class="footer-logo" width="40" height="40">
                        <h3 class="footer-tagline">FinGuid USA</h3>
                    </div>
                    <p class="footer-description">
                        World's first AI-enhanced calculator platform built specifically for American homebuyers. 
                        Get instant mortgage calculations with live USA rates, comprehensive loan analysis, 
                        and expert insights powered by artificial intelligence.
                    </p>
                </div>
                
                <div class="footer-links">
                    <div class="link-group">
                        <h4>Calculators</h4>
                        <a href="/mortgage-calculator">Mortgage Calculator</a>
                        <a href="/refinance-calculator">Refinance Calculator</a>
                        <a href="/affordability-calculator">Affordability Calculator</a>
                        <a href="/rent-vs-buy">Rent vs Buy</a>
                    </div>
                    
                    <div class="link-group">
                        <h4>Loan Types</h4>
                        <a href="/fha-loans">FHA Loans</a>
                        <a href="/va-loans">VA Loans</a>
                        <a href="/usda-loans">USDA Loans</a>
                        <a href="/conventional-loans">Conventional Loans</a>
                    </div>
                    
                    <div class="link-group">
                        <h4>Resources</h4>
                        <a href="/first-time-buyer">First-Time Buyers</a>
                        <a href="/closing-costs">Closing Costs</a>
                        <a href="/credit-score-guide">Credit Score Guide</a>
                        <a href="/mortgage-rates">Current Rates</a>
                    </div>
                    
                    <div class="link-group">
                        <h4>Company</h4>
                        <a href="/about">About FinGuid</a>
                        <a href="/contact">Contact Us</a>
                        <a href="/privacy">Privacy Policy</a>
                        <a href="/terms">Terms of Service</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="copyright">
                    <div>Â© 2025 FinGuid - World's First AI Calculator Platform for Americans</div>
                    <div class="seo-text">
                        USA Mortgage Calculator | FHA VA USDA Conventional Loans | 
                        AI-Powered Insights | Live American Rates | Mobile Optimized | 
                        Voice Control | Accessibility Compliant | PWA Ready
                    </div>
                </div>
                
                <div class="footer-badges">
                    <span class="footer-badge">ðŸ‡ºðŸ‡¸ Made for USA</span>
                    <span class="footer-badge">ðŸ§  AI-Enhanced</span>
                    <span class="footer-badge">ðŸ“± PWA Ready</span>
                    <span class="footer-badge">â™¿ Accessible</span>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>
    
    <!-- Loading Indicator -->
    <div id="loading-indicator" class="loading-indicator" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Calculating...</div>
        </div>
    </div>
    
    <!-- Enhanced JavaScript -->
    <script src="./mortgage-calculator-enhanced-fixed.js"></script>
    
    <!-- PWA Registration -->
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
