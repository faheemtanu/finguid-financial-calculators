<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI-Enhanced Mortgage Calculator</title>
  <link rel="stylesheet" href="/style.css" />
  <meta name="theme-color" content="#21808d" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    .wrap { max-width: 1100px; margin: 100px auto 40px; padding: 0 16px; }
    .grid { display:grid; grid-template-columns:1.1fr 0.9fr; gap:24px }
    @media(max-width:960px){.grid{grid-template-columns:1fr}}
    .section{background:var(--color-surface);border:1px solid var(--color-card-border);border-radius:12px;box-shadow:var(--shadow-sm)}
    .hd{padding:16px 20px;border-bottom:1px solid var(--color-card-border-inner);display:flex;align-items:center;gap:8px}
    .bd{padding:20px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .btnbar{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .chip{padding:8px 12px;border:1px solid var(--color-border);border-radius:20px;background:var(--color-surface);cursor:pointer}
    .chip.active{background:var(--color-primary);color:var(--color-btn-primary-text);border-color:transparent}
    .tab{display:flex;gap:8px;margin-bottom:8px}
    .hidden{display:none!important}
    .result-kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
    .kpi{background:var(--color-surface);border:1px solid var(--color-card-border);border-radius:10px;padding:12px}
    .kpi .v{font-size:22px;font-weight:700;color:var(--color-primary)}
    canvas{width:100%;height:260px;border:1px dashed var(--color-card-border);border-radius:10px;background:var(--color-background)}
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .legend span{padding:4px 8px;border:1px solid var(--color-border);font-size:12px;border-radius:999px}
    .status{display:none;align-items:center;gap:8px;padding:8px 10px;border:1px dashed var(--color-border);border-radius:8px;margin-top:8px}
    .status.active{display:flex}
    dialog{width:min(980px,96vw);border:1px solid var(--color-card-border);border-radius:12px;padding:0}
    dialog .hd{padding:12px 16px;border-bottom:1px solid var(--color-card-border-inner);display:flex;justify-content:space-between;align-items:center}
    dialog .body{padding:16px;max-height:70vh;overflow:auto}
  </style>
</head>
<body>
  <header class="header">
    <nav class="navbar">
      <div class="container">
        <a class="nav-brand" href="/"><i class="fa fa-scale-balanced"></i><span class="brand-text">Finguid</span></a>
        <div id="nav-menu" class="nav-menu">
          <a class="nav-link" href="/">Home</a>
          <a class="nav-link" href="/mortgage-calculator">Mortgage</a>
          <a class="nav-link" href="/calculators">Calculators</a>
        </div>
        <div id="hamburger" class="hamburger" aria-label="Menu" aria-expanded="false"><span></span><span></span><span></span></div>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- Loan Details -->
      <section class="section" aria-labelledby="loan-details">
        <div class="hd"><i class="fa fa-house"></i><h2 id="loan-details">Loan Details</h2></div>
        <div class="bd">
          <!-- Home Price & Rate -->
          <div class="row">
            <div>
              <label class="form-label">Home Price ($) <i class="info" title="Purchase price">?</i></label>
              <div style="display:flex;gap:8px">
                <input id="home-price" class="form-input" type="number" min="0" step="1000" value="400000"/>
                <button class="chip voice-btn" data-voice="home-price"><i class="fa fa-microphone"></i></button>
              </div>
            </div>
            <div>
              <label class="form-label">Interest Rate (%) <i class="info" title="Annual APR">?</i></label>
              <input id="interest-rate" class="form-input" type="number" min="0" step="0.01" value="6.75"/>
            </div>
          </div>
          <!-- Down Payment Tabs -->
          <div>
            <div class="tab">
              <button id="tab-amount" class="chip active">Amount $</button>
              <button id="tab-percent" class="chip">Percent %</button>
            </div>
            <div class="row">
              <div id="dp-amount-wrap">
                <label class="form-label">Down Payment ($) <i class="info" title="Cash upfront">?</i></label>
                <input id="dp-amount" class="form-input" type="number" min="0" step="500" value="80000"/>
              </div>
              <div id="dp-percent-wrap" class="hidden">
                <label class="form-label">Down Payment (%)</label>
                <input id="dp-percent" class="form-input" type="number" min="0" max="100" step="0.1" value="20"/>
              </div>
            </div>
            <div id="pmi-banner" class="form-help hidden">PMI likely required until 20% equity.</div>
          </div>
          <!-- Term Selection -->
          <div>
            <label class="form-label">Loan Term <i class="info" title="Years">?</i></label>
            <div class="btnbar" id="term-buttons">
              <button class="chip" data-term="10">10y</button>
              <button class="chip" data-term="15">15y</button>
              <button class="chip" data-term="20">20y</button>
              <button class="chip" data-term="25">25y</button>
              <button class="chip active" data-term="30">30y</button>
              <span class="chip pill">or</span>
              <input id="term-custom" class="form-input" type="number" min="1" max="50" step="1" placeholder="Custom"/>
            </div>
          </div>
          <!-- State & Tax -->
          <div class="row">
            <div>
              <label class="form-label">Property State <i class="info" title="Select state">?</i></label>
              <select id="state" class="form-control">
                <option value="">Select state</option>
                <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><!-- & 47 more -->
              </select>
            </div>
            <div>
              <label class="form-label">Property Tax (Annual $) <i class="info" title="Auto-rate">?</i></label>
              <input id="property-tax" class="form-input" type="number" min="0" step="50" value="0"/>
            </div>
          </div>
          <!-- Advanced Options -->
          <div>
            <div id="advanced-toggle" class="adv-toggle"><i class="fa fa-chevron-down"></i><strong>Advanced options</strong></div>
            <div id="advanced-panel" class="hidden" style="margin-top:10px">
              <div class="row">
                <div>
                  <label class="form-label">Home Insurance ($) <i class="info" title="~0.24% home value">?</i></label>
                  <input id="home-insurance" class="form-input" type="number" min="0" step="50" value="0"/>
                </div>
                <div>
                  <label class="form-label">PMI Rate (%) <i class="info" title="If <20% DP">?</i></label>
                  <input id="pmi-rate" class="form-input" type="number" min="0" step="0.05" value="0.8"/>
                </div>
              </div>
              <div class="row">
                <div>
                  <label class="form-label">HOA Fees ($/mo)</label>
                  <input id="hoa-fees" class="form-input" type="number" min="0" step="10" value="0"/>
                </div>
                <div>
                  <label class="form-label">Extra Payment ($/mo) <i class="info" title="Principal only">?</i></label>
                  <input id="extra-monthly" class="form-input" type="number" min="0" step="10" value="0"/>
                </div>
              </div>
              <div class="row">
                <div>
                  <label class="form-label">One-Time Extra ($) <i class="info" title="First payment">?</i></label>
                  <input id="extra-once" class="form-input" type="number" min="0" step="100" value="0"/>
                </div>
              </div>
            </div>
          </div>
          <!-- Actions -->
          <div class="btnbar">
            <button id="calculate-btn" class="btn btn-primary"><i class="fa fa-calculator"></i>&nbsp;Calculate</button>
            <button id="save-comparison" class="btn btn-secondary"><i class="fa fa-scale-balanced"></i>&nbsp;Save to Compare</button>
            <button id="reset-form" class="btn btn-outline"><i class="fa fa-rotate-left"></i>&nbsp;Reset</button>
            <button id="email-results" class="btn btn-outline"><i class="fa fa-envelope"></i>&nbsp;Email Results</button>
          </div>
          <div id="voice-status" class="status"><i class="fa fa-microphone-lines"></i><span>Listeningâ€¦</span></div>
        </div>
      </section>

      <!-- Results -->
      <section class="section" aria-labelledby="results">
        <div class="hd"><i class="fa fa-chart-pie"></i><h2 id="results">Payment Results</h2></div>
        <div class="bd">
          <!-- KPIs -->
          <div class="result-kpis">
            <div class="kpi"><div>Total Monthly</div><div id="total-payment" class="v">$0</div></div>
            <div class="kpi"><div>Loan Amount</div><div id="loan-amount" class="v">$0</div></div>
            <div class="kpi"><div>Total Interest</div><div id="total-interest" class="v">$0</div></div>
          </div>
          <!-- Charts -->
          <div class="row">
            <div>
              <strong>Monthly Breakdown</strong>
              <canvas id="breakdownChart" aria-label="Pie chart"></canvas>
              <div class="legend" id="legend-breakdown"></div>
              <table class="table"><tbody>
                <tr><td>P&I</td><td id="pi-amount">$0</td></tr>
                <tr><td>Taxes</td><td id="tax-amount">$0</td></tr>
                <tr><td>Insurance</td><td id="insurance-amount">$0</td></tr>
                <tr id="row-pmi"><td>PMI</td><td id="pmi-amount">$0</td></tr>
                <tr><td>HOA</td><td id="hoa-amount">$0</td></tr>
              </tbody></table>
            </div>
            <div>
              <strong>Amortization</strong>
              <canvas id="amortizationChart" aria-label="Line chart"></canvas>
              <div class="form-help">Balance over time with extras applied.</div>
            </div>
          </div>
          <!-- Insights -->
          <div>
            <div style="display:flex;align-items:center;gap:8px"><h3 style="margin:0">AI Insights</h3><span class="pill">auto</span></div>
            <ul id="insights-list" style="margin:8px 0 0 18px"></ul>
          </div>
          <!-- 5-Year Schedule -->
          <div>
            <div style="display:flex;align-items:center;gap:8px">
              <h3 style="margin:0">Payment Schedule (First 5 Years)</h3>
              <button id="view-full-schedule" class="btn btn-outline" style="margin-left:auto">View full schedule</button>
            </div>
            <table class="table"><thead><tr><th>Year</th><th>Payment</th><th>Principal</th><th>Interest</th><th>End Balance</th></tr></thead>
            <tbody id="amortization-body"></tbody></table>
          </div>
        </div>
      </section>
    </div>

    <!-- Comparison -->
    <section class="section" style="margin-top:24px" aria-labelledby="compare">
      <div class="hd"><i class="fa fa-scale-balanced"></i><h2 id="compare">Loan Comparison</h2></div>
      <div class="bd">
        <div class="row">
          <div><label class="form-label">Scenario Name</label><input id="scenario-name" class="form-input" placeholder="e.g. 20% down @ 6.5%"/></div>
          <div class="btnbar" style="align-items:end">
            <button id="add-scenario" class="btn btn-primary"><i class="fa fa-plus"></i>&nbsp;Add Current</button>
            <button id="clear-scenarios" class="btn btn-outline"><i class="fa fa-trash"></i>&nbsp;Clear</button>
          </div>
        </div>
        <div id="comparison-grid" class="compare-grid"></div>
      </div>
    </section>
  </main>

  <!-- Full schedule modal -->
  <dialog id="schedule-modal">
    <div class="hd"><strong>Full Amortization Schedule</strong><button id="close-schedule" class="btn btn-outline">Close</button></div>
    <div class="body">
      <table class="table"><thead><tr><th>#</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Extra</th><th>Balance</th></tr></thead>
      <tbody id="full-schedule-body"></tbody></table>
    </div>
  </dialog>

  <script src="/mortgage-calculator.js" defer></script>
  <script>
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('/sw.js').catch(()=>{});
    document.getElementById('hamburger').addEventListener('click', ()=>{
      document.getElementById('nav-menu').classList.toggle('active');
      document.getElementById('hamburger').classList.toggle('active');
    });
  </script>
</body>
</html>
