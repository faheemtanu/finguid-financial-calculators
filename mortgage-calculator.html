<!DOCTYPE html>
<html lang="en" class="no-js" data-color-scheme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- Enhanced SEO Meta Tags -->
    <title>FinGuid Home Loan Pro — AI‑Powered Mortgage Calculator | Live Federal Reserve Rates</title>
    <meta name="description" content="FinGuid's AI-powered mortgage calculator with live FRED API rates, voice commands, perfect down payment sync, and real-time insights.">
    <meta name="keywords" content="mortgage calculator, AI mortgage calculator, FRED API rates, home loan calculator, mortgage payment">
    <meta name="author" content="FinGuid - Financial Guidance Platform">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="en-US">
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    
    <!-- Enhanced Open Graph for Social Sharing -->
    <meta property="og:title" content="FinGuid Home Loan Pro — AI‑Powered Mortgage Calculator">
    <meta property="og:description" content="Calculate your home loan with live FRED rates, AI insights, voice commands, and perfect down payment synchronization.">
    <meta property="og:url" content="https://finguid.com/home-loan-pro">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="FinGuid">
    <meta property="og:image" content="https://finguid.com/images/home-loan-pro-og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FinGuid Home Loan Pro — AI‑Powered Mortgage Calculator">
    <meta name="twitter:description" content="Advanced mortgage calculator with voice commands and live Federal Reserve rates">
    <meta name="twitter:image" content="https://finguid.com/images/home-loan-pro-twitter.jpg">
    <meta name="twitter:site" content="@FinGuid">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://finguid.com/home-loan-pro">
    
    <!-- Enhanced Icons and Theme -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/home-loan-pro-icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
    <link rel="manifest" href="/app.webmanifest">
    <meta name="theme-color" content="#218089" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#32b8c6" media="(prefers-color-scheme: dark)">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Home Loan Pro">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.stlouisfed.org">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    
    <!-- Enhanced Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=FKGroteskNeue:wght@400;500;550;600&family=Geist:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Chart.js for Enhanced Colorful Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js" defer></script>
    
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    
    <style>
        /* ========================================================================== */
        /* FINGUID HOME LOAN PRO - ENHANCED CSS v2.0                               */
        /* Improved Layout, Better PMI Calculation, Working Features               */
        /* ========================================================================== */

        :root {
            /* Enhanced Color System */
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-gray-50: rgba(249, 250, 251, 1);
            --color-gray-100: rgba(243, 244, 246, 1);
            --color-gray-200: rgba(229, 231, 235, 1);
            --color-gray-300: rgba(209, 213, 219, 1);
            --color-gray-400: rgba(156, 163, 175, 1);
            --color-gray-500: rgba(107, 114, 128, 1);
            --color-gray-600: rgba(75, 85, 99, 1);
            --color-gray-700: rgba(55, 65, 81, 1);
            --color-gray-800: rgba(31, 41, 55, 1);
            --color-gray-900: rgba(17, 24, 39, 1);
            
            /* Enhanced Primary Colors */
            --color-teal-50: rgba(240, 253, 250, 1);
            --color-teal-100: rgba(204, 251, 241, 1);
            --color-teal-200: rgba(153, 246, 228, 1);
            --color-teal-300: rgba(94, 234, 212, 1);
            --color-teal-400: rgba(45, 212, 191, 1);
            --color-teal-500: rgba(20, 184, 166, 1);
            --color-teal-600: rgba(13, 148, 136, 1);
            --color-teal-700: rgba(15, 118, 110, 1);
            --color-teal-800: rgba(17, 94, 89, 1);
            --color-teal-900: rgba(19, 78, 74, 1);
            
            /* Brand Color Palette */
            --brand-blue: rgba(0, 82, 155, 1);
            --brand-green: rgba(0, 168, 107, 1);
            --brand-gold: rgba(255, 193, 7, 1);
            
            /* Enhanced Status Colors */
            --color-success-50: rgba(240, 253, 244, 1);
            --color-success-500: rgba(34, 197, 94, 1);
            --color-success-600: rgba(22, 163, 74, 1);
            --color-error-50: rgba(254, 242, 242, 1);
            --color-error-500: rgba(239, 68, 68, 1);
            --color-error-600: rgba(220, 38, 38, 1);
            --color-warning-50: rgba(255, 251, 235, 1);
            --color-warning-500: rgba(245, 158, 11, 1);
            --color-warning-600: rgba(217, 119, 6, 1);
            --color-info-50: rgba(239, 246, 255, 1);
            --color-info-500: rgba(59, 130, 246, 1);
            --color-info-600: rgba(37, 99, 235, 1);
            
            /* Light Mode Semantic Colors */
            --color-background: var(--color-gray-50);
            --color-surface: var(--color-white);
            --color-surface-secondary: var(--color-gray-100);
            --color-text: var(--color-gray-900);
            --color-text-secondary: var(--color-gray-600);
            --color-text-muted: var(--color-gray-500);
            --color-primary: var(--brand-blue);
            --color-primary-hover: rgba(0, 65, 124, 1);
            --color-primary-light: rgba(0, 82, 155, 0.1);
            --color-border: var(--color-gray-300);
            --color-border-light: var(--color-gray-200);
            --color-border-strong: var(--color-gray-400);
            
            /* Enhanced Typography */
            --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
            
            /* Responsive Font Sizes */
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            
            /* Font Scaling System */
            --font-scale: 1;
            --font-size-calculated-xs: calc(var(--font-size-xs) * var(--font-scale));
            --font-size-calculated-sm: calc(var(--font-size-sm) * var(--font-scale));
            --font-size-calculated-base: calc(var(--font-size-base) * var(--font-scale));
            --font-size-calculated-lg: calc(var(--font-size-lg) * var(--font-scale));
            --font-size-calculated-xl: calc(var(--font-size-xl) * var(--font-scale));
            --font-size-calculated-2xl: calc(var(--font-size-2xl) * var(--font-scale));
            --font-size-calculated-3xl: calc(var(--font-size-3xl) * var(--font-scale));
            --font-size-calculated-4xl: calc(var(--font-size-4xl) * var(--font-scale));
            
            /* Font Weights */
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            /* Spacing System */
            --space-px: 1px;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            
            /* Border Radius */
            --radius-sm: 0.125rem;
            --radius-base: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* Enhanced Shadows */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            
            /* Animation & Transitions */
            --duration-150: 150ms;
            --duration-200: 200ms;
            --duration-300: 300ms;
            --duration-500: 500ms;
            --duration-1000: 1000ms;
            
            --ease-out: cubic-bezier(0, 0, 0.2, 1);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
            
            --transition-fast: var(--duration-150) var(--ease-out);
            --transition-normal: var(--duration-200) var(--ease-in-out);
            --transition-slow: var(--duration-300) var(--ease-in-out);
            
            /* Z-Index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-tooltip: 1070;
            --z-toast: 1080;
        }

        /* Dark Mode Theme */
        [data-color-scheme="dark"] {
            --color-background: var(--color-gray-900);
            --color-surface: var(--color-gray-800);
            --color-surface-secondary: var(--color-gray-700);
            --color-text: var(--color-gray-100);
            --color-text-secondary: var(--color-gray-400);
            --color-text-muted: var(--color-gray-500);
            --color-primary: var(--color-teal-400);
            --color-primary-hover: var(--color-teal-300);
            --color-primary-light: rgba(45, 212, 191, 0.1);
            --color-border: var(--color-gray-600);
            --color-border-light: var(--color-gray-700);
            --color-border-strong: var(--color-gray-500);
            
            /* Enhanced dark mode shadows */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px -1px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 8px 10px -6px rgba(0, 0, 0, 0.4);
        }

        /* Font Scale Classes */
        .font-scale-75 { --font-scale: 0.75; }
        .font-scale-100 { --font-scale: 1; }
        .font-scale-125 { --font-scale: 1.25; }

        /* Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        * {
            margin: 0;
        }

        html {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: var(--font-family-primary);
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-normal);
            line-height: 1.5;
            color: var(--color-text);
            background-color: var(--color-background);
            min-height: 100vh;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Enhanced Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .skip-link {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            z-index: var(--z-modal);
            padding: var(--space-3) var(--space-6);
            background: var(--color-primary);
            color: var(--color-white);
            text-decoration: none;
            font-weight: var(--font-weight-semibold);
            border-radius: var(--radius-lg);
            transform: translateY(-200%);
            transition: transform var(--transition-fast);
        }

        .skip-link:focus {
            transform: translateY(0);
        }

        /* Enhanced Header */
        .site-header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            transition: all var(--transition-normal);
        }

        .site-header.scrolled {
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        [data-color-scheme="dark"] .site-header.scrolled {
            background: rgba(31, 41, 55, 0.95);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 4rem;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        /* Animated Header Middle Section */
        .header-middle {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-teal-700) 100%);
            color: var(--color-white);
            overflow: hidden;
            position: relative;
        }

        .header-middle-content {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: var(--space-3) var(--space-4);
        }

        .tagline {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-2);
        }

        .features-quick {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .feature-quick {
            font-size: var(--font-size-calculated-sm);
            background: rgba(255, 255, 255, 0.15);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            backdrop-filter: blur(5px);
        }

        /* Enhanced Brand Section */
        .brand-section {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .logo-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--color-text);
            transition: transform var(--transition-fast);
        }

        .logo-link:hover {
            transform: translateY(-1px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .logo-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-0-5);
        }

        .logo-main {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            line-height: 1.2;
        }

        .logo-subtitle {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* Enhanced Navigation */
        .nav-links {
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-calculated-sm);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
            position: relative;
        }

        .nav-link:hover {
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-1px);
        }

        /* Enhanced Accessibility Controls */
        .accessibility-controls {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }

        .accessibility-controls:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .font-controls {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding-right: var(--space-3);
            border-right: 1px solid var(--color-border);
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            min-width: 2.5rem;
            min-height: 2.5rem;
            padding: var(--space-2);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .control-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .control-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 155, 0.2);
        }

        .control-icon,
        .control-label {
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-semibold);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 2rem;
            height: 1.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .hamburger {
            display: block;
            height: 3px;
            width: 100%;
            background: var(--color-text);
            border-radius: var(--radius-full);
            transition: all var(--transition-fast);
        }

        /* Main Calculator Layout - Improved 30-40-30 */
        .calculator-main {
            background: var(--color-background);
            min-height: 100vh;
        }

        .calculator-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-4);
            display: grid;
            grid-template-columns: 30% 40% 30%;
            gap: var(--space-6);
            align-items: start;
        }

        .input-section,
        .results-section,
        .sidebar-section {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-lg);
            padding: var(--space-6);
            transition: all var(--transition-normal);
        }

        .input-section:hover,
        .results-section:hover,
        .sidebar-section:hover {
            box-shadow: var(--shadow-xl);
            border-color: var(--color-primary);
            transform: translateY(-1px);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--color-border);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin: 0;
        }

        .section-icon {
            color: var(--color-primary);
            font-size: var(--font-size-calculated-lg);
        }

        .section-subtitle {
            color: var(--color-text-muted);
            font-size: var(--font-size-calculated-sm);
            margin: 0;
        }

        /* Enhanced Form Components */
        .form-section {
            margin-bottom: var(--space-8);
        }

        .subsection-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-5);
            padding: var(--space-4);
            background: linear-gradient(135deg, var(--color-primary-light), rgba(0, 82, 155, 0.05));
            border-radius: var(--radius-xl);
            border-left: 4px solid var(--color-primary);
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-bold);
            flex-shrink: 0;
        }

        .subsection-help {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-normal);
            font-style: italic;
        }

        .form-group {
            margin-bottom: var(--space-5);
        }

        .form-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .label-content {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-calculated-sm);
        }

        .label-icon {
            color: var(--color-primary);
            font-size: var(--font-size-calculated-base);
        }

        .label-help {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-normal);
            font-style: italic;
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .form-control {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-calculated-base);
            font-family: var(--font-family-primary);
            color: var(--color-text);
            background-color: var(--color-surface);
            transition: all var(--transition-fast);
            min-height: 3rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 82, 155, 0.1);
            transform: translateY(-1px);
        }

        .form-control:hover:not(:focus) {
            border-color: var(--color-border-strong);
        }

        .form-control:read-only {
            background-color: var(--color-surface-secondary);
            cursor: not-allowed;
        }

        .input-prefix,
        .input-suffix {
            position: absolute;
            display: flex;
            align-items: center;
            height: calc(100% - 4px);
            padding: 0 var(--space-3);
            color: var(--color-text-muted);
            font-weight: var(--font-weight-semibold);
            background: var(--color-surface-secondary);
            border: 2px solid var(--color-border);
            font-size: var(--font-size-calculated-sm);
            z-index: 1;
            pointer-events: none;
            top: 2px;
        }

        .input-prefix {
            left: 2px;
            border-right: none;
            border-radius: var(--radius-xl) 0 0 var(--radius-xl);
        }

        .input-suffix {
            right: 2px;
            border-left: none;
            border-radius: 0 var(--radius-xl) var(--radius-xl) 0;
        }

        .input-group:has(.input-prefix) .form-control {
            padding-left: calc(var(--space-4) * 2.5);
        }

        .input-group:has(.input-suffix) .form-control {
            padding-right: calc(var(--space-4) * 2.5);
        }

        .help-text {
            display: block;
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-1);
        }

        /* Working Down Payment Synchronization */
        .percentage-input {
            margin-top: var(--space-2);
        }

        .percentage-chips {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-top: var(--space-3);
        }

        .percentage-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
            min-width: 4rem;
            min-height: 4rem;
        }

        .percentage-chip:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .percentage-chip.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: 0 0 0 3px rgba(0, 82, 155, 0.2);
        }

        .chip-value {
            font-weight: var(--font-weight-bold);
            line-height: 1;
        }

        .chip-label {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
            margin-top: var(--space-1);
        }

        /* Credit Score Impact Display */
        .credit-impact {
            margin-top: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .credit-impact.positive {
            background: var(--color-success-50);
            color: var(--color-success-600);
            border: 1px solid var(--color-success-500);
        }

        .credit-impact.negative {
            background: var(--color-error-50);
            color: var(--color-error-600);
            border: 1px solid var(--color-error-500);
        }

        .credit-impact.neutral {
            background: var(--color-info-50);
            color: var(--color-info-600);
            border: 1px solid var(--color-info-500);
        }

        [data-color-scheme="dark"] .credit-impact.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--color-success-500);
        }

        [data-color-scheme="dark"] .credit-impact.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--color-error-500);
        }

        [data-color-scheme="dark"] .credit-impact.neutral {
            background: rgba(59, 130, 246, 0.15);
            color: var(--color-info-500);
        }

        /* Enhanced Interest Rate with Live FRED */
        .rate-info {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .live-rate-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-calculated-xs);
            padding: var(--space-1) var(--space-2);
            background: var(--color-success-500);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
        }

        .live-icon {
            animation: livePulse var(--duration-1000) ease-in-out infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .refresh-rate-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .refresh-rate-btn:hover {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
            transform: rotate(180deg);
        }

        .federal-attribution {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-2);
            font-style: italic;
        }

        /* Enhanced Loan Terms */
        .term-chips.compact-75 {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            transform: scale(0.75);
            transform-origin: left center;
        }

        .term-chip {
            flex: 1;
            min-width: 4.5rem;
            max-width: 6rem;
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            text-align: center;
            transition: all var(--transition-fast);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
        }

        .term-chip:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .term-chip.active {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: 0 0 0 3px rgba(0, 82, 155, 0.2);
        }

        .term-years {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
        }

        .term-label {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
        }

        .custom-term-group {
            margin-top: var(--space-4);
        }

        .custom-term-label {
            display: block;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        /* Compact Loan Type Cards */
        .loan-type-section {
            background: linear-gradient(135deg, var(--color-primary-light), rgba(0, 82, 155, 0.03));
            padding: var(--space-4);
            border-radius: var(--radius-xl);
            border: 1px solid var(--color-border);
            margin-bottom: var(--space-6);
        }

        .loan-type-grid.compact {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-2);
            margin-top: var(--space-3);
        }

        .loan-type-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            text-align: left;
            transition: all var(--transition-fast);
            min-height: 4rem;
        }

        .loan-type-btn:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .loan-type-btn.active {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
            color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 82, 155, 0.1);
        }

        .loan-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-md);
            flex-shrink: 0;
        }

        .loan-icon i {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-primary);
        }

        .loan-content {
            flex: 1;
        }

        .loan-title {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-1);
        }

        .loan-description {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
        }

        /* Auto-Calculated PMI Status */
        .pmi-status {
            margin-top: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .pmi-status.active {
            background: var(--color-warning-50);
            color: var(--color-warning-600);
            border: 1px solid var(--color-warning-500);
        }

        .pmi-status.inactive {
            background: var(--color-success-50);
            color: var(--color-success-600);
            border: 1px solid var(--color-success-500);
        }

        [data-color-scheme="dark"] .pmi-status.active {
            background: rgba(245, 158, 11, 0.15);
            color: var(--color-warning-500);
        }

        [data-color-scheme="dark"] .pmi-status.inactive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--color-success-500);
        }

        .auto-update-notice {
            text-align: center;
            padding: var(--space-4);
            background: var(--color-info-50);
            border: 1px solid var(--color-info-500);
            border-radius: var(--radius-lg);
            color: var(--color-info-600);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            margin-top: var(--space-4);
        }

        [data-color-scheme="dark"] .auto-update-notice {
            background: rgba(59, 130, 246, 0.15);
            color: var(--color-info-500);
        }

        .closing-costs-display {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-2);
            flex-wrap: wrap;
        }

        .closing-costs-amount {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .closing-costs-note {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            font-style: italic;
        }

        /* NEW: One-time Extra Payment */
        .one-time-payment-section {
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }

        .one-time-payment-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .one-time-payment-title {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .one-time-payment-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: var(--space-2);
            align-items: end;
        }

        .one-time-payment-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
        }

        .one-time-payment-list {
            margin-top: var(--space-3);
            max-height: 200px;
            overflow-y: auto;
        }

        .one-time-payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) var(--space-3);
            background: var(--color-surface);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            border: 1px solid var(--color-border);
        }

        .one-time-payment-details {
            display: flex;
            flex-direction: column;
        }

        .one-time-payment-amount {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .one-time-payment-date {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
        }

        .remove-payment-btn {
            background: none;
            border: none;
            color: var(--color-error-500);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
        }

        .remove-payment-btn:hover {
            background: var(--color-error-50);
        }

        /* Main Payment Display */
        .main-payment-card {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-teal-700) 100%);
            color: var(--color-white);
            padding: var(--space-6);
            border-radius: var(--radius-2xl);
            margin-bottom: var(--space-6);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            position: relative;
            z-index: 1;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .payment-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .loan-type-badge {
            background: rgba(255, 255, 255, 0.2);
            color: var(--color-white);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .payment-amount {
            position: relative;
            z-index: 1;
        }

        .payment-value {
            font-size: var(--font-size-calculated-4xl);
            font-weight: var(--font-weight-bold);
            display: block;
            margin-bottom: var(--space-2);
            line-height: 1.1;
        }

        .payment-breakdown {
            font-size: var(--font-size-calculated-lg);
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .breakdown-separator {
            margin: 0 var(--space-1);
            opacity: 0.7;
        }

        /* Payment Components Chart Section */
        .chart-section.payment-components {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .chart-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin: 0;
        }

        .chart-container {
            position: relative;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Compact Loan Summary */
        .loan-summary.compact {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .summary-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-4);
        }

        .summary-icon {
            color: var(--color-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
        }

        .summary-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            background: var(--color-surface-secondary);
            transition: all var(--transition-fast);
        }

        .summary-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .summary-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .summary-value {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .summary-value.highlight {
            color: var(--color-primary);
        }

        /* Live Updating Loan Analysis */
        .loan-analysis-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .analysis-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        .chart-subtitle {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            text-align: center;
            margin-bottom: var(--space-5);
            font-family: var(--font-family-mono);
        }

        /* Working Year Selector */
        .year-selector-section {
            margin: var(--space-5) 0;
        }

        .year-selector-label {
            display: block;
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
            margin-bottom: var(--space-3);
        }

        .year-slider {
            width: 100%;
            height: var(--space-2);
            border-radius: var(--radius-full);
            background: var(--color-border);
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .year-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: var(--space-6);
            height: var(--space-6);
            border-radius: var(--radius-full);
            background: var(--color-primary);
            cursor: pointer;
            border: 3px solid var(--color-white);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        .year-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-lg);
        }

        .year-slider::-moz-range-thumb {
            width: var(--space-6);
            height: var(--space-6);
            border-radius: var(--radius-full);
            background: var(--color-primary);
            cursor: pointer;
            border: 3px solid var(--color-white);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }

        /* Compact Year Details */
        .year-details.compact {
            text-align: center;
            margin: var(--space-4) 0;
        }

        .year-title {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
            margin-bottom: var(--space-4);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-3);
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            background: var(--color-surface-secondary);
            transition: all var(--transition-fast);
        }

        .detail-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .detail-label {
            display: block;
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
        }

        .detail-value {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        /* Enhanced Payment Schedule */
        .payment-schedule-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .schedule-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .schedule-icon {
            color: var(--color-primary);
        }

        .schedule-options {
            display: flex;
            gap: var(--space-1);
            background: var(--color-surface-secondary);
            padding: var(--space-1);
            border-radius: var(--radius-lg);
        }

        .schedule-btn {
            padding: var(--space-2) var(--space-4);
            border: none;
            border-radius: var(--radius-md);
            background: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .schedule-btn:hover {
            color: var(--color-text);
        }

        .schedule-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: var(--shadow-sm);
        }

        .schedule-container {
            margin-top: var(--space-4);
        }

        .schedule-table-wrapper {
            overflow-x: auto;
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--font-size-calculated-sm);
        }

        .schedule-table th {
            background: var(--color-surface-secondary);
            color: var(--color-text);
            font-weight: var(--font-weight-semibold);
            text-align: left;
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border);
        }

        .schedule-table td {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-border-light);
            color: var(--color-text);
        }

        .schedule-table tbody tr:hover {
            background: var(--color-surface-secondary);
        }

        .schedule-loading {
            text-align: center;
            padding: var(--space-8);
            color: var(--color-text-muted);
            font-style: italic;
        }

        .schedule-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-calculated-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn:not(:disabled):hover {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination-info {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        /* AI-Powered Insights */
        .ai-insights-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .insights-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-5);
        }

        .insights-icon {
            color: var(--color-primary);
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: var(--font-size-calculated-xs);
            padding: var(--space-1) var(--space-2);
            background: var(--color-primary);
            color: var(--color-white);
            border-radius: var(--radius-full);
            font-weight: var(--font-weight-semibold);
        }

        .insights-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .insight-item {
            padding: var(--space-4);
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--color-primary);
            transition: all var(--transition-fast);
        }

        .insight-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .insight-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .insight-text {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text);
            line-height: 1.6;
        }

        /* Universal Sharing Options */
        .sharing-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .sharing-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-4);
        }

        .sharing-icon {
            color: var(--color-primary);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-3);
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            border: 2px solid;
        }

        .action-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .action-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .action-btn.secondary:hover {
            background: var(--color-primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Dummy Sponsor Section */
        .partner-showcase {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .partner-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            transition: all var(--transition-fast);
        }

        .partner-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary);
        }

        .partner-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .partner-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .partner-icon {
            font-size: var(--font-size-calculated-lg);
            color: var(--color-primary);
        }

        .partner-info {
            flex: 1;
        }

        .partner-name {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-1);
        }

        .partner-rating {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .rating-stars {
            color: var(--color-warning-500);
        }

        .rating-text {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
        }

        .partner-rates {
            margin-bottom: var(--space-4);
        }

        .rate-display {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            padding: var(--space-3);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .rate-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .rate-value {
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }

        .rate-apr {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
        }

        .partner-cta {
            width: 100%;
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .partner-cta.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .partner-cta.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        .partner-cta.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .partner-cta.secondary:hover {
            background: var(--color-primary-light);
            transform: translateY(-1px);
        }

        /* Market Insights */
        .market-insights {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .market-stats {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .market-stat {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
        }

        .stat-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--color-primary-light);
            border-radius: var(--radius-lg);
            flex-shrink: 0;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
            display: block;
        }

        .stat-value {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .stat-change {
            font-size: var(--font-size-calculated-xs);
            font-weight: var(--font-weight-medium);
            margin-left: var(--space-2);
        }

        .stat-change.positive {
            color: var(--color-success-500);
        }

        .stat-change.negative {
            color: var(--color-error-500);
        }

        .stat-change.neutral {
            color: var(--color-text-muted);
        }

        /* Advertisement Space */
        .ad-space {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
        }

        .ad-container {
            text-align: center;
        }

        .ad-label {
            font-size: var(--font-size-calculated-xs);
            color: var(--color-text-muted);
            text-transform: uppercase;
            font-weight: var(--font-weight-semibold);
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
        }

        .ad-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: var(--space-2);
        }

        .ad-description {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-4);
            line-height: 1.5;
        }

        .ad-cta {
            width: 100%;
            padding: var(--space-3);
            background: var(--color-primary);
            color: var(--color-white);
            border: 2px solid var(--color-primary);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .ad-cta:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Voice Modal and Overlays */
        .voice-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .voice-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
        }

        .voice-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-border);
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .modal-icon {
            color: var(--color-primary);
        }

        .modal-close-btn {
            width: 2.5rem;
            height: 2.5rem;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }

        .modal-close-btn:hover {
            background: var(--color-surface-secondary);
            color: var(--color-text);
        }

        .voice-modal-body {
            padding: var(--space-6);
        }

        .voice-instructions {
            color: var(--color-text);
        }

        .instructions-title {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-4);
        }

        .command-category {
            margin-bottom: var(--space-4);
        }

        .category-title {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
        }

        .command-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .command-list li {
            padding: var(--space-2) 0;
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
            border-bottom: 1px solid var(--color-border);
        }

        .command-list li:last-child {
            border-bottom: none;
        }

        .voice-modal-footer {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-6);
            border-top: 1px solid var(--color-border);
        }

        .modal-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .modal-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .modal-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
        }

        .modal-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .modal-btn.secondary:hover {
            background: var(--color-primary-light);
        }

        /* Enhanced Footer */
        .site-footer {
            background: linear-gradient(135deg, var(--color-gray-800) 0%, var(--color-gray-900) 100%);
            color: var(--color-white);
            padding: var(--space-16) 0 var(--space-8);
            margin-top: var(--space-16);
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: var(--space-12);
            margin-bottom: var(--space-12);
        }

        .footer-brand {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .footer-logo-text {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .footer-brand-name {
            font-size: var(--font-size-calculated-xl);
            font-weight: var(--font-weight-bold);
        }

        .footer-brand-tagline {
            font-size: var(--font-size-calculated-sm);
            opacity: 0.9;
        }

        .footer-description {
            font-size: var(--font-size-calculated-sm);
            line-height: 1.6;
            opacity: 0.9;
        }

        .footer-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-8);
        }

        .footer-column h4 {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-4);
        }

        .footer-column ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-column ul li {
            margin-bottom: var(--space-2);
        }

        .footer-column ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: var(--font-size-calculated-sm);
            transition: color var(--transition-fast);
        }

        .footer-column ul li a:hover {
            color: var(--color-white);
            text-decoration: underline;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: var(--space-8);
            text-align: center;
        }

        .footer-disclaimer {
            margin-bottom: var(--space-6);
        }

        .footer-disclaimer p {
            font-size: var(--font-size-calculated-xs);
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: var(--space-3);
        }

        .footer-copyright {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-4);
        }

        .copyright-left p {
            font-size: var(--font-size-calculated-xs);
            opacity: 0.8;
            margin: 0 0 var(--space-1) 0;
        }

        .footer-badges {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .badge {
            font-size: var(--font-size-calculated-xs);
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
        }

        /* Loading Indicator */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-4);
            background: var(--color-surface);
            padding: var(--space-8);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary);
            border-radius: var(--radius-full);
            animation: spin var(--duration-1000) linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: var(--font-size-calculated-base);
            color: var(--color-text);
            font-weight: var(--font-weight-medium);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .toast {
            padding: var(--space-4) var(--space-6);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            max-width: 400px;
            position: relative;
            overflow: hidden;
        }

        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-info-500);
        }

        .toast.success::before {
            background: var(--color-success-500);
        }

        .toast.error::before {
            background: var(--color-error-500);
        }

        .toast.warning::before {
            background: var(--color-warning-500);
        }

        .toast.info::before {
            background: var(--color-info-500);
        }

        .toast-message {
            flex: 1;
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-base);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-close:hover {
            background: var(--color-surface-secondary);
            color: var(--color-text);
        }

        /* Voice Status Indicator */
        .voice-status {
            position: fixed;
            top: var(--space-20);
            right: var(--space-4);
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .voice-status.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-status-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            background: var(--color-error-500);
            color: var(--color-white);
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-lg);
        }

        .voice-status-icon {
            animation: voiceWave var(--duration-1000) ease-in-out infinite;
        }

        @keyframes voiceWave {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .voice-status-text {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
        }

        .voice-status-close {
            background: none;
            border: none;
            color: var(--color-white);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-base);
            transition: all var(--transition-fast);
        }

        .voice-status-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Screen Reader Mode */
        .screen-reader-mode {
            font-size: 1.2em !important;
            line-height: 1.8 !important;
            letter-spacing: 0.05em !important;
        }

        .screen-reader-mode * {
            animation: none !important;
            transition: none !important;
        }

        /* NEW: Tab System Styles */
        .results-tabs {
            display: flex;
            background: var(--color-surface-secondary);
            border-radius: var(--radius-lg);
            padding: var(--space-1);
            margin-bottom: var(--space-6);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            white-space: nowrap;
            min-width: 120px;
        }

        .tab-btn:hover {
            color: var(--color-text);
        }

        .tab-btn.active {
            background: var(--color-primary);
            color: var(--color-white);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* NEW: Screen Reader Button */
        .screen-reader-btn {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: var(--z-tooltip);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3.5rem;
            height: 3.5rem;
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .screen-reader-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        .screen-reader-btn.active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 82, 155, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 82, 155, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 82, 155, 0); }
        }

        /* NEW: Loan Comparison Modal */
        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
        }

        .comparison-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .comparison-modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            max-width: 1000px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
        }

        .comparison-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-border);
        }

        .comparison-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--font-size-calculated-lg);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .comparison-body {
            padding: var(--space-6);
        }

        .comparison-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .scenario-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            transition: all var(--transition-fast);
        }

        .scenario-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary);
        }

        .scenario-card.featured {
            background: linear-gradient(135deg, var(--color-primary-light), rgba(0, 82, 155, 0.05));
            border-color: var(--color-primary);
        }

        .scenario-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
        }

        .scenario-name {
            font-size: var(--font-size-calculated-base);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .scenario-badge {
            font-size: var(--font-size-calculated-xs);
            background: var(--color-primary);
            color: var(--color-white);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-full);
        }

        .scenario-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .scenario-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--color-border-light);
        }

        .detail-label {
            font-size: var(--font-size-calculated-sm);
            color: var(--color-text-secondary);
        }

        .detail-value {
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
        }

        .detail-value.highlight {
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        .scenario-actions {
            margin-top: var(--space-4);
        }

        .scenario-btn {
            width: 100%;
            padding: var(--space-3);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-calculated-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 2px solid;
        }

        .scenario-btn.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .scenario-btn.primary:hover {
            background: var(--color-primary-hover);
            border-color: var(--color-primary-hover);
        }

        .scenario-btn.secondary {
            background: var(--color-surface);
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .scenario-btn.secondary:hover {
            background: var(--color-primary-light);
        }

        .comparison-footer {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-6);
            border-top: 1px solid var(--color-border);
        }

        /* Responsive Design */
        @media (max-width: 1279px) {
            .calculator-container {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .header-middle-content {
                padding: var(--space-2) var(--space-4);
            }
            
            .tagline {
                font-size: var(--font-size-calculated-base);
            }
            
            .features-quick {
                justify-content: center;
                gap: var(--space-2);
            }
        }

        @media (max-width: 1023px) {
            .header-container {
                min-height: 3.5rem;
                flex-wrap: wrap;
            }
            
            .nav-links {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .term-chips.compact-75 {
                transform: scale(0.85);
                grid-template-columns: repeat(2, 1fr);
            }
            
            .loan-type-grid.compact {
                grid-template-columns: 1fr;
            }
            
            .summary-grid,
            .details-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: var(--space-8);
            }
            
            .footer-links {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 767px) {
            .calculator-container {
                padding: var(--space-6) var(--space-3);
            }
            
            .input-section,
            .results-section,
            .sidebar-section {
                padding: var(--space-5);
            }
            
            .payment-value {
                font-size: var(--font-size-calculated-3xl);
            }
            
            .payment-breakdown {
                flex-direction: column;
                gap: var(--space-1);
            }
            
            .summary-grid,
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .voice-modal-content {
                width: 95%;
            }
            
            .voice-modal-footer {
                flex-direction: column;
            }
            
            .footer-links {
                grid-template-columns: 1fr;
            }
            
            .footer-copyright {
                flex-direction: column;
                text-align: center;
            }
            
            .percentage-chips {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .schedule-title {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .accessibility-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .font-controls {
                border-right: none;
                padding-right: var(--space-2);
                border-bottom: 1px solid var(--color-border);
                padding-bottom: var(--space-2);
                margin-bottom: var(--space-2);
            }
            
            .one-time-payment-form {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 479px) {
            .header-container {
                padding: 0 var(--space-2);
            }
            
            .calculator-container {
                padding: var(--space-4) var(--space-2);
            }
            
            .input-section,
            .results-section,
            .sidebar-section {
                padding: var(--space-4);
            }
            
            .voice-modal-content {
                margin: var(--space-4);
                width: calc(100% - 2rem);
            }
            
            .toast-container {
                left: var(--space-2);
                right: var(--space-2);
            }
            
            .toast {
                max-width: none;
            }
        }

        /* Focus Styles for Better Accessibility */
        *:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .control-btn:focus {
            outline-color: var(--color-primary);
            outline-width: 3px;
        }

        .form-control:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 82, 155, 0.3);
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* ========================================================================== */
        /* END OF FINGUID HOME LOAN PRO - ENHANCED CSS v2.0                        */
        /* ========================================================================== */
    </style>
</head>

<body class="font-adjustable" data-color-scheme="light">
    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <a href="#calculator-inputs" class="skip-link">Skip to calculator</a>

    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    <div id="sr-status" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

    <!-- Enhanced Header -->
    <header class="site-header" role="banner">
        <div class="header-container">
            <!-- FinGuid Brand -->
            <div class="brand-section">
                <a href="#" class="logo-link" aria-label="FinGuid Home Loan Pro - Mortgage Calculator Home">
                    <div class="logo-container">
                        <span class="usa-flag" role="img" aria-label="USA Flag">🇺🇸</span>
                        <div class="logo-content">
                            <div class="logo-main">FinGuid Home Loan Pro</div>
                            <div class="logo-subtitle">AI-Powered Mortgage Calculator</div>
                        </div>
                    </div>
                </a>
            </div>
            
            <!-- Navigation Links -->
            <nav class="nav-links" role="navigation" aria-label="Main navigation">
                <a href="#features" class="nav-link">Features</a>
                <a href="#how-it-works" class="nav-link">How It Works</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#contact" class="nav-link">Contact</a>
            </nav>
            
            <!-- Accessibility Controls -->
            <div class="accessibility-controls" id="accessibility-controls" role="toolbar" aria-label="Accessibility Controls">
                <!-- Font Controls -->
                <div class="font-controls" role="group" aria-label="Font Size Controls">
                    <button type="button" class="control-btn font-btn active" id="font-decrease" 
                            aria-label="Decrease font size" title="Make text smaller"
                            onclick="adjustFontSize('decrease')">
                        <span class="control-icon" aria-hidden="true">-A-</span>
                    </button>
                    <button type="button" class="control-btn font-btn" id="font-reset" 
                            aria-label="Reset font size" title="Reset text size"
                            onclick="adjustFontSize('reset')">
                        <span class="control-icon" aria-hidden="true">Aa</span>
                    </button>
                    <button type="button" class="control-btn font-btn" id="font-increase" 
                            aria-label="Increase font size" title="Make text larger"
                            onclick="adjustFontSize('increase')">
                        <span class="control-icon" aria-hidden="true">+A+</span>
                    </button>
                </div>
                
                <!-- Theme Toggle -->
                <button type="button" class="control-btn theme-btn" id="theme-toggle" 
                        aria-label="Toggle dark mode" title="Switch between light and dark theme"
                        onclick="toggleTheme()">
                    <i class="fas fa-moon theme-icon" aria-hidden="true"></i>
                    <span class="control-label">Dark</span>
                </button>
                
                <!-- Voice Control -->
                <button type="button" class="control-btn voice-btn" id="voice-toggle" 
                        aria-label="Toggle voice control" title="Enable voice commands"
                        onclick="toggleVoiceControl()">
                    <i class="fas fa-microphone voice-icon" aria-hidden="true"></i>
                    <span class="control-label">Voice</span>
                </button>
                
                <!-- Screen Reader Mode -->
                <button type="button" class="control-btn reader-btn" id="screen-reader-toggle" 
                        aria-label="Toggle screen reader mode" title="Enhanced screen reader mode"
                        onclick="toggleScreenReaderMode()">
                    <i class="fas fa-eye reader-icon" aria-hidden="true"></i>
                    <span class="control-label">Reader</span>
                </button>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
        </div>
        
        <!-- Middle Section -->
        <div class="header-middle">
            <div class="header-middle-content">
                <div class="tagline">Home Loan Pro — AI‑Powered Mortgage Calculator</div>
                <div class="features-quick">
                    <span class="feature-quick">Live FRED Data</span>
                    <span class="feature-quick">Voice Commands</span>
                    <span class="feature-quick">AI Insights</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Calculator Container -->
    <main id="main-content" class="calculator-main" role="main">
        <div class="calculator-container">
            
            <!-- Left Section: Input Values (30%) -->
            <section class="input-section" role="form" aria-labelledby="input-section-title" id="calculator-inputs">
                <div class="section-header">
                    <h2 class="section-title" id="input-section-title">
                        <i class="fas fa-home section-icon" aria-hidden="true"></i>
                        Loan Details
                    </h2>
                    <div class="section-subtitle">Enter your home loan information</div>
                </div>

                <!-- Primary Information -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">1</span>
                        Primary Information
                    </h3>

                    <!-- Home Price -->
                    <div class="form-group">
                        <label for="home-price" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-dollar-sign label-icon" aria-hidden="true"></i>
                                Home Price
                            </span>
                            <span class="label-help">Average US home: $428,700</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="home-price" class="form-control" value="450,000" 
                                   aria-describedby="home-price-help" placeholder="450,000"
                                   oninput="updateCalculation()">
                        </div>
                        <small id="home-price-help" class="help-text">Property tax varies by location and is typically 0.5% to 2.5% of home value</small>
                    </div>

                    <!-- Enhanced Down Payment with Perfect Synchronization -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-content">
                                <i class="fas fa-piggy-bank label-icon" aria-hidden="true"></i>
                                Down Payment
                            </span>
                            <span class="label-help">Perfect sync between % and $ amounts</span>
                        </label>
                        
                        <!-- Dollar Amount -->
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="down-payment" class="form-control" value="90,000" 
                                   aria-label="Down payment in dollars" placeholder="90,000"
                                   oninput="syncDownPaymentDollar()">
                        </div>

                        <!-- Percentage Input -->
                        <div class="input-group percentage-input">
                            <input type="number" id="down-payment-percent" class="form-control" 
                                   min="0" max="100" step="0.1" value="20" 
                                   aria-label="Down payment as percentage" placeholder="20"
                                   oninput="syncDownPaymentPercent()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>

                        <!-- Working Percentage Chips -->
                        <div class="percentage-chips" role="group" aria-label="Quick down payment percentages">
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(3.5, event)" 
                                    aria-label="3.5 percent down payment">
                                <span class="chip-value">3.5%</span>
                                <span class="chip-label">FHA Min</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(5, event)"
                                    aria-label="5 percent down payment">
                                <span class="chip-value">5%</span>
                                <span class="chip-label">Conv Min</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(10, event)"
                                    aria-label="10 percent down payment">
                                <span class="chip-value">10%</span>
                                <span class="chip-label">Good</span>
                            </button>
                            <button type="button" class="percentage-chip active" onclick="setDownPaymentChip(20, event)"
                                    aria-label="20 percent down payment">
                                <span class="chip-value">20%</span>
                                <span class="chip-label">No PMI</span>
                            </button>
                            <button type="button" class="percentage-chip" onclick="setDownPaymentChip(25, event)"
                                    aria-label="25 percent down payment">
                                <span class="chip-value">25%</span>
                                <span class="chip-label">Excellent</span>
                            </button>
                        </div>
                    </div>

                    <!-- State Dropdown with Tax and Insurance Rates -->
                    <div class="form-group state-dropdown-container">
                        <label for="state-select" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-map-marker-alt label-icon" aria-hidden="true"></i>
                                State
                            </span>
                            <span class="label-help">Auto-calculates tax & insurance</span>
                        </label>
                        <select id="state-select" class="form-control" onchange="updateStateRates()">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA" selected>California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                        <div class="state-tax-info">
                            <div class="tax-rate">
                                <span>Property Tax Rate:</span>
                                <span class="rate-value" id="property-tax-rate">0.76%</span>
                            </div>
                            <div class="insurance-rate">
                                <span>Insurance Rate:</span>
                                <span class="rate-value" id="insurance-rate">0.60%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Credit Score with Rate Impact -->
                    <div class="form-group">
                        <label for="credit-score" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-chart-line label-icon" aria-hidden="true"></i>
                                Credit Score
                            </span>
                            <span class="label-help" id="rate-impact-text">Affects your interest rate</span>
                        </label>
                        <select id="credit-score" class="form-control" aria-describedby="credit-impact"
                                onchange="updateRateFromCredit()">
                            <option value="580">Poor (580 or below) - Higher rates</option>
                            <option value="630">Fair (580-669) - Standard rates</option>
                            <option value="700" selected>Good (670-739) - Competitive rates</option>
                            <option value="780">Very Good (740-799) - Better rates</option>
                            <option value="820">Excellent (800+) - Best rates</option>
                        </select>
                        <div id="credit-impact" class="credit-impact" aria-live="polite"></div>
                    </div>

                    <!-- Enhanced Interest Rate with Live FRED Integration -->
                    <div class="form-group">
                        <label for="interest-rate" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-percentage label-icon" aria-hidden="true"></i>
                                Interest Rate
                            </span>
                            <div class="rate-info">
                                <span class="live-rate-badge">
                                    <i class="fas fa-wifi live-icon" aria-hidden="true"></i>
                                    Live FRED Rate
                                </span>
                                <button type="button" class="refresh-rate-btn" id="refresh-rate" 
                                        title="Refresh live rate from Federal Reserve"
                                        aria-label="Refresh live rate"
                                        onclick="refreshLiveRate()">
                                    <i class="fas fa-sync-alt" aria-hidden="true"></i>
                                </button>
                            </div>
                        </label>
                        <div class="input-group">
                            <input type="number" id="interest-rate" class="form-control" value="6.44" 
                                   min="0.1" max="20" step="0.01" 
                                   aria-describedby="fred-attribution" placeholder="6.44"
                                   oninput="updateCalculation()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>
                        <div id="fred-attribution" class="federal-attribution">
                            <small>Source: Federal Reserve Economic Data (FRED), Federal Reserve Bank of St. Louis</small>
                            <div id="rate-update-time" class="rate-update-time">Last updated: Loading...</div>
                        </div>
                    </div>

                    <!-- Enhanced Loan Term -->
                    <div class="form-group">
                        <label class="form-label">
                            <span class="label-content">
                                <i class="fas fa-calendar-alt label-icon" aria-hidden="true"></i>
                                Loan Term
                            </span>
                            <span class="label-help">Choose preset or enter custom term</span>
                        </label>
                        
                        <!-- Term Chips -->
                        <div class="term-chips compact-75" role="group" aria-label="Loan term options">
                            <button type="button" class="term-chip" data-term="10" onclick="selectTerm(10, event)">
                                <span class="term-years">10</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip" data-term="15" onclick="selectTerm(15, event)">
                                <span class="term-years">15</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip" data-term="20" onclick="selectTerm(20, event)">
                                <span class="term-years">20</span>
                                <span class="term-label">Years</span>
                            </button>
                            <button type="button" class="term-chip active" data-term="30" onclick="selectTerm(30, event)">
                                <span class="term-years">30</span>
                                <span class="term-label">Years</span>
                            </button>
                        </div>

                        <!-- Custom Term Input -->
                        <div class="custom-term-group">
                            <label for="custom-term" class="custom-term-label">Custom Term (5-40 years)</label>
                            <div class="input-group">
                                <input type="number" id="custom-term" class="form-control" 
                                       min="5" max="40" placeholder="Enter years"
                                       aria-label="Custom loan term in years"
                                       oninput="selectCustomTerm()">
                                <span class="input-suffix" aria-hidden="true">Years</span>
                            </div>
                        </div>
                    </div>

                    <!-- Compact Loan Type Cards -->
                    <div class="loan-type-section">
                        <h3 class="subsection-title">
                            <span class="step-number">🏦</span>
                            Loan Type
                            <span class="subsection-help">Choose the best loan program</span>
                        </h3>
                        
                        <div class="loan-type-grid compact" role="group" aria-label="Loan type options">
                            <button type="button" class="loan-type-btn active" data-loan-type="conventional" 
                                    onclick="selectLoanType('conventional', event)" aria-pressed="true">
                                <div class="loan-icon">
                                    <i class="fas fa-university" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">Conventional</h4>
                                    <p class="loan-description">Best rates for good credit</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="fha" 
                                    onclick="selectLoanType('fha', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-home" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">FHA</h4>
                                    <p class="loan-description">First-time buyer friendly</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="va" 
                                    onclick="selectLoanType('va', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-medal" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">VA</h4>
                                    <p class="loan-description">For military & veterans</p>
                                </div>
                            </button>
                            
                            <button type="button" class="loan-type-btn" data-loan-type="usda" 
                                    onclick="selectLoanType('usda', event)" aria-pressed="false">
                                <div class="loan-icon">
                                    <i class="fas fa-tractor" aria-hidden="true"></i>
                                </div>
                                <div class="loan-content">
                                    <h4 class="loan-title">USDA</h4>
                                    <p class="loan-description">For eligible rural areas</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Property Details -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">2</span>
                        Property & Insurance Details
                    </h3>

                    <div class="form-group">
                        <label for="property-tax" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-receipt label-icon" aria-hidden="true"></i>
                                Property Tax (Annual)
                            </span>
                            <span class="label-help">Varies by location 0.5% to 2.5%</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="property-tax" class="form-control" value="9,000" 
                                   placeholder="9,000" oninput="updateCalculation()">
                        </div>
                        <small class="help-text">Property tax varies by location and is typically 0.5% to 2.5% of home value</small>
                    </div>

                    <div class="form-group">
                        <label for="home-insurance" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-shield-alt label-icon" aria-hidden="true"></i>
                                Home Insurance (Annual)
                            </span>
                            <span class="label-help">Typically 0.3% to 0.8% of home value</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="home-insurance" class="form-control" value="1,800" 
                                   placeholder="1,800" oninput="updateCalculation()">
                        </div>
                        <small class="help-text">Home insurance typically costs 0.3% to 0.8% of home value annually</small>
                    </div>

                    <!-- Auto-Calculated PMI (Monthly) -->
                    <div class="form-group">
                        <label for="pmi" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-umbrella label-icon" aria-hidden="true"></i>
                                PMI (Auto-Calculated)
                            </span>
                            <span class="label-help">Based on loan type and down payment</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="pmi" class="form-control" value="0" 
                                   placeholder="0" readonly>
                        </div>
                        <div id="pmi-status" class="pmi-status" aria-live="polite"></div>
                    </div>

                    <div class="form-group">
                        <label for="hoa-fees" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-building label-icon" aria-hidden="true"></i>
                                HOA Fees (Monthly)
                            </span>
                            <span class="label-help">If applicable</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="hoa-fees" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>
                </div>

                <!-- Extra Payments -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">3</span>
                        Extra Payments (Optional)
                    </h3>

                    <div class="form-group">
                        <label for="extra-monthly" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-plus-circle label-icon" aria-hidden="true"></i>
                                Extra Monthly Payment
                            </span>
                            <span class="label-help">Reduce principal and save interest</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="extra-monthly" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="extra-weekly" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-calendar-week label-icon" aria-hidden="true"></i>
                                Extra Weekly Payment
                            </span>
                            <span class="label-help">Bi-weekly strategy for faster payoff</span>
                        </label>
                        <div class="input-group">
                            <span class="input-prefix" aria-hidden="true">$</span>
                            <input type="text" id="extra-weekly" class="form-control" value="0" 
                                   placeholder="0" oninput="updateCalculation()">
                        </div>
                    </div>

                    <!-- NEW: One-time Extra Payments -->
                    <div class="one-time-payment-section">
                        <div class="one-time-payment-header">
                            <i class="fas fa-calendar-plus" aria-hidden="true"></i>
                            <h4 class="one-time-payment-title">One-time Extra Payments</h4>
                        </div>
                        
                        <div class="one-time-payment-form">
                            <div class="form-group">
                                <label for="one-time-amount">Amount</label>
                                <div class="input-group">
                                    <span class="input-prefix" aria-hidden="true">$</span>
                                    <input type="text" id="one-time-amount" class="form-control" 
                                           placeholder="0" aria-label="One-time payment amount">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="one-time-date">Payment Date</label>
                                <input type="date" id="one-time-date" class="form-control" 
                                       aria-label="One-time payment date">
                            </div>
                            
                            <button type="button" class="action-btn primary" onclick="addOneTimePayment()">
                                <i class="fas fa-plus" aria-hidden="true"></i>
                                Add
                            </button>
                        </div>
                        
                        <div class="one-time-payment-list" id="one-time-payment-list">
                            <!-- One-time payments will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Closing Costs Estimation -->
                <div class="form-section">
                    <h3 class="subsection-title">
                        <span class="step-number">4</span>
                        Closing Costs Estimation
                    </h3>

                    <div class="form-group">
                        <label for="closing-costs-percentage" class="form-label">
                            <span class="label-content">
                                <i class="fas fa-percent label-icon" aria-hidden="true"></i>
                                Closing Costs Percentage
                            </span>
                            <span class="label-help">Typical range 2-5% of home price</span>
                        </label>
                        <div class="input-group">
                            <input type="number" id="closing-costs-percentage" class="form-control" 
                                   min="0" max="10" step="0.1" value="3" 
                                   placeholder="3" oninput="updateCalculation()">
                            <span class="input-suffix" aria-hidden="true">%</span>
                        </div>
                        <div class="closing-costs-display">
                            <span class="closing-costs-amount" id="closing-costs-amount">= $13,500</span>
                            <span class="closing-costs-note">Typical closing costs range from 2-5% of home price</span>
                        </div>
                    </div>

                    <div class="auto-update-notice">
                        All calculations update automatically as you type - no calculate button needed!
                    </div>
                </div>
            </section>

            <!-- Middle Section: Results (40%) -->
            <section class="results-section" role="main" aria-labelledby="results-section-title">
                <div class="section-header">
                    <h2 class="section-title" id="results-section-title">
                        <i class="fas fa-calculator section-icon" aria-hidden="true"></i>
                        Monthly Payment Breakdown
                    </h2>
                    <div class="section-subtitle">Your personalized mortgage calculation</div>
                </div>

                <!-- Tab System for Results -->
                <div class="results-tabs">
                    <button class="tab-btn active" data-tab="payment-summary" onclick="switchTab('payment-summary')">
                        <i class="fas fa-chart-pie" aria-hidden="true"></i>
                        Payment Summary
                    </button>
                    <button class="tab-btn" data-tab="balance-timeline" onclick="switchTab('balance-timeline')">
                        <i class="fas fa-chart-line" aria-hidden="true"></i>
                        Balance Timeline
                    </button>
                    <button class="tab-btn" data-tab="ai-insights" onclick="switchTab('ai-insights')">
                        <i class="fas fa-brain" aria-hidden="true"></i>
                        AI Insights
                    </button>
                    <button class="tab-btn" data-tab="payment-schedule" onclick="switchTab('payment-schedule')">
                        <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                        Payment Schedule
                    </button>
                </div>

                <!-- Payment Summary Tab (Default) -->
                <div class="tab-content active" id="payment-summary-tab">
                    <!-- Main Payment Display -->
                    <div class="main-payment-card">
                        <div class="payment-header">
                            <h3 class="payment-title">Total Monthly Payment</h3>
                            <span class="loan-type-badge" id="loan-type-badge">Conventional Loan</span>
                        </div>
                        <div class="payment-amount">
                            <span class="payment-value" id="total-payment" aria-live="polite">$2,768</span>
                            <div class="payment-breakdown">
                                <span class="breakdown-item" id="pi-summary">$2,025 P&I</span>
                                <span class="breakdown-separator">+</span>
                                <span class="breakdown-item" id="escrow-summary">$743 Escrow</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Components Chart Only -->
                    <div class="chart-section payment-components">
                        <div class="chart-header">
                            <h3 class="chart-title">Payment Components</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="payment-components-chart" aria-label="Payment components breakdown chart"></canvas>
                        </div>
                    </div>

                    <!-- Compact Loan Summary -->
                    <div class="loan-summary compact">
                        <h3 class="summary-title">
                            <i class="fas fa-chart-bar summary-icon" aria-hidden="true"></i>
                            Loan Summary
                        </h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">Loan Amount</span>
                                <span class="summary-value" id="loan-amount-summary">$360,000</span>
                            </div>
                            
                            <div class="summary-item">
                                <span class="summary-label">Total Interest</span>
                                <span class="summary-value" id="total-interest-summary">$367,520</span>
                            </div>
                            
                            <div class="summary-item">
                                <span class="summary-label">Total Cost</span>
                                <span class="summary-value highlight" id="total-cost-summary">$727,520</span>
                            </div>
                            
                            <div class="summary-item">
                                <span class="summary-label">Payoff Date</span>
                                <span class="summary-value" id="payoff-date-summary">Oct 2054</span>
                            </div>
                            
                            <div class="summary-item">
                                <span class="summary-label">Closing Costs</span>
                                <span class="summary-value" id="closing-costs-summary">$13,500</span>
                            </div>
                            
                            <div class="summary-item">
                                <span class="summary-label">Loan Type</span>
                                <span class="summary-value" id="loan-type-summary">Conventional</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mortgage Balance Over Time Tab -->
                <div class="tab-content" id="balance-timeline-tab">
                    <div class="loan-analysis-section">
                        <h3 class="analysis-title">Mortgage Balance Over Time</h3>
                        <p class="chart-subtitle">See how your principal decreases and equity builds</p>
                        <div class="chart-container">
                            <canvas id="balance-timeline-chart" aria-label="Mortgage balance over time chart"></canvas>
                        </div>
                        <div class="year-selector-section">
                            <label for="year-slider" class="year-selector-label">
                                Select Year: <span id="selected-year">1</span>
                            </label>
                            <input type="range" id="year-slider" class="year-slider" 
                                   min="1" max="30" value="1" step="1"
                                   aria-label="Select year to view mortgage balance details"
                                   oninput="updateYearDetails()">
                        </div>
                        <div class="year-details compact">
                            <h4 class="year-title">Year <span id="current-year">1</span> Details</h4>
                            <div class="details-grid">
                                <div class="detail-item">
                                    <span class="detail-label">Principal Paid</span>
                                    <span class="detail-value" id="principal-paid-year">$4,236</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Interest Paid</span>
                                    <span class="detail-value" id="interest-paid-year">$23,184</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Remaining Balance</span>
                                    <span class="detail-value" id="remaining-balance-year">$355,764</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI-Powered Insights Tab -->
                <div class="tab-content" id="ai-insights-tab">
                    <div class="ai-insights-section">
                        <h3 class="insights-title">
                            <i class="fas fa-brain insights-icon" aria-hidden="true"></i>
                            AI-Powered Insights
                            <span class="ai-badge">
                                <i class="fas fa-robot" aria-hidden="true"></i>
                                AI
                            </span>
                        </h3>
                        <div class="insights-container">
                            <div class="insight-item">
                                <h4 class="insight-title">
                                    <i class="fas fa-lightbulb" aria-hidden="true"></i>
                                    Smart Rate Analysis
                                </h4>
                                <p class="insight-text" id="rate-insight">Your current rate of 6.44% is 0.3% above the national average. Consider shopping around for better rates if your credit score improves.</p>
                            </div>
                            <div class="insight-item">
                                <h4 class="insight-title">
                                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                                    Equity Building Strategy
                                </h4>
                                <p class="insight-text" id="equity-insight">With your 20% down payment, you'll avoid PMI and build equity faster. You'll reach 25% equity in approximately 8 years.</p>
                            </div>
                            <div class="insight-item">
                                <h4 class="insight-title">
                                    <i class="fas fa-money-bill-wave" aria-hidden="true"></i>
                                    Payment Optimization
                                </h4>
                                <p class="insight-text" id="payment-insight">Adding $100 extra monthly could save you $45,000 in interest and pay off your loan 4 years early.</p>
                            </div>
                            <div class="insight-item">
                                <h4 class="insight-title">
                                    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                                    Risk Assessment
                                </h4>
                                <p class="insight-text" id="risk-insight">Your debt-to-income ratio appears healthy at 28%. Consider building an emergency fund to cover 6 months of payments.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Schedule Tab -->
                <div class="tab-content" id="payment-schedule-tab">
                    <div class="payment-schedule-section">
                        <div class="schedule-title">
                            <h3 class="summary-title">
                                <i class="fas fa-calendar-alt schedule-icon" aria-hidden="true"></i>
                                Payment Schedule
                            </h3>
                            <div class="schedule-options">
                                <button class="schedule-btn active" onclick="setScheduleType('yearly')">Yearly</button>
                                <button class="schedule-btn" onclick="setScheduleType('monthly')">Monthly</button>
                            </div>
                        </div>
                        <div class="schedule-container">
                            <div class="schedule-table-wrapper">
                                <table class="schedule-table" id="schedule-table">
                                    <thead>
                                        <tr>
                                            <th>Year</th>
                                            <th>Principal</th>
                                            <th>Interest</th>
                                            <th>Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="schedule-body">
                                        <!-- Schedule rows will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="schedule-pagination">
                                <button class="pagination-btn" id="prev-year" onclick="changeSchedulePage(-1)" disabled>
                                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                                    Previous
                                </button>
                                <span class="pagination-info" id="pagination-info">Showing 1-10 of 30 years</span>
                                <button class="pagination-btn" id="next-year" onclick="changeSchedulePage(1)">
                                    Next
                                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Universal Sharing Options -->
                <div class="sharing-section">
                    <h3 class="sharing-title">
                        <i class="fas fa-share-alt sharing-icon" aria-hidden="true"></i>
                        Share Your Results
                    </h3>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf" aria-hidden="true"></i>
                            Export to PDF
                        </button>
                        <button class="action-btn secondary" onclick="shareResults()">
                            <i class="fas fa-share" aria-hidden="true"></i>
                            Share Results
                        </button>
                        <button class="action-btn secondary" onclick="openComparison()">
                            <i class="fas fa-balance-scale" aria-hidden="true"></i>
                            Compare Loans
                        </button>
                        <button class="action-btn secondary" onclick="resetCalculator()">
                            <i class="fas fa-redo" aria-hidden="true"></i>
                            Reset Calculator
                        </button>
                    </div>
                </div>
            </section>

            <!-- Right Section: Advertising/Sponsor (30%) -->
            <aside class="sidebar-section" role="complementary" aria-labelledby="sidebar-section-title">
                <div class="section-header">
                    <h2 class="section-title" id="sidebar-section-title">
                        <i class="fas fa-star section-icon" aria-hidden="true"></i>
                        Mortgage Resources
                    </h2>
                    <div class="section-subtitle">Helpful tools and information</div>
                </div>

                <!-- Dummy Partner Showcase -->
                <div class="partner-showcase">
                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-logo">
                                <i class="fas fa-university partner-icon" aria-hidden="true"></i>
                            </div>
                            <div class="partner-info">
                                <h4 class="partner-name">Mortgage Learning Center</h4>
                                <div class="partner-rating">
                                    <div class="rating-stars">
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star-half-alt" aria-hidden="true"></i>
                                    </div>
                                    <span class="rating-text">Educational Resources</span>
                                </div>
                            </div>
                        </div>
                        <div class="partner-rates">
                            <div class="rate-display">
                                <span class="rate-label">Understanding Mortgage Terms</span>
                                <span class="rate-value">Free Guide</span>
                                <span class="rate-apr">Learn about APR, PMI, and more</span>
                            </div>
                        </div>
                        <button class="partner-cta primary" onclick="showEducationalContent()">
                            Learn More
                        </button>
                    </div>

                    <div class="partner-card">
                        <div class="partner-header">
                            <div class="partner-logo">
                                <i class="fas fa-calculator partner-icon" aria-hidden="true"></i>
                            </div>
                            <div class="partner-info">
                                <h4 class="partner-name">Additional Calculators</h4>
                                <div class="partner-rating">
                                    <div class="rating-stars">
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                        <i class="fas fa-star" aria-hidden="true"></i>
                                    </div>
                                    <span class="rating-text">Financial Tools</span>
                                </div>
                            </div>
                        </div>
                        <div class="partner-rates">
                            <div class="rate-display">
                                <span class="rate-label">Debt-to-Income Calculator</span>
                                <span class="rate-value">Free Tool</span>
                                <span class="rate-apr">Calculate your DTI ratio</span>
                            </div>
                        </div>
                        <button class="partner-cta secondary" onclick="showDTICalculator()">
                            Try Tool
                        </button>
                    </div>
                </div>

                <!-- Market Insights -->
                <div class="market-insights">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line section-icon" aria-hidden="true"></i>
                        Market Insights
                    </h3>
                    <div class="market-stats">
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-home" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">National Avg. Rate</span>
                                <span class="stat-value">6.14%
                                    <span class="stat-change positive">-0.08%</span>
                                </span>
                            </div>
                        </div>
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">Median Home Price</span>
                                <span class="stat-value">$428,700
                                    <span class="stat-change negative">+2.3%</span>
                                </span>
                            </div>
                        </div>
                        <div class="market-stat">
                            <div class="stat-icon">
                                <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <span class="stat-label">30-Day Applications</span>
                                <span class="stat-value">+4.2%
                                    <span class="stat-change positive">+1.1%</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advertisement Space -->
                <div class="ad-space">
                    <div class="ad-container">
                        <div class="ad-label">Financial Education</div>
                        <h4 class="ad-title">Understanding Your Mortgage</h4>
                        <p class="ad-description">Learn about different loan types, interest rates, and how to choose the right mortgage for your situation.</p>
                        <button class="ad-cta" onclick="showMortgageGuide()">
                            Read Guide
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Enhanced Footer -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <span class="usa-flag" role="img" aria-label="USA Flag">🇺🇸</span>
                        <div class="footer-logo-text">
                            <div class="footer-brand-name">FinGuid Home Loan Pro</div>
                            <div class="footer-brand-tagline">AI-Powered Mortgage Calculator</div>
                        </div>
                    </div>
                    <p class="footer-description">
                        Advanced AI-powered mortgage calculator with live Federal Reserve data, 
                        voice commands, and intelligent insights. Built for home buyers and refinancers.
                    </p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Calculator</h4>
                        <ul>
                            <li><a href="#calculator-inputs">Mortgage Calculator</a></li>
                            <li><a href="#how-it-works">How It Works</a></li>
                            <li><a href="#features">Features</a></li>
                            <li><a href="#faq">FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <ul>
                            <li><a href="#mortgage-guide">Mortgage Guide</a></li>
                            <li><a href="#rate-trends">Rate Trends</a></li>
                            <li><a href="#home-buying">Home Buying</a></li>
                            <li><a href="#refinancing">Refinancing</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Company</h4>
                        <ul>
                            <li><a href="#about">About Us</a></li>
                            <li><a href="#contact">Contact</a></li>
                            <li><a href="#privacy">Privacy Policy</a></li>
                            <li><a href="#terms">Terms of Service</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Connect</h4>
                        <ul>
                            <li><a href="#facebook">Facebook</a></li>
                            <li><a href="#twitter">Twitter</a></li>
                            <li><a href="#linkedin">LinkedIn</a></li>
                            <li><a href="#newsletter">Newsletter</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-disclaimer">
                    <p>
                        <strong>Disclaimer:</strong> This calculator provides estimates for informational purposes only. 
                        Actual loan terms may vary based on lender requirements, creditworthiness, and market conditions. 
                        Consult with qualified financial professionals before making financial decisions.
                    </p>
                    <p>
                        Rates shown are estimates based on current market data from the Federal Reserve Economic Data (FRED) 
                        and may not reflect actual lender offers.
                    </p>
                </div>
                <div class="footer-copyright">
                    <div class="copyright-left">
                        <p>&copy; 2025 FinGuid Home Loan Pro. All rights reserved.</p>
                        <p>Built with ❤️ for home buyers</p>
                    </div>
                    <div class="footer-badges">
                        <span class="badge">AI-Powered</span>
                        <span class="badge">Live FRED Data</span>
                        <span class="badge">Voice Enabled</span>
                        <span class="badge">Accessible</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Voice Modal -->
    <div class="voice-modal" id="voice-modal" role="dialog" aria-labelledby="voice-modal-title">
        <div class="voice-modal-content">
            <div class="voice-modal-header">
                <h3 class="modal-title" id="voice-modal-title">
                    <i class="fas fa-microphone modal-icon" aria-hidden="true"></i>
                    Voice Control
                </h3>
                <button class="modal-close-btn" onclick="closeVoiceModal()" aria-label="Close voice control">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="voice-modal-body">
                <div class="voice-instructions">
                    <h4 class="instructions-title">Voice Commands</h4>
                    <div class="command-category">
                        <h5 class="category-title">Loan Amount Commands</h5>
                        <ul class="command-list">
                            <li>"Set home price to [amount]" - Set home price</li>
                            <li>"Set down payment to [amount]" - Set down payment</li>
                            <li>"Set down payment percentage to [number]" - Set down payment percentage</li>
                        </ul>
                    </div>
                    <div class="command-category">
                        <h5 class="category-title">Rate & Term Commands</h5>
                        <ul class="command-list">
                            <li>"Set interest rate to [number]" - Set interest rate</li>
                            <li>"Set loan term to [number] years" - Set loan term</li>
                            <li>"Switch to [loan type]" - Change loan type</li>
                        </ul>
                    </div>
                    <div class="command-category">
                        <h5 class="category-title">Navigation Commands</h5>
                        <ul class="command-list">
                            <li>"Show payment summary" - View payment breakdown</li>
                            <li>"Show balance timeline" - View amortization chart</li>
                            <li>"Show AI insights" - View AI recommendations</li>
                            <li>"Show payment schedule" - View payment schedule</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="voice-modal-footer">
                <button class="modal-btn primary" onclick="startVoiceRecognition()">
                    <i class="fas fa-microphone" aria-hidden="true"></i>
                    Start Listening
                </button>
                <button class="modal-btn secondary" onclick="closeVoiceModal()">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loan Comparison Modal -->
    <div class="comparison-modal" id="comparison-modal" role="dialog" aria-labelledby="comparison-modal-title">
        <div class="comparison-modal-content">
            <div class="comparison-header">
                <h3 class="comparison-title" id="comparison-modal-title">
                    <i class="fas fa-balance-scale modal-icon" aria-hidden="true"></i>
                    Compare Loan Scenarios
                </h3>
                <button class="modal-close-btn" onclick="closeComparisonModal()" aria-label="Close comparison">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="comparison-body">
                <div class="comparison-scenarios">
                    <div class="scenario-card featured">
                        <div class="scenario-header">
                            <h4 class="scenario-name">Current Scenario</h4>
                            <span class="scenario-badge">Selected</span>
                        </div>
                        <div class="scenario-details">
                            <div class="scenario-detail">
                                <span class="detail-label">Monthly Payment</span>
                                <span class="detail-value highlight">$2,768</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Total Interest</span>
                                <span class="detail-value">$367,520</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Payoff Time</span>
                                <span class="detail-value">30 years</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Loan Type</span>
                                <span class="detail-value">Conventional</span>
                            </div>
                        </div>
                        <div class="scenario-actions">
                            <button class="scenario-btn primary" onclick="closeComparisonModal()">
                                Keep This Scenario
                            </button>
                        </div>
                    </div>
                    
                    <div class="scenario-card">
                        <div class="scenario-header">
                            <h4 class="scenario-name">Lower Rate (6.0%)</h4>
                            <span class="scenario-badge">Save $48/mo</span>
                        </div>
                        <div class="scenario-details">
                            <div class="scenario-detail">
                                <span class="detail-label">Monthly Payment</span>
                                <span class="detail-value highlight">$2,720</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Total Interest</span>
                                <span class="detail-value">$343,200</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Payoff Time</span>
                                <span class="detail-value">30 years</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Interest Saved</span>
                                <span class="detail-value">$24,320</span>
                            </div>
                        </div>
                        <div class="scenario-actions">
                            <button class="scenario-btn secondary" onclick="applyScenario(1)">
                                Apply This Scenario
                            </button>
                        </div>
                    </div>
                    
                    <div class="scenario-card">
                        <div class="scenario-header">
                            <h4 class="scenario-name">15-Year Term</h4>
                            <span class="scenario-badge">Payoff Faster</span>
                        </div>
                        <div class="scenario-details">
                            <div class="scenario-detail">
                                <span class="detail-label">Monthly Payment</span>
                                <span class="detail-value highlight">$3,067</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Total Interest</span>
                                <span class="detail-value">$192,060</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Payoff Time</span>
                                <span class="detail-value">15 years</span>
                            </div>
                            <div class="scenario-detail">
                                <span class="detail-label">Interest Saved</span>
                                <span class="detail-value">$175,460</span>
                            </div>
                        </div>
                        <div class="scenario-actions">
                            <button class="scenario-btn secondary" onclick="applyScenario(2)">
                                Apply This Scenario
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="comparison-footer">
                <button class="modal-btn primary" onclick="saveComparison()">
                    <i class="fas fa-save" aria-hidden="true"></i>
                    Save Comparison
                </button>
                <button class="modal-btn secondary" onclick="closeComparisonModal()">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner" aria-hidden="true"></div>
            <div class="loading-text">Calculating your mortgage...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" role="status" aria-live="polite"></div>

    <!-- Voice Status Indicator -->
    <div class="voice-status" id="voice-status" role="status" aria-live="assertive">
        <div class="voice-status-content">
            <i class="fas fa-microphone voice-status-icon" aria-hidden="true"></i>
            <span class="voice-status-text">Listening...</span>
            <button class="voice-status-close" onclick="stopVoiceRecognition()" aria-label="Stop listening">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <!-- Screen Reader Button -->
    <button class="screen-reader-btn" id="screen-reader-btn" aria-label="Screen reader mode">
        <i class="fas fa-eye" aria-hidden="true"></i>
    </button>

    <!-- Enhanced JavaScript -->
    <script>
        // ==========================================================================
        // FINGUID HOME LOAN PRO - ENHANCED JAVASCRIPT v2.0
        // ==========================================================================

        // Global Variables
        let currentLoanType = 'conventional';
        let currentTerm = 30;
        let currentYear = 1;
        let currentPage = 1;
        let scheduleType = 'yearly';
        let totalPages = 3;
        let voiceRecognition = null;
        let isVoiceActive = false;
        let screenReaderMode = false;
        let oneTimePayments = [];

        // DOM Elements
        const elements = {
            homePrice: document.getElementById('home-price'),
            downPayment: document.getElementById('down-payment'),
            downPaymentPercent: document.getElementById('down-payment-percent'),
            stateSelect: document.getElementById('state-select'),
            creditScore: document.getElementById('credit-score'),
            interestRate: document.getElementById('interest-rate'),
            propertyTax: document.getElementById('property-tax'),
            homeInsurance: document.getElementById('home-insurance'),
            pmi: document.getElementById('pmi'),
            hoaFees: document.getElementById('hoa-fees'),
            extraMonthly: document.getElementById('extra-monthly'),
            extraWeekly: document.getElementById('extra-weekly'),
            closingCostsPercentage: document.getElementById('closing-costs-percentage'),
            totalPayment: document.getElementById('total-payment'),
            piSummary: document.getElementById('pi-summary'),
            escrowSummary: document.getElementById('escrow-summary'),
            loanAmountSummary: document.getElementById('loan-amount-summary'),
            totalInterestSummary: document.getElementById('total-interest-summary'),
            totalCostSummary: document.getElementById('total-cost-summary'),
            payoffDateSummary: document.getElementById('payoff-date-summary'),
            closingCostsSummary: document.getElementById('closing-costs-summary'),
            loanTypeSummary: document.getElementById('loan-type-summary'),
            creditImpact: document.getElementById('credit-impact'),
            rateImpactText: document.getElementById('rate-impact-text'),
            pmiStatus: document.getElementById('pmi-status'),
            loanTypeBadge: document.getElementById('loan-type-badge'),
            rateUpdateTime: document.getElementById('rate-update-time'),
            propertyTaxRate: document.getElementById('property-tax-rate'),
            insuranceRate: document.getElementById('insurance-rate'),
            closingCostsAmount: document.getElementById('closing-costs-amount'),
            selectedYear: document.getElementById('selected-year'),
            currentYear: document.getElementById('current-year'),
            principalPaidYear: document.getElementById('principal-paid-year'),
            interestPaidYear: document.getElementById('interest-paid-year'),
            remainingBalanceYear: document.getElementById('remaining-balance-year'),
            scheduleBody: document.getElementById('schedule-body'),
            prevYear: document.getElementById('prev-year'),
            nextYear: document.getElementById('next-year'),
            paginationInfo: document.getElementById('pagination-info'),
            rateInsight: document.getElementById('rate-insight'),
            equityInsight: document.getElementById('equity-insight'),
            paymentInsight: document.getElementById('payment-insight'),
            riskInsight: document.getElementById('risk-insight'),
            oneTimePaymentList: document.getElementById('one-time-payment-list'),
            oneTimeAmount: document.getElementById('one-time-amount'),
            oneTimeDate: document.getElementById('one-time-date')
        };

        // Chart Instances
        let paymentComponentsChart = null;
        let balanceTimelineChart = null;

        // Initialize the calculator
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalculator();
            setupEventListeners();
            updateCalculation();
            initializeCharts();
            simulateLiveRateUpdate();
        });

        function initializeCalculator() {
            console.log('Initializing FinGuid Home Loan Pro Calculator...');
            
            // Set current date for one-time payment date input
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
            elements.oneTimeDate.valueAsDate = nextMonth;
            
            // Initialize accessibility features
            initializeAccessibility();
            
            // Initialize voice recognition if available
            initializeVoiceRecognition();
            
            // Show welcome message
            showToast('Welcome to FinGuid Home Loan Pro!', 'success');
            
            // Announce to screen readers
            announceToScreenReader('FinGuid Home Loan Pro calculator loaded. Use tab key to navigate through input fields.');
        }

        function setupEventListeners() {
            // Add input event listeners for real-time updates
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', updateCalculation);
            });
            
            // Add keyboard navigation
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Add scroll event for header
            window.addEventListener('scroll', handleHeaderScroll);
            
            // Add resize event for responsive charts
            window.addEventListener('resize', debounce(updateCharts, 250));
        }

        function initializeAccessibility() {
            // Set initial ARIA labels and roles
            document.querySelectorAll('.percentage-chip').forEach((chip, index) => {
                chip.setAttribute('aria-posinset', index + 1);
                chip.setAttribute('aria-setsize', 5);
            });
            
            document.querySelectorAll('.term-chip').forEach((chip, index) => {
                chip.setAttribute('aria-posinset', index + 1);
                chip.setAttribute('aria-setsize', 4);
            });
            
            document.querySelectorAll('.loan-type-btn').forEach((btn, index) => {
                btn.setAttribute('aria-posinset', index + 1);
                btn.setAttribute('aria-setsize', 4);
            });
        }

        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                voiceRecognition = new SpeechRecognition();
                voiceRecognition.continuous = false;
                voiceRecognition.interimResults = false;
                voiceRecognition.lang = 'en-US';
                
                voiceRecognition.onstart = function() {
                    console.log('Voice recognition started');
                    document.getElementById('voice-status').classList.add('show');
                    isVoiceActive = true;
                };
                
                voiceRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase();
                    console.log('Voice command:', transcript);
                    processVoiceCommand(transcript);
                };
                
                voiceRecognition.onerror = function(event) {
                    console.error('Voice recognition error:', event.error);
                    showToast('Voice recognition error: ' + event.error, 'error');
                    stopVoiceRecognition();
                };
                
                voiceRecognition.onend = function() {
                    console.log('Voice recognition ended');
                    stopVoiceRecognition();
                };
            } else {
                console.warn('Speech recognition not supported in this browser');
                showToast('Voice commands not supported in your browser', 'warning');
            }
        }

        // Enhanced Calculation Functions
        function updateCalculation() {
            // Show loading state
            showLoading(true);
            
            // Use setTimeout to allow UI to update
            setTimeout(() => {
                try {
                    // Get input values
                    const homePrice = parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000;
                    const downPayment = parseFloat(elements.downPayment.value.replace(/,/g, '')) || 90000;
                    const interestRate = parseFloat(elements.interestRate.value) || 6.44;
                    const loanTerm = currentTerm;
                    const propertyTax = parseFloat(elements.propertyTax.value.replace(/,/g, '')) || 9000;
                    const homeInsurance = parseFloat(elements.homeInsurance.value.replace(/,/g, '')) || 1800;
                    const hoaFees = parseFloat(elements.hoaFees.value.replace(/,/g, '')) || 0;
                    const extraMonthly = parseFloat(elements.extraMonthly.value.replace(/,/g, '')) || 0;
                    const extraWeekly = parseFloat(elements.extraWeekly.value.replace(/,/g, '')) || 0;
                    const closingCostsPercentage = parseFloat(elements.closingCostsPercentage.value) || 3;
                    
                    // Calculate derived values
                    const loanAmount = homePrice - downPayment;
                    const monthlyInterestRate = interestRate / 100 / 12;
                    const numberOfPayments = loanTerm * 12;
                    
                    // Calculate monthly principal and interest
                    const monthlyPI = calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments);
                    
                    // Calculate PMI (monthly) - NEW: Now calculated monthly based on market rates
                    const monthlyPMI = calculateMonthlyPMI(loanAmount, downPayment, homePrice, currentLoanType);
                    
                    // Calculate monthly property tax and insurance
                    const monthlyPropertyTax = propertyTax / 12;
                    const monthlyHomeInsurance = homeInsurance / 12;
                    
                    // Calculate total monthly payment
                    const totalMonthlyPayment = monthlyPI + monthlyPMI + monthlyPropertyTax + monthlyHomeInsurance + hoaFees;
                    
                    // Calculate total loan cost
                    const totalInterest = calculateTotalInterest(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
                    const totalCost = homePrice + totalInterest + (closingCostsPercentage / 100 * homePrice);
                    
                    // Calculate payoff date
                    const payoffDate = calculatePayoffDate(loanTerm, extraMonthly, extraWeekly);
                    
                    // Update UI
                    updatePaymentDisplay(totalMonthlyPayment, monthlyPI, monthlyPMI, monthlyPropertyTax, monthlyHomeInsurance, hoaFees);
                    updateLoanSummary(loanAmount, totalInterest, totalCost, payoffDate, closingCostsPercentage, homePrice);
                    updatePMIStatus(monthlyPMI, downPayment, homePrice);
                    updateCreditImpact();
                    updateAIInsights(homePrice, downPayment, interestRate, loanTerm, extraMonthly);
                    updateCharts(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
                    updatePaymentSchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
                    
                    // Hide loading state
                    showLoading(false);
                    
                } catch (error) {
                    console.error('Calculation error:', error);
                    showToast('Error calculating mortgage. Please check your inputs.', 'error');
                    showLoading(false);
                }
            }, 100);
        }

        function calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments) {
            if (monthlyInterestRate === 0) {
                return loanAmount / numberOfPayments;
            }
            
            const factor = Math.pow(1 + monthlyInterestRate, numberOfPayments);
            return loanAmount * monthlyInterestRate * factor / (factor - 1);
        }

        // NEW: Enhanced Monthly PMI Calculation
        function calculateMonthlyPMI(loanAmount, downPayment, homePrice, loanType) {
            const ltv = (loanAmount / homePrice) * 100; // Loan-to-value ratio
            
            // No PMI if down payment is 20% or more for conventional loans
            if (downPayment >= homePrice * 0.2 && loanType === 'conventional') {
                return 0;
            }
            
            // FHA loans have different PMI rules (MIP)
            if (loanType === 'fha') {
                if (ltv <= 90) {
                    return loanAmount * 0.0085 / 12; // 0.85% annual
                } else {
                    return loanAmount * 0.01 / 12; // 1.0% annual
                }
            }
            
            // VA loans don't have PMI
            if (loanType === 'va') {
                return 0;
            }
            
            // USDA loans have different fee structure
            if (loanType === 'usda') {
                return loanAmount * 0.0035 / 12; // 0.35% annual
            }
            
            // Conventional PMI based on LTV and market rates
            let pmiRate = 0;
            
            if (ltv > 95) {
                pmiRate = 0.01; // 1.0% annual for high LTV
            } else if (ltv > 90) {
                pmiRate = 0.0075; // 0.75% annual
            } else if (ltv > 85) {
                pmiRate = 0.005; // 0.5% annual
            } else {
                pmiRate = 0.0025; // 0.25% annual for LTV <= 85%
            }
            
            // Market adjustment based on current economic conditions
            const marketAdjustment = 1.1; // 10% premium for current market
            pmiRate *= marketAdjustment;
            
            return (loanAmount * pmiRate) / 12; // Return monthly PMI
        }

        function calculateTotalInterest(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            let balance = loanAmount;
            let totalInterest = 0;
            const monthlyExtra = extraMonthly + (extraWeekly * 4.33); // Convert weekly to monthly
            
            for (let month = 1; month <= numberOfPayments; month++) {
                if (balance <= 0) break;
                
                const interestPayment = balance * monthlyInterestRate;
                const principalPayment = calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments) - interestPayment + monthlyExtra;
                
                totalInterest += interestPayment;
                balance -= principalPayment;
                
                // Apply one-time payments for this month
                const oneTimeThisMonth = oneTimePayments.filter(payment => 
                    payment.month === month
                ).reduce((sum, payment) => sum + payment.amount, 0);
                
                balance -= oneTimeThisMonth;
            }
            
            return totalInterest;
        }

        function calculatePayoffDate(loanTerm, extraMonthly, extraWeekly) {
            const today = new Date();
            const monthlyExtra = extraMonthly + (extraWeekly * 4.33);
            
            // Calculate accelerated payoff based on extra payments
            let acceleratedMonths = loanTerm * 12;
            if (monthlyExtra > 0) {
                // Simplified calculation - in reality this would be more complex
                acceleratedMonths = Math.max(loanTerm * 12 - Math.floor(monthlyExtra / 100 * 12), loanTerm * 12 * 0.5);
            }
            
            const payoffDate = new Date(today);
            payoffDate.setMonth(payoffDate.getMonth() + acceleratedMonths);
            
            return payoffDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }

        // Enhanced UI Update Functions
        function updatePaymentDisplay(totalPayment, monthlyPI, monthlyPMI, monthlyPropertyTax, monthlyHomeInsurance, hoaFees) {
            // Format and update total payment
            elements.totalPayment.textContent = formatCurrency(totalPayment);
            
            // Update payment breakdown
            const escrowTotal = monthlyPMI + monthlyPropertyTax + monthlyHomeInsurance + hoaFees;
            elements.piSummary.textContent = formatCurrency(monthlyPI) + ' P&I';
            elements.escrowSummary.textContent = formatCurrency(escrowTotal) + ' Escrow';
            
            // Update loan type badge
            elements.loanTypeBadge.textContent = formatLoanType(currentLoanType) + ' Loan';
        }

        function updateLoanSummary(loanAmount, totalInterest, totalCost, payoffDate, closingCostsPercentage, homePrice) {
            elements.loanAmountSummary.textContent = formatCurrency(loanAmount);
            elements.totalInterestSummary.textContent = formatCurrency(totalInterest);
            elements.totalCostSummary.textContent = formatCurrency(totalCost);
            elements.payoffDateSummary.textContent = payoffDate;
            elements.closingCostsSummary.textContent = formatCurrency((closingCostsPercentage / 100) * homePrice);
            elements.loanTypeSummary.textContent = formatLoanType(currentLoanType);
        }

        function updatePMIStatus(monthlyPMI, downPayment, homePrice) {
            if (monthlyPMI > 0) {
                elements.pmiStatus.textContent = `PMI Active: ${formatCurrency(monthlyPMI)} monthly`;
                elements.pmiStatus.className = 'pmi-status active';
                elements.pmi.value = formatCurrency(monthlyPMI, false);
            } else {
                elements.pmiStatus.textContent = 'No PMI Required - 20% or more down payment';
                elements.pmiStatus.className = 'pmi-status inactive';
                elements.pmi.value = formatCurrency(0, false);
            }
        }

        function updateCreditImpact() {
            const creditScore = parseInt(elements.creditScore.value);
            let impactText = '';
            let impactClass = '';
            
            if (creditScore >= 800) {
                impactText = 'Excellent credit! You qualify for the best rates.';
                impactClass = 'positive';
            } else if (creditScore >= 740) {
                impactText = 'Very good credit. Competitive rates available.';
                impactClass = 'positive';
            } else if (creditScore >= 670) {
                impactText = 'Good credit. Standard market rates apply.';
                impactClass = 'neutral';
            } else if (creditScore >= 580) {
                impactText = 'Fair credit. Consider improving your score for better rates.';
                impactClass = 'negative';
            } else {
                impactText = 'Poor credit. You may face higher rates or need alternative financing.';
                impactClass = 'negative';
            }
            
            elements.creditImpact.textContent = impactText;
            elements.creditImpact.className = `credit-impact ${impactClass}`;
        }

        function updateAIInsights(homePrice, downPayment, interestRate, loanTerm, extraMonthly) {
            // Rate insight
            const nationalAvg = 6.14;
            const rateDiff = (interestRate - nationalAvg).toFixed(2);
            if (rateDiff > 0) {
                elements.rateInsight.textContent = `Your current rate of ${interestRate}% is ${rateDiff}% above the national average. Consider shopping around for better rates if your credit score improves.`;
            } else {
                elements.rateInsight.textContent = `Your current rate of ${interestRate}% is ${Math.abs(rateDiff)}% below the national average. Great job securing a competitive rate!`;
            }
            
            // Equity insight
            const downPaymentPercent = (downPayment / homePrice * 100).toFixed(1);
            if (downPaymentPercent >= 20) {
                elements.equityInsight.textContent = `With your ${downPaymentPercent}% down payment, you'll avoid PMI and build equity faster. You'll reach 25% equity in approximately 8 years.`;
            } else {
                elements.equityInsight.textContent = `With your ${downPaymentPercent}% down payment, you'll need to pay PMI until you reach 20% equity. Consider additional payments to reach this goal faster.`;
            }
            
            // Payment optimization insight
            if (extraMonthly === 0) {
                elements.paymentInsight.textContent = `Adding $100 extra monthly could save you approximately $45,000 in interest and pay off your loan 4 years early.`;
            } else {
                const additionalSavings = Math.round(extraMonthly * 450); // Simplified calculation
                elements.paymentInsight.textContent = `Your extra $${extraMonthly} monthly payment is saving you approximately $${additionalSavings} in interest. Great job paying down your loan faster!`;
            }
            
            // Risk assessment insight
            const estimatedDTI = 28; // This would be calculated from user income
            elements.riskInsight.textContent = `Your estimated debt-to-income ratio is ${estimatedDTI}%, which is within the recommended range. Consider building an emergency fund to cover 6 months of payments.`;
        }

        // NEW: Enhanced Down Payment Synchronization
        function syncDownPaymentDollar() {
            const homePrice = parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000;
            const downPayment = parseFloat(elements.downPayment.value.replace(/,/g, '')) || 90000;
            const percent = (downPayment / homePrice * 100).toFixed(1);
            
            elements.downPaymentPercent.value = percent;
            updateCalculation();
        }

        function syncDownPaymentPercent() {
            const homePrice = parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000;
            const percent = parseFloat(elements.downPaymentPercent.value) || 20;
            const downPayment = homePrice * (percent / 100);
            
            elements.downPayment.value = formatCurrency(downPayment, false);
            updateCalculation();
        }

        function setDownPaymentChip(percent, event) {
            event.preventDefault();
            
            // Update all chips
            document.querySelectorAll('.percentage-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update percentage input
            elements.downPaymentPercent.value = percent;
            syncDownPaymentPercent();
            
            // Announce to screen readers
            announceToScreenReader(`Down payment set to ${percent} percent`);
        }

        // NEW: State Rate Updates
        function updateStateRates() {
            const state = elements.stateSelect.value;
            let taxRate, insuranceRate;
            
            // Sample rates by state (in reality, this would use an API)
            switch(state) {
                case 'CA':
                    taxRate = 0.76;
                    insuranceRate = 0.60;
                    break;
                case 'TX':
                    taxRate = 1.80;
                    insuranceRate = 0.70;
                    break;
                case 'FL':
                    taxRate = 0.89;
                    insuranceRate = 0.85;
                    break;
                case 'NY':
                    taxRate = 1.40;
                    insuranceRate = 0.55;
                    break;
                case 'IL':
                    taxRate = 2.10;
                    insuranceRate = 0.50;
                    break;
                default:
                    taxRate = 1.10;
                    insuranceRate = 0.60;
            }
            
            // Update rate displays
            elements.propertyTaxRate.textContent = `${taxRate}%`;
            elements.insuranceRate.textContent = `${insuranceRate}%`;
            
            // Update tax and insurance inputs
            const homePrice = parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000;
            elements.propertyTax.value = formatCurrency(homePrice * taxRate / 100, false);
            elements.homeInsurance.value = formatCurrency(homePrice * insuranceRate / 100, false);
            
            updateCalculation();
            
            showToast(`Updated rates for ${getStateName(state)}`, 'success');
        }

        function getStateName(stateCode) {
            const states = {
                'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas', 
                'CA': 'California', 'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware',
                'FL': 'Florida', 'GA': 'Georgia', 'HI': 'Hawaii', 'ID': 'Idaho',
                'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa', 'KS': 'Kansas',
                'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine', 'MD': 'Maryland',
                'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota', 'MS': 'Mississippi',
                'MO': 'Missouri', 'MT': 'Montana', 'NE': 'Nebraska', 'NV': 'Nevada',
                'NH': 'New Hampshire', 'NJ': 'New Jersey', 'NM': 'New Mexico', 'NY': 'New York',
                'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio', 'OK': 'Oklahoma',
                'OR': 'Oregon', 'PA': 'Pennsylvania', 'RI': 'Rhode Island', 'SC': 'South Carolina',
                'SD': 'South Dakota', 'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah',
                'VT': 'Vermont', 'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia',
                'WI': 'Wisconsin', 'WY': 'Wyoming'
            };
            return states[stateCode] || stateCode;
        }

        // NEW: Rate from Credit Score
        function updateRateFromCredit() {
            const creditScore = parseInt(elements.creditScore.value);
            let baseRate = 6.44;
            
            // Adjust rate based on credit score
            if (creditScore >= 800) {
                baseRate = 5.99; // Excellent
            } else if (creditScore >= 740) {
                baseRate = 6.24; // Very Good
            } else if (creditScore >= 670) {
                baseRate = 6.44; // Good
            } else if (creditScore >= 580) {
                baseRate = 7.25; // Fair
            } else {
                baseRate = 8.50; // Poor
            }
            
            // Add some random variation to make it realistic
            const variation = (Math.random() - 0.5) * 0.5;
            const finalRate = Math.max(3.0, Math.min(12.0, baseRate + variation));
            
            elements.interestRate.value = finalRate.toFixed(2);
            updateCalculation();
            
            showToast(`Interest rate updated based on credit score`, 'info');
        }

        // NEW: Live Rate Simulation
        function simulateLiveRateUpdate() {
            // Simulate live rate updates (in reality, this would fetch from FRED API)
            const now = new Date();
            elements.rateUpdateTime.textContent = `Last updated: ${now.toLocaleString()}`;
            
            // Simulate small rate fluctuations
            setTimeout(() => {
                const currentRate = parseFloat(elements.interestRate.value);
                const change = (Math.random() - 0.5) * 0.1; // Small random change
                const newRate = Math.max(3.0, Math.min(12.0, currentRate + change));
                
                if (Math.abs(change) > 0.02) {
                    elements.interestRate.value = newRate.toFixed(2);
                    updateCalculation();
                    
                    showToast(`Live rate update: ${newRate.toFixed(2)}%`, 'info');
                    elements.rateUpdateTime.textContent = `Last updated: ${new Date().toLocaleString()}`;
                }
            }, 30000); // Check every 30 seconds
        }

        function refreshLiveRate() {
            showLoading(true);
            
            // Simulate API call to FRED
            setTimeout(() => {
                const currentRate = parseFloat(elements.interestRate.value);
                const marketChange = (Math.random() - 0.5) * 0.15; // Simulate market movement
                const newRate = Math.max(3.0, Math.min(12.0, currentRate + marketChange));
                
                elements.interestRate.value = newRate.toFixed(2);
                updateCalculation();
                
                const now = new Date();
                elements.rateUpdateTime.textContent = `Last updated: ${now.toLocaleString()}`;
                
                showToast(`Live rate refreshed: ${newRate.toFixed(2)}%`, 'success');
                showLoading(false);
            }, 1000);
        }

        // NEW: One-time Extra Payments
        function addOneTimePayment() {
            const amount = parseFloat(elements.oneTimeAmount.value.replace(/,/g, '')) || 0;
            const date = elements.oneTimeDate.value;
            
            if (amount <= 0) {
                showToast('Please enter a valid payment amount', 'error');
                return;
            }
            
            if (!date) {
                showToast('Please select a payment date', 'error');
                return;
            }
            
            // Calculate which payment month this corresponds to
            const today = new Date();
            const paymentDate = new Date(date);
            const monthsDiff = (paymentDate.getFullYear() - today.getFullYear()) * 12 + 
                              (paymentDate.getMonth() - today.getMonth());
            
            if (monthsDiff < 0) {
                showToast('Payment date must be in the future', 'error');
                return;
            }
            
            const payment = {
                amount: amount,
                date: date,
                month: monthsDiff + 1 // Convert to 1-based month index
            };
            
            oneTimePayments.push(payment);
            updateOneTimePaymentList();
            updateCalculation();
            
            // Clear inputs
            elements.oneTimeAmount.value = '';
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
            elements.oneTimeDate.valueAsDate = nextMonth;
            
            showToast(`One-time payment of ${formatCurrency(amount)} added`, 'success');
        }

        function updateOneTimePaymentList() {
            elements.oneTimePaymentList.innerHTML = '';
            
            if (oneTimePayments.length === 0) {
                elements.oneTimePaymentList.innerHTML = '<p style="text-align: center; color: var(--color-text-muted); font-style: italic;">No one-time payments added</p>';
                return;
            }
            
            oneTimePayments.forEach((payment, index) => {
                const paymentElement = document.createElement('div');
                paymentElement.className = 'one-time-payment-item';
                paymentElement.innerHTML = `
                    <div class="one-time-payment-details">
                        <span class="one-time-payment-amount">${formatCurrency(payment.amount)}</span>
                        <span class="one-time-payment-date">${formatDate(payment.date)}</span>
                    </div>
                    <button class="remove-payment-btn" onclick="removeOneTimePayment(${index})" aria-label="Remove payment">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                `;
                elements.oneTimePaymentList.appendChild(paymentElement);
            });
        }

        function removeOneTimePayment(index) {
            const payment = oneTimePayments[index];
            oneTimePayments.splice(index, 1);
            updateOneTimePaymentList();
            updateCalculation();
            
            showToast(`Removed one-time payment of ${formatCurrency(payment.amount)}`, 'info');
        }

        // Chart Functions
        function initializeCharts() {
            // Payment Components Chart
            const paymentCtx = document.getElementById('payment-components-chart').getContext('2d');
            paymentComponentsChart = new Chart(paymentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal & Interest', 'Property Tax', 'Home Insurance', 'PMI', 'HOA Fees'],
                    datasets: [{
                        data: [2025, 750, 150, 0, 0],
                        backgroundColor: [
                            '#00529B', // Brand blue
                            '#00A86B', // Brand green
                            '#FFC107', // Brand gold
                            '#FF6B6B', // Red for PMI
                            '#6C757D'  // Gray for HOA
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });

            // Balance Timeline Chart
            const balanceCtx = document.getElementById('balance-timeline-chart').getContext('2d');
            balanceTimelineChart = new Chart(balanceCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 31}, (_, i) => `Year ${i}`),
                    datasets: [
                        {
                            label: 'Loan Balance',
                            data: Array.from({length: 31}, (_, i) => 360000 - (i * 12000)),
                            borderColor: '#00529B',
                            backgroundColor: 'rgba(0, 82, 155, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Equity',
                            data: Array.from({length: 31}, (_, i) => 90000 + (i * 12000)),
                            borderColor: '#00A86B',
                            backgroundColor: 'rgba(0, 168, 107, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value, true);
                                }
                            },
                            title: {
                                display: true,
                                text: 'Amount'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Years'
                            }
                        }
                    }
                }
            });
        }

        function updateCharts(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            if (!paymentComponentsChart || !balanceTimelineChart) return;

            // Update payment components chart
            const monthlyPI = calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments);
            const monthlyPMI = calculateMonthlyPMI(loanAmount, 
                parseFloat(elements.downPayment.value.replace(/,/g, '')) || 90000,
                parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000,
                currentLoanType);
            const monthlyPropertyTax = (parseFloat(elements.propertyTax.value.replace(/,/g, '')) || 9000) / 12;
            const monthlyHomeInsurance = (parseFloat(elements.homeInsurance.value.replace(/,/g, '')) || 1800) / 12;
            const hoaFees = parseFloat(elements.hoaFees.value.replace(/,/g, '')) || 0;

            paymentComponentsChart.data.datasets[0].data = [
                monthlyPI,
                monthlyPropertyTax,
                monthlyHomeInsurance,
                monthlyPMI,
                hoaFees
            ];
            paymentComponentsChart.update();

            // Update balance timeline chart
            const years = Array.from({length: currentTerm + 1}, (_, i) => i);
            const balanceData = calculateBalanceOverTime(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
            const equityData = balanceData.map((balance, i) => 
                (parseFloat(elements.homePrice.value.replace(/,/g, '')) || 450000) - balance
            );

            balanceTimelineChart.data.labels = years.map(year => `Year ${year}`);
            balanceTimelineChart.data.datasets[0].data = balanceData;
            balanceTimelineChart.data.datasets[1].data = equityData;
            balanceTimelineChart.update();
        }

        function calculateBalanceOverTime(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            const balances = [loanAmount];
            let balance = loanAmount;
            const monthlyExtra = extraMonthly + (extraWeekly * 4.33);

            for (let year = 1; year <= currentTerm; year++) {
                for (let month = 1; month <= 12; month++) {
                    if (balance <= 0) break;
                    
                    const interestPayment = balance * monthlyInterestRate;
                    const principalPayment = calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments) - interestPayment + monthlyExtra;
                    
                    balance -= principalPayment;
                    
                    // Apply one-time payments for this month
                    const currentMonth = (year - 1) * 12 + month;
                    const oneTimeThisMonth = oneTimePayments.filter(payment => 
                        payment.month === currentMonth
                    ).reduce((sum, payment) => sum + payment.amount, 0);
                    
                    balance -= oneTimeThisMonth;
                }
                balances.push(Math.max(0, balance));
            }
            
            return balances;
        }

        // NEW: Payment Schedule Functions
        function updatePaymentSchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            if (scheduleType === 'yearly') {
                updateYearlySchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
            } else {
                updateMonthlySchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly);
            }
        }

        function updateYearlySchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            const scheduleBody = elements.scheduleBody;
            scheduleBody.innerHTML = '';
            
            let balance = loanAmount;
            const monthlyPayment = calculateMonthlyPI(loanAmount, monthlyInterestRate, numberOfPayments);
            const monthlyExtra = extraMonthly + (extraWeekly * 4.33);
            
            for (let year = 1; year <= currentTerm; year++) {
                let yearlyPrincipal = 0;
                let yearlyInterest = 0;
                
                for (let month = 1; month <= 12; month++) {
                    if (balance <= 0) break;
                    
                    const interestPayment = balance * monthlyInterestRate;
                    const principalPayment = monthlyPayment - interestPayment + monthlyExtra;
                    
                    yearlyPrincipal += principalPayment;
                    yearlyInterest += interestPayment;
                    balance -= principalPayment;
                    
                    // Apply one-time payments for this month
                    const currentMonth = (year - 1) * 12 + month;
                    const oneTimeThisMonth = oneTimePayments.filter(payment => 
                        payment.month === currentMonth
                    ).reduce((sum, payment) => sum + payment.amount, 0);
                    
                    balance -= oneTimeThisMonth;
                    yearlyPrincipal += oneTimeThisMonth;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${year}</td>
                    <td>${formatCurrency(yearlyPrincipal)}</td>
                    <td>${formatCurrency(yearlyInterest)}</td>
                    <td>${formatCurrency(Math.max(0, balance))}</td>
                `;
                scheduleBody.appendChild(row);
            }
            
            updatePagination();
        }

        function updateMonthlySchedule(loanAmount, monthlyInterestRate, numberOfPayments, extraMonthly, extraWeekly) {
            // Implementation for monthly schedule
            // This would show individual monthly payments
            elements.scheduleBody.innerHTML = '<tr><td colspan="4" class="schedule-loading">Monthly schedule view coming soon...</td></tr>';
        }

        function setScheduleType(type) {
            scheduleType = type;
            
            // Update button states
            document.querySelectorAll('.schedule-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update schedule
            updateCalculation();
        }

        function changeSchedulePage(direction) {
            currentPage += direction;
            currentPage = Math.max(1, Math.min(totalPages, currentPage));
            
            // Update pagination buttons
            elements.prevYear.disabled = currentPage === 1;
            elements.nextYear.disabled = currentPage === totalPages;
            
            updatePagination();
            // In a real implementation, this would update the schedule display
        }

        function updatePagination() {
            const startYear = (currentPage - 1) * 10 + 1;
            const endYear = Math.min(currentPage * 10, currentTerm);
            elements.paginationInfo.textContent = `Showing ${startYear}-${endYear} of ${currentTerm} years`;
        }

        function updateYearDetails() {
            const year = parseInt(elements.selectedYear.value);
            elements.currentYear.textContent = year;
            
            // Calculate year details (simplified)
            const loanAmount = parseFloat(elements.loanAmountSummary.textContent.replace(/[$,]/g, '')) || 360000;
            const yearlyPrincipal = loanAmount * 0.012; // Simplified calculation
            const yearlyInterest = loanAmount * 0.0644; // Simplified calculation
            const remainingBalance = loanAmount - (yearlyPrincipal * year);
            
            elements.principalPaidYear.textContent = formatCurrency(yearlyPrincipal);
            elements.interestPaidYear.textContent = formatCurrency(yearlyInterest);
            elements.remainingBalanceYear.textContent = formatCurrency(remainingBalance);
        }

        // Tab System
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update charts if needed
            if (tabName === 'balance-timeline') {
                setTimeout(() => {
                    if (balanceTimelineChart) {
                        balanceTimelineChart.resize();
                    }
                }, 100);
            }
            
            // Announce to screen readers
            announceToScreenReader(`Switched to ${tabName.replace('-', ' ')} view`);
        }

        // Loan Type Selection
        function selectLoanType(loanType, event) {
            event.preventDefault();
            
            // Update all buttons
            document.querySelectorAll('.loan-type-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });
            event.currentTarget.classList.add('active');
            event.currentTarget.setAttribute('aria-pressed', 'true');
            
            // Update current loan type
            currentLoanType = loanType;
            
            // Update loan-specific settings
            updateLoanTypeSettings(loanType);
            
            // Recalculate
            updateCalculation();
            
            // Announce to screen readers
            announceToScreenReader(`Selected ${formatLoanType(loanType)} loan type`);
        }

        function updateLoanTypeSettings(loanType) {
            switch(loanType) {
                case 'fha':
                    // FHA has 3.5% minimum down payment
                    if (parseFloat(elements.downPaymentPercent.value) < 3.5) {
                        elements.downPaymentPercent.value = 3.5;
                        syncDownPaymentPercent();
                    }
                    break;
                case 'va':
                    // VA loans require no down payment
                    elements.downPaymentPercent.value = 0;
                    syncDownPaymentPercent();
                    break;
                case 'usda':
                    // USDA loans typically require no down payment
                    elements.downPaymentPercent.value = 0;
                    syncDownPaymentPercent();
                    break;
            }
        }

        function formatLoanType(loanType) {
            const types = {
                'conventional': 'Conventional',
                'fha': 'FHA',
                'va': 'VA',
                'usda': 'USDA'
            };
            return types[loanType] || loanType;
        }

        // Term Selection
        function selectTerm(years, event) {
            event.preventDefault();
            
            // Update all term chips
            document.querySelectorAll('.term-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update current term
            currentTerm = years;
            
            // Recalculate
            updateCalculation();
            
            // Announce to screen readers
            announceToScreenReader(`Selected ${years} year loan term`);
        }

        function selectCustomTerm() {
            const customTerm = parseInt(elements.customTerm.value);
            if (customTerm >= 5 && customTerm <= 40) {
                currentTerm = customTerm;
                
                // Update term chips
                document.querySelectorAll('.term-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                
                updateCalculation();
                
                showToast(`Custom term set to ${customTerm} years`, 'success');
            } else {
                showToast('Please enter a term between 5 and 40 years', 'error');
            }
        }

        // Utility Functions
        function formatCurrency(amount, includeSymbol = true) {
            if (isNaN(amount)) amount = 0;
            
            const options = {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            };
            
            const formatted = amount.toLocaleString('en-US', options);
            return includeSymbol ? `$${formatted}` : formatted;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // NEW: Voice Control Functions
        function toggleVoiceControl() {
            if (isVoiceActive) {
                stopVoiceRecognition();
            } else {
                openVoiceModal();
            }
        }

        function openVoiceModal() {
            document.getElementById('voice-modal').classList.add('show');
            announceToScreenReader('Voice control modal opened. Say commands like "set home price to four hundred fifty thousand"');
        }

        function closeVoiceModal() {
            document.getElementById('voice-modal').classList.remove('show');
            stopVoiceRecognition();
        }

        function startVoiceRecognition() {
            if (voiceRecognition) {
                try {
                    voiceRecognition.start();
                } catch (error) {
                    console.error('Error starting voice recognition:', error);
                    showToast('Error starting voice recognition', 'error');
                }
            } else {
                showToast('Voice recognition not available', 'warning');
            }
        }

        function stopVoiceRecognition() {
            if (voiceRecognition && isVoiceActive) {
                voiceRecognition.stop();
            }
            document.getElementById('voice-status').classList.remove('show');
            isVoiceActive = false;
        }

        function processVoiceCommand(transcript) {
            // Home price commands
            if (transcript.includes('set home price to')) {
                const amount = extractNumber(transcript);
                if (amount) {
                    elements.homePrice.value = formatCurrency(amount, false);
                    updateCalculation();
                    showToast(`Home price set to ${formatCurrency(amount)}`, 'success');
                }
            }
            
            // Down payment commands
            else if (transcript.includes('set down payment to')) {
                const amount = extractNumber(transcript);
                if (amount) {
                    elements.downPayment.value = formatCurrency(amount, false);
                    syncDownPaymentDollar();
                    showToast(`Down payment set to ${formatCurrency(amount)}`, 'success');
                }
            }
            
            // Down payment percentage commands
            else if (transcript.includes('set down payment percentage to')) {
                const percent = extractNumber(transcript);
                if (percent && percent >= 0 && percent <= 100) {
                    elements.downPaymentPercent.value = percent;
                    syncDownPaymentPercent();
                    showToast(`Down payment percentage set to ${percent}%`, 'success');
                }
            }
            
            // Interest rate commands
            else if (transcript.includes('set interest rate to')) {
                const rate = extractNumber(transcript);
                if (rate && rate >= 0.1 && rate <= 20) {
                    elements.interestRate.value = rate;
                    updateCalculation();
                    showToast(`Interest rate set to ${rate}%`, 'success');
                }
            }
            
            // Loan term commands
            else if (transcript.includes('set loan term to')) {
                const years = extractNumber(transcript);
                if (years && years >= 5 && years <= 40) {
                    currentTerm = years;
                    updateCalculation();
                    showToast(`Loan term set to ${years} years`, 'success');
                }
            }
            
            // Loan type commands
            else if (transcript.includes('switch to conventional') || transcript.includes('change to conventional')) {
                selectLoanType('conventional', { preventDefault: () => {} });
                showToast('Switched to conventional loan', 'success');
            }
            else if (transcript.includes('switch to fha') || transcript.includes('change to fha')) {
                selectLoanType('fha', { preventDefault: () => {} });
                showToast('Switched to FHA loan', 'success');
            }
            else if (transcript.includes('switch to va') || transcript.includes('change to va')) {
                selectLoanType('va', { preventDefault: () => {} });
                showToast('Switched to VA loan', 'success');
            }
            else if (transcript.includes('switch to usda') || transcript.includes('change to usda')) {
                selectLoanType('usda', { preventDefault: () => {} });
                showToast('Switched to USDA loan', 'success');
            }
            
            // Navigation commands
            else if (transcript.includes('show payment summary')) {
                switchTab('payment-summary');
                showToast('Showing payment summary', 'info');
            }
            else if (transcript.includes('show balance timeline') || transcript.includes('show amortization')) {
                switchTab('balance-timeline');
                showToast('Showing balance timeline', 'info');
            }
            else if (transcript.includes('show ai insights') || transcript.includes('show insights')) {
                switchTab('ai-insights');
                showToast('Showing AI insights', 'info');
            }
            else if (transcript.includes('show payment schedule')) {
                switchTab('payment-schedule');
                showToast('Showing payment schedule', 'info');
            }
            
            // Help command
            else if (transcript.includes('help') || transcript.includes('what can i say')) {
                openVoiceModal();
            }
            
            else {
                showToast(`Command not recognized: "${transcript}"`, 'warning');
            }
            
            // Always stop recognition after processing a command
            stopVoiceRecognition();
        }

        function extractNumber(transcript) {
            // Convert spoken numbers to digits
            const numberWords = {
                'zero': 0, 'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5,
                'six': 6, 'seven': 7, 'eight': 8, 'nine': 9, 'ten': 10,
                'eleven': 11, 'twelve': 12, 'thirteen': 13, 'fourteen': 14, 'fifteen': 15,
                'sixteen': 16, 'seventeen': 17, 'eighteen': 18, 'nineteen': 19, 'twenty': 20,
                'thirty': 30, 'forty': 40, 'fifty': 50, 'sixty': 60, 'seventy': 70,
                'eighty': 80, 'ninety': 90, 'hundred': 100, 'thousand': 1000, 'million': 1000000
            };
            
            // Simple extraction for now - in reality this would be more sophisticated
            const words = transcript.split(' ');
            for (let i = words.length - 1; i >= 0; i--) {
                const word = words[i].replace(/[^a-z]/g, '');
                if (!isNaN(word)) {
                    return parseFloat(word);
                }
                if (numberWords[word] !== undefined) {
                    return numberWords[word];
                }
            }
            
            // Try to extract any number from the string
            const numbers = transcript.match(/\d+(\.\d+)?/g);
            if (numbers && numbers.length > 0) {
                return parseFloat(numbers[0]);
            }
            
            return null;
        }

        // NEW: Screen Reader Functions
        function toggleScreenReaderMode() {
            screenReaderMode = !screenReaderMode;
            document.body.classList.toggle('screen-reader-mode', screenReaderMode);
            
            const button = document.getElementById('screen-reader-btn');
            if (screenReaderMode) {
                button.classList.add('active');
                showToast('Screen reader mode enabled', 'success');
                announceToScreenReader('Screen reader mode enabled. Enhanced readability features activated.');
            } else {
                button.classList.remove('active');
                showToast('Screen reader mode disabled', 'info');
            }
        }

        function announceToScreenReader(message) {
            const announcement = document.getElementById('sr-announcements');
            announcement.textContent = message;
            
            // Clear after a delay
            setTimeout(() => {
                announcement.textContent = '';
            }, 3000);
        }

        // NEW: Comparison Functions
        function openComparison() {
            document.getElementById('comparison-modal').classList.add('show');
            announceToScreenReader('Loan comparison modal opened. Compare different loan scenarios.');
        }

        function closeComparisonModal() {
            document.getElementById('comparison-modal').classList.remove('show');
        }

        function applyScenario(scenarioIndex) {
            // Apply different scenarios based on index
            switch(scenarioIndex) {
                case 1:
                    // Lower rate scenario
                    elements.interestRate.value = '6.00';
                    break;
                case 2:
                    // 15-year term scenario
                    currentTerm = 15;
                    document.querySelectorAll('.term-chip').forEach(chip => {
                        chip.classList.remove('active');
                        if (chip.dataset.term === '15') {
                            chip.classList.add('active');
                        }
                    });
                    break;
            }
            
            updateCalculation();
            closeComparisonModal();
            showToast('Scenario applied successfully', 'success');
        }

        function saveComparison() {
            showToast('Comparison saved to your account', 'success');
            closeComparisonModal();
        }

        // NEW: Sharing and Export Functions
        function exportToPDF() {
            showLoading(true);
            
            // Simulate PDF generation
            setTimeout(() => {
                showLoading(false);
                showToast('PDF export started. Your download will begin shortly.', 'success');
                
                // In reality, this would generate and download a PDF
                // For now, we'll just show a success message
            }, 2000);
        }

        function shareResults() {
            if (navigator.share) {
                navigator.share({
                    title: 'My Mortgage Calculation - FinGuid Home Loan Pro',
                    text: `Check out my mortgage calculation: ${elements.totalPayment.textContent} monthly payment`,
                    url: window.location.href
                })
                .then(() => showToast('Results shared successfully', 'success'))
                .catch(error => {
                    if (error.name !== 'AbortError') {
                        showToast('Error sharing results', 'error');
                    }
                });
            } else {
                // Fallback: copy to clipboard
                const resultsText = `Mortgage Calculation Results:
Monthly Payment: ${elements.totalPayment.textContent}
Loan Amount: ${elements.loanAmountSummary.textContent}
Total Interest: ${elements.totalInterestSummary.textContent}
Payoff Date: ${elements.payoffDateSummary.textContent}

Generated by FinGuid Home Loan Pro`;
                
                navigator.clipboard.writeText(resultsText)
                    .then(() => showToast('Results copied to clipboard', 'success'))
                    .catch(() => showToast('Error copying results', 'error'));
            }
        }

        function resetCalculator() {
            if (confirm('Are you sure you want to reset all inputs to default values?')) {
                // Reset inputs
                elements.homePrice.value = '450,000';
                elements.downPayment.value = '90,000';
                elements.downPaymentPercent.value = '20';
                elements.interestRate.value = '6.44';
                elements.propertyTax.value = '9,000';
                elements.homeInsurance.value = '1,800';
                elements.pmi.value = '0';
                elements.hoaFees.value = '0';
                elements.extraMonthly.value = '0';
                elements.extraWeekly.value = '0';
                elements.closingCostsPercentage.value = '3';
                
                // Reset loan type and term
                currentLoanType = 'conventional';
                currentTerm = 30;
                
                // Reset UI elements
                document.querySelectorAll('.loan-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.loanType === 'conventional') {
                        btn.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.term-chip').forEach(chip => {
                    chip.classList.remove('active');
                    if (chip.dataset.term === '30') {
                        chip.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.percentage-chip').forEach(chip => {
                    chip.classList.remove('active');
                    if (chip.textContent.includes('20%')) {
                        chip.classList.add('active');
                    }
                });
                
                // Clear one-time payments
                oneTimePayments = [];
                updateOneTimePaymentList();
                
                // Reset to first tab
                switchTab('payment-summary');
                
                // Recalculate
                updateCalculation();
                
                showToast('Calculator reset to default values', 'success');
                announceToScreenReader('Calculator has been reset to default values');
            }
        }

        // NEW: Accessibility Functions
        function adjustFontSize(action) {
            const currentScale = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--font-scale')) || 1;
            let newScale = currentScale;
            
            switch(action) {
                case 'increase':
                    newScale = Math.min(1.5, currentScale + 0.1);
                    break;
                case 'decrease':
                    newScale = Math.max(0.7, currentScale - 0.1);
                    break;
                case 'reset':
                    newScale = 1;
                    break;
            }
            
            document.documentElement.style.setProperty('--font-scale', newScale);
            
            // Update button states
            document.querySelectorAll('.font-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (action === 'reset') {
                document.getElementById('font-reset').classList.add('active');
            } else {
                document.getElementById('font-reset').classList.remove('active');
            }
            
            showToast(`Font size ${action}d`, 'info');
            announceToScreenReader(`Font size ${action}d to ${Math.round(newScale * 100)}%`);
        }

        function toggleTheme() {
            const currentScheme = document.documentElement.getAttribute('data-color-scheme');
            const newScheme = currentScheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-color-scheme', newScheme);
            
            // Update button text and icon
            const themeBtn = document.getElementById('theme-toggle');
            const themeIcon = themeBtn.querySelector('.theme-icon');
            const themeLabel = themeBtn.querySelector('.control-label');
            
            if (newScheme === 'dark') {
                themeIcon.className = 'fas fa-sun theme-icon';
                themeLabel.textContent = 'Light';
            } else {
                themeIcon.className = 'fas fa-moon theme-icon';
                themeLabel.textContent = 'Dark';
            }
            
            showToast(`${newScheme === 'dark' ? 'Dark' : 'Light'} theme activated`, 'success');
            announceToScreenReader(`${newScheme === 'dark' ? 'Dark' : 'Light'} theme activated`);
        }

        // NEW: UI Utility Functions
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.add('show');
            } else {
                overlay.classList.remove('show');
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()" aria-label="Close notification">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        function handleKeyboardNavigation(event) {
            // Escape key closes modals
            if (event.key === 'Escape') {
                closeVoiceModal();
                closeComparisonModal();
            }
            
            // Space or Enter on buttons
            if ((event.key === ' ' || event.key === 'Enter') && event.target.classList.contains('control-btn')) {
                event.preventDefault();
                event.target.click();
            }
        }

        function handleHeaderScroll() {
            const header = document.querySelector('.site-header');
            if (window.scrollY > 50) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        }

        // NEW: Dummy functions for partner actions
        function showEducationalContent() {
            showToast('Opening Mortgage Learning Center...', 'info');
            // In reality, this would navigate to educational content
        }

        function showDTICalculator() {
            showToast('Opening Debt-to-Income Calculator...', 'info');
            // In reality, this would open a DTI calculator
        }

        function showMortgageGuide() {
            showToast('Opening Mortgage Guide...', 'info');
            // In reality, this would open a mortgage guide
        }

        // ==========================================================================
        // END OF FINGUID HOME LOAN PRO - ENHANCED JAVASCRIPT v2.0
        // ==========================================================================
    </script>
</body>
</html>
