<!DOCTYPE html>
<html lang="en" data-color-scheme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- SEO: Title -->
    <title>AI Investment Calculator 2025 | Growth, Goal & Retirement Planner | FinGuid</title>

    <!-- SEO: Description -->
    <meta name="description" content="World's Best AI-Powered Investment Calculator by FinGuid. Project investment growth, calculate compound interest, plan for retirement & financial goals with AI insights. Uses live FRED inflation data. WCAG 2.1 AA compliant.">

    <!-- SEO: Keywords (Massive list as requested) -->
    <meta name="keywords" content="investment calculator, compound interest calculator, retirement calculator, financial goal planner, investment growth calculator, AI investing, FinGuid, USA investing, inflation adjusted return, FRED API, 401k calculator, Roth IRA calculator, savings calculator, future value calculator, investment projection, AI financial planner, investment returns, stock market calculator, mutual fund calculator, ETF calculator, retirement savings, long-term investing, financial planning tools, AI finance, SEO friendly, mobile friendly, WCAG compliant, PWA, best investment calculator, top investment tool, free investment calculator, AI investment advisor, calculate investments, how to calculate investment growth, future value of savings, retirement planning, savings goal calculator, investment return calculator, portfolio growth, finance calculator, wealth building, nest egg calculator, inflation calculator, time value of money, investment tools, AI financial advisor, FinGuid USA">

    <meta name="author" content="FinGuid USA">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="theme-color" content="#24ACB9"> <!-- Brand Color from Mortgage Calc -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="AI Investment Calculator 2025 | Live Inflation Rates | FinGuid">
    <meta property="og:description" content="Free AI investment calculator with FRED inflation data, goal planning, and 100+ AI insights">
    
    <link rel="canonical" href="https://www.finguid.com/calculators/investment">
    
    <!-- PWA: Inlined Web App Manifest (From Mortgage Calc) -->
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22FinGuid%20AI%20Investment%20Calculator%22,%22short_name%22:%22InvestCalc%22,%22description%22:%22AI-Powered%20Investment%20Calculator%20with%20Goal%20Planning,%20Live%20Rates,%20and%20AI%20Insights.%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#FFFFFD%22,%22theme_color%22:%22#24ACB9%22,%22icons%22:[{%22src%22:%22https://placehold.co/192x192/24ACB9/FFFFFF?text=FinGuid%22,%22type%22:%22image/png%22,%22sizes%22:%22192x192%22},{%22src%22:%22https://placehold.co/512x512/24ACB9/FFFFFF?text=FinGuid%22,%22type%22:%22image/png%22,%22sizes%22:%22512x512%22}]}">
    
    <!-- Font Awesome for Icons (From Investment Calc) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- 
      START: Inlined CSS
      This is the production-ready CSS from mortgage-calculator (6).html,
      which provides the unified layout, colors, and compliance styles.
      Minor additions are made for investment-specific elements.
    -->
    <style>
        /* === START: Global Variables (Brand Color Match from Mortgage Calc) === */
        :root {
            --primary: #24ACB9; /* Teal (Matches FinGuid Image & Car Lease CSS) */
            --primary-dark: #19343B; /* Dark Teal (Matches Car Lease CSS) */
            --accent: #FFC107;
            --accent-dark: #E69500;
            --text: #1F2121;
            --text-light: #64748B;
            --bg: #FFFFFD;
            --bg-secondary: #F5F7FA;
            --card: #FFFFFF;
            --border: #E2E8F0;
            --error: #EF4444;
            --success: #10B981;
            --fred-color: #A31B20; /* FRED standard color for Live Rates button */
        }

        [data-color-scheme="dark"] {
            --text: #E1E8ED;
            --text-light: #B8C5D0;
            --bg: #1F2121;
            --bg-secondary: #242B36;
            --card: #181919;
            --border: #38444D;
        }
        /* === END: Global Variables === */

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { 
            font-size: 16px; 
            -webkit-font-smoothing: antialiased; 
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Helvetica Neue', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            color: var(--text);
            background: var(--bg);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 16px; }

        /* ===== HEADER STYLES (From Mortgage Calc) ===== */
        .header {
            position: sticky;
            top: 0;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            gap: 16px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--primary);
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }

        .logo:hover { color: var(--primary-dark); }
        .logo span[role="img"] { font-size: 24px; } /* FinGuid logo from mortgage */

        .calculator-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            flex-shrink: 0;
            margin-left: 16px;
            flex-basis: auto;
            min-width: 0;
        }

        .header-features {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: 24px;
            flex-grow: 1;
            justify-content: flex-start;
            overflow: hidden;
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }

        .header-feature-item {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            animation: pulse-color-text 2.5s infinite ease-in-out;
            white-space: nowrap;
        }
        .header-feature-item:nth-child(1) { animation-delay: 0s; }
        .header-feature-item:nth-child(2) { animation-delay: 0.2s; }
        .header-feature-item:nth-child(3) { animation-delay: 0.4s; }
        .header-feature-item:nth-child(4) { animation-delay: 0.6s; }

        @keyframes pulse-color-text {
            0%, 100% {
                opacity: 0.8;
                color: var(--text-light);
                transform: scale(1);
            }
            50% {
                opacity: 1;
                color: var(--primary);
                transform: scale(1.03);
            }
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            margin-left: auto;
        }

        .icon-btn {
            background: var(--bg-secondary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            transition: all 0.3s ease;
            position: relative;
            font-size: 16px; /* Ensure icons are visible */
        }

        .icon-btn:hover { background: var(--primary); color: white; }
        .icon-btn.active { background: var(--primary); color: white; }

        #pwa-install-btn {
            display: none; /* Hidden by default, shown by JS */
            padding: 8px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            align-items: center;
            gap: 4px;
        }
        #pwa-install-btn:hover { background: var(--primary-dark); transform: scale(1.05); }
        /* ===== END HEADER STYLES ===== */


        /* ===== SPONSOR BANNER (From Mortgage Calc) ===== */
        .sponsor-banner {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .sponsor-text { font-weight: 500; flex: 1; min-width: 200px; }
        .sponsor-buttons { display: flex; gap: 8px; }
        .sponsor-btn {
            padding: 8px 12px;
            background: white;
            color: #6366F1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .sponsor-btn:hover { background: var(--accent); color: var(--text); transform: translateY(-2px); }

        /* ===== MAIN CALCULATOR (Layout from Mortgage Calc) ===== */
        .calculator-wrapper {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
            padding: 24px 0;
            margin-bottom: 40px;
        }

        .inputs-panel, .results-panel {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        .inputs-panel:hover, .results-panel:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .panel-title { 
            font-size: 18px; 
            font-weight: 700; 
            color: var(--text); 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .section-heading {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 20px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        .form-group { margin-bottom: 16px; }

        .form-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }

        /* ===== NEW: Tooltip Styles (from Mortgage Calc) ===== */
        .tooltip {
            font-weight: bold;
            cursor: help;
            margin-left: 4px;
            position: relative;
            display: inline-flex;
            align-items: center;
            color: var(--text-light);
        }
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--text-light);
            color: var(--card);
            font-style: normal;
            font-size: 10px;
            font-weight: 700;
            line-height: 14px;
            margin-left: 5px;
            transition: all 0.2s ease;
        }
        .tooltip:hover .tooltip-icon,
        .tooltip:focus .tooltip-icon {
            background: var(--primary);
            outline: none;
        }
        .tooltip:focus { outline: none; }
        .tooltip-box {
            position: fixed;
            background: #1a1a1a;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            max-width: 200px;
            white-space: normal;
            display: none;
            opacity: 0;
            transition: opacity 0.2s;
        }
        /* ===== END: Tooltip Styles ===== */


        .input-wrapper { 
            position: relative; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            min-width: 0; 
        }

        input[type="number"], input[type="text"], input[type="date"], input[type="month"], select {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 0;
            width: 100%;
        }
        
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        /* WCAG FIX: Focus ring */
        input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus, 
        input[type="month"]:focus, select:focus, .rate-btn:focus, .lookup-btn:focus, 
        .sponsor-btn:focus, .btn-secondary:focus, .icon-btn:focus, 
        #pwa-install-btn:focus, .tab-btn:focus, .faq-question:focus,
        .primary-button:focus, .secondary-button:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.25);
        }
        .icon-btn:focus, #pwa-install-btn:focus, .sponsor-btn:focus, .lookup-btn:focus,
        .primary-button:focus, .secondary-button:focus {
             box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
        }


        .input-addon {
            background: var(--bg-secondary);
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            min-width: 50px;
            text-align: center;
        }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        /* Note for FRED data */
        .fred-source-note {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 600;
            display: inline-block;
            margin-left: 8px;
        }

        .input-note {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* ===== NEW: Ad Slot (from Mortgage Calc) ===== */
        .ad-slot {
            background: var(--bg-secondary);
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }
        .ad-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: var(--accent-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .ad-placeholder {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 600;
        }
        /* ===== END: Ad Slot ===== */
        
        /* ===== NEW: Affiliate Slot (from Investment Calc, styled like Mortgage Ad Slot) ===== */
        .affiliate-slot {
            background: rgba(36, 172, 185, 0.05); /* Light primary bg */
            border: 1px solid rgba(36, 172, 185, 0.2); /* Primary border */
            border-radius: 8px;
            padding: 16px;
            text-align: left;
            margin: 24px 0;
        }
        .affiliate-slot h4 {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .affiliate-slot p {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
            line-height: 1.5;
        }
        .primary-button {
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            width: auto;
        }
        .primary-button:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .secondary-button {
            padding: 10px 16px;
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .secondary-button:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* ===== RESULTS SECTION (from Mortgage Calc) ===== */
        .summary-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(36, 172, 185, 0.2);
            text-align: center;
        }
        .summary-label { font-size: 0.875rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .payment-amount { display: flex; align-items: baseline; justify-content: center; gap: 8px; margin: 8px 0; }
        .amount { font-size: 2rem; font-weight: bold; }
        .unit { font-size: 1rem; opacity: 0.9; }
        .payment-breakdown { font-size: 0.875rem; opacity: 0.8; }
        
        /* Investment Calc Specific Result Styles */
        .piti-breakdown-summary {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        .inflation-adjusted-value {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-top: 8px;
            font-style: italic;
        }
        /* Goal summary card */
        .goal-summary {
            background: var(--bg-secondary);
            color: var(--text);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        .goal-summary .summary-label {
            color: var(--primary);
            opacity: 1;
        }
        .goal-summary .amount {
            color: var(--text);
        }
         .goal-summary .unit {
            color: var(--text-light);
        }
        .goal-summary .piti-breakdown-summary {
            color: var(--text-light);
            opacity: 1;
        }
        .hidden { display: none; }
        

        /* ===== TABS (from Mortgage Calc) ===== */
        .tabs { margin-bottom: 24px; }
        .tab-buttons { 
            display: flex; 
            gap: 4px; 
            border-bottom: 2px solid var(--border); 
            margin-bottom: 24px; 
            overflow-x: auto; 
        }

        .tab-btn {
            padding: 16px 24px;
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: -2px;
            white-space: nowrap;
        }
        .tab-btn:hover { color: var(--text); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-btn:focus {
            color: var(--primary);
            box-shadow: none;
            border-bottom-color: rgba(36, 172, 185, 0.5);
        }
        .tab-btn.active:focus { border-bottom-color: var(--primary); }


        .tab-content { display: none; padding: 8px; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        .tab-content:focus-visible {
            outline: 2px solid var(--primary);
            border-radius: 4px;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Input tabs (from investment calc, styled like mortgage tabs) */
        .input-tabs {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 16px;
        }
        .input-tabs .tab-btn {
            padding: 12px 16px;
            font-size: 14px;
            flex-grow: 1;
            justify-content: center;
        }

        .results-heading {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin: 16px 0;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .chart-container {
            position: relative;
            height: 350px;
            margin: 20px 0;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
        }
        
        .chart-caption {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
            margin-bottom: 8px;
        }


        /* ===== AMORTIZATION/DATA TABLE STYLES (from Mortgage Calc) ===== */
        .table-scroll-wrapper {
            overflow-x: auto;
            max-height: 500px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .data-table thead {
            position: sticky;
            top: 0;
            background: var(--primary);
            color: white;
            z-index: 10;
        }
        .data-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .data-table th:nth-child(n+2) { text-align: right; }

        .data-table tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }
        .data-table tbody tr:nth-child(even) { background: var(--bg-secondary); }
        .data-table tbody tr:hover { background: rgba(36, 172, 185, 0.1); }
        .data-table td {
            padding: 10px 12px;
            color: var(--text-light);
        }
        .data-table td:first-child { font-weight: 600; color: var(--text); }
        .data-table td:nth-child(n+2) {
            text-align: right;
            font-family: 'Courier New', Courier, monospace;
        }
        /* ===== END: Data Table Styles ===== */


        /* ===== AI INSIGHTS (from Investment Calc, styled like Mortgage Calc) ===== */
        .insights-container { margin-top: 20px; }
        .ai-insights-box .placeholder-text {
            font-style: italic;
            color: var(--text-light);
            text-align: center;
            padding: 20px;
        }
        .ai-insights-box h4 {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 16px;
            margin-bottom: 8px;
        }
        .ai-insights-box p {
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 12px;
        }
        .ai-insights-box p > strong {
            color: var(--text);
        }

        /* AI Alert Boxes */
        .recommendation-alert {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            margin: 12px 0;
            border-radius: 6px;
            border: 1px solid transparent;
        }
        .recommendation-alert i {
            font-size: 16px;
            margin-top: 2px;
        }
        .recommendation-alert.high-priority {
            background: rgba(239, 68, 68, 0.05);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--error);
        }
        .recommendation-alert.medium-priority {
            background: rgba(230, 149, 0, 0.05);
            border-color: rgba(230, 149, 0, 0.3);
            color: var(--accent-dark);
        }
        .recommendation-alert.low-priority {
            background: rgba(16, 185, 129, 0.05);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--success);
        }
        .recommendation-alert strong {
            display: block;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }
        /* Links inside insights */
        .ai-insights-box p a {
            color: var(--primary);
            font-weight: 600;
            text-decoration: underline;
        }
        .ai-insights-box p a:hover {
            color: var(--primary-dark);
        }


        /* ===== PARTNER SECTION (from Mortgage Calc) ===== */
        .footer-sponsor {
            background: linear-gradient(135deg, rgba(36, 172, 185, 0.1) 0%, rgba(25, 52, 59, 0.1) 100%);
            padding: 40px;
            border-bottom: 1px solid rgba(36, 172, 185, 0.2);
            border-radius: 12px;
        }
        .sponsor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
        .sponsor-item { text-align: center; padding: 16px; border-radius: 8px; background: var(--card); transition: all 0.2s; }
        .sponsor-item:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .sponsor-item h4 { margin-bottom: 8px; color: var(--primary); font-size: 1rem; }
        .sponsor-item p { color: var(--text-light); margin-bottom: 12px; font-size: 0.875rem; line-height: 1.5; }
        .sponsor-item a {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .sponsor-item a:focus {
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
            outline: none;
        }
        .sponsor-item a:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(36, 172, 185, 0.3); }

        /* ===== FOOTER (from Mortgage Calc) ===== */
        .footer { background: var(--card); border-top: 1px solid var(--border); padding: 32px 0; margin-top: 40px; }
        .footer-content { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-bottom: 32px; }
        .footer-section h4 { font-size: 13px; font-weight: 700; color: var(--text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
        .footer-section a { display: block; font-size: 12px; color: var(--text-light); text-decoration: none; margin-bottom: 8px; transition: color 0.3s ease; }
        .footer-section a:hover, .footer-section a:focus { 
            color: var(--primary); 
            text-decoration: underline;
            outline: none;
        }
        .compliance-badges { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; font-size: 12px; }
        .badge { display: flex; align-items: center; gap: 4px; padding: 6px 10px; background: var(--bg-secondary); border-radius: 4px; font-weight: 600; color: var(--text-light); }
        .badge i { color: var(--primary); }
        .disclaimer { font-size: 11px; color: var(--text-light); line-height: 1.6; padding-top: 20px; border-top: 1px solid var(--border); }
        .footer-bottom { text-align: center; font-size: 12px; color: var(--text-light); padding-top: 16px; border-top: 1px solid var(--border); }

        /* ===== FAQ ACCORDION (from Mortgage Calc) ===== */
        .faq-section { margin: 40px 0; }
        .faq-title { font-size: 24px; font-weight: 700; color: var(--text); margin-bottom: 20px; text-align: center; }
        .faq-container { max-width: 900px; margin: 0 auto; }
        .faq-item { margin-bottom: 12px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; transition: all 0.3s ease; }
        .faq-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .faq-question { padding: 16px; background: var(--bg-secondary); cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: var(--text); transition: all 0.3s ease; }
        .faq-question:hover { background: var(--card); color: var(--primary); }
        .faq-question.active { background: var(--primary); color: white; }
        .faq-question:focus {
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4) inset;
            color: var(--primary);
        }
        .faq-icon { font-size: 18px; transition: transform 0.3s ease; }
        .faq-question.active .faq-icon { transform: rotate(180deg); }
        .faq-answer { display: none; padding: 16px; background: var(--card); color: var(--text-light); line-height: 1.8; font-size: 14px; }
        .faq-answer p { margin-bottom: 12px; }
        .faq-answer a { color: var(--primary); font-weight: 600; text-decoration: underline; }
        .faq-answer a:hover { color: var(--primary-dark); }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }

        /* ===== GDPR/CCPA COOKIE BANNER (from Mortgage Calc) ===== */
        #cookie-consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            color: var(--text);
            padding: 24px;
            border-top: 1px solid var(--border);
            box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }
        .cookie-consent-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-light);
            flex: 1 1 400px;
        }
        .cookie-consent-text a {
            color: var(--primary);
            text-decoration: underline;
        }
        .cookie-consent-text a:hover { color: var(--primary-dark); }
        #cookie-consent-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #cookie-consent-btn:hover { background: var(--primary-dark); }
        #cookie-consent-btn:focus {
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
            outline: none;
        }
        /* ===== END: Cookie Consent Styles ===== */


        /* ===== RESPONSIVE (from Mortgage Calc) ===== */
        @media (max-width: 1024px) {
            .calculator-wrapper { grid-template-columns: 1fr; }
            .inputs-panel { position: static; max-height: none; overflow-y: visible; }
            .footer-content { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .header-features { display: none; }
            .sponsor-banner { flex-direction: column; gap: 12px; }
            .sponsor-buttons { flex: 1 1 100%; justify-content: space-between; }
            .tab-buttons { flex-wrap: nowrap; overflow-x: auto; }
            .inputs-panel, .results-panel { padding: 16px; }
            .footer-sponsor { padding: 24px; }
        }

        @media (max-width: 480px) {
            .calculator-title { display: none; }
            .header-features { display: none; }
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .header-controls {
                margin-left: 0;
                width: 100%;
                justify-content: space-between;
            }
            #pwa-install-btn { flex-grow: 1; }
            .payment-amount { flex-direction: column; gap: 0; }
            .amount { font-size: 2rem; }
            .unit { font-size: 0.875rem; }
            .form-row { grid-template-columns: 1fr; }
            .footer-content { grid-template-columns: 1fr; }
            .sponsor-grid { grid-template-columns: 1fr; }
            #cookie-consent-banner { flex-direction: column; text-align: center; }
            .cookie-consent-text { flex-basis: auto; }
            #cookie-consent-btn { width: 100%; }
        }

        /* ===== PRINT STYLE (from Mortgage Calc) ===== */
        @media print {
            .header, .sponsor-banner, .header-controls, .footer-sponsor, .faq-section, 
            .footer, .ad-slot, .affiliate-slot, .tab-buttons, .secondary-button,
            #cookie-consent-banner {
                display: none;
            }
            .calculator-wrapper { grid-template-columns: 1fr; }
            .inputs-panel, .results-panel { box-shadow: none; border: 1px solid #ccc; }
            .tab-content { display: block !important; padding: 0; }
            .chart-container { height: 300px; page-break-inside: avoid; }
            .table-scroll-wrapper { max-height: none; overflow: visible; page-break-inside: auto; }
            .ai-insights-box { page-break-inside: avoid; }
        }
    </style>
    <!-- END: Inlined CSS -->

    <!-- Google Analytics Script (From Doc) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NYBL2CDNQJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NYBL2CDNQJ');
    </script>

    <!-- PWA Install & Preload Logic (From Mortgage Calc) -->
    <script>
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
            const pwaInstall = document.getElementById('pwa-install-btn');
            if (pwaInstall) pwaInstall.style.display = 'flex';
        });

        // Preload Chart.js
        document.addEventListener('DOMContentLoaded', () => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'script';
            link.href = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
            document.head.appendChild(link);
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="https_www.finguid.com" class="logo">
                    <span role="img" aria-label="Money bag emoji">üí∞</span>
                    <span>FinGuid USA</span>
                </a>
                
                <!-- Title changed for Investment Calculator -->
                <span class="calculator-title">AI Investment Planner</span>

                <div class="header-features" aria-hidden="true">
                    <span class="header-feature-item">ü§ñ AI Powered</span>
                    <span class="header-feature-item">üìà Live FRED Inflation</span>
                    <span class="header-feature-item">üí° AI Goal Planning</span>
                    <span class="header-feature-item">üìä Compound Growth</span>
                </div>

                <div class="header-controls">
                    <!-- PWA Install Button -->
                    <button type="button" id="pwa-install-btn" aria-label="Install App"><i class="fas fa-download"></i> Install</button>
                    <!-- Dark Mode -->
                    <button type="button" class="icon-btn" id="darkModeToggle" aria-label="Toggle dark mode" title="Dark mode"><i class="fas fa-moon"></i></button>
                    <!-- Voice -->
                    <button type="button" class="icon-btn" id="voiceToggle" aria-label="Voice control" title="Voice commands"><i class="fas fa-microphone"></i></button>
                    <!-- TTS -->
                    <button type="button" class="icon-btn" id="ttsToggle" aria-label="Text to speech" title="Read results"><i class="fas fa-volume-high"></i></button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Sponsor Banner (Content changed for investing) -->
    <div class="sponsor-banner">
        <span class="sponsor-text">üéÅ Start Investing Today and Get $100 in Free Stock</span>
        <div class="sponsor-buttons">
            <button type="button" class="sponsor-btn" onclick="location.href='#our-partners'">View Partner Brokers ‚Üí</button>
            <button type="button" class="sponsor-btn" onclick="app.showPartnerAlert('Brokerage Partnerships')">Become a Partner ‚Üí</button>
        </div>
    </div>

    <main class="container" role="main">
        <div class="calculator-wrapper">
            <!-- 
              INPUTS PANEL
              Content from investment-calculator.html, structure from mortgage-calculator.html
            -->
            <section class="inputs-panel" role="region" aria-labelledby="inputs-title">
                <h2 class="panel-title" id="inputs-title"><i class="fas fa-calculator"></i> Investment Parameters</h2>

                <!-- Ad Slot (From Mortgage Calc) -->
                <div class="ad-slot" role="complementary" aria-label="Sponsor Ad Slot">
                    <p class="ad-label">SPONSORED BROKERAGE</p>
                    <div class="ad-placeholder">
                       Start Investing with $0 Commission (Sponsor)
                    </div>
                </div>
                
                <form id="investment-form" novalidate>
                    <!-- Input Tabs (from Investment Calc, styled like Mortgage Calc) -->
                    <div class="input-tabs tab-buttons">
                         <button type="button" class="tab-btn active" role="tab" aria-controls="calc-fv" aria-selected="true" id="tab-calc-fv">Calculate Future Value</button>
                         <button type="button" class="tab-btn" role="tab" aria-controls="calc-goal" aria-selected="false" id="tab-calc-goal" tabindex="-1">Plan Financial Goal</button>
                    </div>

                    <!-- Future Value Tab Content -->
                    <div id="calc-fv" class="tab-content active" role="tabpanel" aria-labelledby="tab-calc-fv" tabindex="0">
                        <h3 class="section-heading">Investment Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="initial-investment">Initial Investment
                                    <span class="tooltip" data-tooltip="The starting amount you are investing." tabindex="0" role="tooltip" id="tooltip-initial">
                                        <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <span class="input-addon" aria-hidden="true">$</span>
                                    <input type="number" id="initial-investment" value="10000" min="0" step="100" aria-label="Initial investment amount">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="monthly-contribution">Monthly Contribution
                                    <span class="tooltip" data-tooltip="The additional amount you will invest each month." tabindex="0" role="tooltip" id="tooltip-monthly">
                                        <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <span class="input-addon" aria-hidden="true">$</span>
                                    <input type="number" id="monthly-contribution" value="500" min="0" step="50" aria-label="Monthly contribution amount">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                             <div class="form-group">
                                <label class="form-label" for="years-to-grow">Years to Grow
                                    <span class="tooltip" data-tooltip="The total number of years you plan to let your investment grow." tabindex="0" role="tooltip" id="tooltip-years">
                                        <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                    </span>
                                </label>
                                <input type="number" id="years-to-grow" value="20" min="1" step="1" aria-label="Years to grow">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="expected-return-rate">Expected Annual Return
                                    <span class="tooltip" data-tooltip="Your estimated average annual rate of return (e.g., S&P 500 average is ~10%)." tabindex="0" role="tooltip" id="tooltip-return">
                                        <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="expected-return-rate" value="7.0" min="0" max="50" step="0.1" aria-label="Expected annual return rate">
                                    <span class="input-addon" aria-hidden="true">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Goal Planning Tab Content -->
                    <div id="calc-goal" class="tab-content" role="tabpanel" aria-labelledby="tab-calc-goal" tabindex="0">
                        <h3 class="section-heading">Financial Goal</h3>
                        <div class="form-group">
                            <label class="form-label" for="financial-goal">Financial Goal Amount
                                 <span class="tooltip" data-tooltip="The total amount you want to reach." tabindex="0" role="tooltip" id="tooltip-goal-amt">
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <span class="input-addon" aria-hidden="true">$</span>
                                <input type="number" id="financial-goal" value="1000000" min="0" step="10000" aria-label="Financial goal amount">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="initial-investment-goal">Initial Investment</label>
                                <div class="input-wrapper">
                                    <span class="input-addon" aria-hidden="true">$</span>
                                    <input type="number" id="initial-investment-goal" value="10000" min="0" step="100" aria-label="Initial investment for goal">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="expected-return-rate-goal">Expected Annual Return</label>
                                <div class="input-wrapper">
                                    <input type="number" id="expected-return-rate-goal" value="7.0" min="0" max="50" step="0.1" aria-label="Expected return rate for goal">
                                    <span class="input-addon" aria-hidden="true">%</span>
                                </div>
                            </div>
                        </div>
                        <h4 class="section-heading" style="font-size: 14px; margin-top: 16px;">Calculate ONE of the following:</h4>
                        <div class="form-group">
                            <label class="form-label" for="monthly-contribution-goal">Monthly Contribution</label>
                             <div class="input-wrapper">
                                <span class="input-addon" aria-hidden="true">$</span>
                                <input type="number" id="monthly-contribution-goal" value="500" min="0" step="50" aria-label="Monthly contribution for goal">
                                <button type="button" class="secondary-button" id="calculate-time-button" style="margin-left: 8px; white-space: nowrap;">Calculate Time</button>
                             </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="years-to-grow-goal">Years to Reach Goal</label>
                            <div class="input-wrapper">
                                <input type="number" id="years-to-grow-goal" value="20" min="1" step="1" aria-label="Years to reach goal">
                                <button type="button" class="secondary-button" id="calculate-contribution-button" style="margin-left: 8px; white-space: nowrap;">Calculate Contribution</button>
                            </div>
                        </div>
                    </div>

                    <!-- Economic Factors (Shared) -->
                    <h3 class="section-heading">Economic Factors (Optional)</h3>
                     <div class="form-group">
                        <label class="form-label" for="inflation-rate">Expected Annual Inflation
                            <span class="fred-source-note" id="fred-last-updated">Fetching Live FRED Rate...</span>
                        </label>
                        <div class="input-wrapper">
                            <input type="number" id="inflation-rate" value="3.0" min="0" step="0.1" readonly aria-label="Expected annual inflation rate">
                            <span class="input-addon" aria-hidden="true">%</span>
                        </div>
                         <p class="input-note">Live rate (US CPI) used for inflation-adjusted projections. Data via <a href="https://fred.stlouisfed.org/" target="_blank" rel="noopener">FRED¬Æ</a>.</p>
                    </div>

                    <!-- Affiliate Slot (From Investment Calc, styled) -->
                    <aside class="affiliate-slot" role="complementary" aria-label="Affiliate Link">
                        <h4><i class="fas fa-handshake"></i> Need Investment Ideas?</h4>
                        <p>Explore diversified, low-cost ETFs & Mutual Funds to match your expected returns. (Affiliate Link)</p>
                        <a href="#our-partners" class="primary-button affiliate-link-cta" id="affiliate-link-1" onclick="app.showPartnerAlert('Brokerage Platforms')">See Top Investment Platforms</a>
                    </aside>

                </form>
            </section>

            <!-- 
              RESULTS PANEL
              Content from investment-calculator.html, structure from mortgage-calculator.html
            -->
            <section class="results-panel" role="region" aria-labelledby="results-title">
                <h2 class="panel-title" id="results-title"><i class="fas fa-chart-pie"></i> Investment Projection & Analysis</h2>

                <!-- Ad Slot -->
                <div class="ad-slot" role="complementary" aria-label="Advertisement">
                    <p class="ad-label">SPONSORED CONTENT / AD</p>
                    <div class="ad-placeholder">
                        <p>Plan for Retirement with a Certified Financial Planner (Sponsor Link)</p>
                    </div>
                </div>

                <!-- Main Summary Card -->
                <div class="summary-card" id="fv-results-summary">
                    <div class="summary-label">Projected Future Value</div>
                    <div class="payment-amount">
                        <span class="amount" id="future-value-total" aria-live="polite">$0</span>
                    </div>
                    <div class="piti-breakdown-summary" id="investment-summary-details" aria-live="polite">
                        Total Principal: $0 | Total Gains: $0
                    </div>
                     <div class="inflation-adjusted-value" id="inflation-adjusted-value" aria-live="polite">
                        Inflation-Adjusted: $0 (in today's dollars)
                    </div>
                </div>

                <!-- Goal Summary Card (Initially Hidden) -->
                 <div id="goal-results-summary" class="summary-card goal-summary hidden">
                    <p class="summary-label">Goal Planning Result</p>
                    <div class="payment-amount">
                        <span id="goal-result-figure" class="amount" aria-live="polite">--</span>
                        <span id="goal-result-unit" class="unit"></span>
                    </div>
                    <p class="piti-breakdown-summary" id="goal-details-summary" aria-live="polite"></p>
                </div>

                
                <div class="tabs">
                    <!-- Result Tabs (WCAG compliant from Mortgage Calc) -->
                    <div class="tab-buttons" role="tablist" aria-label="Results sections">
                        <button type="button" class="tab-btn active" role="tab" aria-controls="growth-chart" aria-selected="true" id="tab-growth-chart"><i class="fas fa-chart-line"></i> Growth Chart</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="ai-insights" aria-selected="false" id="tab-ai-insights" tabindex="-1"><i class="fas fa-robot"></i> AI Insights</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="data-table" aria-selected="false" id="tab-data-table" tabindex="-1"><i class="fas fa-table"></i> Annual Data</button>
                    </div>

                    <!-- Growth Chart Tab -->
                    <div class="tab-content active" id="growth-chart" role="tabpanel" aria-labelledby="tab-growth-chart" tabindex="0">
                        <h3 class="results-heading">Investment Growth Over Time</h3>
                        <p class="chart-caption">Visualizing nominal value, total contributions, and inflation-adjusted value.</p>
                        <div class="chart-container">
                            <canvas id="investmentGrowthChart" role="img" aria-label="Line chart showing investment growth over time"></canvas>
                        </div>
                    </div>

                    <!-- AI Insights Tab -->
                    <div class="tab-content" id="ai-insights" role="tabpanel" aria-labelledby="tab-ai-insights" tabindex="0">
                         <h3 class="results-heading"><i class="fas fa-robot"></i> AI-Powered Insights</h3>
                        <div class="insights-container" id="ai-insights-output" aria-live="polite">
                            <div class="recommendation-alert low-priority">
                                <strong><i class="fas fa-robot"></i> AI Advisor:</strong> Enter your details to generate personalized insights...
                            </div>
                        </div>
                        <!-- Ad Slot (From Investment Calc) -->
                         <aside class="ad-slot" role="complementary" aria-label="Affiliate Ad Slot" style="margin-top: 24px;">
                            <p class="ad-label">SPONSORED CONTENT / AD</p>
                            <div class="ad-placeholder">Learn about Tax-Advantaged Retirement Accounts (Sponsor)</div>
                        </aside>
                    </div>
                    
                    <!-- Annual Data Tab -->
                    <div class="tab-content" id="data-table" role="tabpanel" aria-labelledby="tab-data-table" tabindex="0">
                        <h3 class="results-heading">Annual Investment Breakdown</h3>
                         <button type="button" id="export-csv-button" class="secondary-button" style="margin-bottom: 16px;"><i class="fas fa-file-csv"></i> Export Annual Data to CSV</button>
                        <div class="table-scroll-wrapper">
                            <table id="annual-data-table" class="data-table" aria-label="Annual Investment Data">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Start Balance</th>
                                        <th>Contributions</th>
                                        <th>Interest Earned</th>
                                        <th>End Balance</th>
                                        <th>Inflation Adj. Balance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data injected by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Partner Section (Content changed for investing) -->
        <section class="footer-sponsor" id="our-partners" aria-labelledby="partners-title">
            <div class="container">
                <h3 id="partners-title" style="text-align: center; margin-bottom: 24px; color: var(--primary); font-size: 24px; font-weight: 700;">Our Investment Partners</h3>
                <div class="sponsor-grid">
                    <div class="sponsor-item">
                        <h4><i class="fas fa-seedling"></i> New Investors</h4>
                        <p>Start with $0 commission trades on stocks & ETFs. Get a $100 bonus when you sign up.</p>
                        <a href="#affiliate-link-1" onclick="app.showPartnerAlert('Partner Brokerage'); return false;" aria-label="Get Started with our Partner Brokerage">Get Started ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4><i class="fas fa-robot"></i> Robo-Advisors</h4>
                        <p>Let experts build and manage a diversified portfolio for you. Low fees and automated investing.</p>
                        <a href="#affiliate-link-2" onclick="app.showPartnerAlert('Robo-Advisor'); return false;" aria-label="Compare Robo-Advisors">Compare Advisors ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4><i class="fas fa-chart-pie"></i> Retirement (IRA/401k)</h4>
                        <p>Open a tax-advantaged retirement account (IRA) or roll over your old 401(k).</p>
                        <a href="#affiliate-link-3" onclick="app.showPartnerAlert('Retirement Accounts'); return false;" aria-label="Explore Retirement Accounts">Explore Accounts ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4><i class="fas fa-shield-alt"></i> Financial Advisors</h4>
                        <p>Connect with a certified financial planner (CFP) for a holistic wealth strategy.</p>
                        <a href="#affiliate-link-4" onclick="app.showPartnerAlert('Financial Planners'); return false;" aria-label="Find a Financial Advisor">Find a CFP ‚Üí</a>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- SEO: FAQ Section (Content is new and investment-focused) -->
        <section class="faq-section" aria-labelledby="faq-title">
            <h2 class="faq-title" id="faq-title"><i class="fas fa-comments-dollar"></i> Investment FAQs</h2>
            <div class="faq-container" id="faqContainer">
                <!-- FAQs will be dynamically inserted here by JS -->
            </div>
        </section>

        <!-- Footer (from Mortgage Calc, links adapted for investing) -->
        <footer class="footer" role="contentinfo">
            <div class="container">
                <div class="footer-content">
                    <nav class="footer-section" role="navigation" aria-label="About this calculator">
                        <h4>About Investment Calculator</h4>
                        <a href="#how-it-works">How It Works</a>
                        <a href="#features">Features</a>
                        <a href="#faq">FAQ</a>
                        <a href="#contact">Contact Us</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Learn more about investing">
                        <h4>Learn More</h4>
                        <a href="#compound-interest">What is Compound Interest?</a>
                        <a href="#ira">Roth vs. Traditional IRA</a>
                        <a href="#401k">401(k) Basics</a>
                        <a href="#etf-vs-mutual-fund">ETFs vs. Mutual Funds</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Financial resources">
                        <h4>Other Calculators</h4>
                        <a href="/mortgage-calculator">Mortgage Calculator</a>
                        <a href="/retirement-calculator">Retirement Calculator</a>
                        <a href="/auto-loan-calculator">Auto Loan Calculator</a>
                        <a href="/savings-calculator">Savings Calculator</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Legal links">
                        <h4>Legal</h4>
                        <a href="#privacy">Privacy Policy</a>
                        <a href="#terms">Terms of Service</a>
                        <a href="#disclaimer">Disclaimer</a>
                        <a href="#affiliate">Affiliate Disclosure</a>
                    </nav>
                </div>

                <div class="compliance-badges" role="list" aria-label="Compliance Badges">
                    <span class="badge" role="listitem"><i class="fas fa-shield-alt"></i> SSL Secured</span>
                    <span class="badge" role="listitem"><i class="fas fa-check-circle"></i> GDPR Compliant</span>
                    <span class="badge" role="listitem"><i class="fas fa-check-circle"></i> CCPA Compliant</span>
                    <span class="badge" role="listitem"><i class="fas fa-check-circle"></i> FTC Compliant</span>
                    <span class="badge" role="listitem"><i class="fas fa-universal-access"></i> WCAG 2.1 AA</span>
                </div>

                <!-- Disclaimer (Adapted for investing) -->
                <section class="disclaimer" aria-label="Disclaimers and Disclosures">
                    <strong>Educational & Informational Only:</strong> This investment calculator is for educational and informational purposes only. It is NOT financial or investment advice. Projections are estimates based on user inputs and market assumptions; **actual results may vary significantly.** Past performance is not indicative of future results. All investments involve risk and may lose value.
                    <br><br>
                    <strong>Affiliate Disclosure:</strong> FinGuid participates in affiliate programs. When you click on partner links, we may receive compensation. This does not affect our analysis or your costs. We only recommend products we believe provide value.
                    <br><br>
                    <strong>Data Accuracy:</strong> Inflation data (CPIAUCSL) provided by the U.S. Bureau of Labor Statistics and delivered via FRED¬Æ API from the Federal Reserve Bank of St. Louis. Data is updated regularly but we make no guarantees about accuracy.
                </section>

                <div class="footer-bottom">
                    ¬© 2025 FinGuid USA. All Rights Reserved. | AI-Powered Financial Tools for Americans
                </div>
            </div>
        </footer>
    </main>

    <!-- GDPR/CCPA Cookie Consent Banner (from Mortgage Calc) -->
    <div id="cookie-consent-banner" role="dialog" aria-modal="true" aria-labelledby="cookie-consent-title" aria-describedby="cookie-consent-desc">
        <div class="cookie-consent-text">
            <h4 id="cookie-consent-title" style="font-weight: 700; color: var(--text); margin-bottom: 8px;">Your Privacy</h4>
            <p id="cookie-consent-desc">
                We use cookies and data to enhance your experience and provide personalized AI insights. By clicking "Accept", you agree to our use of cookies.
                <a href="#privacy" aria-label="Read our Privacy Policy">Privacy Policy</a>.
            </p>
        </div>
        <button type="button" id="cookie-consent-btn">Accept</button>
    </div>

    <!-- WCAG/PWA Compliant Alert Modal (from Mortgage Calc) -->
    <style>
        .alert-modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10002;
            display: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .alert-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 10003;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            display: none;
            opacity: 0;
            transition: all 0.2s ease-in-out;
        }
        .alert-modal.visible { display: block; opacity: 1; }
        .alert-modal-backdrop.visible { display: block; opacity: 1; }
        .alert-modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 12px;
        }
        .alert-modal-body {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 24px;
            line-height: 1.6;
        }
        .alert-modal-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        .alert-modal-btn:hover { background: var(--primary-dark); }
        .alert-modal-btn:focus {
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
            outline: none;
        }
    </style>
    <div class="alert-modal-backdrop" id="alert-modal-backdrop"></div>
    <div class="alert-modal" id="alert-modal" role="alertdialog" aria-modal="true" aria-labelledby="alert-modal-title" aria-describedby="alert-modal-body">
        <h4 class="alert-modal-title" id="alert-modal-title">Partner Information</h4>
        <p class="alert-modal-body" id="alert-modal-body">
            This is an affiliate link for [Partner].
        </p>
        <button type="button" class="alert-modal-btn" id="alert-modal-close">Close</button>
    </div>
    <!-- END: Modal for Alerts -->

    <!-- CDN Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- 
      START: Inlined JavaScript
      This script merges the logic from investment-calculator.js 
      into the compliant app structure from mortgage-calculator (6).html.
    -->
    <script>
        /**
         * ========================================================================
         * AI INVESTMENT PLANNER - PRODUCTION v1.2 (FIXED)
         * ========================================================================
         * Built with: SOLID Principles, WCAG 2.1 AA, PWA Compatible, GDPR/CCPA
         *
         * FIX 1: Swapped to a new CORS proxy (allorigins.win)
         * FIX 2: Removed Blob-based Service Worker registration.
         * ========================================================================
         */

        // ===== APP STATE & CONSTANTS =====
        const FRED_API_KEY = '9c6c421f077f2091e8bae4f143ada59a'; // From tools scrept.docx
        const FRED_URL = 'https://api.stlouisfed.org/fred/series/observations';
        const FRED_INFLATION_SERIES_ID = 'CPIAUCSL'; // US CPI (Inflation)
        const FALLBACK_INFLATION_RATE = 3.0;

        // ===== SEO: Comprehensive FAQ List =====
        const FAQs = [
            {
                q: "What is an investment calculator and how does it work?",
                a: "An investment calculator is an AI-powered tool that projects the future value of your investments. It uses the power of **compound interest**‚Äîthe interest you earn on your initial money *and* on the interest you've already earned. You provide a starting amount, monthly contributions, expected annual return, and time period, and it calculates the growth."
            },
            {
                q: "What is compound interest?",
                a: "Compound interest is the 'snowball effect' for your money. In year one, you earn interest on your principal. In year two, you earn interest on your principal *plus* the interest from year one. Over time, this accelerates your wealth growth significantly. This calculator's 'Growth Chart' visualizes this effect."
            },
            {
                q: "How much money do I need to start investing?",
                a: "You can start investing with any amount! Many modern brokerages (like our partners) allow you to open an account with $0 and buy 'fractional shares' of stocks or ETFs for as little as $1. The most important thing is to start early and be consistent with your contributions."
            },
            {
                q: "What is a good expected annual return?",
                a: "A realistic long-term expected return for a diversified portfolio (like an S&P 500 index fund) is historically between **7% and 10%** per year, *before* adjusting for inflation. Returns are never guaranteed. Our AI Insights will warn you if your expected return seems too optimistic or too pessimistic."
            },
            {
                q: "What is the difference between nominal and inflation-adjusted value?",
                a: "This calculator shows both. **Nominal value** is the final dollar amount your investment grows to (e.g., $1,000,000). **Inflation-adjusted value** (or 'real value') shows what that $1,000,000 will be worth in *today's* dollars, accounting for the loss of purchasing power due to inflation. This is a much more realistic way to plan for retirement."
            },
            {
                q: "What is a 401(k) and should I use it?",
                a: "A 401(k) is an employer-sponsored retirement account. It offers significant tax advantages. Contributions are often 'pre-tax', lowering your current taxable income. Many employers also offer a 'match'‚Äîfree money they contribute if you contribute. If your employer offers a match, this is almost always the first place you should invest."
            },
            {
                q: "What is an IRA? (Roth vs. Traditional)",
                a: "An IRA (Individual Retirement Arrangement) is an account you open on your own. <br/>A **Traditional IRA** is like a 401(k): you may get a tax deduction now, and your money grows tax-deferred, but you pay taxes when you withdraw in retirement.<br/>A **Roth IRA** is the reverse: you contribute with after-tax dollars (no deduction now), but your money grows completely **tax-free**, and all withdrawals in retirement are tax-free. Many financial advisors recommend a Roth IRA for younger investors."
            },
            {
                q: "What are ETFs and Mutual Funds?",
                a: "**ETFs (Exchange-Traded Funds)** and **Mutual Funds** are baskets of investments. Instead of buying just one stock (like Apple), you can buy one ETF or mutual fund that holds hundreds or thousands of stocks (like the entire S&P 500). This provides instant diversification and is the recommended strategy for most long-term investors."
            },
            {
                q: "How do I plan for a financial goal, like a house down payment?",
                a: "Use the 'Plan Financial Goal' tab. Enter your goal amount (e.g., $100,000 for a down payment) and your starting cash. The calculator can then tell you either: <br/><strong>1. How long it will take</strong> to reach your goal based on your monthly contributions. <br/><strong>2. How much you need to contribute</strong> each month to reach your goal by a specific date."
            },
            {
                q: "What is the FRED inflation rate?",
                a: "This calculator uses a live data feed from **FRED (Federal Reserve Economic Data)**, a database maintained by the St. Louis Fed. We pull the latest official **CPIAUCSL (Consumer Price Index)** data to set the default inflation rate, giving you the most realistic, up-to-date projection possible."
            },
            {
                q: "How much should I save for retirement?",
                a: "A common rule of thumb is to save at least **15% of your gross income** each year for retirement. However, the exact amount depends on your age, desired retirement lifestyle, and current savings. Our AI Advisor can give you insights, and for a full plan, you should use a dedicated retirement calculator or speak to a financial planner."
            }
        ];

        // ===== INVESTMENT CALCULATOR ENGINE =====
        class InvestmentCalculator {
            // All calculation logic from investment-calculator.js
            
            static calculateFutureValue(initial, pmt, r, n) {
                let futureValue = initial * Math.pow(1 + r, n);
                if (r > 0) {
                    futureValue += pmt * ((Math.pow(1 + r, n) - 1) / r);
                } else {
                    futureValue += pmt * n; // No interest, just principal + contributions
                }
                return futureValue;
            }

            static calculateInflationAdjustedFV(futureValue, i, n) {
                return futureValue / Math.pow(1 + i, n);
            }

            static calculateTimeToGoal(initial, pmt, r, goal) {
                if (goal <= initial) return 0;
                if (pmt <= 0 && (initial * (1+r)) <= initial) return Infinity; // No growth, no contribution
                
                let years = 0;
                let balance = initial;
                const maxYears = 100;

                while (balance < goal && years < maxYears) {
                    years++;
                    balance = (balance + pmt) * (1 + r);
                }
                return years >= maxYears ? Infinity : years;
            }

            static calculateContributionNeeded(initial, r, n, goal) {
                const fvInitial = initial * Math.pow(1 + r, n);
                if (fvInitial >= goal) return 0;

                let pmt = 0;
                if (r > 0) {
                    const fvAnnuityFactor = (Math.pow(1 + r, n) - 1) / r;
                    pmt = (goal - fvInitial) / fvAnnuityFactor;
                } else {
                    pmt = (goal - initial) / n;
                }
                return Math.max(0, pmt / 12); // Return monthly contribution
            }

            static generateAnnualData(initial, pmt, r, n, i) {
                let annualData = [];
                let balance = initial;

                for (let year = 1; year <= n; year++) {
                    const startBalance = balance;
                    // Interest is earned on start balance + contributions (simplified as end-of-year lump sum for this model)
                    // A more accurate model compounds monthly. Let's refine.
                    
                    let yearEndBalance = startBalance;
                    let totalInterestYear = 0;
                    let monthly_r = r / 12;
                    let monthly_pmt = pmt / 12;

                    // Calculate compounding monthly
                    let monthlyBalance = startBalance;
                    for (let month = 0; month < 12; month++) {
                        monthlyBalance = (monthlyBalance + monthly_pmt) * (1 + monthly_r);
                    }
                    
                    yearEndBalance = monthlyBalance;
                    const totalContributions = pmt;
                    const totalGrowth = yearEndBalance - startBalance - totalContributions;
                    balance = yearEndBalance;

                    const inflationAdjusted = this.calculateInflationAdjustedFV(balance, i, year);

                    annualData.push({
                        year: year,
                        startBalance: startBalance,
                        contributions: totalContributions,
                        interestEarned: totalGrowth,
                        endBalance: balance,
                        inflationAdjustedBalance: inflationAdjusted
                    });
                }
                return annualData;
            }
        }

        // ===== AI INSIGHTS ENGINE (Logic from Investment Calc) =====
        class AIInsightEngine {
            constructor(results, inputs) {
                this.results = results;
                this.inputs = inputs;
            }
            
            generateInsights() {
                const insights = [];
                const {
                    futureValue,
                    totalPrincipal,
                    totalGains,
                    inflationAdjustedFV
                } = this.results;
                
                const {
                    initialInvestment,
                    monthlyContribution,
                    yearsToGrow,
                    expectedReturnRate,
                    inflationRate,
                    calculationMode,
                    financialGoal,
                    yearsToGoal,
                    contributionNeeded
                } = this.inputs;

                const fmtd = UIManager.formatCurrency;
                const fmtdPct = UIManager.formatPercent;
                
                if (futureValue <= 0 && initialInvestment <= 0 && monthlyContribution <= 0) {
                     insights.push({
                        title: "ü§ñ AI Advisor",
                        text: `Enter your investment details to generate personalized insights and see your growth potential.`,
                        type: 'low-priority'
                    });
                    return insights;
                }
                
                // --- Goal Mode Insights ---
                if (calculationMode === 'calc-goal-time') {
                    if (yearsToGoal === Infinity) {
                        insights.push({
                            title: "‚ö†Ô∏è Goal Alert: Plan Unrealistic",
                            text: `At ${fmtd(monthlyContribution, 2)}/mo, reaching your ${fmtd(financialGoal)} goal may take over 100 years. **AI Action:** Drastically increase your monthly contribution or lower your financial goal.`,
                            type: 'high-priority'
                        });
                    } else if (yearsToGoal > 40) {
                         insights.push({
                            title: "‚ö†Ô∏è Goal Alert: Very Long Horizon",
                            text: `It will take **${yearsToGoal} years** to reach your ${fmtd(financialGoal)} goal. **AI Action:** Consider increasing your ${fmtd(monthlyContribution, 2)}/mo contribution to shorten this timeline.`,
                            type: 'medium-priority'
                        });
                    } else if (yearsToGoal > 0) {
                        insights.push({
                            title: "‚úÖ Goal Status: On Track!",
                            text: `You are on track to reach your ${fmtd(financialGoal)} goal in **${yearsToGoal} years** by investing ${fmtd(monthlyContribution, 2)}/mo.`,
                            type: 'low-priority'
                        });
                    } else {
                         insights.push({
                            title: "‚úÖ Goal Met!",
                            text: `Your initial investment of ${fmtd(initialInvestment)} is already greater than your goal of ${fmtd(financialGoal)}.`,
                            type: 'low-priority'
                        });
                    }
                }
                else if (calculationMode === 'calc-goal-contribution') {
                    if (contributionNeeded <= 0) {
                         insights.push({
                            title: "‚úÖ Goal Met!",
                            text: `Your initial investment of ${fmtd(initialInvestment)} is enough to reach your ${fmtd(financialGoal)} goal in ${yearsToGrow} years *without* any additional contributions.`,
                            type: 'low-priority'
                        });
                    } else if (contributionNeeded > (initialInvestment * 0.5)) { // Arbitrary "high" contribution
                         insights.push({
                            title: "‚ö†Ô∏è Goal Alert: High Contribution Needed",
                            text: `To reach your ${fmtd(financialGoal)} goal in ${yearsToGrow} years, you need to save **${fmtd(contributionNeeded, 2)} per month**. **AI Action:** If this is too high, consider extending your timeline or increasing your initial investment.`,
                            type: 'medium-priority'
                        });
                    } else {
                         insights.push({
                            title: "‚úÖ Goal Status: Plan Ready!",
                            text: `You need to invest **${fmtd(contributionNeeded, 2)} per month** for ${yearsToGrow} years to reach your ${fmtd(financialGoal)} goal.`,
                            type: 'low-priority'
                        });
                    }
                }
                // --- FV Mode Insights ---
                else {
                    insights.push({
                        title: "üìà AI Projection Summary",
                        text: `Your plan projects a future value of <strong>${fmtd(futureValue, 0)}</strong>. After adjusting for ${fmtdPct(inflationRate, 1)} inflation, this is estimated to be worth <strong>${fmtd(inflationAdjustedFV, 0)}</strong> in today's dollars.`,
                        type: 'low-priority'
                    });
                }
                
                // --- General Insights (Added to all modes) ---

                // Power of Compounding
                const gainsRatio = (totalGains / futureValue);
                if (gainsRatio > 0.5 && yearsToGrow >= 15) {
                    insights.push({
                        title: "üöÄ Power of Compounding is Working!",
                        text: `Over <strong>${fmtdPct(gainsRatio * 100, 0)}</strong> of your projected future value comes from compound gains, not just your contributions! This is the magic of long-term investing.`,
                        type: 'low-priority'
                    });
                } else if (gainsRatio > 0.25 && yearsToGrow >= 5) {
                     insights.push({
                        title: "üå± Compounding Has Begun",
                        text: `<strong>${fmtdPct(gainsRatio * 100, 0)}</strong> of your future value is projected to be from gains. **AI Tip:** Stay invested! The longer you wait, the more powerful this effect becomes.`,
                        type: 'low-priority'
                    });
                }

                // Inflation Impact Warning
                const inflationErosion = (futureValue - inflationAdjustedFV) / futureValue;
                if (inflationErosion > 0.3 && yearsToGrow > 10) {
                    insights.push({
                        title: "‚ö†Ô∏è Inflation Impact Warning",
                        text: `Inflation is projected to erode over <strong>${fmtdPct(inflationErosion * 100, 0)}</strong> of your portfolio's purchasing power over ${yearsToGrow} years. **AI Action:** This is why it's critical to invest. Your expected return of ${fmtdPct(expectedReturnRate, 1)} is helping you outpace inflation. <a href="#our-partners" onclick="app.showPartnerAlert('Brokerage Platforms')">Explore growth-oriented investments.</a>`,
                        type: 'medium-priority'
                    });
                }

                // High Return Rate Check
                if (expectedReturnRate > 12.0) {
                    insights.push({
                        title: "üîé Expectation Check: High Return Rate",
                        text: `An expected annual return of <strong>${fmtdPct(expectedReturnRate, 1)}</strong> is very optimistic and historically difficult to sustain. The S&P 500 average is ~10%. **AI Action:** Consider using a more conservative rate (e.g., 7-10%) for planning. <a href="#our-partners" onclick="app.showPartnerAlert('Financial Planners')">Connect with an advisor to build a realistic portfolio.</a>`,
                        type: 'high-priority'
                    });
                }
                
                // Low Return Rate Check
                if (expectedReturnRate < inflationRate) {
                    insights.push({
                        title: "üìâ Growth Alert: Losing to Inflation",
                        text: `Your expected return (<strong>${fmtdPct(expectedReturnRate, 1)}</strong>) is *lower* than the inflation rate (<strong>${fmtdPct(inflationRate, 1)}</strong>). This means your money is projected to *lose* purchasing power over time. **AI Action:** Explore investment options that offer the potential for higher returns.`,
                        type: 'high-priority'
                    });
                }

                // Low Contribution Alert
                if (monthlyContribution < 100 && monthlyContribution > 0 && initialInvestment < 5000) {
                    insights.push({
                        title: "üí° Opportunity: Increase Contributions",
                        text: `Your current monthly contribution of <strong>${fmtd(monthlyContribution, 0)}</strong> is a great start. **AI Tip:** Even small increases can have a huge impact. Increasing it by just $50/mo could add thousands to your final value due to compounding.`,
                        type: 'medium-priority'
                    });
                }

                return insights;
            }
        }

        // ===== FRED API MANAGER (Adapted from Mortgage Calc) =====
        class FREDManager {
            
            static getEasternTimeInfo() {
                const now = new Date();
                const etFormatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: 'America/New_York',
                    hour: 'numeric', minute: 'numeric', year: 'numeric', month: 'numeric', day: 'numeric', hour12: false
                });
                
                const parts = etFormatter.formatToParts(now).reduce((acc, part) => {
                    acc[part.type] = part.value;
                    return acc;
                }, {});
                
                const currentETDate = `${parts.year}-${parts.month.padStart(2, '0')}-${parts.day.padStart(2, '0')}`;
                // CPI data is monthly, not daily, so daily cutoff logic is less relevant.
                // We'll cache for 12 hours.
                return { now };
            }

            static isCacheValid(cache) {
                const { lastFetch } = cache;
                if (!lastFetch) return false;

                const { now } = this.getEasternTimeInfo();
                const lastFetchDate = new Date(lastFetch);
                const cacheAge = now.getTime() - lastFetchDate.getTime();
                const twelveHours = 12 * 60 * 60 * 1000;
                
                return cacheAge < twelveHours; // Cache is valid if less than 12 hours old
            }

            static formatTimestamp(now) {
                return new Intl.DateTimeFormat('en-US', {
                    timeZone: 'America/New_York',
                    dateStyle: 'short',
                    timeStyle: 'short'
                }).format(now) + " ET";
            }

            /**
             * Fetches the FRED inflation series.
             */
            static async fetchInflationSeries() {
                // FIX 2: Switched to a new CORS proxy
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                try {
                    // Fetch last 13 months to calculate year-over-year change
                    const apiUrl = `${FRED_URL}?series_id=${FRED_INFLATION_SERIES_ID}&api_key=${FRED_API_KEY}&file_type=json&sort_order=desc&limit=13`;
                    // We must URL-encode the target API URL
                    const url = proxyUrl + encodeURIComponent(apiUrl);
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`FRED API request failed for ${FRED_INFLATION_SERIES_ID}: ${response.status}`);
                    
                    const data = await response.json();
                    
                    if (data.observations && data.observations.length >= 13) {
                        const validObs = data.observations.filter(obs => obs.value !== '.');
                        if (validObs.length < 13) throw new Error('Not enough valid observations.');

                        const latestValue = parseFloat(validObs[0].value);
                        const priorYearValue = parseFloat(validObs[12].value);
                        const date = validObs[0].date;
                        
                        if (isNaN(latestValue) || isNaN(priorYearValue) || priorYearValue === 0) {
                             throw new Error('Invalid inflation data points.');
                        }
                        
                        const inflationRate = ((latestValue - priorYearValue) / priorYearValue) * 100;
                        const rate = Math.max(0, inflationRate); // Don't allow negative inflation (deflation) for this model
                        
                        return { rate, date };
                    }
                } catch (error) {
                    console.error(error);
                }
                return { rate: null, date: null }; // Fallback
            }

            /**
             * Main function to get inflation rate, using cache if valid.
             */
            static async getInflationRate() {
                const cacheStr = localStorage.getItem('fredInflationCache');
                let cache = cacheStr ? JSON.parse(cacheStr) : null;
                
                const { now } = this.getEasternTimeInfo();

                if (cache && this.isCacheValid(cache)) {
                    console.log('Using cached FRED inflation rate');
                    return {
                        ...cache,
                        isCache: true,
                        lastUpdatedTimestamp: `Rate as of ${this.formatTimestamp(new Date(cache.lastFetch))}`
                    };
                }

                console.log('Fetching new FRED inflation rate');
                
                const { rate, date } = await this.fetchInflationSeries();

                const newRate = rate !== null ? rate : FALLBACK_INFLATION_RATE;
                const newDate = date;

                const newCache = {
                    rate: newRate,
                    date: newDate,
                    lastFetch: now.toISOString()
                };

                localStorage.setItem('fredInflationCache', JSON.stringify(newCache));

                return {
                    ...newCache,
                    isCache: false,
                    lastUpdatedTimestamp: `Live Rate updated: ${this.formatTimestamp(now)}`
                };
            }
        }

        // ===== UI MANAGER (from Mortgage Calc, adapted) =====
        class UIManager {
            static formatCurrency(value, decimals = 0) {
                if (typeof value !== 'number' || isNaN(value)) value = 0;
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals
                }).format(value);
            }
            static formatPercent(value, decimals = 1) { 
                if (typeof value !== 'number' || isNaN(value)) value = 0;
                return (value).toFixed(decimals) + '%';
            }
            static formatNumber(num, decimals = 0) {
                if (typeof num !== 'number' || isNaN(num)) return '0';
                return num.toLocaleString('en-US', {
                    minimumFractionDigits: decimals,
                    maximumFractionDigits: decimals,
                });
            }

            static updateResults(results, inputs) {
                 const {
                    futureValue,
                    totalPrincipal,
                    totalGains,
                    inflationAdjustedFV
                } = results;
                
                const {
                    calculationMode,
                    financialGoal,
                    yearsToGoal,
                    contributionNeeded,
                    inflationRate
                } = inputs;

                 // Main FV Summary
                 document.getElementById('future-value-total').textContent = this.formatCurrency(futureValue);
                 document.getElementById('investment-summary-details').innerHTML = `Total Principal: ${this.formatCurrency(totalPrincipal)} | Total Gains: ${this.formatCurrency(totalGains)}`;
                 document.getElementById('inflation-adjusted-value').innerHTML = `Inflation-Adjusted: ${this.formatCurrency(inflationAdjustedFV)} <span class="input-note">(in today's dollars, assuming ${this.formatPercent(inflationRate)} inflation)</span>`;

                // Goal Summary
                const goalSummary = document.getElementById('goal-results-summary');
                const fvSummary = document.getElementById('fv-results-summary');
                
                if (calculationMode === 'calc-goal-time' && yearsToGoal !== null) {
                    goalSummary.classList.remove('hidden');
                    fvSummary.classList.add('hidden');
                    if (yearsToGoal === Infinity) {
                        document.getElementById('goal-result-figure').textContent = 'N/A';
                        document.getElementById('goal-result-unit').textContent = 'Over 100 Yrs';
                        document.getElementById('goal-details-summary').textContent = 'Goal may be unreachable with current inputs.';
                    } else {
                        document.getElementById('goal-result-figure').textContent = this.formatNumber(yearsToGoal);
                        document.getElementById('goal-result-unit').textContent = yearsToGoal === 1 ? 'Year' : 'Years';
                        document.getElementById('goal-details-summary').textContent = `To reach ${this.formatCurrency(financialGoal)}`;
                    }
                } else if (calculationMode === 'calc-goal-contribution' && contributionNeeded !== null) {
                    goalSummary.classList.remove('hidden');
                    fvSummary.classList.add('hidden');
                    document.getElementById('goal-result-figure').textContent = this.formatCurrency(contributionNeeded, 2);
                    document.getElementById('goal-result-unit').textContent = '/ month';
                    document.getElementById('goal-details-summary').textContent = `Needed to reach ${this.formatCurrency(financialGoal)}`;
                } else {
                    // Show FV summary, hide Goal summary
                    goalSummary.classList.add('hidden');
                    fvSummary.classList.remove('hidden');
                }
            }

            static updateDataTable(annualData) {
                const tableBody = document.querySelector('#annual-data-table tbody');
                tableBody.innerHTML = '';

                if (!annualData || annualData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" style="padding: 12px; text-align: center; color: var(--text-light);">No data to display.</td></tr>';
                    return;
                }
                
                const fragment = document.createDocumentFragment();
                annualData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.year}</td>
                        <td>${this.formatCurrency(item.startBalance)}</td>
                        <td>${this.formatCurrency(item.contributions)}</td>
                        <td>${this.formatCurrency(item.interestEarned)}</td>
                        <td>${this.formatCurrency(item.endBalance)}</td>
                        <td>${this.formatCurrency(item.inflationAdjustedBalance)}</td>
                    `;
                    fragment.appendChild(row);
                });
                tableBody.appendChild(fragment);
            }

            static updateInsights(insights) {
                const container = document.getElementById('ai-insights-output');
                container.innerHTML = '';
                if(!insights || insights.length === 0) {
                     container.innerHTML = '<div class="recommendation-alert low-priority"><strong><i class="fas fa-robot"></i> AI Advisor:</strong> Enter valid investment details...</div>';
                     return;
                }
                insights.forEach(insight => {
                    const box = document.createElement('div');
                    box.className = `recommendation-alert ${insight.type}`;
                    // Use innerHTML to render bold/links
                    box.innerHTML = `<strong><i class="fas fa-robot"></i> ${insight.title}:</strong> ${insight.text}`;
                    container.appendChild(box);
                });
            }
        }

        // ===== CHART MANAGER (from Mortgage Calc, adapted) =====
        class ChartManager {
            static charts = {};

            static renderInvestmentChart(annualData, initialInvestment, inflationRate) {
                const ctx = document.getElementById('investmentGrowthChart')?.getContext('2d');
                if (!ctx) return;
                if (this.charts.investmentGrowth) this.charts.investmentGrowth.destroy();
                
                if(!annualData || annualData.length === 0) return;

                const labels = annualData.map(d => `Year ${d.year}`);
                const totalValueData = annualData.map(d => d.endBalance);
                const principalData = annualData.map((d, i) => initialInvestment + d.contributions * (i + 1));
                const inflationAdjustedData = annualData.map(d => d.inflationAdjustedBalance);

                const isDarkMode = document.documentElement.getAttribute('data-color-scheme') === 'dark';
                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDarkMode ? '#E1E8ED' : '#1F2121';
                
                this.charts.investmentGrowth = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Total Value (Nominal)',
                                data: totalValueData,
                                borderColor: 'var(--primary)',
                                backgroundColor: 'rgba(36, 172, 185, 0.1)',
                                fill: true,
                                tension: 0.3,
                                borderWidth: 3,
                            },
                            {
                                label: 'Total Principal Invested',
                                data: principalData,
                                borderColor: 'var(--accent-dark)',
                                borderDash: [5, 5],
                                fill: false,
                                tension: 0.1,
                                borderWidth: 2,
                            },
                            {
                                label: 'Value (Inflation-Adjusted)',
                                data: inflationAdjustedData,
                                borderColor: 'var(--error)',
                                fill: false,
                                tension: 0.3,
                                borderWidth: 2,
                                hidden: inflationRate <= 0 // Hide if no inflation
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { 
                            mode: 'index', 
                            intersect: false 
                        },
                        plugins: {
                            legend: { 
                                labels: { 
                                    color: textColor,
                                    font: { size: 12 },
                                    padding: 15
                                } 
                            },
                            tooltip: {
                                backgroundColor: isDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: gridColor,
                                borderWidth: 1,
                                padding: 12,
                                displayColors: true,
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: ${UIManager.formatCurrency(context.parsed.y)}`
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: { display: true, text: 'Value ($)', color: textColor, font: { size: 13, weight: 'bold' }},
                                ticks: { color: textColor, callback: (value) => UIManager.formatCurrency(value) },
                                grid: { color: gridColor },
                                beginAtZero: true
                            },
                            x: {
                                title: { display: true, text: 'Time (Years)', color: textColor, font: { size: 13, weight: 'bold' }},
                                ticks: { color: textColor, maxRotation: 45, minRotation: 0 },
                                grid: { color: gridColor }
                            }
                        }
                    }
                });
            }
        }

        // ===== MAIN APP (Controller) =====
        const app = {
            calculateDebounce: null,
            lastResults: null,
            lastAnnualData: [], 
            state: {
                isTtsEnabled: false,
                liveInflationRate: FALLBACK_INFLATION_RATE
            },

            async init() {
                this.setupEventListeners();
                this.setupDarkMode();
                this.setupPWA();
                this.setupVoiceControls();
                this.setupFAQ();
                this.initTooltips(); 
                this.setupTabs(); // WCAG Tab Navigation
                this.setupAlertModal(); // WCAG Modal
                this.setupCookieConsent(); // GDPR/CCPA Banner
                await this.loadInflationRate(); // Fetch live inflation
            },

            setupEventListeners() {
                const form = document.getElementById('investment-form');
                if (form) {
                    form.addEventListener('input', () => this.debouncedCalculate());
                    form.addEventListener('change', () => this.debouncedCalculate());
                }
                
                // Goal Calculation Buttons
                document.getElementById('calculate-time-button')?.addEventListener('click', () => {
                    this.state.calculationMode = 'calc-goal-time'; // Set mode override
                    this.calculate();
                    app.showAlert('Goal Plan', 'Calculating time needed to reach your goal...');
                });
                document.getElementById('calculate-contribution-button')?.addEventListener('click', () => {
                    this.state.calculationMode = 'calc-goal-contribution'; // Set mode override
                    this.calculate();
                    app.showAlert('Goal Plan', 'Calculating monthly contribution needed...');
                });

                // Export CSV Button
                document.getElementById('export-csv-button')?.addEventListener('click', () => this.exportDataToCsv());
            },

            // --- WCAG FIX: Accessible tabs ---
            setupTabs() {
                const tablists = document.querySelectorAll('[role="tablist"]');
                tablists.forEach(tablist => {
                    const tabs = tablist.querySelectorAll('[role="tab"]');
                    
                    tablist.addEventListener('click', (e) => {
                        const clickedTab = e.target.closest('[role="tab"]');
                        if (!clickedTab) return;
                        this.activateTab(clickedTab, tablist);
                    });

                    tablist.addEventListener('keydown', (e) => {
                        let index = Array.from(tabs).indexOf(document.activeElement);
                        if (index === -1) return;

                        let direction = 0;
                        if (e.key === 'ArrowRight' || e.key === 'ArrowDown') direction = 1;
                        else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') direction = -1;
                        else if (e.key === 'Home') { e.preventDefault(); tabs[0].focus(); }
                        else if (e.key === 'End') { e.preventDefault(); tabs[tabs.length - 1].focus(); }

                        if (direction !== 0) {
                            e.preventDefault();
                            index = (index + direction + tabs.length) % tabs.length;
                            tabs[index].focus();
                        }
                    });
                });
            },

            activateTab(tab, tablist) {
                const tabId = tab.getAttribute('aria-controls');
                
                // Deactivate all tabs in this list
                tablist.querySelectorAll('[role="tab"]').forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                    t.setAttribute('tabindex', '-1');
                });
                
                // Deactivate all panels associated with this list
                tablist.querySelectorAll('[role="tab"]').forEach(t => {
                    const panel = document.getElementById(t.getAttribute('aria-controls'));
                    if (panel) {
                        panel.classList.remove('active');
                        panel.style.display = 'none';
                    }
                });
                
                // Activate clicked tab
                tab.classList.add('active');
                tab.setAttribute('aria-selected', 'true');
                tab.setAttribute('tabindex', '0');

                // Activate corresponding panel
                const panel = document.getElementById(tabId);
                panel.classList.add('active');
                panel.style.display = 'block';

                // If it's an input tab, recalculate
                if (tablist.classList.contains('input-tabs')) {
                    this.state.calculationMode = tab.getAttribute('aria-controls'); // Set mode
                    this.calculate();
                }

                // Render charts if switching to their tabs
                if (tabId === 'growth-chart' && this.lastAnnualData) {
                    setTimeout(() => ChartManager.renderInvestmentChart(this.lastAnnualData, this.lastResults.totalPrincipal, this.state.liveInflationRate), 50);
                }
            },
            
            // Debounced calculation
            debouncedCalculate() {
                clearTimeout(this.calculateDebounce);
                this.calculateDebounce = setTimeout(() => this.calculate(), 250);
            },

            // --- Main Calculation Function ---
            calculate() {
                // 1. Get Inputs
                const activeInputTab = document.querySelector('.input-tabs [role="tab"][aria-selected="true"]');
                const calculationMode = this.state.calculationMode || activeInputTab.getAttribute('aria-controls') || 'calc-fv';
                
                let inputs = {
                    calculationMode: calculationMode,
                    inflationRate: parseFloat(document.getElementById('inflation-rate').value) || 0
                };

                if (calculationMode === 'calc-fv') {
                    inputs.initialInvestment = parseFloat(document.getElementById('initial-investment').value) || 0;
                    inputs.monthlyContribution = parseFloat(document.getElementById('monthly-contribution').value) || 0;
                    inputs.yearsToGrow = parseFloat(document.getElementById('years-to-grow').value) || 0;
                    inputs.expectedReturnRate = parseFloat(document.getElementById('expected-return-rate').value) || 0;
                    // Goal inputs remain null
                    inputs.financialGoal = null;
                    inputs.yearsToGoal = null;
                    inputs.contributionNeeded = null;
                } else {
                    inputs.financialGoal = parseFloat(document.getElementById('financial-goal').value) || 0;
                    inputs.initialInvestment = parseFloat(document.getElementById('initial-investment-goal').value) || 0;
                    inputs.expectedReturnRate = parseFloat(document.getElementById('expected-return-rate-goal').value) || 0;

                    if (calculationMode === 'calc-goal-time') {
                        inputs.monthlyContribution = parseFloat(document.getElementById('monthly-contribution-goal').value) || 0;
                        inputs.yearsToGrow = 0; // Will be calculated
                    } else { // calc-goal-contribution
                        inputs.monthlyContribution = 0; // Will be calculated
                        inputs.yearsToGrow = parseFloat(document.getElementById('years-to-grow-goal').value) || 0;
                    }
                }
                
                // 2. Perform Calculations
                const r_annual = inputs.expectedReturnRate / 100;
                const i_annual = inputs.inflationRate / 100;
                
                let results = {};
                
                if (calculationMode === 'calc-goal-time') {
                    const pmt_annual = inputs.monthlyContribution * 12;
                    const years = InvestmentCalculator.calculateTimeToGoal(inputs.initialInvestment, pmt_annual, r_annual, inputs.financialGoal);
                    inputs.yearsToGoal = years;
                    inputs.yearsToGrow = (years === Infinity) ? 100 : years; // Use 100 yrs for table if infinite
                } else if (calculationMode === 'calc-goal-contribution') {
                    const contribution_monthly = InvestmentCalculator.calculateContributionNeeded(inputs.initialInvestment, r_annual, inputs.yearsToGrow, inputs.financialGoal);
                    inputs.contributionNeeded = contribution_monthly;
                    inputs.monthlyContribution = contribution_monthly;
                }
                
                // 3. Always calculate FV and Data Table based on final inputs
                const pmt_annual = inputs.monthlyContribution * 12;
                const n_years = inputs.yearsToGrow;

                results.futureValue = InvestmentCalculator.calculateFutureValue(inputs.initialInvestment, pmt_annual, r_annual, n_years);
                results.totalPrincipal = inputs.initialInvestment + (pmt_annual * n_years);
                results.totalGains = results.futureValue - results.totalPrincipal;
                results.inflationAdjustedFV = InvestmentCalculator.calculateInflationAdjustedFV(results.futureValue, i_annual, n_years);

                const annualData = InvestmentCalculator.generateAnnualData(inputs.initialInvestment, pmt_annual, r_annual, n_years, i_annual);
                
                this.lastResults = results;
                this.lastAnnualData = annualData;
                
                // 4. Update UI
                UIManager.updateResults(results, inputs);
                UIManager.updateDataTable(annualData);
                
                const aiEngine = new AIInsightEngine(results, inputs);
                const insights = aiEngine.generateInsights();
                UIManager.updateInsights(insights);

                if (this.state.isTtsEnabled) {
                    this.speakResults();
                }

                // 5. Refresh chart if tab is active
                const activeTabId = document.querySelector('.results-panel [role="tab"][aria-selected="true"]')?.getAttribute('aria-controls');
                if (activeTabId === 'growth-chart') {
                    setTimeout(() => ChartManager.renderInvestmentChart(this.lastAnnualData, inputs.initialInvestment, inputs.inflationRate), 50);
                }
            },
            
            exportDataToCsv() {
                if (!this.lastAnnualData || this.lastAnnualData.length === 0) {
                    app.showAlert('Export Error', 'No data available to export.');
                    return;
                }

                let csvContent = "data:text/csv;charset=utf-8,";
                const header = ['Year', 'Start Balance ($)', 'Contributions ($)', 'Interest Earned ($)', 'End Balance ($)', 'Inflation Adjusted Balance ($)'];
                csvContent += header.join(',') + '\n';

                this.lastAnnualData.forEach(item => {
                    const row = [
                        item.year,
                        item.startBalance.toFixed(2),
                        item.contributions.toFixed(2),
                        item.interestEarned.toFixed(2),
                        item.endBalance.toFixed(2),
                        item.inflationAdjustedBalance.toFixed(2),
                    ];
                    csvContent += row.join(',') + '\n';
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `investment_projection.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },

            // --- Fetch live inflation rate ---
            async loadInflationRate() {
                const updatedEl = document.getElementById('fred-last-updated');
                const rateEl = document.getElementById('inflation-rate');
                
                try {
                    const { rate, date, lastUpdatedTimestamp } = await FREDManager.getInflationRate();
                    
                    this.state.liveInflationRate = rate;
                    rateEl.value = rate.toFixed(1);

                    updatedEl.textContent = `Live Rate (${date})`;
                    updatedEl.style.color = "var(--text-light)";

                } catch (error) {
                    console.error("Error loading inflation rate:", error);
                    updatedEl.textContent = 'Using Fallback Rate';
                    updatedEl.style.color = "var(--error)";
                    this.state.liveInflationRate = FALLBACK_INFLATION_RATE;
                    rateEl.value = FALLBACK_INFLATION_RATE.toFixed(1);
                }
                
                this.calculate(); // Run initial calculation
            },

            // --- WCAG: Tooltips (from Mortgage Calc) ---
            initTooltips() {
                let tooltipBox = null;
                document.querySelectorAll('.tooltip').forEach(el => {
                    const showTooltip = (e) => {
                        const text = e.currentTarget.getAttribute('data-tooltip');
                        if (!text) return;
                        if (tooltipBox) tooltipBox.remove();
                        tooltipBox = document.createElement('div');
                        tooltipBox.className = 'tooltip-box';
                        tooltipBox.textContent = text;
                        tooltipBox.setAttribute('role', 'tooltip');
                        document.body.appendChild(tooltipBox);
                        const rect = e.currentTarget.getBoundingClientRect();
                        let top = rect.top - tooltipBox.offsetHeight - 5;
                        let left = rect.left + rect.width / 2 - tooltipBox.offsetWidth / 2;
                        if (top < 0) { top = rect.bottom + 5; }
                        if (left < 0) { left = 5; }
                        if (left + tooltipBox.offsetWidth > window.innerWidth) {
                            left = window.innerWidth - tooltipBox.offsetWidth - 5;
                        }
                        tooltipBox.style.left = `${left}px`;
                        tooltipBox.style.top = `${top}px`;
                        tooltipBox.style.display = 'block';
                        setTimeout(() => { if (tooltipBox) tooltipBox.style.opacity = '1'; }, 10);
                    };
                    const hideTooltip = () => {
                        if (tooltipBox) {
                            tooltipBox.style.opacity = '0';
                            setTimeout(() => { if (tooltipBox) { tooltipBox.remove(); tooltipBox = null; } }, 200);
                        }
                    };
                    el.addEventListener('mouseenter', showTooltip);
                    el.addEventListener('focus', showTooltip);
                    el.addEventListener('mouseleave', hideTooltip);
                    el.addEventListener('blur', hideTooltip);
                });
            },

            // --- Dark Mode (from Mortgage Calc) ---
            setupDarkMode() {
                const toggle = document.getElementById('darkModeToggle');
                const icon = toggle.querySelector('i');
                const scheme = localStorage.getItem('colorScheme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                document.documentElement.setAttribute('data-color-scheme', scheme);
                icon.className = scheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                
                toggle.addEventListener('click', () => {
                    const current = document.documentElement.getAttribute('data-color-scheme');
                    const next = current === 'light' ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-color-scheme', next);
                    localStorage.setItem('colorScheme', next);
                    icon.className = next === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                    
                    // Force chart redraw on theme change
                    this.calculate(); 
                });
            },

            // --- PWA (from Mortgage Calc) ---
            setupPWA() {
                const pwaBtn = document.getElementById('pwa-install-btn');
                if (pwaBtn) {
                    pwaBtn.addEventListener('click', async () => {
                        if (window.deferredPrompt) {
                            window.deferredPrompt.prompt();
                            const { outcome } = await window.deferredPrompt.userChoice;
                            if (outcome === 'accepted') this.showAlert('App Installed', 'FinGuid Investment Planner has been added to your device!');
                            window.deferredPrompt = null;
                        }
                    });
                }
            },

            // --- Voice & TTS (from Mortgage Calc) ---
            setupVoiceControls() {
                const voiceBtn = document.getElementById('voiceToggle');
                const ttsBtn = document.getElementById('ttsToggle');
                
                if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.lang = 'en-US';
                    
                    recognition.onstart = () => { voiceBtn.classList.add('active'); voiceBtn.querySelector('i').className = 'fas fa-circle-notch fa-spin'; };
                    recognition.onend = () => { voiceBtn.classList.remove('active'); voiceBtn.querySelector('i').className = 'fas fa-microphone'; };
                    recognition.onerror = (event) => { console.error('Voice recognition error', event.error); this.showAlert('Voice Error', 'Sorry, I couldn\'t understand that.'); };

                    recognition.onresult = (event) => {
                        const command = event.results[0][0].transcript.toLowerCase();
                        if (command.includes('calculate')) this.calculate();
                        else if (command.includes('read results')) this.speakResults();
                        else if (command.includes('read insights')) this.speakInsights();
                    };
                    voiceBtn.addEventListener('click', () => { try { recognition.start(); } catch(e) { console.error("Voice recognition error", e); } });
                } else {
                     voiceBtn.title = 'Voice control not supported in this browser.';
                     voiceBtn.style.opacity = '0.5';
                     voiceBtn.disabled = true;
                }
                
                ttsBtn.addEventListener('click', () => {
                    this.state.isTtsEnabled = !this.state.isTtsEnabled;
                    if (this.state.isTtsEnabled) {
                        ttsBtn.classList.add('active'); 
                        this.speakResults(); 
                    } else {
                        ttsBtn.classList.remove('active'); 
                        if ('speechSynthesis' in window && speechSynthesis.speaking) {
                            speechSynthesis.cancel(); 
                        }
                    }
                });
            },

            speakResults() {
                if ('speechSynthesis' in window && this.lastResults) {
                    speechSynthesis.cancel();
                    let text = '';
                    const activeInputTab = document.querySelector('.input-tabs [role="tab"][aria-selected="true"]');
                    const calculationMode = activeInputTab.getAttribute('aria-controls') || 'calc-fv';

                    if (calculationMode === 'calc-fv') {
                         text = `Your projected future value is ${UIManager.formatCurrency(this.lastResults.futureValue, 0)}. In today's dollars, that's about ${UIManager.formatCurrency(this.lastResults.inflationAdjustedFV, 0)}.`;
                    } else {
                        text = document.getElementById('goal-details-summary')?.textContent || 'Goal calculated.';
                    }

                    const utterance = new SpeechSynthesisUtterance(text);
                    speechSynthesis.speak(utterance);
                }
            },
            
            speakInsights() {
                 if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const insightsContainer = document.getElementById('ai-insights-output');
                    const firstInsight = insightsContainer.querySelector('.recommendation-alert');
                    if(firstInsight) {
                        const text = firstInsight.textContent;
                        const utterance = new SpeechSynthesisUtterance(text);
                        speechSynthesis.speak(utterance);
                    }
                }
            },

            // --- WCAG: Accessible FAQ (from Mortgage Calc) ---
            setupFAQ() {
                const container = document.getElementById('faqContainer');
                if(!container) return;

                FAQs.forEach((faq, index) => {
                    const qId = `faq-q-${index}`;
                    const aId = `faq-a-${index}`;
                    const item = document.createElement('div');
                    item.className = 'faq-item';
                    item.innerHTML = `
                        <button class="faq-question" type="button" aria-expanded="false" aria-controls="${aId}" id="${qId}">
                            <span>${faq.q}</span>
                            <span class="faq-icon" aria-hidden="true"><i class="fas fa-chevron-down"></i></span>
                        </button>
                        <div class="faq-answer" role="region" aria-labelledby="${qId}" id="${aId}">${faq.a}</div>
                    `;
                    container.appendChild(item);
                });
                
                container.addEventListener('click', (e) => {
                    const question = e.target.closest('.faq-question');
                    if (question) this.toggleFAQ(question);
                });
            },
            
            toggleFAQ(question) {
                const answer = document.getElementById(question.getAttribute('aria-controls'));
                const isActive = question.getAttribute('aria-expanded') === 'true';

                // Deactivate all others
                document.querySelectorAll('.faq-question[aria-expanded="true"]').forEach(q => {
                    if (q !== question) {
                        q.setAttribute('aria-expanded', 'false');
                        q.classList.remove('active');
                        document.getElementById(q.getAttribute('aria-controls')).style.display = 'none';
                        q.querySelector('.faq-icon i').className = 'fas fa-chevron-down';
                    }
                });

                if (!isActive) {
                    question.setAttribute('aria-expanded', 'true');
                    question.classList.add('active');
                    answer.style.display = 'block';
                    answer.style.animation = 'slideDown 0.3s ease';
                    question.querySelector('.faq-icon i').className = 'fas fa-chevron-up';
                } else {
                    question.setAttribute('aria-expanded', 'false');
                    question.classList.remove('active');
                    answer.style.display = 'none';
                    question.querySelector('.faq-icon i').className = 'fas fa-chevron-down';
                }
            },

            // --- GDPR/CCPA (from Mortgage Calc) ---
            setupCookieConsent() {
                const banner = document.getElementById('cookie-consent-banner');
                const btn = document.getElementById('cookie-consent-btn');
                if (!banner || !btn) return;
                
                if (localStorage.getItem('cookieConsent') === 'true') {
                    banner.style.display = 'none';
                } else {
                    banner.style.display = 'flex';
                }
                
                btn.addEventListener('click', () => {
                    localStorage.setItem('cookieConsent', 'true');
                    banner.style.display = 'none';
                });
            },
            
            // --- WCAG Alert Modal (from Mortgage Calc) ---
            setupAlertModal() {
                const modal = document.getElementById('alert-modal');
                const backdrop = document.getElementById('alert-modal-backdrop');
                const closeBtn = document.getElementById('alert-modal-close');
                
                const closeModal = () => {
                    modal.classList.remove('visible');
                    backdrop.classList.remove('visible');
                };

                closeBtn.addEventListener('click', closeModal);
                backdrop.addEventListener('click', closeModal);
            },
            
            showAlert(title, message) {
                document.getElementById('alert-modal-title').textContent = title;
                document.getElementById('alert-modal-body').textContent = message;
                document.getElementById('alert-modal').classList.add('visible');
                document.getElementById('alert-modal-backdrop').classList.add('visible');
                document.getElementById('alert-modal-close').focus();
            },
            
            showPartnerAlert(partnerName) {
                this.showAlert(
                    'Affiliate Partner Link',
                    `This is an affiliate link. If you click this link and apply for a product, we may receive a commission. This partner is: ${partnerName}.`
                );
            }
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => app.init());
        
        // Handle window resize for chart responsiveness
        window.addEventListener('resize', () => {
            if (ChartManager.charts.investmentGrowth) {
                ChartManager.charts.investmentGrowth.resize();
            }
        });
    </script>
    <!-- END: Inlined JavaScript -->

    <!-- 
      FIX: Removed the PWA Service Worker script that was causing
      the blob: URL error. The PWA manifest link in the <head>
      is still active for installability.
    -->

</body>
</html>
