<!DOCTYPE html>
<html lang="en" data-color-scheme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>AI IRA Calculator 2025 | Roth vs Traditional | FinGuid USA</title>
    <meta name="description" content="World's Best AI-Powered IRA Calculator by FinGuid. Compare Roth vs Traditional, analyze tax benefits, check MAGI limits, and get 100+ AI insights. Uses live FRED inflation data. WCAG 2.1 AA compliant.">
    <meta name="keywords" content="ira calculator, roth vs traditional calculator, retirement calculator, ira contribution calculator, roth ira calculator, traditional ira calculator, ira tax calculator, retirement savings, AI retirement planning, ira comparison, roth ira contribution limits 2024, traditional ira deduction, magi limits, backdoor roth, ira optimizer, retirement planning, FinGuid, ira growth chart, retirement projection, catch-up contributions, ira tax savings, retirement income calculator, ira inflation adjustment, FRED API inflation, ira pwa, accessible ira calculator, ira tax brackets, ira advisor, AI financial advisor, ira tool, retirement tool, roth ira conversion, ira projections, ira investment returns, roth ira eligibility">
    <meta name="author" content="FinGuid USA">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="theme-color" content="#24ACB9"> <meta property="og:type" content="website">
    <meta property="og:title" content="AI IRA Calculator 2025 | Compare Roth vs Traditional | FinGuid">
    <meta property="og:description" content="Free AI-powered IRA calculator to compare Roth vs. Traditional. Analyzes tax savings, MAGI limits, and provides AI insights with live FRED inflation data.">
    <link rel="canonical" href="https://www.finguid.com/calculators/ira">

    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22FinGuid%20AI%20IRA%20Calculator%22,%22short_name%22:%22IRA%20Calc%22,%22description%22:%22AI-Powered%20IRA%20Calculator%20to%20compare%20Roth%20vs%20Traditional,%20with%20AI%20Insights%20and%20Live%20Inflation%20Data.%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#FFFFFD%22,%22theme_color%22:%22#24ACB9%22,%22icons%22:[{%22src%22:%22https://placehold.co/192x192/24ACB9/FFFFFF?text=FinGuid%22,%22type%22:%22image/png%22,%22sizes%22:%22192x192%22},{%22src%22:%22https://placehold.co/512x512/24ACB9/FFFFFF?text=FinGuid%22,%22type%22:%22image/png%22,%22sizes%22:%22512x512%22}]}">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVJkEZSMUkrQ6usznlsmcWdiM3UUQtjyS5gPIBlElmEUIL8D0iYpJZLdPyElkEzdoe+G+cFDGRA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* === START: Global Variables (From Mortgage CSS) === */
        :root {
            --primary: #24ACB9;
            --primary-dark: #19343B;
            --accent: #FFC107;
            --accent-dark: #E69500;
            --text: #1F2121;
            --text-light: #64748B;
            --bg: #FFFFFD;
            --bg-secondary: #F5F7FA;
            --card: #FFFFFF;
            --border: #E2E8F0;
            --error: #EF4444;
            --success: #10B981;
            --fred-color: #A31B20;
        }

        [data-color-scheme="dark"] {
            --text: #E1E8ED;
            --text-light: #B8C5D0;
            --bg: #1F2121;
            --bg-secondary: #242B36;
            --card: #181919;
            --border: #38444D;
        }
        /* === END: Global Variables === */

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { 
            font-size: 16px; 
            -webkit-font-smoothing: antialiased; 
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Helvetica Neue', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            color: var(--text);
            background: var(--bg);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 16px; }

        /* ===== HEADER (From Mortgage) ===== */
        .header {
            position: sticky;
            top: 0;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            gap: 16px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--primary);
            font-weight: 700;
            font-size: 18px;
            flex-shrink: 0;
        }

        .logo:hover { color: var(--primary-dark); }

        .calculator-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            flex-shrink: 0;
            margin-left: 16px;
            flex-basis: auto;
            min-width: 0;
        }

        .header-features {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: 24px;
            flex-grow: 1;
            justify-content: flex-start;
            overflow: hidden;
            mask-image: linear-gradient(to right, black 90%, transparent 100%);
        }

        .header-feature-item {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            animation: pulse-color-text 2.5s infinite ease-in-out;
        }
        .header-feature-item:nth-child(1) { animation-delay: 0s; }
        .header-feature-item:nth-child(2) { animation-delay: 0.2s; }
        .header-feature-item:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse-color-text {
            0%, 100% {
                opacity: 0.8;
                color: var(--text-light);
                transform: scale(1);
            }
            50% {
                opacity: 1;
                color: var(--primary);
                transform: scale(1.03);
            }
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
            margin-left: auto;
        }

        .icon-btn {
            background: var(--bg-secondary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            transition: all 0.3s ease;
            position: relative;
        }
        .icon-btn:hover { background: var(--primary); color: white; }
        .icon-btn.active { background: var(--primary); color: white; }

        #pwa-install-btn {
            display: none;
            padding: 8px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #pwa-install-btn:hover { background: var(--primary-dark); transform: scale(1.05); }

        /* ===== SPONSOR BANNER (From Mortgage) ===== */
        .sponsor-banner {
            background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .sponsor-text { font-weight: 500; flex: 1; min-width: 200px; }
        .sponsor-buttons { display: flex; gap: 8px; }
        .sponsor-btn {
            padding: 8px 12px;
            background: white;
            color: #6366F1;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .sponsor-btn:hover { background: var(--accent); color: var(--text); transform: translateY(-2px); }

        /* ===== MAIN CALCULATOR (Layout From Mortgage) ===== */
        .calculator-wrapper {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
            padding: 24px 0;
            margin-bottom: 40px;
        }

        .inputs-panel, .results-panel {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        .inputs-panel:hover, .results-panel:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .panel-title { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }

        .section-heading {
            font-size: 13px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 20px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        .form-group { margin-bottom: 16px; }

        .form-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 6px;
        }
        
        .fred-source-note {
            font-size: 11px;
            color: var(--text-light);
            text-align: left;
            margin-top: 4px;
            display: block;
        }
        .fred-source-note a { color: var(--text-light); text-decoration: none; }
        .fred-source-note a:hover { color: var(--primary); }

        /* Tooltip Styles (From Mortgage) */
        .tooltip {
            font-weight: bold;
            cursor: help;
            margin-left: 4px;
            position: relative;
            display: inline-flex;
            align-items: center;
            color: var(--text-light);
        }
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--text-light);
            color: var(--card);
            font-style: normal;
            font-size: 10px;
            font-weight: 700;
            line-height: 14px;
            margin-left: 5px;
            transition: all 0.2s ease;
        }
        .tooltip:hover .tooltip-icon,
        .tooltip:focus .tooltip-icon {
            background: var(--primary);
            outline: none;
        }
        .tooltip:focus { outline: none; }
        .tooltip-box {
            position: fixed;
            background: #1a1a1a;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            max-width: 200px;
            white-space: normal;
            display: none; 
            opacity: 0;
            transition: opacity 0.2s;
        }

        .input-wrapper { position: relative; display: flex; align-items: center; gap: 8px; min-width: 0; }

        input[type="number"], input[type="text"], input[type="date"], input[type="month"], select {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 0;
            width: 100%; 
        }

        /* WCAG Focus Rings */
        input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus, 
        input[type="month"]:focus, select:focus, .rate-btn:focus, .lookup-btn:focus, 
        .sponsor-btn:focus, .btn-secondary:focus, .icon-btn:focus, 
        #pwa-install-btn:focus, .tab-btn:focus, .faq-question:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.25);
        }
        .icon-btn:focus, #pwa-install-btn:focus, .sponsor-btn:focus, .lookup-btn:focus, .primary-button:focus {
             box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
        }

        .input-addon {
            background: var(--bg-secondary);
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            min-width: 50px;
            text-align: center;
        }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        /* Primary Button (from 401k, adapted) */
        .primary-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            gap: 8px;
            margin-top: 16px;
        }
        .primary-button:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .primary-button:active { transform: translateY(0); }

        /* Ad Slot (From Mortgage) */
        .ad-slot {
            background: var(--bg-secondary);
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            margin: 24px 0;
        }
        .ad-label {
            font-size: 0.75rem;
            font-weight: bold;
            color: var(--accent-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .ad-placeholder {
            font-size: 14px;
            color: var(--text-light);
            font-weight: 600;
        }
        
        /* ===== RESULTS SECTION (From Mortgage) ===== */
        .summary-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(36, 172, 185, 0.2);
            text-align: center;
        }
        .summary-label { font-size: 0.875rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .payment-amount { display: flex; align-items: baseline; justify-content: center; gap: 8px; margin: 8px 0; }
        .amount { font-size: 2rem; font-weight: bold; }
        .unit { font-size: 1rem; opacity: 0.9; }
        .payment-breakdown { font-size: 0.875rem; opacity: 0.8; }

        .tabs { margin-bottom: 24px; }
        .tab-buttons { 
            display: flex; 
            gap: 4px; 
            border-bottom: 2px solid var(--border); 
            margin-bottom: 24px; 
            overflow-x: auto; 
        }
        .tab-btn {
            padding: 16px 24px;
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: -2px;
            white-space: nowrap;
        }
        .tab-btn:hover { color: var(--text); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-btn:focus {
            color: var(--primary);
            box-shadow: none; 
            border-bottom-color: rgba(36, 172, 185, 0.5);
        }
        .tab-btn.active:focus { border-bottom-color: var(--primary); }

        .tab-content { display: none; padding: 8px; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        .tab-content:focus-visible {
            outline: 2px solid var(--primary);
            border-radius: 4px;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .results-heading {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin: 16px 0;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        /* Result Grid for Summary Tab (from 401k, adapted to mortgage style) */
        .summary-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        .detail-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 4px solid var(--border);
            text-align: center;
        }
        .detail-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        .detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }
        .detail-item.detail-total {
            border-left-color: var(--primary);
            background: rgba(36, 172, 185, 0.1);
        }
        .detail-item.success {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        .detail-item.success .detail-value { color: var(--success); }
        .detail-item.warning {
            border-left-color: var(--accent-dark);
            background: rgba(255, 193, 7, 0.1);
        }
        .detail-item.warning .detail-value { color: var(--accent-dark); }


        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
        }

        /* Amortization Table Styles (From Mortgage) */
        .table-scroll-wrapper {
            overflow-x: auto;
            max-height: 500px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        .styled-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .styled-table thead {
            position: sticky;
            top: 0;
            background: var(--primary);
            color: white;
            z-index: 10;
        }
        .styled-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .styled-table th:nth-child(n+2) { text-align: right; } 
        .styled-table tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }
        .styled-table tbody tr:nth-child(even) { background: var(--bg-secondary); }
        .styled-table tbody tr:hover { background: rgba(36, 172, 185, 0.1); }
        .styled-table td { padding: 10px 12px; color: var(--text-light); }
        .styled-table td:first-child { font-weight: 600; color: var(--text); }
        .styled-table td:nth-child(n+2) {
            text-align: right;
            font-family: 'Courier New', Courier, monospace;
        }

        /* AI INSIGHTS (Using Mortgage classes) */
        .insights-container { margin-top: 20px; }
        .insight-box {
            background: var(--bg-secondary);
            border-left: 4px solid var(--primary);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.5;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .insight-box.success { border-left-color: var(--success); }
        .insight-box.warning { border-left-color: var(--accent-dark); }
        .insight-box.error { border-left-color: var(--error); }
        .insight-box.info { border-left-color: var(--primary); }

        /* 401k specific AI alert (adapted to mortgage style) */
        .recommendation-alert {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.5;
            border-left-width: 4px;
            border-left-style: solid;
        }
        .recommendation-alert.high-priority {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: var(--error);
            color: var(--text);
        }
        .recommendation-alert.low-priority {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: var(--success);
            color: var(--text);
        }

        /* ===== PARTNER SECTION (From Mortgage) ===== */
        .footer-sponsor {
            background: linear-gradient(135deg, rgba(36, 172, 185, 0.1) 0%, rgba(25, 52, 59, 0.1) 100%);
            padding: 40px;
            border-bottom: 1px solid rgba(36, 172, 185, 0.2);
            border-radius: 12px;
        }
        .sponsor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
        .sponsor-item { text-align: center; padding: 16px; border-radius: 8px; background: var(--card); transition: all 0.2s; }
        .sponsor-item:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .sponsor-item h4 { margin-bottom: 8px; color: var(--primary); font-size: 1rem; }
        .sponsor-item p { color: var(--text-light); margin-bottom: 12px; font-size: 0.875rem; line-height: 1.5; }
        .sponsor-item a {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .sponsor-item a:focus { box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4); outline: none; }
        .sponsor-item a:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(36, 172, 185, 0.3); }

        /* ===== FOOTER (From Mortgage) ===== */
        .footer { background: var(--card); border-top: 1px solid var(--border); padding: 32px 0; margin-top: 40px; }
        .footer-content { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-bottom: 32px; }
        .footer-section h4 { font-size: 13px; font-weight: 700; color: var(--text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
        .footer-section a { display: block; font-size: 12px; color: var(--text-light); text-decoration: none; margin-bottom: 8px; transition: color 0.3s ease; }
        .footer-section a:hover, .footer-section a:focus { color: var(--primary); text-decoration: underline; outline: none; }
        .compliance-badges { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; font-size: 12px; }
        .badge { display: flex; align-items: center; gap: 4px; padding: 6px 10px; background: var(--bg-secondary); border-radius: 4px; font-weight: 600; color: var(--text-light); }
        .disclaimer { font-size: 11px; color: var(--text-light); line-height: 1.6; padding-top: 20px; border-top: 1px solid var(--border); }
        .footer-bottom { text-align: center; font-size: 12px; color: var(--text-light); padding-top: 16px; border-top: 1px solid var(--border); }

        /* ===== FAQ ACCORDION (From Mortgage) ===== */
        .faq-section { margin: 40px 0; }
        .faq-title { font-size: 24px; font-weight: 700; color: var(--text); margin-bottom: 20px; text-align: center; }
        .faq-container { max-width: 900px; margin: 0 auto; }
        .faq-item { margin-bottom: 12px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; transition: all 0.3s ease; }
        .faq-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .faq-question { padding: 16px; background: var(--bg-secondary); cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; color: var(--text); transition: all 0.3s ease; }
        .faq-question:hover { background: var(--card); color: var(--primary); }
        .faq-question.active { background: var(--primary); color: white; }
        .faq-question:focus { box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4) inset; color: var(--primary); }
        .faq-icon { font-size: 18px; transition: transform 0.3s ease; }
        .faq-question.active .faq-icon { transform: rotate(180deg); }
        .faq-answer { display: none; padding: 16px; background: var(--card); color: var(--text-light); line-height: 1.8; font-size: 14px; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }

        /* ===== Cookie Consent Banner (From Mortgage) ===== */
        #cookie-consent-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card);
            color: var(--text);
            padding: 24px;
            border-top: 1px solid var(--border);
            box-shadow: 0 -4px 16px rgba(0,0,0,0.1);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }
        .cookie-consent-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-light);
            flex: 1 1 400px;
        }
        .cookie-consent-text a { color: var(--primary); text-decoration: underline; }
        .cookie-consent-text a:hover { color: var(--primary-dark); }
        #cookie-consent-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        #cookie-consent-btn:hover { background: var(--primary-dark); }
        #cookie-consent-btn:focus { box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4); outline: none; }

        /* ===== RESPONSIVE (From Mortgage) ===== */
        @media (max-width: 1024px) {
            .calculator-wrapper { grid-template-columns: 1fr; }
            .footer-content { grid-template-columns: repeat(2, 1fr); }
            .inputs-panel {
                position: static;
                max-height: none;
                overflow-y: visible;
            }
        }
        @media (max-width: 768px) {
            .header-features { display: none; }
            .sponsor-banner { flex-direction: column; gap: 12px; }
            .sponsor-buttons { flex: 1 1 100%; justify-content: space-between; }
            .tab-buttons { flex-wrap: nowrap; overflow-x: auto; }
            .inputs-panel, .results-panel { padding: 16px; }
            .footer-sponsor { padding: 24px; }
        }
        @media (max-width: 480px) {
            .calculator-title { display: none; }
            .header-features { display: none; }
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .header-controls {
                margin-left: 0;
                width: 100%;
                justify-content: space-between;
            }
            #pwa-install-btn { flex-grow: 1; }
            .payment-breakdown { font-size: 0.75rem; }
            .amount { font-size: 2rem; }
            .form-row { grid-template-columns: 1fr; }
            .footer-content { grid-template-columns: 1fr; }
            .sponsor-grid { grid-template-columns: 1fr; }
            #cookie-consent-banner { flex-direction: column; text-align: center; }
            .cookie-consent-text { flex-basis: auto; }
            #cookie-consent-btn { width: 100%; }
        }
        
        /* Visually hidden class for accessibility */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* ===== PRINT STYLE (From Mortgage) ===== */
        @media print {
            .header, .sponsor-banner, .header-controls, .footer-sponsor, .faq-section, 
            .footer, .ad-slot, .amortization-controls, .chart-summary-controls,
            #cookie-consent-banner, .primary-button, .lookup-btn, .rate-btn {
                display: none;
            }
            .calculator-wrapper { grid-template-columns: 1fr; }
            .inputs-panel, .results-panel { box-shadow: none; border: 1px solid #ccc; }
            .table-scroll-wrapper { max-height: none; overflow: visible; }
        }
        
        /* Modal for Alerts (From Mortgage) */
        .alert-modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10002;
            display: none;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .alert-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 10003;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            display: none;
            opacity: 0;
            transition: all 0.2s ease-in-out;
        }
        .alert-modal.visible { display: block; opacity: 1; }
        .alert-modal-backdrop.visible { display: block; opacity: 1; }
        .alert-modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 12px;
        }
        .alert-modal-body {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 24px;
            line-height: 1.6;
        }
        .alert-modal-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        .alert-modal-btn:hover { background: var(--primary-dark); }
        .alert-modal-btn:focus {
            box-shadow: 0 0 0 3px rgba(36, 172, 185, 0.4);
            outline: none;
        }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NYBL2CDNQJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NYBL2CDNQJ');
    </script>

    <script>
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredPrompt = e;
            const pwaInstall = document.getElementById('pwa-install-btn');
            if (pwaInstall) pwaInstall.style.display = 'flex';
        });

        document.addEventListener('DOMContentLoaded', () => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'script';
            link.href = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
            document.head.appendChild(link);
        });
    </script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="https_www.finguid.com" class="logo">
                    <span role="img" aria-label="Money bag emoji">üí∞</span>
                    <span>FinGuid USA</span>
                </a>
                
                <span class="calculator-title">AI IRA Optimizer</span>

                <div class="header-features" aria-hidden="true">
                    <span class="header-feature-item">ü§ñ AI Insights</span>
                    <span class="header-feature-item">‚öñÔ∏è Roth vs. Traditional</span>
                    <span class="header-feature-item">üìà Live Inflation Data</span>
                    <span class="header-feature-item">üí° Tax Analysis</span>
                </div>

                <div class="header-controls">
                    <button type="button" id="pwa-install-btn" aria-label="Install App" title="Install App">üì± Install</button>
                    <button type="button" class="icon-btn" id="darkModeToggle" aria-label="Toggle dark mode" title="Dark/Light Mode"><i class="fas fa-sun"></i></button>
                    <button type="button" class="icon-btn" id="voiceToggle" aria-label="Voice control" title="Voice Commands"><i class="fas fa-microphone"></i></button>
                    <button type="button" class="icon-btn" id="ttsToggle" aria-label="Text to speech" title="Read Results"><i class="fas fa-volume-up"></i></button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="sponsor-banner">
        <span class="sponsor-text">üéÅ Open an IRA today and get up to $100 in bonus stock.</span>
        <div class="sponsor-buttons">
            <button type="button" class="sponsor-btn" onclick="app.trackAffiliateClick('Open IRA')">View Brokers ‚Üí</button>
            <button type="button" class="sponsor-btn" onclick="app.trackAffiliateClick('Become Partner')">Become a Partner ‚Üí</button>
        </div>
    </div>

    <main class="container" role="main">
        <div class="calculator-wrapper">
            
            <section class="inputs-panel" role="region" aria-labelledby="inputs-title">
                <h2 class="panel-title" id="inputs-title"><i class="fas fa-sliders-h"></i> Your Profile & Strategy</h2>

                <form id="ira-form" aria-label="IRA Calculator Form" novalidate>
                    
                    <div class="section-heading">üë§ Personal Information</div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="current-age">Current Age
                                <span class="tooltip" data-tooltip="Your age as of today. Used to determine catch-up contribution eligibility." tabindex="0" role="tooltip" id="tooltip-age">
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="current-age" value="35" min="18" max="100" aria-label="Current Age" aria-describedby="tooltip-age" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="retirement-age">Retirement Age
                                <span class="tooltip" data-tooltip="Age you plan to retire. Must be 59.5 or older for penalty-free withdrawals." tabindex="0" role="tooltip" id="tooltip-retire-age">
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="retirement-age" value="67" min="59" max="100" aria-label="Retirement Age" aria-describedby="tooltip-retire-age" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="annual-income">Annual Gross Income
                            <span class="tooltip" data-tooltip="Your total income before taxes. Used to calculate tax rates and Roth IRA eligibility." tabindex="0" role="tooltip" id="tooltip-income">$
                                <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                            </span>
                        </label>
                        <div class="input-wrapper">
                            <span class="input-addon" aria-hidden="true">$</span>
                            <input type="text" id="annual-income" value="85,000" inputmode="numeric" aria-label="Annual Gross Income" aria-describedby="tooltip-income" required>
                        </div>
                    </div>

                    <div class="form-row">
                         <div class="form-group">
                            <label class="form-label" for="filing-status">Filing Status
                                <span class="tooltip" data-tooltip="Your tax filing status. This determines your tax brackets and IRA eligibility limits." tabindex="0" role="tooltip" id="tooltip-status">
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <select id="filing-status" aria-label="Filing Status" aria-describedby="tooltip-status" required>
                                <option value="Single" selected>Single</option>
                                <option value="Married Filing Jointly">Married Filing Jointly</option>
                                <option value="Head of Household">Head of Household</option>
                                <option value="Married Filing Separately">Married Filing Separately</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="income-growth">Income Growth
                                <span class="tooltip" data-tooltip="Your expected average annual salary increase." tabindex="0" role="tooltip" id="tooltip-growth">%
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="income-growth" value="3" min="0" max="20" step="0.5" aria-label="Annual Income Growth" aria-describedby="tooltip-growth" required>
                                <span class="input-addon" aria-hidden="true">%</span>
                            </div>
                        </div>
                    </div>

                    <div class="section-heading">üéØ IRA Strategy</div>
                    
                    <div class="form-group">
                        <label class="form-label" for="ira-type">Choose Strategy</label>
                        <select id="ira-type" aria-label="Choose Strategy" required>
                            <option value="roth">Roth IRA (Tax-Free Growth)</option>
                            <option value="traditional">Traditional IRA (Tax Deductible)</option>
                            <option value="compare" selected>Compare Both Strategies</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="annual-contribution">Annual Contribution
                             <span class="tooltip" data-tooltip="The amount you plan to contribute each year. This will be capped at the IRS limit." tabindex="0" role="tooltip" id="tooltip-contrib">$
                                <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                            </span>
                        </label>
                        <div class="input-wrapper">
                            <span class="input-addon" aria-hidden="true">$</span>
                            <input type="text" id="annual-contribution" value="7,000" inputmode="numeric" aria-label="Annual Contribution" aria-describedby="tooltip-contrib" required>
                        </div>
                        <span class="fred-source-note" id="contribution-limit-note">2024 Limit: $7,000 (Under 50)</span>
                    </div>

                    <div class="section-heading">üìà Investment & Assumptions</div>

                    <div class="form-group">
                        <label class="form-label" for="current-balance">Current IRA Balance
                            <span class="tooltip" data-tooltip="The total amount you already have saved in your IRAs." tabindex="0" role="tooltip" id="tooltip-balance">$
                                <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                            </span>
                        </label>
                        <div class="input-wrapper">
                            <span class="input-addon" aria-hidden="true">$</span>
                            <input type="text" id="current-balance" value="25,000" inputmode="numeric" aria-label="Current IRA Balance" aria-describedby="tooltip-balance" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="return-rate">Expected Return
                                <span class="tooltip" data-tooltip="Your estimated average annual return on investment." tabindex="0" role="tooltip" id="tooltip-return">%
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="return-rate" value="7" min="-10" max="20" step="0.5" aria-label="Expected Return" aria-describedby="tooltip-return" required>
                                <span class="input-addon" aria-hidden="true">%</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="inflation-rate">Est. Inflation
                                 <span class="tooltip" data-tooltip="Assumed long-term inflation rate. We pre-fill this with live FRED data." tabindex="0" role="tooltip" id="tooltip-inflation">%
                                    <span class="tooltip-icon" role="img" aria-label="Info">i</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="inflation-rate" value="2.5" min="0" max="10" step="0.1" aria-label="Estimated Inflation Rate" aria-describedby="tooltip-inflation" required>
                                <span class="input-addon" aria-hidden="true">%</span>
                            </div>
                        </div>
                    </div>
                    <span class="fred-source-note">
                        Inflation pre-filled via <a href="https://fred.stlouisfed.org/" target="_blank" rel="noopener">FRED¬Æ</a> (Requirement 2 & 8)
                    </span>
                    
                    <aside class="ad-slot" role="complementary" aria-label="Sponsored Advertisement">
                        <p class="ad-label">SPONSORED PRODUCT</p>
                        <div class="ad-placeholder">
                            <strong>Open Your IRA Today</strong><br>
                            Low-Cost Broker ‚Ä¢ Zero Setup Fees ‚Ä¢ Expert Support
                        </div>
                    </aside>

                    <button type="submit" class="primary-button" id="calculate-button">
                        <i class="fas fa-calculator"></i> Calculate & Analyze
                    </button>
                </form>
            </section>

            <section class="results-panel" role="region" aria-labelledby="results-title">
                <h2 class="panel-title" id="results-title">üìä Analysis & Results</h2>

                <div class="summary-card">
                    <div class="summary-label">Projected Balance at Retirement</div>
                    <div class="payment-amount">
                        <span class="amount" id="projected-total" aria-live="polite">$0</span>
                    </div>
                    <div class="payment-breakdown" id="projection-summary" aria-live="polite">
                        Calculating...
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab-buttons" role="tablist" aria-label="Results sections">
                        <button type="button" class="tab-btn active" role="tab" aria-controls="tab-comparison" aria-selected="true" id="tab-btn-comparison">‚öñÔ∏è Roth vs Traditional</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="tab-projection" aria-selected="false" id="tab-btn-projection" tabindex="-1">üìä Projection</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="tab-tax-analysis" aria-selected="false" id="tab-btn-tax" tabindex="-1">üí≥ Tax Analysis</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="tab-limits" aria-selected="false" id="tab-btn-limits" tabindex="-1">üìã Limits & Rules</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="tab-ai-insights" aria-selected="false" id="tab-btn-insights" tabindex="-1">ü§ñ AI Insights</button>
                        <button type="button" class="tab-btn" role="tab" aria-controls="tab-schedule" aria-selected="false" id="tab-btn-schedule" tabindex="-1">üìÖ Year Schedule</button>
                    </div>

                    <div class="tab-content active" id="tab-comparison" role="tabpanel" aria-labelledby="tab-btn-comparison" tabindex="0">
                        <h3 class="results-heading">Roth vs. Traditional (Net Retirement Value)</h3>
                        <div class="chart-container">
                            <canvas id="comparison-canvas" role="img" aria-label="Bar chart comparing the after-tax value of a Roth IRA vs. a Traditional IRA at retirement."></canvas>
                        </div>
                        <div class="summary-details">
                            <div class="detail-item success">
                                <span class="detail-label">Roth IRA Value (Tax-Free)</span>
                                <span class="detail-value" id="roth-balance-val">$0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Traditional IRA (Net Value)</span>
                                <span class="detail-value" id="trad-balance-val">$0</span>
                            </div>
                            <div class="detail-item detail-total" id="roth-advantage-box">
                                <span class="detail-label">Roth Advantage</span>
                                <span class="detail-value" id="roth-advantage-val">+$0</span>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-projection" role="tabpanel" aria-labelledby="tab-btn-projection" tabindex="0">
                        <h3 class="results-heading">Balance Growth Projection</h3>
                        <div class="chart-container">
                            <canvas id="projection-canvas" role="img" aria-label="Line chart showing total IRA balance, contributions, and growth projected over time."></canvas>
                        </div>
                        <div class="summary-details">
                            <div class="detail-item">
                                <span class="detail-label">Total Contributions</span>
                                <span class="detail-value" id="total-contributions">$0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Investment Growth</span>
                                <span class="detail-value" id="total-growth">$0</span>
                            </div>
                            <div class="detail-item detail-total">
                                <span class="detail-label">Final Balance</span>
                                <span class="detail-value" id="retirement-balance">$0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="tab-tax-analysis" role="tabpanel" aria-labelledby="tab-btn-tax" tabindex="0">
                        <h3 class="results-heading">Tax Impact Analysis</h3>
                        <div class="summary-details">
                            <div class="detail-item">
                                <span class="detail-label">Current Marginal Tax Rate</span>
                                <span class="detail-value" id="current-tax-rate">0%</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Est. Retirement Tax Rate</span>
                                <span class="detail-value" id="retirement-tax-rate">0%</span>
                            </div>
                            <div class="detail-item success">
                                <span class="detail-label">Annual Tax Savings (Trad.)</span>
                                <span class="detail-value" id="annual-tax-savings">$0</span>
                            </div>
                            <div class="detail-item success">
                                <span class="detail-label">Lifetime Tax-Free Growth (Roth)</span>
                                <span class="detail-value" id="roth-tax-free-growth">$0</span>
                            </div>
                        </div>
                        <div class="insight-box info">
                            <strong>Tax Bracket Note:</strong> Your tax rate is key. If you expect to be in a *lower* tax bracket in retirement, a Traditional IRA's upfront deduction is often better. If you expect to be in a *higher* bracket (or the same), a Roth IRA's tax-free withdrawals are usually more valuable.
                        </div>
                    </div>

                    <div class="tab-content" id="tab-limits" role="tabpanel" aria-labelledby="tab-btn-limits" tabindex="0">
                        <h3 class="results-heading">2024 IRA Contribution & Deduction Limits</h3>
                        <div class="summary-details">
                            <div class="detail-item">
                                <span class="detail-label">Your Annual Limit (Age < 50)</span>
                                <span class="detail-value" id="limit-standard">$7,000</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Catch-Up (Age 50+)</span>
                                <span class="detail-value" id="limit-catchup">$1,000</span>
                            </div>
                            <div class="detail-item detail-total">
                                <span class="detail-label">Your Max Contribution</span>
                                <span class="detail-value" id="your-max-contrib">$0</span>
                            </div>
                        </div>
                        <h3 class="results-heading">2024 MAGI Phase-Outs (Eligibility)</h3>
                         <div class="summary-details">
                            <div class="detail-item" id="roth-eligibility-box">
                                <span class="detail-label">Roth Eligibility (Your Income)</span>
                                <span class="detail-value" id="roth-eligibility-val">100%</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Roth Phase-Out (Your Status)</span>
                                <span class="detail-value" id="roth-phaseout-range">$0k - $0k</span>
                            </div>
                            <div class="detail-item" id="trad-deduction-box">
                                <span class="detail-label">Trad. Deduction (If Covered*)</span>
                                <span class="detail-value" id="trad-deduction-val">100%</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Trad. Phase-Out (If Covered*)</span>
                                <span class="detail-value" id="trad-phaseout-range">$0k - $0k</span>
                            </div>
                        </div>
                        <div class="insight-box info">
                            *Traditional IRA deduction limits only apply if you (or your spouse) are covered by a retirement plan at work. If not, you can deduct your full contribution regardless of income.
                        </div>
                    </div>

                    <div class="tab-content" id="tab-ai-insights" role="tabpanel" aria-labelledby="tab-btn-insights" tabindex="0">
                         <h3 class="results-heading">ü§ñ AI-Powered Insights</h3>
                        <div class="insights-container" id="ai-insights-content" aria-live="polite">
                            <div class="insight-box info">
                                <strong>ü§ñ AI Advisor:</strong> Enter your details to generate personalized insights...
                            </div>
                        </div>
                        <aside class="ad-slot" role="complementary" aria-label="Sponsor Advertisement" style="margin-top: 24px;">
                            <p class="ad-label">SPONSORED ADVISOR</p>
                            <div class="ad-placeholder">Need a custom plan? Connect with a Vetted US Financial Advisor.</div>
                        </aside>
                    </div>

                    <div class="tab-content" id="tab-schedule" role="tabpanel" aria-labelledby="tab-btn-schedule" tabindex="0">
                        <h3 class="results-heading">Year-by-Year Projection</h3>
                        <div class="table-scroll-wrapper">
                            <table class="styled-table" id="projection-table" aria-label="Yearly IRA Projection Schedule">
                                <caption class="visually-hidden">Detailed projection schedule showing age, contribution, gains, and end balance for each year.</caption>
                                <thead>
                                    <tr>
                                        <th>Age</th>
                                        <th>Contribution</th>
                                        <th>Gains</th>
                                        <th>End Balance</th>
                                        <th>Tax Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <section class="footer-sponsor" id="our-partners" aria-labelledby="partners-title">
            <div class="container">
                <h3 id="partners-title" style="text-align: center; margin-bottom: 24px; color: var(--primary); font-size: 24px; font-weight: 700;">Our Partners</h3>
                <div class="sponsor-grid">
                    <div class="sponsor-item">
                        <h4>üìà Low-Fee IRA Brokers</h4>
                        <p>Open a Roth or Traditional IRA with our top-rated, low-fee broker partners. Get started in minutes.</p>
                        <a href="#affiliate-link-1" onclick="app.trackAffiliateClick('Broker Partners'); return false;" aria-label="Compare Rates for IRA Brokers">Compare Brokers ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4>ü§ñ Robo-Advisors</h4>
                        <p>Let experts build and manage your IRA portfolio for you. Low fees and automated rebalancing.</p>
                        <a href="#affiliate-link-2" onclick="app.trackAffiliateClick('Robo-Advisors'); return false;" aria-label="Compare Robo-Advisor platforms">Compare Platforms ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4>ü§ù Financial Advisor Match</h4>
                        <p>Connect with a pre-vetted, fiduciary financial advisor in your state to build a custom retirement plan.</p>
                        <a href="#affiliate-link-3" onclick="app.trackAffiliateClick('Advisor Match'); return false;" aria-label="Get Matched with a Financial Advisor">Get Matched ‚Üí</a>
                    </div>
                    <div class="sponsor-item">
                        <h4>üîÑ 401(k) Rollover Service</h4>
                        <p>Have an old 401(k)? Easily roll it over into a new IRA penalty-free to consolidate your accounts.</p>
                        <a href="#affiliate-link-4" onclick="app.trackAffiliateClick('Rollover Service'); return false;" aria-label="View Plans for 401(k) Rollover Services">Start Rollover ‚Üí</a>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="faq-section" aria-labelledby="faq-title">
            <h2 class="faq-title" id="faq-title">‚ùì Frequently Asked Questions (FAQ)</h2>
            <div class="faq-container" id="faqContainer">
                </div>
        </section>

        <footer class="footer" role="contentinfo">
            <div class="container">
                <div class="footer-content">
                    <nav class="footer-section" role="navigation" aria-label="About this calculator">
                        <h4>About IRA Calculator</h4>
                        <a href="#how-it-works">How It Works</a>
                        <a href="#features">Features</a>
                        <a href="#faq">FAQ</a>
                        <a href="#contact">Contact Us</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Learn more about retirement">
                        <h4>Learn More</h4>
                        <a href="#what-is-ira">What is an IRA?</a>
                        <a href="#roth-vs-trad">Roth vs. Traditional</a>
                        <a href="#magi-limits">MAGI Limits</a>
                        <a href="#blog">Blog</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Financial resources">
                        <h4>Other Calculators</h4>
                        <a href="/mortgage-calculator">Mortgage Calculator</a>
                        <a href="/401k-calculator">401(k) Calculator</a>
                        <a href="#tools">Financial Tools</a>
                        <a href="#glossary">Glossary</a>
                    </nav>
                    <nav class="footer-section" role="navigation" aria-label="Legal links">
                        <h4>Legal</h4>
                        <a href="#privacy">Privacy Policy</a>
                        <a href="#terms">Terms of Service</a>
                        <a href="#disclaimer">Disclaimer</a>
                        <a href="#affiliate">Affiliate Disclosure</a>
                    </nav>
                </div>

                <div class="compliance-badges" role="list" aria-label="Compliance Badges">
                    <span class="badge" role="listitem">üîí SSL Secured</span>
                    <span class="badge" role="listitem">‚úÖ GDPR Compliant</span>
                    <span class="badge" role="listitem">‚úÖ CCPA Compliant</span>
                    <span class="badge" role="listitem">‚úÖ FTC Compliant</span>
                    <span class="badge" role="listitem">‚ôø WCAG 2.1 AA</span>
                </div>

                <section class="disclaimer" aria-label="Disclaimers and Disclosures">
                    <strong>Educational & Informational Only (Disclaimer):</strong> This IRA calculator is for educational and illustrative purposes only. It is NOT financial, legal, or investment advice. Projections are based on user inputs and assumptions (e.g., return rates, inflation, tax rates) which are hypothetical and not guaranteed. Actual results will vary.
                    <br><br>
                    <strong>No Financial Advice:</strong> FinGuid USA is not a Registered Investment Adviser (RIA) or fiduciary. All information is provided for informational purposes only. You must consult with a qualified financial advisor, tax professional, or fiduciary before making any financial decisions.
                    <br><br>
                    <strong>Privacy Policy (GLBA):</strong> We are committed to protecting your privacy. This calculator is a client-side tool; your personal financial data is not stored or transmitted to our servers. Please review our full <a href="#privacy">Privacy Policy</a> for details on what anonymous data we collect (like usage analytics via Google) and how it is protected, in compliance with the Gramm-Leach-Bliley Act (GLBA).
                    <br><br>
                    <strong>Affiliate Disclosure (FTC):</strong> FinGuid USA monetizes through affiliate marketing and advertising (Requirement 1). When you click on partner links (e.g., for brokers or advisors) and apply for products, we may receive compensation. This does not affect your rates or terms and helps us provide these free AI-powered tools.
                    <br><A>
                    <strong>Data Accuracy (FRED):</strong> Inflation data (CPIAUCSL) is sourced from the Federal Reserve Bank of St. Louis (FRED¬Æ). While we strive for accuracy, we make no guarantees. All data is provided "as is." (Requirement 2 & 8).
                    <br><br>
                    <strong>Recordkeeping (SEC Rule 204-2):</strong> As a financial information publisher, we maintain records of our website content as required by applicable regulations. This does not include your personal calculation inputs.
                </section>

                <div class="footer-bottom">
                    ¬© 2025 FinGuid USA. All Rights Reserved. | AI-Powered Financial Tools for Americans
                </div>
            </div>
        </footer>
    </main>

    <div id="cookie-consent-banner" role="dialog" aria-modal="true" aria-labelledby="cookie-consent-title" aria-describedby="cookie-consent-desc">
        <div class="cookie-consent-text">
            <h4 id="cookie-consent-title" style="font-weight: 700; color: var(--text); margin-bottom: 8px;">Your Privacy</h4>
            <p id="cookie-consent-desc">
                We use cookies and data (like Google Analytics) to enhance your experience, improve our tools, and provide personalized AI insights. By clicking "Accept", you agree to our use of cookies.
                <a href="#privacy" aria-label="Read our Privacy Policy">Privacy Policy</a>.
            </p>
        </div>
        <button type="button" id="cookie-consent-btn">Accept</button>
    </div>

    <div class="alert-modal-backdrop" id="alert-modal-backdrop"></div>
    <div class="alert-modal" id="alert-modal" role="alertdialog" aria-modal="true" aria-labelledby="alert-modal-title" aria-describedby="alert-modal-body">
        <h4 class="alert-modal-title" id="alert-modal-title">Alert</h4>
        <p class="alert-modal-body" id="alert-modal-body">
            This is an alert message.
        </p>
        <button type="button" class="alert-modal-btn" id="alert-modal-close">Close</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        /**
         * ========================================================================
         * AI IRA OPTIMIZER - PRODUCTION READY
         * ========================================================================
         * Version: 2.0 - 100% COMPLIANT
         * Built with: S.O.L.I.D Principles, WCAG 2.1 AA, PWA, GDPR/CCPA
         *
         * This file merges the IRA calculator's logic into the mortgage
         * calculator's advanced, compliant shell (app controller, UI, etc.).
         * ========================================================================
         */

        // ===== MAIN APP CONTROLLER (From Mortgage Shell) =====
        const app = {
            calculateDebounce: null,
            lastResults: null,
            state: {
                isTtsEnabled: false,
                isVoiceActive: false,
                recognition: null,
                synthesizer: null,
            },

            // ===== IRA Module (Contains all logic from ira-calculator.js) =====
            IRA: {
                // (Requirement 8)
                CONFIG: {
                    FRED_API_KEY: '9c6c421f077f2091e8bae4f143ada59a',
                    FRED_BASE_URL: 'https://api.stlouisfed.org/fred/series/observations',
                    FRED_SERIES_ID: 'CPIAUCSL', // Inflation Data (Requirement 2)
                    
                    // 2024 IRA Contribution Limits
                    CONTRIBUTION_LIMIT: 7000,
                    CATCHUP_LIMIT: 1000,
                    
                    // 2024 MAGI Phaseout Ranges
                    ROTH_PHASEOUT: {
                        'Single': { start: 146000, end: 161000 },
                        'Married Filing Jointly': { start: 230000, end: 240000 },
                        'Head of Household': { start: 146000, end: 161000 }, // Using Single's for HoH
                        'Married Filing Separately': { start: 0, end: 10000 }
                    },
                    
                    // Traditional IRA Deduction Phaseout (Assumes covered by workplace plan)
                    TRAD_PHASEOUT: {
                        'Single': { start: 77000, end: 87000 },
                        'Married Filing Jointly': { start: 123000, end: 143000 }, // Note: 123-143k for 2024
                        'Head of Household': { start: 77000, end: 87000 }, // No specific HoH, use Single
                        'Married Filing Separately': { start: 0, end: 10000 }
                    },
                    
                    // 2024 Tax Brackets
                    TAX_BRACKETS: {
                        'Single': [
                            { limit: 11600, rate: 0.10 }, { limit: 47150, rate: 0.12 },
                            { limit: 100525, rate: 0.22 }, { limit: 191950, rate: 0.24 },
                            { limit: 243725, rate: 0.32 }, { limit: 609350, rate: 0.35 },
                            { limit: Infinity, rate: 0.37 }
                        ],
                        'Married Filing Jointly': [
                            { limit: 23200, rate: 0.10 }, { limit: 94300, rate: 0.12 },
                            { limit: 201050, rate: 0.22 }, { limit: 383900, rate: 0.24 },
                            { limit: 487450, rate: 0.32 }, { limit: 731200, rate: 0.35 },
                            { limit: Infinity, rate: 0.37 }
                        ],
                        'Head of Household': [
                            { limit: 16550, rate: 0.10 }, { limit: 63100, rate: 0.12 },
                            { limit: 100500, rate: 0.22 }, { limit: 191950, rate: 0.24 },
                            { limit: 243700, rate: 0.32 }, { limit: 609350, rate: 0.35 },
                            { limit: Infinity, rate: 0.37 }
                        ],
                        'Married Filing Separately': [
                            { limit: 11600, rate: 0.10 }, { limit: 47150, rate: 0.12 },
                            { limit: 100525, rate: 0.22 }, { limit: 191950, rate: 0.24 },
                            { limit: 243725, rate: 0.32 }, { limit: 609350, rate: 0.35 },
                            { limit: Infinity, rate: 0.37 }
                        ]
                    },
                    charts: { projection: null, comparison: null },
                    calculation: { projection: [], totals: {}, inputs: {} },
                    liveInflationRate: 0.025 // Default fallback
                },

                // Get Marginal Tax Rate
                getTaxRate(income, filingStatus) {
                    const brackets = this.CONFIG.TAX_BRACKETS[filingStatus] || this.CONFIG.TAX_BRACKETS['Single'];
                    for (const bracket of brackets) {
                        if (income <= bracket.limit) return bracket.rate;
                    }
                    return 0.37;
                },

                // Check Roth Eligibility (0 to 1)
                checkRothEligibility(magi, filingStatus) {
                    const phaseout = this.CONFIG.ROTH_PHASEOUT[filingStatus];
                    if (magi < phaseout.start) return 1.0;
                    if (magi >= phaseout.end) return 0.0;
                    const reduction = (magi - phaseout.start) / (phaseout.end - phaseout.start);
                    return Math.max(0, 1 - reduction);
                },

                // Check Traditional Deduction Eligibility (0 to 1)
                checkTradDeduction(magi, filingStatus) {
                    const phaseout = this.CONFIG.TRAD_PHASEOUT[filingStatus];
                    if (magi < phaseout.start) return 1.0;
                    if (magi >= phaseout.end) return 0.0;
                    const reduction = (magi - phaseout.start) / (phaseout.end - phaseout.start);
                    return Math.max(0, 1 - reduction);
                },

                // Main Calculation Engine
                calculate() {
                    const inputs = {
                        age: app.UTILS.parseInput('current-age', false),
                        filingStatus: document.getElementById('filing-status').value,
                        income: app.UTILS.parseInput('annual-income', true),
                        incomeGrowth: app.UTILS.parseInput('income-growth', false) / 100,
                        iraType: document.getElementById('ira-type').value,
                        contribution: app.UTILS.parseInput('annual-contribution', true),
                        currentBalance: app.UTILS.parseInput('current-balance', true),
                        returnRate: app.UTILS.parseInput('return-rate', false) / 100,
                        retirementAge: app.UTILS.parseInput('retirement-age', false),
                        inflationRate: app.UTILS.parseInput('inflation-rate', false) / 100 || this.CONFIG.liveInflationRate
                    };

                    // WCAG 3.3.4: Error Prevention (Requirement 10)
                    if (inputs.age >= inputs.retirementAge) {
                        app.showAlert('Input Error', 'Current Age must be less than Retirement Age.');
                        return false;
                    }
                    if (inputs.retirementAge < 59.5) {
                         app.showAlert('Input Error', 'Retirement Age must be 59.5 or older for penalty-free withdrawals.');
                         return false;
                    }

                    // Real return rate (inflation-adjusted)
                    const realReturn = ((1 + inputs.returnRate) / (1 + inputs.inflationRate)) - 1;

                    // Generate projection
                    let rothBalance = inputs.currentBalance;
                    let tradBalance = inputs.currentBalance;
                    let totalContrib = 0;
                    let totalGains = 0;
                    let totalTaxSavings = 0; // Tax saved from traditional contributions
                    const projection = [];
                    
                    const years = inputs.retirementAge - inputs.age;

                    for (let i = 0; i < years; i++) {
                        const currentAge = inputs.age + i;
                        const yearlyIncome = inputs.income * Math.pow(1 + inputs.incomeGrowth, i);
                        
                        // Calculate contribution limit
                        let maxContribution = this.CONFIG.CONTRIBUTION_LIMIT;
                        if (currentAge >= 50) {
                            maxContribution += this.CONFIG.CATCHUP_LIMIT;
                        }
                        
                        // Calculate eligibility
                        const rothEligibility = this.checkRothEligibility(yearlyIncome, inputs.filingStatus);
                        const tradDeductionEligibility = this.checkTradDeduction(yearlyIncome, inputs.filingStatus);
                        
                        // Cap contribution at user input AND IRS limit
                        let contrib = Math.min(inputs.contribution, maxContribution);
                        
                        // Calculate Roth Contribution
                        const rothContrib = contrib * rothEligibility;
                        const rothGains = (rothBalance + rothContrib / 2) * realReturn;
                        rothBalance += rothContrib + rothGains;
                        
                        // Calculate Traditional Contribution
                        const tradContrib = contrib; // Can always contribute, just may not be deductible
                        const tradGains = (tradBalance + tradContrib / 2) * realReturn;
                        tradBalance += tradContrib + tradGains;

                        // Calculate tax savings
                        const currentTaxRate = this.getTaxRate(yearlyIncome, inputs.filingStatus);
                        const deductiblePortion = tradContrib * tradDeductionEligibility;
                        totalTaxSavings += (deductiblePortion * currentTaxRate);

                        if (i === 0) {
                            inputs.firstYearTaxRate = currentTaxRate;
                            inputs.firstYearTaxSavings = (deductiblePortion * currentTaxRate);
                            inputs.firstYearRothEligibility = rothEligibility;
                            inputs.firstYearTradDeduction = tradDeductionEligibility;
                        }

                        // For single-type projection
                        if (inputs.iraType === 'roth') {
                            totalGains += rothGains;
                            totalContrib += rothContrib;
                        } else {
                            totalGains += tradGains;
                            totalContrib += tradContrib;
                        }

                        projection.push({
                            age: currentAge,
                            contribution: (inputs.iraType === 'roth') ? rothContrib : tradContrib,
                            gains: (inputs.iraType === 'roth') ? rothGains : tradGains,
                            balance: (inputs.iraType === 'roth') ? rothBalance : tradBalance,
                            taxRate: currentTaxRate
                        });
                    }

                    // Estimate retirement tax rate (assuming 70% of final salary as income)
                    const finalSalary = inputs.income * Math.pow(1 + inputs.incomeGrowth, years);
                    const retirementIncome = finalSalary * 0.7;
                    const retirementTaxRate = this.getTaxRate(retirementIncome, inputs.filingStatus);

                    // Calculate final net values
                    const finalRothValue = rothBalance; // No tax
                    const finalTradValueNet = tradBalance * (1 - retirementTaxRate); // Taxed on withdrawal

                    this.CONFIG.calculation = {
                        projection,
                        inputs,
                        totals: {
                            finalBalance: (inputs.iraType === 'roth') ? finalRothValue : tradBalance,
                            totalContrib,
                            totalGains,
                            rothBalance: finalRothValue,
                            tradBalanceNet: finalTradValueNet,
                            tradBalanceGross: tradBalance,
                            totalTaxSavings,
                            retirementTaxRate,
                            advantage: finalRothValue - finalTradValueNet,
                            maxContribution: maxContribution
                        }
                    };
                    return true;
                },

                // Main UI Update Controller
                updateUI() {
                    try {
                        const success = this.calculate();
                        if (!success) return; // Stop if validation failed

                        const { inputs, totals } = this.CONFIG.calculation;
                        const fmtd = app.UTILS.formatCurrency;

                        // Update summary card
                        document.getElementById('projected-total').textContent = fmtd(totals.finalBalance, 0);
                        let summaryText = `Your Cont: ${fmtd(totals.totalContrib, 0)} | Growth: ${fmtd(totals.totalGains, 0)}`;
                        if (inputs.iraType === 'compare') {
                             summaryText = `Roth (Net): ${fmtd(totals.rothBalance, 0)} | Trad (Net): ${fmtd(totals.tradBalanceNet, 0)}`;
                        }
                        document.getElementById('projection-summary').innerHTML = summaryText;

                        // Update tabs
                        this.updateCharts();
                        this.updateDetailsTab();
                        this.updateTaxAnalysis();
                        this.updateContributionLimits();
                        this.updateSchedule();
                        this.generateAIInsights();
                        
                        // Track event (Requirement 7)
                        app.trackEvent('ira_calculation', {
                            ira_type: inputs.iraType,
                            annual_income: inputs.income,
                            projected_balance: totals.finalBalance,
                            final_age: inputs.retirementAge
                        });
                        
                        // Speak results if TTS is on
                        app.speak(`Calculation complete. Your projected total is ${fmtd(totals.finalBalance, 0)}.`);

                    } catch (error) {
                        console.error('Calculation error:', error);
                        app.showAlert('Calculation Error', 'An error occurred. Please check your inputs.');
                    }
                },

                // Update "Projection" Tab
                updateDetailsTab() {
                    const { totals } = this.CONFIG.calculation;
                    document.getElementById('total-contributions').textContent = app.UTILS.formatCurrency(totals.totalContrib, 0);
                    document.getElementById('total-growth').textContent = app.UTILS.formatCurrency(totals.totalGains, 0);
                    document.getElementById('retirement-balance').textContent = app.UTILS.formatCurrency(totals.finalBalance, 0);
                },

                // Update "Tax Analysis" Tab
                updateTaxAnalysis() {
                    const { inputs, totals } = this.CONFIG.calculation;
                    document.getElementById('current-tax-rate').textContent = `${(inputs.firstYearTaxRate * 100).toFixed(1)}%`;
                    document.getElementById('retirement-tax-rate').textContent = `${(totals.retirementTaxRate * 100).toFixed(1)}%`;
                    document.getElementById('annual-tax-savings').textContent = app.UTILS.formatCurrency(inputs.firstYearTaxSavings, 0);
                    document.getElementById('roth-tax-free-growth').textContent = app.UTILS.formatCurrency(totals.totalGains, 0); // Note: This is simplified
                },

                // Update "Limits & Rules" Tab
                updateContributionLimits() {
                    const { inputs } = this.CONFIG.calculation;
                    const { filingStatus } = inputs;
                    
                    const rothPhaseout = this.CONFIG.ROTH_PHASEOUT[filingStatus];
                    const tradPhaseout = this.CONFIG.TRAD_PHASEOUT[filingStatus];
                    
                    document.getElementById('your-max-contrib').textContent = app.UTILS.formatCurrency(inputs.maxContribution, 0);
                    document.getElementById('limit-standard').textContent = app.UTILS.formatCurrency(this.CONFIG.CONTRIBUTION_LIMIT, 0);
                    document.getElementById('limit-catchup').textContent = app.UTILS.formatCurrency(this.CONFIG.CATCHUP_LIMIT, 0);

                    document.getElementById('roth-eligibility-val').textContent = `${(inputs.firstYearRothEligibility * 100).toFixed(0)}%`;
                    document.getElementById('roth-phaseout-range').textContent = `$${rothPhaseout.start/1000}k - $${rothPhaseout.end/1000}k`;
                    document.getElementById('trad-deduction-val').textContent = `${(inputs.firstYearTradDeduction * 100).toFixed(0)}%`;
                    document.getElementById('trad-phaseout-range').textContent = `$${tradPhaseout.start/1000}k - $${tradPhaseout.end/1000}k`;

                    // Add warning/success colors
                    document.getElementById('roth-eligibility-box').className = inputs.firstYearRothEligibility > 0 ? 'detail-item success' : 'detail-item warning';
                    document.getElementById('trad-deduction-box').className = inputs.firstYearTradDeduction > 0 ? 'detail-item success' : 'detail-item warning';
                },

                // Update "Yearly Schedule" Tab
                updateSchedule() {
                    const { projection } = this.CONFIG.calculation;
                    const tbody = document.querySelector('#projection-table tbody');
                    if (!tbody) return;
                    
                    tbody.innerHTML = '';
                    projection.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.age}</td>
                            <td>${app.UTILS.formatCurrency(item.contribution, 0)}</td>
                            <td>${app.UTILS.formatCurrency(item.gains, 0)}</td>
                            <td>${app.UTILS.formatCurrency(item.balance, 0)}</td>
                            <td>${(item.taxRate * 100).toFixed(1)}%</td>
                        `;
                        tbody.appendChild(row);
                    });
                },

                // Update All Charts
                updateCharts() {
                    const { projection, totals, inputs } = this.CONFIG.calculation;
                    if (projection.length === 0) return;

                    const themeColor = document.documentElement.getAttribute('data-color-scheme') === 'dark' ? '#E1E8ED' : '#1F2121';
                    const gridColor = document.documentElement.getAttribute('data-color-scheme') === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                    
                    // Chart 1: Projection Chart
                    const ctx1 = document.getElementById('projection-canvas')?.getContext('2d');
                    if (ctx1) {
                        const labels = projection.map(p => p.age);
                        const balances = projection.map(p => p.balance);
                        const contribs = projection.reduce((acc, p) => { acc.push((acc.length > 0 ? acc[acc.length - 1] : 0) + p.contribution); return acc; }, []);

                        if (this.CONFIG.charts.projection) this.CONFIG.charts.projection.destroy();

                        this.CONFIG.charts.projection = new Chart(ctx1, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: 'Total Balance',
                                        data: balances,
                                        borderColor: 'var(--primary)',
                                        backgroundColor: 'rgba(36, 172, 185, 0.1)',
                                        fill: true,
                                        borderWidth: 3,
                                    },
                                    {
                                        label: 'Total Contributions',
                                        data: contribs,
                                        borderColor: 'var(--primary-dark)',
                                        fill: false,
                                        borderDash: [5, 5],
                                        borderWidth: 2
                                    }
                                ]
                            },
                            options: {
                                responsive: true, maintainAspectRatio: false,
                                plugins: { legend: { position: 'top', labels: { color: themeColor } } },
                                scales: {
                                    y: { ticks: { color: themeColor, callback: (v) => app.UTILS.formatCurrency(v, 0) }, grid: { color: gridColor } },
                                    x: { ticks: { color: themeColor }, grid: { color: gridColor } }
                                }
                            }
                        });
                    }

                    // Chart 2: Comparison Chart
                    const ctx2 = document.getElementById('comparison-canvas')?.getContext('2d');
                    if (ctx2) {
                        if (this.CONFIG.charts.comparison) this.CONFIG.charts.comparison.destroy();

                        this.CONFIG.charts.comparison = new Chart(ctx2, {
                            type: 'bar',
                            data: {
                                labels: ['Roth IRA (Net Value)', 'Traditional IRA (Net Value)'],
                                datasets: [{
                                    label: 'After-Tax Value',
                                    data: [totals.rothBalance, totals.tradBalanceNet],
                                    backgroundColor: ['var(--success)', 'var(--primary-dark)'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true, maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    y: { ticks: { color: themeColor, callback: (v) => app.UTILS.formatCurrency(v, 0) }, grid: { color: gridColor } },
                                    x: { ticks: { color: themeColor }, grid: { display: false } }
                                }
                            }
                        });
                        
                        // Update comparison tab text
                        document.getElementById('roth-balance-val').textContent = app.UTILS.formatCurrency(totals.rothBalance, 0);
                        document.getElementById('trad-balance-val').textContent = app.UTILS.formatCurrency(totals.tradBalanceNet, 0);
                        document.getElementById('roth-advantage-val').textContent = app.UTILS.formatCurrency(totals.advantage, 0);
                        document.getElementById('roth-advantage-box').className = totals.advantage > 0 ? 'detail-item success' : 'detail-item warning';
                    }
                },

                // Generate AI Insights (Requirement 2)
                generateAIInsights() {
                    const { inputs, totals } = this.CONFIG.calculation;
                    const contentBox = document.getElementById('ai-insights-content');
                    if (!contentBox) return;
                    const fmtd = app.UTILS.formatCurrency;

                    let html = '';

                    // 1. IRA Type Recommendation
                    if (inputs.firstYearTaxRate > totals.retirementTaxRate + 0.05) { // Significantly higher rate now
                        html += `
                            <div class="insight-box success">
                                <strong><i class="fas fa-check-circle"></i> AI Recommends: Traditional IRA</strong>
                                <p style="margin-top: 8px;">Your current tax rate (${(inputs.firstYearTaxRate * 100).toFixed(0)}%) is significantly higher than your estimated retirement rate (${(totals.retirementTaxRate * 100).toFixed(0)}%). A **Traditional IRA** is likely better, as you save more on taxes today than you'll pay later.</p>
                            </div>
                        `;
                    } else if (inputs.firstYearTaxRate < totals.retirementTaxRate - 0.05) { // Significantly lower rate now
                        html += `
                            <div class="insight-box success">
                                <strong><i class="fas fa-check-circle"></i> AI Recommends: Roth IRA</strong>
                                <p style="margin-top: 8px;">Your current tax rate (${(inputs.firstYearTaxRate * 100).toFixed(0)}%) is lower than your estimated retirement rate (${(totals.retirementTaxRate * 100).toFixed(0)}%). A **Roth IRA** is likely better. Pay taxes now while your rate is low and enjoy tax-free withdrawals later.</p>
                            </div>
                        `;
                    } else { // Similar rates
                         html += `
                            <div class="insight-box info">
                                <strong><i class="fas fa-balance-scale"></i> It's a Close Call!</strong>
                                <p style="margin-top: 8px;">Your current and estimated retirement tax rates are very similar. The **Roth IRA** is often preferred in this case for its tax-free growth and flexibility (no RMDs).</p>
                            </div>
                        `;
                    }

                    // 2. Contribution Strategy
                    if (inputs.contribution < inputs.maxContribution) {
                        const gap = inputs.maxContribution - inputs.contribution;
                        const futureGap = app.IRA.calculateFutureValue(gap, inputs.returnRate, inputs.retirementAge - inputs.age);
                        html += `
                            <div class="insight-box warning">
                                <strong><i class="fas fa-exclamation-triangle"></i> Maximize Your Contribution!</strong>
                                <p style="margin-top: 8px;">You're contributing ${fmtd(inputs.contribution, 0)}, but you're eligible for ${fmtd(inputs.maxContribution, 0)}. Closing this <strong>${fmtd(gap, 0)}/year</strong> gap could add an estimated <strong>${fmtd(futureGap, 0)}</strong> to your retirement balance!</p>
                            </div>
                        `;
                    } else {
                         html += `
                            <div class="insight-box success">
                                <strong><i class="fas fa-star"></i> Excellent! You're Maxing Out!</strong>
                                <p style="margin-top: 8px;">You are contributing the maximum allowed amount of <strong>${fmtd(inputs.maxContribution, 0)}</strong>. This is the single best way to accelerate your retirement goals.</p>
                            </div>
                        `;
                    }

                    // 3. Roth Eligibility Warning
                    if (inputs.firstYearRothEligibility < 1.0 && inputs.firstYearRothEligibility > 0) {
                         html += `
                            <div class="insight-box warning">
                                <strong><i class="fas fa-info-circle"></i> Roth Phase-Out Warning</strong>
                                <p style="margin-top: 8px;">Your income of ${fmtd(inputs.income, 0)} puts you in the Roth IRA phase-out range. You are only eligible to contribute <strong>${fmtd(inputs.maxContribution * inputs.firstYearRothEligibility, 0)}</strong> to a Roth IRA this year.</p>
                            </div>
                        `;
                    } else if (inputs.firstYearRothEligibility === 0) {
                         html += `
                            <div class="insight-box error">
                                <strong><i class="fas fa-times-circle"></i> Income Too High for Roth</strong>
                                <p style="margin-top: 8px;">Your income of ${fmtd(inputs.income, 0)} is above the limit for direct Roth IRA contributions. <strong>AI Suggestion:</strong> Look into a **Backdoor Roth IRA** strategy to contribute.</p>
                            </div>
                        `;
                    }
                    
                    // 4. Traditional Deduction Warning
                    if (inputs.firstYearTradDeduction < 1.0 && inputs.firstYearTradDeduction > 0) {
                         html += `
                            <div class="insight-box warning">
                                <strong><i class="fas fa-info-circle"></i> Traditional Deduction Phase-Out</strong>
                                <p style="margin-top: 8px;">Your income of ${fmtd(inputs.income, 0)} is in the phase-out range for *deducting* Traditional IRA contributions (assuming you have a workplace plan). You can only deduct <strong>${(inputs.firstYearTradDeduction * 100).toFixed(0)}%</strong> of your contribution.</p>
                            </div>
                        `;
                    } else if (inputs.firstYearTradDeduction === 0) {
                         html += `
                            <div class="insight-box error">
                                <strong><i class="fas fa-times-circle"></i> Income Too High for Deduction</strong>
                                <p style="margin-top: 8px;">Your income of ${fmtd(inputs.income, 0)} is too high to deduct Traditional IRA contributions (assuming you have a workplace plan). A **Roth IRA** or **Backdoor Roth IRA** is likely a better strategy.</p>
                            </div>
                        `;
                    }

                    contentBox.innerHTML = html;
                },
                
                // Helper for AI Insights
                calculateFutureValue(pmt, rate, years) {
                    if (rate === 0) return pmt * years;
                    return pmt * ((Math.pow(1 + rate, years) - 1) / rate);
                },

                // Fetch Inflation Data (Requirement 2 & 8)
                async fetchInflation() {
                    try {
                        const url = new URL(this.CONFIG.FRED_BASE_URL);
                        url.searchParams.append('series_id', this.CONFIG.FRED_SERIES_ID);
                        url.searchParams.append('api_key', this.CONFIG.FRED_API_KEY);
                        url.searchParams.append('file_type', 'json');
                        url.searchParams.append('sort_order', 'desc');
                        url.searchParams.append('limit', '13'); // Get 13 months for YoY
                        const response = await fetch(url.toString());
                        if (!response.ok) throw new Error('FRED API error');
                        const data = await response.json();
                        const observations = data.observations.filter(o => o.value && o.value !== '.');
                        if (observations.length >= 13) {
                            const latest = parseFloat(observations[0].value);
                            const prior = parseFloat(observations[12].value);
                            const rate = (latest - prior) / prior;
                            this.CONFIG.liveInflationRate = rate;
                            document.getElementById('inflation-rate').value = (rate * 100).toFixed(1);
                            console.log(`Live inflation rate (YoY) loaded: ${(rate * 100).toFixed(2)}%`);
                            return rate;
                        }
                    } catch (error) {
                        console.error('FRED API error:', error);
                        app.showAlert('API Error', 'Could not fetch live inflation data from FRED¬Æ. Using default value of 2.5%.');
                    }
                    this.CONFIG.liveInflationRate = 0.025; // Fallback
                    return 0.025;
                },
            }, // End app.IRA module
            
            // ===== App Controller Functions (From Mortgage Shell) =====

            // Utility functions
            UTILS: {
                formatCurrency(amount, decimals = 0) {
                    if (typeof amount !== 'number' || isNaN(amount)) return '$0';
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    }).format(amount);
                },
                parseInput(id, isCurrency = true) {
                    const el = document.getElementById(id);
                    if (!el) return 0;
                    const value = el.value;
                    if (isCurrency) {
                        const clean = value.replace(/[$,]/g, '').trim();
                        return parseFloat(clean) || 0;
                    }
                    return parseFloat(value) || 0;
                },
                trackEvent(eventName, eventData = {}) {
                    if (typeof gtag === 'function') {
                        gtag('event', eventName, eventData); // Requirement 7
                    }
                }
            },
            
            // App Initialization
            async init() {
                this.setupEventListeners();
                this.setupDarkMode();
                this.setupPWA();
                this.setupVoiceControls();
                this.setupFAQ();
                this.initTooltips(); 
                this.setupTabs();
                this.setupAlertModal();
                this.setupCookieConsent();
                Chart.register(Chart.controllers.bar, Chart.controllers.line, Chart.elements.point, Chart.elements.bar, Chart.elements.arc, Chart.plugins.legend, Chart.plugins.tooltip, Chart.scales.linear, Chart.scales.category, Chart.fillers.filler);

                await this.IRA.fetchInflation(); // Load inflation
                this.IRA.updateUI(); // Run initial calculation
            },

            // Setup main event listeners
            setupEventListeners() {
                const form = document.getElementById('ira-form');
                if (!form) return;

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.IRA.updateUI();
                });

                const debouncedCalc = () => {
                    clearTimeout(this.calculateDebounce);
                    this.calculateDebounce = setTimeout(() => this.IRA.updateUI(), 400);
                };
                
                form.querySelectorAll('input, select').forEach(el => {
                    el.addEventListener('input', debouncedCalc);
                    el.addEventListener('change', debouncedCalc);
                });

                document.getElementById('darkModeToggle').addEventListener('click', () => this.toggleDarkMode());
                document.getElementById('voiceToggle').addEventListener('click', () => this.toggleVoice());
                document.getElementById('ttsToggle').addEventListener('click', () => this.toggleTTS());
            },
            
            // Affiliate/Partner Click Tracking
            trackAffiliateClick(partner) {
                this.UTILS.trackEvent('affiliate_click', { partner_name: partner });
                this.showAlert('Affiliate Partner Link', `You are navigating to our partner, ${partner}. This is an affiliate link and helps support our free tools.`);
            },
            
            // Dark Mode
            setupDarkMode() {
                const toggle = document.getElementById('darkModeToggle');
                const icon = toggle.querySelector('i');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const saved = localStorage.getItem('colorScheme');
                
                const scheme = saved || (prefersDark ? 'dark' : 'light');
                document.documentElement.setAttribute('data-color-scheme', scheme);
                icon.className = scheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            },
            
            toggleDarkMode() {
                const toggle = document.getElementById('darkModeToggle');
                const icon = toggle.querySelector('i');
                const current = document.documentElement.getAttribute('data-color-scheme');
                const next = current === 'light' ? 'dark' : 'light';
                
                document.documentElement.setAttribute('data-color-scheme', next);
                localStorage.setItem('colorScheme', next);
                icon.className = next === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
                
                this.UTILS.trackEvent('theme_toggle', { theme: next });
                this.IRA.updateCharts(); // Re-render charts for new theme
            },

            // PWA Install
            setupPWA() {
                const pwaBtn = document.getElementById('pwa-install-btn');
                if (pwaBtn) {
                    pwaBtn.addEventListener('click', async () => {
                        if (window.deferredPrompt) {
                            window.deferredPrompt.prompt();
                            const { outcome } = await window.deferredPrompt.userChoice;
                            if (outcome === 'accepted') {
                                this.UTILS.trackEvent('pwa_installed');
                            }
                            window.deferredPrompt = null;
                            pwaBtn.style.display = 'none';
                        }
                    });
                }
            },

            // Voice & TTS (Requirement 3)
            setupVoiceControls() {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (SpeechRecognition) {
                    this.state.recognition = new SpeechRecognition();
                    this.state.recognition.continuous = false;
                    this.state.recognition.interimResults = false;
                    this.state.recognition.lang = 'en-US';
                    
                    this.state.recognition.onstart = () => { 
                        document.getElementById('voiceToggle').classList.add('active'); 
                    };
                    this.state.recognition.onend = () => { 
                        document.getElementById('voiceToggle').classList.remove('active'); 
                        this.state.isVoiceActive = false;
                    };
                    this.state.recognition.onerror = (event) => { 
                        console.error('Voice recognition error', event.error); 
                        this.showAlert('Voice Error', `Error: ${event.error}. Please ensure microphone access is allowed.`);
                    };
                    
                    this.state.recognition.onresult = (event) => {
                        const command = event.results[0][0].transcript.toLowerCase();
                        if (command.includes('calculate') || command.includes('analyze')) {
                            this.IRA.updateUI();
                        } else if (command.includes('read insights') || command.includes('read advice')) {
                            this.speakInsights();
                        } else if (command.includes('compare')) {
                            document.getElementById('ira-type').value = 'compare';
                            this.IRA.updateUI();
                        } else if (command.includes('show roth')) {
                            document.getElementById('ira-type').value = 'roth';
                            this.IRA.updateUI();
                        } else if (command.includes('show traditional')) {
                            document.getElementById('ira-type').value = 'traditional';
                            this.IRA.updateUI();
                        }
                    };
                }
                this.state.synthesizer = window.speechSynthesis;
            },
            
            toggleVoice() {
                if (!this.state.recognition) {
                    this.showAlert('Not Supported', 'Voice commands are not supported in this browser.');
                    return;
                }
                this.state.isVoiceActive = !this.state.isVoiceActive;
                if (this.state.isVoiceActive) {
                    try { this.state.recognition.start(); } catch(e) { console.error("Voice start error", e); this.state.isVoiceActive = false; }
                } else {
                    this.state.recognition.abort();
                }
                this.UTILS.trackEvent('voice_toggle', { active: this.state.isVoiceActive });
            },
            
            toggleTTS() {
                if (!this.state.synthesizer) {
                    this.showAlert('Not Supported', 'Text-to-Speech is not supported in this browser.');
                    return;
                }
                this.state.isTtsEnabled = !this.state.isTtsEnabled;
                const btn = document.getElementById('ttsToggle');
                
                if (this.state.isTtsEnabled) {
                    btn.classList.add('active');
                    this.speak('Text to speech enabled');
                } else {
                    btn.classList.remove('active');
                    this.state.synthesizer.cancel();
                }
                this.UTILS.trackEvent('tts_toggle', { active: this.state.isTtsEnabled });
            },
            
            speak(text) {
                if (!this.state.isTtsEnabled || !this.state.synthesizer) return;
                this.state.synthesizer.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                this.state.synthesizer.speak(utterance);
            },
            
            speakInsights() {
                const insightsContainer = document.getElementById('ai-insights-content');
                const firstInsight = insightsContainer.querySelector('.insight-box');
                if (firstInsight) {
                    this.speak(firstInsight.textContent);
                } else {
                    this.speak('No insights are available yet.');
                }
            },
            
            // WCAG Tabs (Requirement 10)
            setupTabs() {
                const tablist = document.querySelector('[role="tablist"]');
                if (!tablist) return;
                const tabs = tablist.querySelectorAll('[role="tab"]');
                
                tablist.addEventListener('click', (e) => {
                    const clickedTab = e.target.closest('[role="tab"]');
                    if (!clickedTab) return;
                    this.activateTab(clickedTab);
                });

                tablist.addEventListener('keydown', (e) => {
                    let index = Array.from(tabs).indexOf(document.activeElement);
                    if (index === -1) return;

                    let direction = 0;
                    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { direction = 1; }
                    else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') { direction = -1; }
                    else if (e.key === 'Home') { e.preventDefault(); tabs[0].focus(); }
                    else if (e.key === 'End') { e.preventDefault(); tabs[tabs.length - 1].focus(); }

                    if (direction !== 0) {
                        e.preventDefault();
                        index = (index + direction + tabs.length) % tabs.length;
                        tabs[index].focus();
                        this.activateTab(tabs[index]);
                    }
                });
            },
            
            activateTab(tab) {
                const tabId = tab.getAttribute('aria-controls');
                
                document.querySelectorAll('[role="tab"]').forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                    t.setAttribute('tabindex', '-1');
                });
                
                document.querySelectorAll('[role="tabpanel"]').forEach(p => {
                    p.classList.remove('active');
                });
                
                tab.classList.add('active');
                tab.setAttribute('aria-selected', 'true');
                tab.setAttribute('tabindex', '0');

                const panel = document.getElementById(tabId);
                panel.classList.add('active');
                
                this.UTILS.trackEvent('tab_view', { tab: tabId });

                if (tabId === 'tab-projection' || tabId === 'tab-comparison') {
                    this.IRA.updateCharts();
                }
            },
            
            // WCAG Accessible FAQ (Requirement 4 & 10)
            setupFAQ() {
                const container = document.getElementById('faqContainer');
                if(!container) return;

                const FAQs = [
                    { q: "What's the difference between a Roth and Traditional IRA?", a: "A **Traditional IRA** uses pre-tax dollars. You get a tax deduction *today*, your money grows tax-deferred, and you pay ordinary income tax on withdrawals in retirement. A **Roth IRA** uses post-tax dollars. You get no deduction today, but your money grows 100% tax-free, and all qualified withdrawals in retirement are also 100% tax-free." },
                    { q: "Which is better: Roth or Traditional IRA?", a: "It depends on your tax rate. **If you expect to be in a *higher* tax bracket in retirement than you are today, a Roth IRA is usually better.** You pay taxes now at your lower rate. **If you expect to be in a *lower* tax bracket in retirement, a Traditional IRA is often better.** You get the tax break now at your higher rate. This AI calculator analyzes this for you." },
                    { q: "What is the 2024 IRA contribution limit?", a: "For 2024, the total contribution limit for all your IRAs (Roth and Traditional combined) is <strong>$7,000</strong> if you are under age 50, and <strong>$8,000</strong> if you are age 50 or older (this includes the $1,000 'catch-up' contribution)." },
                    { q: "What is a MAGI limit?", a: "MAGI stands for Modified Adjusted Gross Income. The IRS uses your MAGI to determine if you are eligible to contribute to a Roth IRA or deduct contributions to a Traditional IRA. This calculator automatically checks your income against these limits." },
                    { q: "What is the Roth IRA income limit for 2024?", a: "For 2024, the ability to contribute to a Roth IRA phases out for single filers with a MAGI between **$146,000 and $161,000**. For those married filing jointly, the phase-out range is **$230,000 to $240,000**." },
                    { q: "What is a Backdoor Roth IRA?", a: "A Backdoor Roth IRA is a strategy used by high-income earners who are above the Roth MAGI limits. It involves making a non-deductible contribution to a Traditional IRA and then immediately converting it to a Roth IRA. This calculator's AI insights will suggest this if you are over the limit." },
                    { q: "Can I deduct my Traditional IRA contribution?", a: "It depends. If you (and your spouse, if married) do *not* have a retirement plan at work (like a 401(k)), you can deduct your full contribution. If you *do* have a workplace plan, your ability to deduct phases out based on your income. This calculator checks this for you." },
                    { q: "When can I withdraw money from my IRA?", a: "You can withdraw your contributions from a **Roth IRA** at any time, tax-free and penalty-free. You can withdraw *earnings* from a Roth IRA tax-free and penalty-free after age 59.5 (and after the account is 5 years old). For a **Traditional IRA**, any withdrawal before age 59.5 is typically subject to income tax *and* a 10% penalty." },
                    { q: "What is an RMD?", a: "RMD stands for Required Minimum Distribution. Starting at age 73, the IRS *requires* you to withdraw a certain amount from your Traditional IRA each year (so it can be taxed). **Roth IRAs do not have RMDs** for the original owner." }
                ];

                FAQs.forEach((faq, index) => {
                    const qId = `faq-q-${index}`;
                    const aId = `faq-a-${index}`;
                    
                    const item = document.createElement('div');
                    item.className = 'faq-item';
                    item.innerHTML = `
                        <button class="faq-question" role="button" aria-expanded="false" aria-controls="${aId}" id="${qId}">
                            <span>${faq.q}</span>
                            <span class="faq-icon" aria-hidden="true">‚ñº</span>
                        </button>
                        <div class="faq-answer" role="region" aria-labelledby="${qId}" id="${aId}">${faq.a}</div>
                    `;
                    container.appendChild(item);
                });
                
                container.addEventListener('click', (e) => {
                    const question = e.target.closest('.faq-question');
                    if (question) this.toggleFAQ(question);
                });
                
                container.addEventListener('keydown', (e) => {
                    const question = e.target.closest('.faq-question');
                    if (question && (e.key === 'Enter' || e.key === ' ')) {
                        e.preventDefault();
                        this.toggleFAQ(question);
                    }
                });
            },
            
            toggleFAQ(question) {
                const answer = document.getElementById(question.getAttribute('aria-controls'));
                const isActive = question.getAttribute('aria-expanded') === 'true';

                document.querySelectorAll('.faq-question[aria-expanded="true"]').forEach(q => {
                    if (q !== question) {
                        q.setAttribute('aria-expanded', 'false');
                        q.classList.remove('active');
                        document.getElementById(q.getAttribute('aria-controls')).style.display = 'none';
                        q.querySelector('.faq-icon').style.transform = 'rotate(0deg)';
                    }
                });

                if (!isActive) {
                    question.setAttribute('aria-expanded', 'true');
                    question.classList.add('active');
                    answer.style.display = 'block';
                    answer.style.animation = 'slideDown 0.3s ease';
                    question.querySelector('.faq-icon').style.transform = 'rotate(180deg)';
                } else {
                    question.setAttribute('aria-expanded', 'false');
                    question.classList.remove('active');
                    answer.style.display = 'none';
                    question.querySelector('.faq-icon').style.transform = 'rotate(0deg)';
                }
            },

            // WCAG Tooltips (Requirement 10)
            initTooltips() {
                let tooltipBox = null;
                document.querySelectorAll('.tooltip').forEach(el => {
                    const showTooltip = (e) => {
                        const text = e.currentTarget.getAttribute('data-tooltip');
                        if (!text) return;
                        if (tooltipBox) tooltipBox.remove();
                        
                        tooltipBox = document.createElement('div');
                        tooltipBox.className = 'tooltip-box';
                        tooltipBox.textContent = text;
                        tooltipBox.setAttribute('role', 'tooltip');
                        document.body.appendChild(tooltipBox);

                        const rect = e.currentTarget.getBoundingClientRect();
                        let top = rect.top - tooltipBox.offsetHeight - 5;
                        let left = rect.left + rect.width / 2 - tooltipBox.offsetWidth / 2;

                        if (top < 0) { top = rect.bottom + 5; }
                        if (left < 0) { left = 5; }
                        if (left + tooltipBox.offsetWidth > window.innerWidth) {
                            left = window.innerWidth - tooltipBox.offsetWidth - 5;
                        }

                        tooltipBox.style.left = `${left}px`;
                        tooltipBox.style.top = `${top}px`;
                        tooltipBox.style.display = 'block';
                        setTimeout(() => { if (tooltipBox) tooltipBox.style.opacity = '1'; }, 10);
                    };

                    const hideTooltip = () => {
                        if (tooltipBox) {
                            tooltipBox.style.opacity = '0';
                            setTimeout(() => {
                                if (tooltipBox) {
                                    tooltipBox.remove();
                                    tooltipBox = null;
                                }
                            }, 200);
                        }
                    };

                    el.addEventListener('mouseenter', showTooltip);
                    el.addEventListener('focus', showTooltip); 
                    el.addEventListener('mouseleave', hideTooltip);
                    el.addEventListener('blur', hideTooltip);
                });
            },

            // GDPR/CCPA Cookie Consent (Requirement 6 & 9)
            setupCookieConsent() {
                const banner = document.getElementById('cookie-consent-banner');
                const btn = document.getElementById('cookie-consent-btn');
                
                if (localStorage.getItem('cookieConsent') === 'true') {
                    banner.style.display = 'none';
                } else {
                    banner.style.display = 'flex';
                }
                
                btn.addEventListener('click', () => {
                    localStorage.setItem('cookieConsent', 'true');
                    banner.style.display = 'none';
                    this.UTILS.trackEvent('cookie_consent_given');
                });
            },
            
            // WCAG Alert Modal (Requirement 10)
            setupAlertModal() {
                const modal = document.getElementById('alert-modal');
                const backdrop = document.getElementById('alert-modal-backdrop');
                const closeBtn = document.getElementById('alert-modal-close');
                
                const closeModal = () => {
                    modal.classList.remove('visible');
                    backdrop.classList.remove('visible');
                };

                closeBtn.addEventListener('click', closeModal);
                backdrop.addEventListener('click', closeModal);
            },
            
            showAlert(title, message) {
                document.getElementById('alert-modal-title').textContent = title;
                document.getElementById('alert-modal-body').textContent = message;
                document.getElementById('alert-modal').classList.add('visible');
                document.getElementById('alert-modal-backdrop').classList.add('visible');
                document.getElementById('alert-modal-close').focus();
            },
        };

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => app.init());

        // ===== PWA Service Worker (Requirement 11) =====
        if ('serviceWorker' in navigator) {
            const OFFLINE_HTML = `
                <!DOCTYPE html>
                <html lang="en" style="font-family: Arial, sans-serif; background: #F5F7FA; color: #1F2121; padding: 20px;">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Offline | FinGuid IRA Calculator</title>
                    <style>
                        body { text-align: center; padding-top: 50px; }
                        h1 { color: #24ACB9; }
                        p { font-size: 1.1rem; line-height: 1.6; }
                        .icon { font-size: 4rem; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="icon">ü§ñ</div>
                    <h1>You are Offline</h1>
                    <p>This AI IRA Calculator needs an internet connection to function and fetch live inflation data.</p>
                    <p>Please check your connection and try again.</p>
                </body>
                </html>
            `;
            
            const swContent = `
                const CACHE_NAME = 'ira-calculator-v1';
                const urlsToCache = [
                    '.', 
                    'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                ];
                const OFFLINE_PAGE_CONTENT = \`${OFFLINE_HTML}\`;

                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                console.log('Service Worker: Opened cache');
                                return cache.addAll(urlsToCache);
                            })
                    );
                });

                self.addEventListener('fetch', event => {
                    if (event.request.mode !== 'navigate') {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    return response || fetch(event.request);
                                })
                        );
                        return;
                    }
                    
                    event.respondWith(
                        fetch(event.request)
                            .catch(() => {
                                return caches.match(event.request)
                                    .then(response => {
                                        return response || new Response(OFFLINE_PAGE_CONTENT, {
                                            headers: { 'Content-Type': 'text/html' }
                                        });
                                    });
                            })
                    );
                });
            `;
            const blob = new Blob([swContent], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);

            navigator.serviceWorker.register(swUrl)
                .then(reg => console.log('Service Worker registered.', reg))
                .catch(err => console.error('Service Worker registration failed:', err));
        }

        // ===== Global Error Handling (Requirement 10) =====
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.message, event.filename, event.lineno);
            app.showAlert('Application Error', 'A script on this page encountered an error. Please reload.');
        });
        window.addEventListener('unhandledrejection', (event) => {
             console.error('Unhandled promise rejection:', event.reason);
             app.showAlert('Application Error', 'An asynchronous operation failed. Please check your connection or reload.');
        });
    </script>
    </body>
</html>
